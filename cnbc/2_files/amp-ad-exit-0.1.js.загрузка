(self.AMP=self.AMP||[]).push({n:"amp-ad-exit",v:"2101120021000",m:0,f:(function(AMP,_){
'use strict';var h,aa="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function ba(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object");})()}ba(this);"function"===typeof Symbol&&Symbol("x");var p;
if("function"==typeof Object.setPrototypeOf)p=Object.setPrototypeOf;else{var q;a:{var ca={a:!0},r={};try{r.__proto__=ca;q=r.a;break a}catch(a){}q=!1}p=q?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var u=p;
function v(a,b){a.prototype=aa(b.prototype);a.prototype.constructor=a;if(u)u(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.V=b.prototype};function w(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}};var da=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function y(a){var b=Object.create(null);if(!a)return b;for(var c;c=da.exec(a);){var d=w(c[1],c[1]),e=c[2]?w(c[2].replace(/\+/g," "),c[2]):"";b[d]=e}return b};var z="";
function ea(){var a=self;if(a.__AMP_MODE)var b=a.__AMP_MODE;else{b=y(a.location.originalHash||a.location.hash);var c=y(a.location.search);z||(z=a.AMP_CONFIG&&a.AMP_CONFIG.v?a.AMP_CONFIG.v:"012101120021000");b={localDev:!1,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(b.development)||a.AMP_DEV_MODE),examiner:"2"==b.development,esm:!1,geoOverride:b["amp-geo"],minified:!0,lite:void 0!=c.amp_lite,test:!1,log:b.log,version:"2101120021000",rtvVersion:z};b=a.__AMP_MODE=b}return b};var fa=Object.prototype.toString;var A=self.AMP_CONFIG||{},ha=("string"==typeof A.cdnProxyRegex?new RegExp(A.cdnProxyRegex):A.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function B(a){if(self.document&&self.document.head&&(!self.location||!ha.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}A.cdnUrl||B("runtime-host");A.geoApiUrl||B("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var C=self.__AMP_LOG;function D(){if(!C.user)throw Error("failed to call initLogConstructor");return C.user}function E(){if(C.dev)return C.dev;throw Error("failed to call initLogConstructor");}function F(a,b,c,d){D().assert(a,b,c,d,void 0,void 0,void 0,void 0,void 0,void 0,void 0)};function G(a,b){this.name=a;this.type=b}G.prototype.filter=function(){};G.prototype.onLayoutMeasure=function(){};function ia(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function ja(a){a=H(a);a=I(a);return J(a,"url-replace")?K(a,"url-replace"):null}function L(a){return a.__AMP_TOP||(a.__AMP_TOP=a)}function H(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=L(b);a=K(b,"ampdoc").getAmpDoc(a)}return a}function I(a){a=H(a);return a.isSingleDoc()?a.win:a}function K(a,b){J(a,b);a=M(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function ka(a){var b;(b=M(a)["host-exit"])?b.promise?b=b.promise:(K(a,"host-exit"),b=b.promise=Promise.resolve(b.obj)):b=null;var c=b;if(c)return c;a=M(a);a["host-exit"]=la();return a["host-exit"].promise}function M(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function J(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)}
function la(){var a=new ia,b=a.promise,c=a.resolve;a=a.reject;b.catch(function(){});return{obj:null,promise:b,resolve:c,reject:a,context:null,ctor:null}};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function N(a,b,c){try{var d=a.open(b,c,void 0)}catch(f){E().error("DOM","Failed to open url on target: ",c,f)}if(!(c=d||"_top"==c)){var e;"number"!==typeof e&&(e=0);c=0<e+8?!1:-1!=="".indexOf("noopener",e)}c||a.open(b,"_top")};var P;function ma(a,b){var c=a,d=b;var e=function(k){try{return d(k)}catch(g){throw self.__AMP_REPORT_ERROR(g),g;}};var f=na();c.addEventListener("message",e,f?void 0:!1);return function(){c&&c.removeEventListener("message",e,f?void 0:!1);e=c=d=null}}function na(){if(void 0!==P)return P;P=!1;try{var a={get capture(){P=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return P};function oa(a,b){return ma(a,b)};var Q={bg:"https://tpc.googlesyndication.com/b4a/b4a-runner.html",moat:"https://z.moatads.com/ampanalytics093284/iframe.html"};Object.assign({},Q,{bg:"https://tpc.googlesyndication.com/b4a/experimental/b4a-runner.html"});function pa(a){F("object"==typeof a);if(a.filters){var b=a.filters,c=["clickDelay","clickLocation","inactiveElement"],d;for(d in b)F("object"==typeof b[d],"Filter specification '%s' is malformed",d),F(-1!=c.indexOf(b[d].type),"Supported filters: "+c.join(", "))}else a.filters={};if(a.transport){b=a.transport;for(var e in b)F("beacon"==e||"image"==e,"Unknown transport option: '"+e+"'"),F("boolean"==typeof b[e])}else a.transport={};e=a.targets;F("object"==typeof e,"'targets' must be an object");for(var f in e)qa(f,
e[f],a);return a}function qa(a,b,c){F("string"==typeof b.finalUrl,"finalUrl of target '%s' must be a string",a);b.filters&&b.filters.forEach(function(e){F(c.filters[e],"filter '%s' not defined",e)});if(b.vars){a=/^_[a-zA-Z0-9_-]+$/;for(var d in b.vars)F(a.test(d),"'%s' must match the pattern '%s'",d,a)}}function R(a){return D().assertString(Q[a],"Unknown or invalid vendor "+a+", note that vendor must use transport: iframe")};function S(a,b,c){G.call(this,a,b.type);F("clickDelay"==b.type&&"number"==typeof b.delay&&0<b.delay,"Invalid ClickDelay spec");this.spec=b;this.intervalStart=Date.now();b.startTimingEvent&&(c.performance&&c.performance.timing?void 0==c.performance.timing[b.startTimingEvent]?E().warn("amp-ad-exit","Invalid performance timing event type "+b.startTimingEvent+", falling back to now"):this.intervalStart=c.performance.timing[b.startTimingEvent]:E().warn("amp-ad-exit","Browser does not support performance timing, falling back to now"))}
v(S,G);S.prototype.filter=function(){return Date.now()-this.intervalStart>=this.spec.delay};function T(a){return{type:"clickDelay",delay:1E3,startTimingEvent:a}};function U(a,b,c){G.call(this,a,b.type);F("clickLocation"==b.type&&("undefined"===typeof b.left||"number"===typeof b.left)&&("undefined"===typeof b.right||"number"===typeof b.right)&&("undefined"===typeof b.top||"number"===typeof b.top)&&("undefined"===typeof b.bottom||"number"===typeof b.bottom)&&("undefined"===typeof b.relativeTo||"string"===typeof b.relativeTo),"Invaid ClickLocation spec");this.R=b.left||0;this.S=b.right||0;this.U=b.top||0;this.O=b.bottom||0;this.I=b.relativeTo;this.L=c;this.h=
{top:0,right:0,bottom:0,left:0}}v(U,G);U.prototype.filter=function(a){return a.clientX>=this.h.left&&a.clientX<=this.h.right&&a.clientY>=this.h.top&&a.clientY<=this.h.bottom?!0:!1};
U.prototype.onLayoutMeasure=function(){var a=this;this.L.getVsync().measure(function(){var b=a.L.win;if(a.I){var c=b.document.querySelector(a.I);F(c,"relativeTo element "+a.I+" not found.");var d=c.getBoundingClientRect();a.h.left=d.left;a.h.top=d.top;a.h.bottom=d.bottom;a.h.right=d.right}else a.h.left=0,a.h.top=0,a.h.bottom=b.innerHeight,a.h.right=b.innerWidth;a.h.left+=a.R;a.h.top+=a.U;a.h.right-=a.S;a.h.bottom-=a.O})};function V(a,b){G.call(this,a,b.type);F("inactiveElement"==b.type&&"string"==typeof b.selector,"Invalid InactiveElementspec");this.T=b.selector}v(V,G);V.prototype.filter=function(a){a=a.target;var b=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return!(b&&b.call(a,this.T))};function W(a,b,c){switch(b.type){case "clickDelay":return new S(a,b,c.win);case "clickLocation":return new U(a,b,c);case "inactiveElement":return new V(a,b)}};function ra(a,b){try{a:{var c=(a.ownerDocument||a).defaultView,d=b||L(c);if(c&&c!=d&&L(c)==d)try{var e=c.frameElement;break a}catch(k){}e=null}var f=e.parentElement;if("AMP-AD"==f.nodeName)return String(f.getResourceId())}catch(k){}return null};function X(){this.P=100;this.G=this.J=0;this.A=Object.create(null)}X.prototype.has=function(a){return!!this.A[a]};X.prototype.get=function(a){var b=this.A[a];if(b)return b.access=++this.G,b.payload};X.prototype.put=function(a,b){this.has(a)||this.J++;this.A[a]={payload:b,access:this.G};if(!(this.J<=this.P)){E().warn("lru-cache","Trimming LRU cache");a=this.A;var c=this.G+1,d;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.J--)}};(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0});var Y,sa;
function ta(a){Y||(Y=self.document.createElement("a"),sa=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new X));var b=sa,c=Y;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=
c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a};function Z(a){a=AMP.BaseElement.call(this,a)||this;a.K={};a.M={};a.B=[];a.C={beacon:!0,image:!0};a.F={};a.registerAction("exit",a.exit.bind(a));a.registerAction("setVariable",a.setVariable.bind(a),1);a.N={};a.D=null;a.o=null;a.H={};return a}v(Z,AMP.BaseElement);h=Z.prototype;
h.exit=function(a){var b=this,c=a.args,d=a.event;F("variable"in c!="target"in c,"One and only one of 'target' and 'variable' must be specified");var e;"variable"in c?((e=this.M[c.variable])||(e=c["default"]),F(e,"Variable target not found, variable:'"+c.variable+"', default:'"+c["default"]+"'"),delete c["default"]):e=c.target;var f=this.K[e];F(f,"Exit target not found: '"+e+"'");F(d,"Unexpected null event");d.preventDefault();if(ua(this.B,d)&&ua(f.filters,d)){var k=va(this,c,d,f);f.trackingUrls&&
f.trackingUrls.map(k).forEach(function(l){D().fine("amp-ad-exit","pinging "+l);b.C.beacon&&b.win.navigator.sendBeacon&&b.win.navigator.sendBeacon(l,"")||!b.C.image||(b.win.document.createElement("img").src=l)});var g=k(f.finalUrl);H(this.getAmpDoc()).getHeadNode().querySelector("script[host-service]")?ka(I(this.getAmpDoc())).then(function(l){return l.openUrl(g)}).catch(function(l){E().fine("amp-ad-exit","ExitServiceError - fallback="+l.fallback);l.fallback&&N(b.win,g,"_blank")}):N(this.win,g,f.behaviors&&
f.behaviors.clickTarget&&"_top"==f.behaviors.clickTarget?"_top":"_blank")}};h.setVariable=function(a){a=a.args;F(this.K[a.target],"Exit target not found: '"+a.target+"'");this.M[a.name]=a.target};
function va(a,b,c,d){var e={CLICK_X:function(){return c.clientX},CLICK_Y:function(){return c.clientY}},f=ja(a.element),k={RANDOM:!0,CLICK_X:!0,CLICK_Y:!0};if(d.vars){var g={},l;for(l in d.vars)g.j=l,"_"==g.j[0]&&(g.l=d.vars[g.j],g.l&&(e[g.j]=function(m){return function(){if(m.l.iframeTransportSignal){var t=f.expandStringSync(m.l.iframeTransportSignal,{IFRAME_TRANSPORT_SIGNAL:function(x,n){if(!x||!n)return"";var O=a.N[x];if(O&&n in O)return O[n]}});if(m.l.iframeTransportSignal=="IFRAME_TRANSPORT_SIGNAL"+
t)E().error("amp-ad-exit","Invalid IFRAME_TRANSPORT_SIGNAL format:"+t+" (perhaps there is a space after a comma?)");else if(""!=t)return t}return m.j in b?b[m.j]:m.l.defaultValue}}(g),k[g.j]=!0)),g={l:g.l,j:g.j}}return function(m){return f.expandUrlSync(m,e,k)}}function ua(a,b){return a.every(function(c){var d=c.filter(b);D().info("amp-ad-exit","Filter '"+c.name+"': "+(d?"pass":"fail"));return d})}
h.buildCallback=function(){var a=this;this.element.setAttribute("aria-hidden","true");this.B.push(W("minDelay",T(),this));this.B.push(W("carouselBtns",{type:"inactiveElement",selector:".amp-carousel-button"},this));var b=this.element.children;F(1==b.length,"The tag should contain exactly one <script> child.");b=b[0];F("SCRIPT"==b.tagName&&b.hasAttribute("type")&&"APPLICATION/JSON"==b.getAttribute("type").toUpperCase(),'The amp-ad-exit config should be inside a <script> tag with type="application/json"');
try{var c=pa(JSON.parse(b.textContent));if("[object Object]"===fa.call(c.options)&&"string"===typeof c.options.startTimingEvent){var d=c.options.startTimingEvent;this.B.splice(0,1,W("minDelay",T(c.options.startTimingEvent),this))}for(var e in c.filters){var f=c.filters[e];"clickDelay"==f.type&&(f.startTimingEvent=f.startTimingEvent||d);this.F[e]=W(e,f,this)}for(var k in c.targets){var g=c.targets[k];this.K[k]={finalUrl:g.finalUrl,trackingUrls:g.trackingUrls||[],vars:g.vars||{},filters:(g.filters||
[]).map(function(n){return a.F[n]}).filter(function(n){return n}),behaviors:g.behaviors||{}};for(var l in g.vars)if(g.vars[l].iframeTransportSignal){var m=g.vars[l].iframeTransportSignal.match(/IFRAME_TRANSPORT_SIGNAL\(([^,]+)/);if(m&&!(2>m.length)){var t=m[1],x=ta(R(t)).origin;this.H[x]=this.H[x]||t}}}this.C.beacon=!1!==c.transport.beacon;this.C.image=!1!==c.transport.image}catch(n){throw this.user().error("amp-ad-exit","Invalid JSON config",n),n;}wa(this)};h.resumeCallback=function(){wa(this)};
h.unlayoutCallback=function(){this.D&&(this.D(),this.D=null);return AMP.BaseElement.prototype.unlayoutCallback.call(this)};
function wa(a){"inabox"!=ea().runtime&&(a.o=a.o||ra(a.element,L(a.win)),a.o?a.D=oa(a.getAmpDoc().win,function(b){if(a.H[b.origin]){var c=b.data;if("string"==typeof c&&0==c.indexOf("amp-")&&-1!=c.indexOf("{")){var d=c.indexOf("{");try{var e=JSON.parse(c.substr(d))}catch(k){E().error("MESSAGING","Failed to parse message: "+c,k),e=null}}else e=null;var f=e;f&&"iframe-transport-response"==f.type&&(b=b.origin,F(f.message,"Received empty response from 3p analytics frame"),F(f.creativeId,"Received malformed message from 3p analytics frame: creativeId missing"),
F(f.vendor,"Received malformed message from 3p analytics frame: vendor missing"),e=ta(R(f.vendor)),F(e&&e.origin==b,"Invalid origin for vendor "+(f.vendor+": "+b)),f.creativeId==a.o&&(a.N[f.vendor]=f.message))}}):D().warn("amp-ad-exit","No friendly parent amp-ad element was found for amp-ad-exit; not in inabox case."))}h.isLayoutSupported=function(){return!0};h.onLayoutMeasure=function(){for(var a in this.F)this.F[a].onLayoutMeasure()};(function(a){a.registerElement("amp-ad-exit",Z)})(self.AMP);
})});

//# sourceMappingURL=amp-ad-exit-0.1.js.map
