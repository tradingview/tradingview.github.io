try{!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=101)}([function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=function(){Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t,this)};var e=function(){var e,t,i,o,r,s,a=[],l=a.slice,c=a.filter,d=window.document,u={},h={},f={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},p=/^\s*<(\w+|!)[^>]*>/,m=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,g=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,y=/^(?:body|html)$/i,v=/([A-Z])/g,b=["val","css","html","text","data","width","height","offset"],_=d.createElement("table"),S=d.createElement("tr"),w={tr:d.createElement("tbody"),tbody:_,thead:_,tfoot:_,td:S,th:S,"*":d.createElement("div")},A=/complete|loaded|interactive/,T=/^[\w-]*$/,P={},C=P.toString,E={},k=d.createElement("div"),O={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},I=Array.isArray||function(e){return e instanceof Array};function V(e){return null==e?String(e):P[C.call(e)]||"object"}function D(e){return"function"==V(e)}function R(e){return null!=e&&e==e.window}function x(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function N(e){return"object"==V(e)}function M(e){return N(e)&&!R(e)&&Object.getPrototypeOf(e)==Object.prototype}function F(e){return"number"==typeof e.length}function L(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function B(e){return e in h?h[e]:h[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function j(e,t){return"number"!=typeof t||f[L(e)]?t:t+"px"}function U(e){return"children"in e?l.call(e.children):i.map(e.childNodes,(function(e){if(1==e.nodeType)return e}))}function W(i,n,o){for(t in n)o&&(M(n[t])||I(n[t]))?(M(n[t])&&!M(i[t])&&(i[t]={}),I(n[t])&&!I(i[t])&&(i[t]=[]),W(i[t],n[t],o)):n[t]!==e&&(i[t]=n[t])}function H(e,t){return null==t?i(e):i(e).filter(t)}function $(e,t,i,n){return D(t)?t.call(e,i,n):t}function z(e,t,i){try{null==i?e.removeAttribute(t):e.setAttribute(t,i)}catch(e){}}function G(t,i){var n=t.className||"",o=n&&n.baseVal!==e;if(i===e)return o?n.baseVal:n;o?n.baseVal=i:t.className=i}function q(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?i.parseJSON(e):e):e}catch(t){return e}}function Y(e,t){t(e);for(var i=0,n=e.childNodes.length;i<n;i++)Y(e.childNodes[i],t)}return E.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var i=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(i)return i.call(e,t);var n,o=e.parentNode,r=!o;return r&&(o=k).appendChild(e),n=~E.qsa(o,t).indexOf(e),r&&k.removeChild(e),n},r=function(e){return e.replace(/-+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},s=function(e){return c.call(e,(function(t,i){return e.indexOf(t)==i}))},E.fragment=function(t,n,o){var r,s,a;return m.test(t)&&(r=i(d.createElement(RegExp.$1))),r||(t.replace&&(t=t.replace(g,"<$1></$2>")),n===e&&(n=p.test(t)&&RegExp.$1),n in w||(n="*"),(a=w[n]).innerHTML=""+t,r=i.each(l.call(a.childNodes),(function(){a.removeChild(this)}))),M(o)&&(s=i(r),i.each(o,(function(e,t){b.indexOf(e)>-1?s[e](t):s.attr(e,t)}))),r},E.Z=function(e,t){return(e=e||[]).__proto__=i.fn,e.selector=t||"",e},E.isZ=function(e){return e instanceof E.Z},E.init=function(t,n){var o,r;if(!t)return E.Z();if("string"==typeof t)if("<"==(t=t.trim())[0]&&p.test(t))o=E.fragment(t,RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);o=E.qsa(d,t)}else{if(D(t))return i(d).ready(t);if(E.isZ(t))return t;if(I(t))r=t,o=c.call(r,(function(e){return null!=e}));else if(N(t))o=[t],t=null;else if(p.test(t))o=E.fragment(t.trim(),RegExp.$1,n),t=null;else{if(n!==e)return i(n).find(t);o=E.qsa(d,t)}}return E.Z(o,t)},(i=function(e,t){return E.init(e,t)}).extend=function(e){try{window.TRC&&window.TRC.performance&&window.TRC.performance.mark&&window.TRC.PerfEvenType&&window.TRC.performance.mark("videoExtendFuncStart",null,"","","videoExtendFunc",window.TRC.PerfEvenType.START)}catch(e){}var t,i=l.call(arguments,1);"boolean"==typeof e&&(t=e,e=i.shift()),i.forEach((function(i){W(e,i,t)}));try{window.TRC&&window.TRC.performance&&window.TRC.performance.mark&&window.TRC.PerfEvenType&&window.TRC.performance.mark("videoExtendFuncStop",null,"","","videoExtendFunc",window.TRC.PerfEvenType.STOP)}catch(e){}return e},E.qsa=function(e,t){var i,n="#"==t[0],o=!n&&"."==t[0],r=n||o?t.slice(1):t,s=T.test(r);return x(e)&&s&&n?(i=e.getElementById(r))?[i]:[]:1!==e.nodeType&&9!==e.nodeType?[]:l.call(s&&!n?o?e.getElementsByClassName(r):e.getElementsByTagName(t):e.querySelectorAll(t))},i.contains=d.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},i.type=V,i.isFunction=D,i.isWindow=R,i.isArray=I,i.isPlainObject=M,i.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},i.inArray=function(e,t,i){return a.indexOf.call(t,e,i)},i.camelCase=r,i.trim=function(e){return null==e?"":String.prototype.trim.call(e)},i.uuid=0,i.support={},i.expr={},i.map=function(e,t){var n,o,r,s,a=[];if(F(e))for(o=0;o<e.length;o++)null!=(n=t(e[o],o))&&a.push(n);else for(r in e)null!=(n=t(e[r],r))&&a.push(n);return(s=a).length>0?i.fn.concat.apply([],s):s},i.each=function(e,t){var i,n;if(F(e)){for(i=0;i<e.length;i++)if(!1===t.call(e[i],i,e[i]))return e}else for(n in e)if(!1===t.call(e[n],n,e[n]))return e;return e},i.grep=function(e,t){return c.call(e,t)},window.JSON&&(i.parseJSON=JSON.parse),i.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(function(e,t){P["[object "+t+"]"]=t.toLowerCase()})),i.fn={forEach:a.forEach,reduce:a.reduce,push:a.push,sort:a.sort,indexOf:a.indexOf,concat:a.concat,map:function(e){return i(i.map(this,(function(t,i){return e.call(t,i,t)})))},slice:function(){return i(l.apply(this,arguments))},ready:function(e){return A.test(d.readyState)&&d.body?e(i):d.addEventListener("DOMContentLoaded",(function(){e(i)}),!1),this},get:function(t){return t===e?l.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each((function(){null!=this.parentNode&&this.parentNode.removeChild(this)}))},each:function(e){return a.every.call(this,(function(t,i){return!1!==e.call(t,i,t)})),this},filter:function(e){return D(e)?this.not(this.not(e)):i(c.call(this,(function(t){return E.matches(t,e)})))},add:function(e,t){return i(s(this.concat(i(e,t))))},is:function(e){return this.length>0&&E.matches(this[0],e)},not:function(t){var n=[];if(D(t)&&t.call!==e)this.each((function(e){t.call(this,e)||n.push(this)}));else{var o="string"==typeof t?this.filter(t):F(t)&&D(t.item)?l.call(t):i(t);this.forEach((function(e){o.indexOf(e)<0&&n.push(e)}))}return i(n)},has:function(e){return this.filter((function(){return N(e)?i.contains(this,e):i(this).find(e).size()}))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!N(e)?e:i(e)},last:function(){var e=this[this.length-1];return e&&!N(e)?e:i(e)},find:function(e){var t=this;return e?"object"==n(e)?i(e).filter((function(){var e=this;return a.some.call(t,(function(t){return i.contains(t,e)}))})):1==this.length?i(E.qsa(this[0],e)):this.map((function(){return E.qsa(this,e)})):i()},closest:function(e,t){var o=this[0],r=!1;for("object"==n(e)&&(r=i(e));o&&!(r?r.indexOf(o)>=0:E.matches(o,e));)o=o!==t&&!x(o)&&o.parentNode;return i(o)},parents:function(e){for(var t=[],n=this;n.length>0;)n=i.map(n,(function(e){if((e=e.parentNode)&&!x(e)&&t.indexOf(e)<0)return t.push(e),e}));return H(t,e)},parent:function(e){return H(s(this.pluck("parentNode")),e)},children:function(e){return H(this.map((function(){return U(this)})),e)},contents:function(){return this.map((function(){return l.call(this.childNodes)}))},siblings:function(e){return H(this.map((function(e,t){return c.call(U(t.parentNode),(function(e){return e!==t}))})),e)},empty:function(){return this.each((function(){this.innerHTML=""}))},pluck:function(e){return i.map(this,(function(t){return t[e]}))},show:function(){return this.each((function(){var e,t,i;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(e=this.nodeName,u[e]||(t=d.createElement(e),d.body.appendChild(t),i=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==i&&(i="block"),u[e]=i),u[e]))}))},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=D(e);if(this[0]&&!t)var n=i(e).get(0),o=n.parentNode||this.length>1;return this.each((function(r){i(this).wrapAll(t?e.call(this,r):o?n.cloneNode(!0):n)}))},wrapAll:function(e){if(this[0]){var t;for(i(this[0]).before(e=i(e));(t=e.children()).length;)e=t.first();i(e).append(this)}return this},wrapInner:function(e){var t=D(e);return this.each((function(n){var o=i(this),r=o.contents(),s=t?e.call(this,n):e;r.length?r.wrapAll(s):o.append(s)}))},unwrap:function(){return this.parent().each((function(){i(this).replaceWith(i(this).children())})),this},clone:function(){return this.map((function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(t){return this.each((function(){var n=i(this);(t===e?"none"==n.css("display"):t)?n.show():n.hide()}))},prev:function(e){return i(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return i(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each((function(t){var n=this.innerHTML;i(this).empty().append($(this,e,t,n))})):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each((function(t){var i=$(this,e,t,this.textContent);this.textContent=null==i?"":""+i})):0 in this?this[0].textContent:null},attr:function(i,n){var o;return"string"!=typeof i||1 in arguments?this.each((function(e){if(1===this.nodeType)if(N(i))for(t in i)z(this,t,i[t]);else z(this,i,$(this,n,e,this.getAttribute(i)))})):this.length&&1===this[0].nodeType?!(o=this[0].getAttribute(i))&&i in this[0]?this[0][i]:o:e},removeAttr:function(e){return this.each((function(){1===this.nodeType&&e.split(" ").forEach((function(e){z(this,e)}),this)}))},prop:function(e,t){return e=O[e]||e,1 in arguments?this.each((function(i){this[e]=$(this,t,i,this[e])})):this[0]&&this[0][e]},data:function(t,i){var n="data-"+t.replace(v,"-$1").toLowerCase(),o=1 in arguments?this.attr(n,i):this.attr(n);return null!==o?q(o):e},val:function(e){return 0 in arguments?this.each((function(t){this.value=$(this,e,t,this.value)})):this[0]&&(this[0].multiple?i(this[0]).find("option").filter((function(){return this.selected})).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each((function(t){var n=i(this),o=$(this,e,t,n.offset()),r=n.offsetParent().offset(),s={top:o.top-r.top,left:o.left-r.left};"static"==n.css("position")&&(s.position="relative"),n.css(s)}));if(!this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,n){if(arguments.length<2){var o,s=this[0];if(!s)return;if(o=getComputedStyle(s,""),"string"==typeof e)return s.style[r(e)]||o.getPropertyValue(e);if(I(e)){var a={};return i.each(e,(function(e,t){a[t]=s.style[r(t)]||o.getPropertyValue(t)})),a}}var l="";if("string"==V(e))n||0===n?l=L(e)+":"+j(e,n):this.each((function(){this.style.removeProperty(L(e))}));else for(t in e)e[t]||0===e[t]?l+=L(t)+":"+j(t,e[t])+";":this.each((function(){this.style.removeProperty(L(t))}));return this.each((function(){this.style.cssText+=";"+l}))},index:function(e){return e?this.indexOf(i(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&a.some.call(this,(function(e){return this.test(G(e))}),B(e))},addClass:function(e){return e?this.each((function(t){if("className"in this){o=[];var n=G(this);$(this,e,t,n).split(/\s+/g).forEach((function(e){i(this).hasClass(e)||o.push(e)}),this),o.length&&G(this,n+(n?" ":"")+o.join(" "))}})):this},removeClass:function(t){return this.each((function(i){if("className"in this){if(t===e)return G(this,"");o=G(this),$(this,t,i,o).split(/\s+/g).forEach((function(e){o=o.replace(B(e)," ")})),G(this,o.trim())}}))},toggleClass:function(t,n){return t?this.each((function(o){var r=i(this);$(this,t,o,G(this)).split(/\s+/g).forEach((function(t){(n===e?!r.hasClass(t):n)?r.addClass(t):r.removeClass(t)}))})):this},scrollTop:function(t){if(this.length){var i="scrollTop"in this[0];return t===e?i?this[0].scrollTop:this[0].pageYOffset:this.each(i?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var i="scrollLeft"in this[0];return t===e?i?this[0].scrollLeft:this[0].pageXOffset:this.each(i?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),o=y.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(i(e).css("margin-top"))||0,n.left-=parseFloat(i(e).css("margin-left"))||0,o.top+=parseFloat(i(t[0]).css("border-top-width"))||0,o.left+=parseFloat(i(t[0]).css("border-left-width"))||0,{top:n.top-o.top,left:n.left-o.left}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent||d.body;e&&!y.test(e.nodeName)&&"static"==i(e).css("position");)e=e.offsetParent;return e}))}},i.fn.detach=i.fn.remove,["width","height"].forEach((function(t){var n=t.replace(/./,(function(e){return e[0].toUpperCase()}));i.fn[t]=function(o){var r,s=this[0];return o===e?R(s)?s["inner"+n]:x(s)?s.documentElement["scroll"+n]:(r=this.offset())&&r[t]:this.each((function(e){(s=i(this)).css(t,$(this,o,e,s[t]()))}))}})),["after","prepend","before","append"].forEach((function(e,t){var n=t%2;i.fn[e]=function(){var e,o,r=i.map(arguments,(function(t){return"object"==(e=V(t))||"array"==e||null==t?t:E.fragment(t)})),s=this.length>1;return r.length<1?this:this.each((function(e,a){o=n?a:a.parentNode,a=0==t?a.nextSibling:1==t?a.firstChild:2==t?a:null;var l=i.contains(d.documentElement,o);r.forEach((function(e){if(s)e=e.cloneNode(!0);else if(!o)return i(e).remove();o.insertBefore(e,a),l&&Y(e,(function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)}))}))}))},i.fn[n?e+"To":"insert"+(t?"Before":"After")]=function(t){return i(t)[e](this),this}})),E.Z.prototype=i.fn,E.uniq=s,E.deserializeValue=q,i.zepto=E,i}(),t=e;return function(e){var t,i=1,n=Array.prototype.slice,o=e.isFunction,r=function(e){return"string"==typeof e},s={},a={},l="onfocusin"in window,c={focus:"focusin",blur:"focusout"},d={mouseenter:"mouseover",mouseleave:"mouseout"};function u(e){return e._zid||(e._zid=i++)}function h(e,t,i,n){if((t=f(t)).ns)var o=(r=t.ns,new RegExp("(?:^| )"+r.replace(" "," .* ?")+"(?: |$)"));var r;return(s[u(e)]||[]).filter((function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!i||u(e.fn)===u(i))&&(!n||e.sel==n)}))}function f(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function p(e,t){return e.del&&!l&&e.e in c||!!t}function m(e){return d[e]||l&&c[e]||e}function g(i,n,o,r,a,l,c){var h=u(i),g=s[h]||(s[h]=[]);n.split(/\s/).forEach((function(n){if("ready"==n)return e(document).ready(o);var s=f(n);s.fn=o,s.sel=a,s.e in d&&(o=function(t){var i=t.relatedTarget;if(!i||i!==this&&!e.contains(this,i))return s.fn.apply(this,arguments)}),s.del=l;var u=l||o;s.proxy=function(e){if(!(e=w(e)).isImmediatePropagationStopped()){e.data=r;var n=u.apply(i,e._args==t?[e]:[e].concat(e._args));return!1===n&&(e.preventDefault(),e.stopPropagation()),n}},s.i=g.length,g.push(s),"addEventListener"in i&&i.addEventListener(m(s.e),s.proxy,p(s,c))}))}function y(e,t,i,n,o){var r=u(e);(t||"").split(/\s/).forEach((function(t){h(e,t,i,n).forEach((function(t){delete s[r][t.i],"removeEventListener"in e&&e.removeEventListener(m(t.e),t.proxy,p(t,o))}))}))}a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",e.event={add:g,remove:y},e.proxy=function(t,i){var s=2 in arguments&&n.call(arguments,2);if(o(t)){var a=function(){return t.apply(i,s?s.concat(n.call(arguments)):arguments)};return a._zid=u(t),a}if(r(i))return s?(s.unshift(t[i],t),e.proxy.apply(null,s)):e.proxy(t[i],t);throw new TypeError("expected function")},e.fn.bind=function(e,t,i){return this.on(e,t,i)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,i,n){return this.on(e,t,i,n,1)};var v=function(){return!0},b=function(){return!1},_=/^([A-Z]|returnValue$|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function w(i,n){return!n&&i.isDefaultPrevented||(n||(n=i),e.each(S,(function(e,t){var o=n[e];i[e]=function(){return this[t]=v,o&&o.apply(n,arguments)},i[t]=b})),(n.defaultPrevented!==t?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(i.isDefaultPrevented=v)),i}function A(e){var i,n={originalEvent:e};for(i in e)_.test(i)||e[i]===t||(n[i]=e[i]);return w(n,e)}e.fn.delegate=function(e,t,i){return this.on(t,e,i)},e.fn.undelegate=function(e,t,i){return this.off(t,e,i)},e.fn.live=function(t,i){return e(document.body).delegate(this.selector,t,i),this},e.fn.die=function(t,i){return e(document.body).undelegate(this.selector,t,i),this},e.fn.on=function(i,s,a,l,c){var d,u,h=this;return i&&!r(i)?(e.each(i,(function(e,t){h.on(e,s,a,t,c)})),h):(r(s)||o(l)||!1===l||(l=a,a=s,s=t),(o(a)||!1===a)&&(l=a,a=t),!1===l&&(l=b),h.each((function(t,o){c&&(d=function(e){return y(o,e.type,l),l.apply(this,arguments)}),s&&(u=function(t){var i,r=e(t.target).closest(s,o).get(0);if(r&&r!==o)return i=e.extend(A(t),{currentTarget:r,liveFired:o}),(d||l).apply(r,[i].concat(n.call(arguments,1)))}),g(o,i,l,a,s,u||d)})))},e.fn.off=function(i,n,s){var a=this;return i&&!r(i)?(e.each(i,(function(e,t){a.off(e,n,t)})),a):(r(n)||o(s)||!1===s||(s=n,n=t),!1===s&&(s=b),a.each((function(){y(this,i,s,n)})))},e.fn.trigger=function(t,i){return(t=r(t)||e.isPlainObject(t)?e.Event(t):w(t))._args=i,this.each((function(){t.type in c&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,i)}))},e.fn.triggerHandler=function(t,i){var n,o;return this.each((function(s,a){(n=A(r(t)?e.Event(t):t))._args=i,n.target=a,e.each(h(a,t.type||t),(function(e,t){if(o=t.proxy(n),n.isImmediatePropagationStopped())return!1}))})),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach((function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}})),e.Event=function(e,t){r(e)||(e=(t=e).type);var i=document.createEvent(a[e]||"Events"),n=!0;if(t)for(var o in t)"bubbles"==o?n=!!t[o]:i[o]=t[o];return i.initEvent(e,n,!0),w(i)}}(e),function(e){var t,i,n=0,o=window.document,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,s=/^(?:text|application)\/javascript/i,a=/^(?:text|application)\/xml/i,l="application/json",c="text/html",d=/^\s*$/,u=o.createElement("a");function h(t,i,n,r){if(t.global)return function(t,i,n){var o=e.Event(i);return e(t).trigger(o,n),!o.isDefaultPrevented()}(i||o,n,r)}function f(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t)||!1===h(t,i,"ajaxBeforeSend",[e,t]))return!1;h(t,i,"ajaxSend",[e,t])}function p(e,t,i,n){var o=i.context,r="success";i.success.call(o,e,r,t),n&&n.resolveWith(o,[e,r,t]),h(i,o,"ajaxSuccess",[t,i,e]),g(r,t,i)}function m(e,t,i,n,o){var r=n.context;n.error.call(r,i,t,e),o&&o.rejectWith(r,[i,t,e]),h(n,r,"ajaxError",[i,n,e||t]),g(t,i,n)}function g(t,i,n){var o=n.context;n.complete.call(o,i,t),h(n,o,"ajaxComplete",[i,n]),function(t){t.global&&!--e.active&&h(t,null,"ajaxStop")}(n)}function y(){}function v(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function b(t,i,n,o){return e.isFunction(i)&&(o=n,n=i,i=void 0),e.isFunction(n)||(o=n,n=void 0),{url:t,data:i,success:n,dataType:o}}u.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,i){if(!("type"in t))return e.ajax(t);var r,s,a=t.jsonpCallback,l=(e.isFunction(a)?a():a)||"jsonp"+ ++n,c=o.createElement("script"),d=window[l],u=function(t){e(c).triggerHandler("error",t||"abort")},h={abort:u};return i&&i.promise(h),e(c).on("load error",(function(n,o){clearTimeout(s),e(c).off().remove(),"error"!=n.type&&r?p(r[0],h,t,i):m(null,o||"error",h,t,i),window[l]=d,r&&e.isFunction(d)&&d(r[0]),d=r=void 0})),!1===f(h,t)?(u("abort"),h):(window[l]=function(){r=arguments},c.src=t.url.replace(/\?(.+)=\?/,"?$1="+l),o.head.appendChild(c),t.timeout>0&&(s=setTimeout((function(){u("timeout")}),t.timeout)),h)},e.ajaxSettings={type:"GET",beforeSend:y,success:y,error:y,complete:y,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:l,xml:"application/xml, text/xml",html:c,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(n){var r,g=e.extend({},n||{}),b=e.Deferred&&e.Deferred();for(t in e.ajaxSettings)void 0===g[t]&&(g[t]=e.ajaxSettings[t]);!function(t){t.global&&0==e.active++&&h(t,null,"ajaxStart")}(g),g.crossDomain||((r=o.createElement("a")).href=g.url,r.href=r.href,g.crossDomain=u.protocol+"//"+u.host!=r.protocol+"//"+r.host),g.url||(g.url=window.location.toString()),function(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=v(t.url,t.data),t.data=void 0)}(g);var _=g.dataType,S=/\?.+=\?/.test(g.url);if(S&&(_="jsonp"),!1!==g.cache&&(n&&!0===n.cache||"script"!=_&&"jsonp"!=_)||(g.url=v(g.url,"_="+Date.now())),"jsonp"==_)return S||(g.url=v(g.url,g.jsonp?g.jsonp+"=?":!1===g.jsonp?"":"callback=?")),e.ajaxJSONP(g,b);var w,A=g.accepts[_],T={},P=function(e,t){T[e.toLowerCase()]=[e,t]},C=/^([\w-]+:)\/\//.test(g.url)?RegExp.$1:window.location.protocol,E=g.xhr(),k=E.setRequestHeader;if(b&&b.promise(E),g.crossDomain||P("X-Requested-With","XMLHttpRequest"),P("Accept",A||"*/*"),(A=g.mimeType||A)&&(A.indexOf(",")>-1&&(A=A.split(",",2)[0]),E.overrideMimeType&&E.overrideMimeType(A)),(g.contentType||!1!==g.contentType&&g.data&&"GET"!=g.type.toUpperCase())&&P("Content-Type",g.contentType||"application/x-www-form-urlencoded"),g.headers)for(i in g.headers)P(i,g.headers[i]);if(E.setRequestHeader=P,E.onreadystatechange=function(){if(4==E.readyState){E.onreadystatechange=y,clearTimeout(w);var t,i=!1;if(E.status>=200&&E.status<300||304==E.status||0==E.status&&"file:"==C){_=_||function(e){return e&&(e=e.split(";",2)[0]),e&&(e==c?"html":e==l?"json":s.test(e)?"script":a.test(e)&&"xml")||"text"}(g.mimeType||E.getResponseHeader("content-type")),t=E.responseText;try{"script"==_?(0,eval)(t):"xml"==_?t=E.responseXML:"json"==_&&(t=d.test(t)?null:e.parseJSON(t))}catch(e){i=e}i?m(i,"parsererror",E,g,b):p(t,E,g,b)}else m(E.statusText||null,E.status?"error":"abort",E,g,b)}},!1===f(E,g))return E.abort(),m(null,"abort",E,g,b),E;if(g.xhrFields)for(i in g.xhrFields)E[i]=g.xhrFields[i];var O=!("async"in g)||g.async;for(i in E.open(g.type,g.url,O,g.username,g.password),T)k.apply(E,T[i]);return g.timeout>0&&(w=setTimeout((function(){E.onreadystatechange=y,E.abort(),m(null,"timeout",E,g,b)}),g.timeout)),E.send(g.data?g.data:null),E},e.get=function(){return e.ajax(b.apply(null,arguments))},e.post=function(){var t=b.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=b.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,i,n){if(!this.length)return this;var o,s=this,a=t.split(/\s/),l=b(t,i,n),c=l.success;return a.length>1&&(l.url=a[0],o=a[1]),l.success=function(t){s.html(o?e("<div>").html(t.replace(r,"")).find(o):t),c&&c.apply(s,arguments)},e.ajax(l),this};var _=encodeURIComponent;e.param=function(t,i){var n=[];return n.add=function(t,i){e.isFunction(i)&&(i=i()),null==i&&(i=""),this.push(_(t)+"="+_(i))},function t(i,n,o,r){var s,a=e.isArray(n),l=e.isPlainObject(n);e.each(n,(function(n,c){s=e.type(c),r&&(n=o?r:r+"["+(l||"object"==s||"array"==s?n:"")+"]"),!r&&a?i.add(c.name,c.value):"array"==s||!o&&"object"==s?t(i,c,o,n):i.add(n,c)}))}(n,t,i),n.join("&").replace(/%20/g,"+")}}(e),function(e){e.fn.serializeArray=function(){var t,i,n=[],o=function e(i){if(i.forEach)return i.forEach(e);n.push({name:t,value:i})};return this[0]&&e.each(this[0].elements,(function(n,r){i=r.type,(t=r.name)&&"fieldset"!=r.nodeName.toLowerCase()&&!r.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||r.checked)&&o(e(r).val())})),n},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach((function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))})),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var i=e.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(e),function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,i){return t=t||[],e.extend(t,e.fn),t.selector=i||"",t.__Z=!0,t},isZ:function(t){return"array"===e.type(t)&&"__Z"in t}});try{getComputedStyle(void 0)}catch(e){var t=getComputedStyle;window.getComputedStyle=function(e,i){try{return t(e,i)}catch(e){return null}}}}(e),t}();t.a=o},function(e,t){e.exports={UNIT_TYPES:{INLINE:0,INTERSTITIAL:1,SLIDER_OUTSTREAM:2,SLIDER_INSTREAM:3,EXPANDABLE:4,"300X600":5,INLINE_FEED:6,COFFEEBREAK:7,SLIDESHOW:8,INLINE_INSTREAM:9,COFFEEBREAK_MOBILE:10,"300X600_MOBILE":11,INLINE_MOBILE:12,INTERSTITIAL_MOBILE:14,SLIDER_OUTSTREAM_MOBILE:15,SLIDER_INSTREAM_MOBILE:16,EXPANDABLE_MOBILE:17,INLINE_INSTREAM_MOBILE:18,INLINE_OUT_OF_VIEW:19,INLINE_OUT_OF_VIEW_MOBILE:20,INLINE_VIEWABILITY_EXPAND:21,INLINE_VIEWABILITY_EXPAND_MOBILE:22,INLINE_INSTREAM_VIEWABILITY_EXPAND:23,INLINE_INSTREAM_VIEWABILITY_EXPAND_MOBILE:24,INLINE_FEED_MOBILE:25,WIDGET_ITEM:26,WIDGET_ITEM_MOBILE:27,NEW_INLINE:28,NEW_INLINE_MOBILE:29,NEW_INLINE_ADJACENT:30,NEW_INLINE_ADJACENT_MOBILE:31,FEED_MANAGER:32,FEED_MANAGER_MOBILE:33,MSN_WIDGET:34,SLIDER_INSTREAM_VFORCE:36,SLIDER_INSTREAM_MOBILE_VFORCE:37},STREAM_TYPES:{IN_STREAM:1,OUT_STREAM:0},UNITS_STREAM_TYPE:{INLINE:0,INTERSTITIAL:0,SLIDER_OUTSTREAM:0,SLIDER_INSTREAM:1,EXPANDABLE:1,"300X600":1,OMNI_TAG:0},APPEND_TYPE:{BEFORE_BEGIN:0,AFTER_BEGIN:1,BEFORE_END:2,AFTER_END:3,beforebegin:0,afterbegin:1,beforeend:2,afterend:3},INVALID_SELECTOR_TAG_NAMES:{IMG:0,UL:1,BUTTON:3,INPUT:4,LABEL:5},OMNI_TAG_UNIT_NAMES:{rightrail1:1,rightrail2:2,rightrail3:3,inlineTop:4,inlineMiddle:5,inlineBottom:6,interstitial:7,sliderOutstream1:8,sliderOutstream2:9,sliderInstream1:10,sliderInstream2:11,coffeeBreak:12,expandable1:13,expandable2:14,expandable3:15,invalidUnitName:1e3},ROLL_TYPE:{preroll:0,"pre-roll":0,midroll:-1,"mid-roll":-1,postroll:-2,"post-roll":-2},TAB_STATE:{focus:0,blur:1,tabOut:2},DFP_KEYWORDS:["google","dfp","gpt"],MIME_TYPES:{1:"video/mp4",5:"video/webm",7:"video/ogg",10:"video/mp4",11:"video/ogg",12:"video/webm"},SUB_UNIT_TYPE:{PLAIN:0,START_FROM_SLIDER:1,DETACH_TO_SLIDER:2,SUPER_SLIDER:3,INLINE_SINGLE_SELECTOR:4,INLINE_MULTI_SELECTOR:5,STICKY_BELOW:6,STICKY_ABOVE:7,STICKY_BELOW_ABOVE:8,WIDGET:9},FEED_SELECTOR:"tbl-feed-container",AD_CHOICE_TYPE:{TITLE:"title",VIDEO_AD:"videoAd",SLIDER:"slider"},REPLAY_AD_CLICK:{ALL:"all",RESTART_PLAYER:"restartPlayer"},DISPLAY_FILLER:{BEFORE_AD:{NONE:"none",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"},BETWEEN_ADS:{LOADING:"loading",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"},ON_TIMEOUT:{CLOSE:"close",D2D:"d2d",CONTENT:"content",STATIC:"static",none:"none"}},TITLE_POSITION:{ABOVE:"above",BELOW:"below"},KIBANA_EVENTS:{start:"start",renderWasCalled:"renderWasCalled",getAd:"getAd",getAdFailed:"getAdFailed",gotAd:"gotAd",adPlay:"adPlay",conversion:"conversion",adPaused:"adPaused",viewability:"viewability",continueAd:"continueAd",adComplete:"adComplete",firstEligibility:"firstEligibility",unitCloseByUser:"unitCloseByUser",unitClosedByMidRollTimeOut:"unitClosedByMidRollTimeOut",attach:"attach",detach:"detach",topParentSelectorLost:"topParentSelectorLost",playerWidthLost:"playerWidthLost",playerHeightLost:"playerHeightLost",invalidCDBobject:"invalidCDBobject",rvHandlerState:"rvHandlerState",playerHasRvInQ:"playerHasRvInQ",rvHandlerTimerExpired:"rvHandlerTimerExpired",D2DClick:"D2DClick"},DEBUG_DATA:{pn:"pn",sqg:"sqg",sqv:"sqv",rv:"rv",sqp:"sqp",rvps:"rvps",rvvs:"rvvs",pps:"pps",ppsc:"ppsc",vms:"vms",gpps:"gpps",gppsc:"gppsc",ft:"ft",fsc:"fsc",fpc:"fpc",sa:"sa",pi:"pi",dt:"dt",vb:"vb",dur:"dur",ttv:"ttv",bovpg:"bovpg",bovpv:"bovpv",be:"be",pap:"pap",mty:"mty",esv:"esv",rot:"rot",roid:"roid",rom:"rom",tti:"tti"},DEBUG_DATA_PIXELS:{ft:"ft",fsc:"fsc",fpc:"fpc"},PREDICT_NAMES:{distancePercentPredict:0,distancePixelsPredict:1,getAdFailPredict:2,loadingPredict:3,multiAdPredict:4,playerReadyPredict:5,repeatPredict:6,autoKillPredict:7,firstScrollPredict:8,emptyQueuePredict:9,bForcePredict:10,intersectionPredict:11,fullEligibilityPredict:12,feedXPredict:13,adProgressionAfterBeginPredict:14,adProgressionBeforeEndPredict:15,feedContainerChangedPredict:16,mp4Predict:17},ANIMATION_TYPE:{none:0,attaching:1,detaching:2,expanding:3,collapsing:4},FLOATING_VIEW_TOP_COMPONENT:{video:0,loading:1,repeat:2,d2d:3,content:4},FRAME_TYPE:{plainPage:0,friendlyIframe:1,nonFriendlyIframe:2,amp:3,inApp:4},CHECK_FOR_RV_PRIORITY:{onEligibility:"hasReachedEligibility",pixelsFromSelector:"hasReachedPixelsFromSelector",intersectionPercent:"intersectionPercent",beforeLoaderEnd:"beforeLoaderEnd"},TIMER_NAMES:{viewability:"viewability",viewabilityOneS:"viewabilityOneS",viewability100:"viewability100",viewabilityAMP:"viewabilityAMP"},AD_STATUS:{new:0,adLoaded:1,startAd:2,adImpression:3,adPlay:4,adError:5,adComplete:6},GENERAL_ERROR:{1:"empty data from player"},CSS_PROPERTIES_FROM_RBOX:["font","@font-face","font-family","font-feature-settings","@font-feature-values","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","line-break","line-height","outline","outline-color","outline-offset","outline-style","outline-width","text-decoration-line","text-underline-position","padding","padding-bottom","padding-left","padding-right","padding-top","margin","margin-bottom","margin-left","margin-right","margin-top","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","text-transform","z-index","text-align","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-indent","text-justify","text-orientation","text-overflow","text-shadow","text-transform","text-underline-position","direction","color"],NATIVE_AD:{DESC_TITLE_FONT_RATIO:.8,FIT_TO_SIZE:{TITLE:"title",FULL:"full",NONE:"none"}},UNIT_QUERY_LANGUAGE:{SUPPORTED_CONFIG_FLAGS:["stickyCard"],MAPPING:[{search:"@Ad@",replaceWith:"activeAd"}]},RV_TYPES:{NON_RV:0,RV:1,ANY:"any"},VIDEO_READY_STATE:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},TRC_PERFORMANCE_ACTIONS:{START:"Start",STOP:"Stop"},OS:{IOS:"iOS"},BROWSER:{IE:"IE",EDGE:"Edge",FIREFOX:"Firefox"}}},function(e,t){e.exports={readyState:"ready",adManagerState:{empty:"empty",hasAds:"hasAds",stopped:"stopped",paused:"paused"},adState:{failed:"failed",playing:"playing",paused:"paused",continueAd:"continueAd",completed:"completed",autoKill:"autoKill",repeating:"repeating",skipped:"skipped"},adQState:{impression:"impression",q0:"q0",q1:"q1",q2:"q2",q3:"q3",completed:"completed",repeating:"repeating"},getAdState:{notCalled:"notCalled",gettingAd:"gettingAd",gotAd:"gotAd",waiting:"waiting",failed:"failed",stopped:"stopped",finished:"finished"},playerState:{error:"error",stopped:"stopped",closed:"closed",restarted:"restarted"},containerViewState:{rendered:"rendered",eligible:"eligible",playing:"playing",collapsed:"collapsed",attached:"attached",detached:"detached"},videoViewState:{rendered:"rendered",attached:"attached",detached:"detached"},repeatState:{hiding:"hiding",showing:"showing",spinning:"spinning",clicked:"clicked"},loadingViewState:{hiding:"hiding",showing:"showing",clicked:"clicked"},clickThruState:{clicked:"clicked",waiting:"waiting"},timerState:{working:"started",paused:"paused",stopped:"stopped",done:"done"},closeState:{terminate:"terminate",containerViewClosed:"containerViewClosed",videoViewClosed:"videoViewClosed",adManagerStop:"adManagerStop",playerClosed:"playerClosed"},tabState:{focus:"focus",blur:"blur",tabOut:"tabOut"},rvHandlerState:{working:"working",idle:"idle"},floatingView:{detach:"detach",attach:"attach",postAttach:"postAttach",permanentClosed:"permanentClosed"},externalUnit:{playing:"playing",stopped:"stopped"},brandingDisplayState:{show:"show",hide:"hide"}}},function(e,t,i){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,n){e||(e={}),e.Backbone||(e.Backbone={});var o=i(5);n(e,t,o)}(this,(function(e,t,i,o){var r=e.Backbone,s=[].slice;t.VERSION="1.1.2",t.$=o,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(e,t,i){return c(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,n){if(!c(this,"once",e,[t,n])||!t)return this;var o=this,r=i.once((function(){o.off(e,r),t.apply(this,arguments)}));return r._callback=t,this.on(e,r,n)},off:function(e,t,n){var o,r,s,a,l,d,u,h;if(!this._events||!c(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(l=0,d=(a=e?[e]:i.keys(this._events)).length;l<d;l++)if(e=a[l],s=this._events[e]){if(this._events[e]=o=[],t||n)for(u=0,h=s.length;u<h;u++)r=s[u],(t&&t!==r.callback&&t!==r.callback._callback||n&&n!==r.context)&&o.push(r);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!c(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&d(i,t),n&&d(n,arguments),this},stopListening:function(e,t,o){var r=this._listeningTo;if(!r)return this;var s=!t&&!o;for(var a in o||"object"!==n(t)||(o=this),e&&((r={})[e._listenId]=e),r)(e=r[a]).off(t,o,this),(s||i.isEmpty(e._events))&&delete this._listeningTo[a];return this}},l=/\s+/,c=function(e,t,i,o){if(!i)return!0;if("object"===n(i)){for(var r in i)e[t].apply(e,[r,i[r]].concat(o));return!1}if(l.test(i)){for(var s=i.split(l),a=0,c=s.length;a<c;a++)e[t].apply(e,[s[a]].concat(o));return!1}return!0},d=function(e,t){var i,n=-1,o=e.length,r=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s,a);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}};i.each({listenTo:"on",listenToOnce:"once"},(function(e,t){a[t]=function(t,o,r){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=i.uniqueId("l"))]=t,r||"object"!==n(o)||(r=this),t[e](o,r,this),this}})),a.bind=a.on,a.unbind=a.off,i.extend(t,a);var u=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(u.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,o){var r,s,a,l,c,d,u,h;if(null==e)return this;if("object"===n(e)?(s=e,o=t):(s={})[e]=t,o||(o={}),!this._validate(s,o))return!1;for(r in a=o.unset,c=o.silent,l=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=i.clone(this.attributes),this.changed={}),h=this.attributes,u=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]),s)t=s[r],i.isEqual(h[r],t)||l.push(r),i.isEqual(u[r],t)?delete this.changed[r]:this.changed[r]=t,a?delete h[r]:h[r]=t;if(!c){l.length&&(this._pending=o);for(var f=0,p=l.length;f<p;f++)this.trigger("change:"+l[f],this,h[l[f]],o)}if(d)return this;if(!c)for(;this._pending;)o=this._pending,this._pending=!1,this.trigger("change",this,o);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=!1,o=this._changing?this._previousAttributes:this.attributes;for(var r in e)i.isEqual(o[r],t=e[r])||((n||(n={}))[r]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){if(!t.set(t.parse(i,e),e))return!1;n&&n(t,i,e),t.trigger("sync",t,i,e)},D(this,e),this.sync("read",this,e)},save:function(e,t,o){var r,s,a,l=this.attributes;if(null==e||"object"===n(e)?(r=e,o=t):(r={})[e]=t,o=i.extend({validate:!0},o),r&&!o.wait){if(!this.set(r,o))return!1}else if(!this._validate(r,o))return!1;r&&o.wait&&(this.attributes=i.extend({},l,r)),void 0===o.parse&&(o.parse=!0);var c=this,d=o.success;return o.success=function(e){c.attributes=l;var t=c.parse(e,o);if(o.wait&&(t=i.extend(r||{},t)),i.isObject(t)&&!c.set(t,o))return!1;d&&d(c,e,o),c.trigger("sync",c,e,o)},D(this,o),"patch"==(s=this.isNew()?"create":o.patch?"patch":"update")&&(o.attrs=r),a=this.sync(s,this,o),r&&o.wait&&(this.attributes=l),a},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&o(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;D(this,e);var r=this.sync("delete",this,e);return e.wait||o(),r},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||V();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}}),i.each(["keys","values","pairs","invert","pick","omit"],(function(e){u.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}}));var h=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},f={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};i.extend(h.prototype,a,{model:u,initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,p))},remove:function(e,t){var n,o,r,s,a=!i.isArray(e);for(t||(t={}),n=0,o=(e=a?[e]:i.clone(e)).length;n<o;n++)(s=e[n]=this.get(e[n]))&&(delete this._byId[s.id],delete this._byId[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),this._removeReference(s,t));return a?e[0]:e},set:function(e,t){(t=i.defaults({},t,f)).parse&&(e=this.parse(e,t));var n,o,r,s,a,l,c,d=!i.isArray(e);e=d?e?[e]:[]:i.clone(e);var h=t.at,p=this.model,m=this.comparator&&null==h&&!1!==t.sort,g=i.isString(this.comparator)?this.comparator:null,y=[],v=[],b={},_=t.add,S=t.merge,w=t.remove,A=!(m||!_||!w)&&[];for(n=0,o=e.length;n<o;n++){if(r=(a=e[n]||{})instanceof u?s=a:a[p.prototype.idAttribute||"id"],l=this.get(r))w&&(b[l.cid]=!0),S&&(a=a===s?s.attributes:a,t.parse&&(a=l.parse(a,t)),l.set(a,t),m&&!c&&l.hasChanged(g)&&(c=!0)),e[n]=l;else if(_){if(!(s=e[n]=this._prepareModel(a,t)))continue;y.push(s),this._addReference(s,t)}s=l||s,!A||!s.isNew()&&b[s.id]||A.push(s),b[s.id]=!0}if(w){for(n=0,o=this.length;n<o;++n)b[(s=this.models[n]).cid]||v.push(s);v.length&&this.remove(v,t)}if(y.length||A&&A.length)if(m&&(c=!0),this.length+=y.length,null!=h)for(n=0,o=y.length;n<o;n++)this.models.splice(h+n,0,y[n]);else{A&&(this.models.length=0);var T=A||y;for(n=0,o=T.length;n<o;n++)this.models.push(T[n])}if(c&&this.sort({silent:!0}),!t.silent){for(n=0,o=y.length;n<o;n++)(s=y[n]).trigger("add",s,this,t);(c||A&&A.length)&&this.trigger("sort",this,t)}return d?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,o=this.models.length;n<o;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"]((function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0}))},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,o=t.success;return t.success=function(e,i){t.wait&&n.add(e,t),o&&o(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof u)return e;(t=t?i.clone(t):{}).collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}}),i.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],(function(e){h.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}})),i.each(["groupBy","countBy","sortBy","indexBy"],(function(e){h.prototype[e]=function(t,n){var o=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,o,n)}}));var m=t.View=function(e){this.cid=i.uniqueId("view"),e||(e={}),i.extend(this,i.pick(e,y)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},g=/^(\S+)\s*(.*)$/,y=["model","collection","el","id","attributes","className","tagName","events"];i.extend(m.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var o=t.match(g),r=o[1],s=o[2];n=i.bind(n,this),r+=".delegateEvents"+this.cid,""===s?this.$el.on(r,n):this.$el.on(r,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,o){var r=b[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=i.result(n,"url")||V()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var a=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1),"PATCH"===s.type&&v&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=o.xhr=t.ajax(i.extend(s,o));return n.trigger("request",n,l,o),l};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),b={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var _=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,w=/(\(\?)?:\w+/g,A=/\*\w+/g,T=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(_.prototype,a,{initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var s=r._extractParameters(e,i);r.execute(o,s),r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),t.history.trigger("route",r,n,s)})),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(T,"\\$&").replace(S,"(?:$1)?").replace(w,(function(e,t){return t?e:"([^/?]+)"})).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var P=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},C=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,k=/msie [\w.]+/,O=/\/$/,I=/#.*$/;P.started=!1,i.extend(P.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(O,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(C,"")},start:function(e){if(P.started)throw new Error("Backbone.history has already been started");P.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),o=document.documentMode,r=k.exec(navigator.userAgent.toLowerCase())&&(!o||o<=7);if(this.root=("/"+this.root+"/").replace(E,"/"),r&&this._wantsHashChange){var s=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(C,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),i.any(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!P.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(I,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new P,u.extend=h.extend=_.extend=m.extend=P.extend=function(e,t){var n,o=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t);var r=function(){this.constructor=n};return r.prototype=o.prototype,n.prototype=new r,e&&i.extend(n.prototype,e),n.__super__=o.prototype,n};var V=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t}))},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(25);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.unitType,r=t.className,s=t.logger,a=void 0===s?n.a.getInstance():s,l=t.version,c=t.isDebug,d=void 0===c||c;o(this,e),this._logger=a,this.unitType=i,this.className=r,this.version=l,this.isDebug=d}var t,i;return t=e,(i=[{key:"info",value:function(e,t){this._logger.info("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"success",value:function(e,t){this._logger.success("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"important",value:function(e,t){this._logger.important("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"warning",value:function(e,t){this._logger.warning("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"pixel",value:function(e,t){this._logger.pixel("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"debug",value:function(e,t){this.isDebug&&this._logger.debug("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"error",value:function(e,t){this.isDebug&&this._logger.error("unit type: ".concat(this.unitType,", ")+"class name: ".concat(this.className," - ").concat(e),t)}},{key:"ga",value:function(e){this._logger.ga(this.unitType,e,this.version)}},{key:"ul",value:function(e,t,i){this._logger.ul(e,t,i)}}])&&r(t.prototype,i),e}()},function(e,t,i){(function(t){var i;i=function(){var e="1.12.0",i="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||Function("return this")()||{},n=Array.prototype,o=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,s=n.push,a=n.slice,l=o.toString,c=o.hasOwnProperty,d="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,h=Array.isArray,f=Object.keys,p=Object.create,m=d&&ArrayBuffer.isView,g=isNaN,y=isFinite,v=!{toString:null}.propertyIsEnumerable("toString"),b=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],_=Math.pow(2,53)-1;function S(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function w(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function A(e){return void 0===e}function T(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)}function P(e){var t="[object "+e+"]";return function(e){return l.call(e)===t}}var C=P("String"),E=P("Number"),k=P("Date"),O=P("RegExp"),I=P("Error"),V=P("Symbol"),D=P("ArrayBuffer"),R=P("Function"),x=i.document&&i.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof x&&(R=function(e){return"function"==typeof e||!1});var N=R,M=P("Object"),F=u&&M(new DataView(new ArrayBuffer(8))),L="undefined"!=typeof Map&&M(new Map),B=P("DataView"),j=F?function(e){return null!=e&&N(e.getInt8)&&D(e.buffer)}:B,U=h||P("Array");function W(e,t){return null!=e&&c.call(e,t)}var H=P("Arguments");!function(){H(arguments)||(H=function(e){return W(e,"callee")})}();var $=H;function z(e){return E(e)&&g(e)}function G(e){return function(){return e}}function q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=_}}function Y(e){return function(t){return null==t?void 0:t[e]}}var K=Y("byteLength"),Q=q(K),X=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,J=d?function(e){return m?m(e)&&!j(e):Q(e)&&X.test(l.call(e))}:G(!1),Z=Y("length");function ee(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=b.length,n=e.constructor,r=N(n)&&n.prototype||o,s="constructor";for(W(e,s)&&!t.contains(s)&&t.push(s);i--;)(s=b[i])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function te(e){if(!w(e))return[];if(f)return f(e);var t=[];for(var i in e)W(e,i)&&t.push(i);return v&&ee(e,t),t}function ie(e,t){var i=te(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var s=i[r];if(t[s]!==o[s]||!(s in o))return!1}return!0}function ne(e){return e instanceof ne?e:this instanceof ne?void(this._wrapped=e):new ne(e)}function oe(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,K(e))}ne.VERSION=e,ne.prototype.value=function(){return this._wrapped},ne.prototype.valueOf=ne.prototype.toJSON=ne.prototype.value,ne.prototype.toString=function(){return String(this._wrapped)};var re="[object DataView]";function se(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&function e(t,i,n,o){t instanceof ne&&(t=t._wrapped),i instanceof ne&&(i=i._wrapped);var s=l.call(t);if(s!==l.call(i))return!1;if(F&&"[object Object]"==s&&j(t)){if(!j(i))return!1;s=re}switch(s){case"[object RegExp]":case"[object String]":return""+t==""+i;case"[object Number]":return+t!=+t?+i!=+i:0==+t?1/+t==1/i:+t==+i;case"[object Date]":case"[object Boolean]":return+t==+i;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(i);case"[object ArrayBuffer]":case re:return e(oe(t),oe(i),n,o)}var a="[object Array]"===s;if(!a&&J(t)){if(K(t)!==K(i))return!1;if(t.buffer===i.buffer&&t.byteOffset===i.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof i)return!1;var c=t.constructor,d=i.constructor;if(c!==d&&!(N(c)&&c instanceof c&&N(d)&&d instanceof d)&&"constructor"in t&&"constructor"in i)return!1}o=o||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return o[u]===i;if(n.push(t),o.push(i),a){if((u=t.length)!==i.length)return!1;for(;u--;)if(!se(t[u],i[u],n,o))return!1}else{var h,f=te(t);if(u=f.length,te(i).length!==u)return!1;for(;u--;)if(!W(i,h=f[u])||!se(t[h],i[h],n,o))return!1}return n.pop(),o.pop(),!0}(e,t,i,n)}function ae(e){if(!w(e))return[];var t=[];for(var i in e)t.push(i);return v&&ee(e,t),t}function le(e){var t=Z(e);return function(i){if(null==i)return!1;var n=ae(i);if(Z(n))return!1;for(var o=0;o<t;o++)if(!N(i[e[o]]))return!1;return e!==fe||!N(i[ce])}}var ce="forEach",de=["clear","delete"],ue=["get","has","set"],he=de.concat(ce,ue),fe=de.concat(ue),pe=["add"].concat(de,ce,"has"),me=L?le(he):P("Map"),ge=L?le(fe):P("WeakMap"),ye=L?le(pe):P("Set"),ve=P("WeakSet");function be(e){for(var t=te(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function _e(e){for(var t={},i=te(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function Se(e){var t=[];for(var i in e)N(e[i])&&t.push(i);return t.sort()}function we(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],s=e(r),a=s.length,l=0;l<a;l++){var c=s[l];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var Ae=we(ae),Te=we(te),Pe=we(ae,!0);function Ce(e){if(!w(e))return{};if(p)return p(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ee(e){return w(e)?U(e)?e.slice():Ae({},e):e}function ke(e){return U(e)?e:[e]}function Oe(e){return ne.toPath(e)}function Ie(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Ve(e,t,i){var n=Ie(e,Oe(t));return A(n)?i:n}function De(e){return e}function Re(e){return e=Te({},e),function(t){return ie(t,e)}}function xe(e){return e=Oe(e),function(t){return Ie(t,e)}}function Ne(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function Me(e,t,i){return null==e?De:N(e)?Ne(e,t,i):w(e)&&!U(e)?Re(e):xe(e)}function Fe(e,t){return Me(e,t,1/0)}function Le(e,t,i){return ne.iteratee!==Fe?ne.iteratee(e,t):Me(e,t,i)}function Be(){}function je(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ne.toPath=ke,ne.iteratee=Fe;var Ue=Date.now||function(){return(new Date).getTime()};function We(e){var t=function(t){return e[t]},i="(?:"+te(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var He={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$e=We(He),ze=We(_e(He)),Ge=ne.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Ye={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ke=/\\|'|\r|\n|\u2028|\u2029/g;function Qe(e){return"\\"+Ye[e]}var Xe=0;function Je(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=Ce(e.prototype),s=e.apply(r,o);return w(s)?s:r}var Ze=S((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,s=Array(r),a=0;a<r;a++)s[a]=t[a]===i?arguments[o++]:t[a];for(;o<arguments.length;)s.push(arguments[o++]);return Je(e,n,this,this,s)};return n}));Ze.placeholder=ne;var et=S((function(e,t,i){if(!N(e))throw new TypeError("Bind must be called on a function");var n=S((function(o){return Je(e,n,t,this,i.concat(o))}));return n})),tt=q(Z);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,s=Z(e);r<s;r++){var a=e[r];if(tt(a)&&(U(a)||$(a)))if(t>1)it(a,t-1,i,n),o=n.length;else for(var l=0,c=a.length;l<c;)n[o++]=a[l++];else i||(n[o++]=a)}return n}var nt=S((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=S((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ne,1);function st(e){return function(){return!e.apply(this,arguments)}}function at(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var lt=Ze(at,2);function ct(e,t,i){t=Le(t,i);for(var n,o=te(e),r=0,s=o.length;r<s;r++)if(t(e[n=o[r]],n,e))return n}function dt(e){return function(t,i,n){i=Le(i,n);for(var o=Z(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var ut=dt(1),ht=dt(-1);function ft(e,t,i,n){for(var o=(i=Le(i,n,1))(t),r=0,s=Z(e);r<s;){var a=Math.floor((r+s)/2);i(e[a])<o?r=a+1:s=a}return r}function pt(e,t,i){return function(n,o,r){var s=0,l=Z(n);if("number"==typeof r)e>0?s=r>=0?r:Math.max(r+l,s):l=r>=0?Math.min(r+1,l):r+l+1;else if(i&&r&&l)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(a.call(n,s,l),z))>=0?r+s:-1;for(r=e>0?s:l-1;r>=0&&r<l;r+=e)if(n[r]===o)return r;return-1}}var mt=pt(1,ut,ft),gt=pt(-1,ht);function yt(e,t,i){var n=(tt(e)?ut:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function vt(e,t,i){var n,o;if(t=Ne(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=te(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function bt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&te(e),o=(n||e).length,r=Array(o),s=0;s<o;s++){var a=n?n[s]:s;r[s]=t(e[a],a,e)}return r}function _t(e){var t=function(t,i,n,o){var r=!tt(t)&&te(t),s=(r||t).length,a=e>0?0:s-1;for(o||(n=t[r?r[a]:a],a+=e);a>=0&&a<s;a+=e){var l=r?r[a]:a;n=i(n,t[l],l,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,Ne(i,o,4),n,r)}}var St=_t(1),wt=_t(-1);function At(e,t,i){var n=[];return t=Le(t,i),vt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function Tt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&te(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(!t(e[s],s,e))return!1}return!0}function Pt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&te(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(t(e[s],s,e))return!0}return!1}function Ct(e,t,i,n){return tt(e)||(e=be(e)),("number"!=typeof i||n)&&(i=0),mt(e,t,i)>=0}var Et=S((function(e,t,i){var n,o;return N(t)?o=t:(t=Oe(t),n=t.slice(0,-1),t=t[t.length-1]),bt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=Ie(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function kt(e,t){return bt(e,xe(t))}function Ot(e,t,i){var n,o,r=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=tt(e)?e:be(e)).length;a<l;a++)null!=(n=e[a])&&n>r&&(r=n);else t=Le(t,i),vt(e,(function(e,i,n){((o=t(e,i,n))>s||o===-1/0&&r===-1/0)&&(r=e,s=o)}));return r}function It(e,t,i){if(null==t||i)return tt(e)||(e=be(e)),e[je(e.length-1)];var n=tt(e)?Ee(e):be(e),o=Z(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,s=0;s<t;s++){var a=je(s,r),l=n[s];n[s]=n[a],n[a]=l}return n.slice(0,t)}function Vt(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Le(n,o),vt(i,(function(t,o){var s=n(t,o,i);e(r,t,s)})),r}}var Dt=Vt((function(e,t,i){W(e,i)?e[i].push(t):e[i]=[t]})),Rt=Vt((function(e,t,i){e[i]=t})),xt=Vt((function(e,t,i){W(e,i)?e[i]++:e[i]=1})),Nt=Vt((function(e,t,i){e[i?0:1].push(t)}),!0),Mt=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ft(e,t,i){return t in i}var Lt=S((function(e,t){var i={},n=t[0];if(null==e)return i;N(n)?(t.length>1&&(n=Ne(n,t[1])),t=ae(e)):(n=Ft,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var s=t[o],a=e[s];n(a,s,e)&&(i[s]=a)}return i})),Bt=S((function(e,t){var i,n=t[0];return N(n)?(n=st(n),t.length>1&&(i=t[1])):(t=bt(it(t,!1,!1),String),n=function(e,i){return!Ct(t,i)}),Lt(e,n,i)}));function jt(e,t,i){return a.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function Ut(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:jt(e,e.length-t)}function Wt(e,t,i){return a.call(e,null==t||i?1:t)}var Ht=S((function(e,t){return t=it(t,!0,!0),At(e,(function(e){return!Ct(t,e)}))})),$t=S((function(e,t){return Ht(e,t)}));function zt(e,t,i,n){T(t)||(n=i,i=t,t=!1),null!=i&&(i=Le(i,n));for(var o=[],r=[],s=0,a=Z(e);s<a;s++){var l=e[s],c=i?i(l,s,e):l;t&&!i?(s&&r===c||o.push(l),r=c):i?Ct(r,c)||(r.push(c),o.push(l)):Ct(o,l)||o.push(l)}return o}var Gt=S((function(e){return zt(it(e,!0,!0))}));function qt(e){for(var t=e&&Ot(e,Z).length||0,i=Array(t),n=0;n<t;n++)i[n]=kt(e,n);return i}var Yt=S(qt);function Kt(e,t){return e._chain?ne(t).chain():t}function Qt(e){return vt(Se(e),(function(t){var i=ne[t]=e[t];ne.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),Kt(this,i.apply(ne,e))}})),ne}vt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=n[e];ne.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Kt(this,i)}})),vt(["concat","join","slice"],(function(e){var t=n[e];ne.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Kt(this,e)}}));var Xt=Qt({__proto__:null,VERSION:e,restArguments:S,isObject:w,isNull:function(e){return null===e},isUndefined:A,isBoolean:T,isElement:function(e){return!(!e||1!==e.nodeType)},isString:C,isNumber:E,isDate:k,isRegExp:O,isError:I,isSymbol:V,isArrayBuffer:D,isDataView:j,isArray:U,isFunction:N,isArguments:$,isFinite:function(e){return!V(e)&&y(e)&&!isNaN(parseFloat(e))},isNaN:z,isTypedArray:J,isEmpty:function(e){if(null==e)return!0;var t=Z(e);return"number"==typeof t&&(U(e)||C(e)||$(e))?0===t:0===Z(te(e))},isMatch:ie,isEqual:function(e,t){return se(e,t)},isMap:me,isWeakMap:ge,isSet:ye,isWeakSet:ve,keys:te,allKeys:ae,values:be,pairs:function(e){for(var t=te(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:_e,functions:Se,methods:Se,extend:Ae,extendOwn:Te,assign:Te,defaults:Pe,create:function(e,t){var i=Ce(e);return t&&Te(i,t),i},clone:Ee,tap:function(e,t){return t(e),e},get:Ve,has:function(e,t){for(var i=(t=Oe(t)).length,n=0;n<i;n++){var o=t[n];if(!W(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Le(t,i);for(var n=te(e),o=n.length,r={},s=0;s<o;s++){var a=n[s];r[a]=t(e[a],a,e)}return r},identity:De,constant:G,noop:Be,toPath:ke,property:xe,propertyOf:function(e){return null==e?Be:function(t){return Ve(e,t)}},matcher:Re,matches:Re,times:function(e,t,i){var n=Array(Math.max(0,e));t=Ne(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:je,now:Ue,escape:$e,unescape:ze,templateSettings:Ge,template:function(e,t,i){!t&&i&&(t=i),t=Pe({},t,ne.templateSettings);var n,o=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),r=0,s="__p+='";e.replace(o,(function(t,i,n,o,a){return s+=e.slice(r,a).replace(Ke,Qe),r=a+t.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?s+="'+\n((__t=("+n+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t})),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=new Function(t.variable||"obj","_",s)}catch(e){throw e.source=s,e}var a=function(e){return n.call(this,e,ne)},l=t.variable||"obj";return a.source="function("+l+"){\n"+s+"}",a},result:function(e,t,i){var n=(t=Oe(t)).length;if(!n)return N(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=N(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Xe+"";return e?e+t:t},chain:function(e){var t=ne(e);return t._chain=!0,t},iteratee:Fe,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return W(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,s,a=0;i||(i={});var l=function(){a=!1===i.leading?0:Ue(),n=null,s=e.apply(o,r),n||(o=r=null)},c=function(){var c=Ue();a||!1!==i.leading||(a=c);var d=t-(c-a);return o=this,r=arguments,d<=0||d>t?(n&&(clearTimeout(n),n=null),a=c,s=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(l,d)),s};return c.cancel=function(){clearTimeout(n),a=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r=function(t,i){n=null,i&&(o=e.apply(t,i))},s=S((function(s){if(n&&clearTimeout(n),i){var a=!n;n=setTimeout(r,t),a&&(o=e.apply(this,s))}else n=ot(r,t,this,s);return o}));return s.cancel=function(){clearTimeout(n),n=null},s},wrap:function(e,t){return Ze(t,e)},negate:st,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:at,once:lt,findKey:ct,findIndex:ut,findLastIndex:ht,sortedIndex:ft,indexOf:mt,lastIndexOf:gt,find:yt,detect:yt,findWhere:function(e,t){return yt(e,Re(t))},each:vt,forEach:vt,map:bt,collect:bt,reduce:St,foldl:St,inject:St,reduceRight:wt,foldr:wt,filter:At,select:At,reject:function(e,t,i){return At(e,st(Le(t)),i)},every:Tt,all:Tt,some:Pt,any:Pt,contains:Ct,includes:Ct,include:Ct,invoke:Et,pluck:kt,where:function(e,t){return At(e,Re(t))},max:Ot,min:function(e,t,i){var n,o,r=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=tt(e)?e:be(e)).length;a<l;a++)null!=(n=e[a])&&n<r&&(r=n);else t=Le(t,i),vt(e,(function(e,i,n){((o=t(e,i,n))<s||o===1/0&&r===1/0)&&(r=e,s=o)}));return r},shuffle:function(e){return It(e,1/0)},sample:It,sortBy:function(e,t,i){var n=0;return t=Le(t,i),kt(bt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:Dt,indexBy:Rt,countBy:xt,partition:Nt,toArray:function(e){return e?U(e)?a.call(e):C(e)?e.match(Mt):tt(e)?bt(e,De):be(e):[]},size:function(e){return null==e?0:tt(e)?e.length:te(e).length},pick:Lt,omit:Bt,first:Ut,head:Ut,take:Ut,initial:jt,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Wt(e,Math.max(0,e.length-t))},rest:Wt,tail:Wt,drop:Wt,compact:function(e){return At(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:$t,uniq:zt,unique:zt,union:Gt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=Z(e);n<o;n++){var r=e[n];if(!Ct(t,r)){var s;for(s=1;s<i&&Ct(arguments[s],r);s++);s===i&&t.push(r)}}return t},difference:Ht,unzip:qt,transpose:qt,zip:Yt,object:function(e,t){for(var i={},n=0,o=Z(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(a.call(e,n,n+=t));return i},mixin:Qt,default:ne});return Xt._=Xt,Xt},e.exports=i()}).call(this,i(29))},function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return p}));var n=i(13);function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i(5);var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"createStateHandlers",value:function(e){Object(n.a)(this,e)}}])&&o(t.prototype,i),e}(),s=i(3),a=i.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=i(5),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}(r);function r(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),o.call(this,e)}return t=r,(i=[{key:"renderTemplate",value:function(){if(this.template&&this.model&&(this.template=f.template(this.template),this.$el.append(this.template(this.model.attributes)),this.ui)){var e={};for(var t in this.ui)e[t]=this.$el.find(this.ui[t]);this.ui=e}}},{key:"createStateHandlers",value:function(e){Object(n.a)(this,e)}}])&&c(t.prototype,i),r}(a.a.View)},function(e,t,i){"use strict";i.d(t,"o",(function(){return Q})),i.d(t,"r",(function(){return X.a})),i.d(t,"g",(function(){return J.a})),i.d(t,"k",(function(){return se})),i.d(t,"p",(function(){return ve})),i.d(t,"l",(function(){return Se})),i.d(t,"a",(function(){return Ne})),i.d(t,"b",(function(){return qe})),i.d(t,"m",(function(){return de.a})),i.d(t,"q",(function(){return et})),i.d(t,"i",(function(){return gt})),i.d(t,"f",(function(){return at})),i.d(t,"n",(function(){return At})),i.d(t,"c",(function(){return It})),i.d(t,"j",(function(){return Lt})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return qt})),i.d(t,"h",(function(){return Qt}));var n=i(0),o=i(3),r=i.n(o),s=i(6),a=i(4),l=i(2),c=i.n(l),d=i(8),u=i.n(d);function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=i(5),p=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.oppsOptions=i,this.options={"auc-dast":void 0,dast:void 0,d:void 0,dp:void 0,os:void 0,pv:void 0,pt:void 0,rs:void 0,rst:void 0,st:void 0,sts:void 0,tms:void 0,vmt:void 0,vpd:void 0,vptd:void 0},this.options=f.extend(this.options,t),this.log=new a.a({className:"Opportunity Manager"}),this.pixelType={tagStarted:0,tagImpression:1,tagTimeout:2,tagError:4,playerClosed:7,AdVideoFirstQuartile:21,AdVideoMidpoint:22,AdVideoThirdQuartile:23,AdVideoComplete:24,viewability:30,firstImpression:99}}var t,i;return t=e,(i=[{key:"send",value:function(e,t){var i=this.isBillableEvent(e.rst)?this.oppsOptions.oppUrl:this.oppsOptions.nonBllbOppUrl;i+="?rst="+e.rst,e=f.extend({},this.options,{tms:Math.floor((new Date).getTime()/1e3)},e),t&&f.isSendBeaconSupported()?navigator.sendBeacon(i,JSON.stringify([e])):n.a.ajax({type:"POST",url:i,data:JSON.stringify([e]),contentType:"text/plain"})}},{key:"isBillableEvent",value:function(e){return this.oppsOptions.billableEvents.indexOf(e)>-1}}])&&h(t.prototype,i),e}(),m=i(1),g=i.n(m),y=i(12);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=i(5),T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=w(e);if(t){var o=w(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return S(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e.model)).model=e.model,t.subModel=e.subModel,t.adData=e.adData||{},t.scrollManager=new y.a,t.onDebugDataChange=e.onDebugDataChange,t.log=new a.a({unitType:t.model.get("unitType"),className:"DebugData",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.isViewed=e.isViewed,e.onDebugDataChange&&(t._onDebugChange(),t._bindEvents()),t}return t=o,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"sqv",funcName:"_onDebugChange"},{event:"conversionCount",funcName:"_onDebugChange"},{event:"rvvs1",funcName:"_onDebugChange"},{event:"rvvs0",funcName:"_onDebugChange"},{event:"rvps1",funcName:"_onDebugChange"},{event:"rvps0",funcName:"_onDebugChange"}])}},{key:"_onDebugChange",value:function(){this.onDebugDataChange(this.getDebugData())}},{key:"getDebugData",value:function(){if(this.model.get("isSendDebugDataReporting")){var e="";for(var t in g.a.DEBUG_DATA){var i=this[t]();e+=void 0!==i?"".concat(g.a.DEBUG_DATA[t],":").concat(i,"!"):"".concat(g.a.DEBUG_DATA[t],":!")}return e}}},{key:"pn",value:function(){return g.a.PREDICT_NAMES[this.adData.pn]}},{key:"sqg",value:function(){return this.adData.adId}},{key:"sqv",value:function(){return this.model.get("sqv")}},{key:"sqp",value:function(){if(this.model.get("conversionCount"))return parseInt(this.model.get("conversionCount"))}},{key:"rv",value:function(){return this.isRv()?1:0}},{key:"rvvs",value:function(){return this.isRv()?this.model.get("rvvs1"):this.model.get("rvvs0")}},{key:"rvps",value:function(){return this.isRv()?this.model.get("rvps1"):this.model.get("rvps0")}},{key:"ppsc",value:function(){return parseInt(this.scrollManager.ppsChange)}},{key:"vms",value:function(){var e=this.scrollManager.vms;return e!==1/0?parseInt(e):"inf"}},{key:"pps",value:function(){return parseInt(this.scrollManager.pps)}},{key:"gpps",value:function(){return parseInt(this.adData.getAdPPS)}},{key:"gppsc",value:function(){return parseInt(this.adData.getAdPPSChange)}},{key:"isRv",value:function(){return A.parseBool(this.adData.requiredViewability)}},{key:"ft",value:function(){return this.model.get("frameType")}},{key:"fsc",value:function(){var e=this.model.get("startCard");if(void 0!==e&&""!==e)return parseInt(e)}},{key:"fpc",value:function(){var e=this.model.get("permanentCard");if(void 0!==e&&""!==e)return parseInt(e)}},{key:"sa",value:function(){var e=this.subModel||this.model;return e&&e.get("isPlacementSingleAd")?1:0}},{key:"pi",value:function(){return this.model.get("MSNCard.placementIndex")}},{key:"dt",value:function(){var e=this.subModel||this.model;return e.get("videoViewState")&&e.get("videoViewState")===l.videoViewState.detached?1:0}},{key:"vb",value:function(){return this.isViewed?1:0}},{key:"dur",value:function(){var e=this.subModel||this.model,t=parseInt(e.get("activeAdMaxTime"));return t||(t=void 0),t}},{key:"ttv",value:function(){return this.adData.timeToVimp?parseInt(this.adData.timeToVimp):0}},{key:"bovpg",value:function(){return this.adData.bovpg?parseInt(this.adData.bovpg):""}},{key:"bovpv",value:function(){return this.adData.bovpv?parseInt(this.adData.bovpv):""}},{key:"be",value:function(){return this.model.get("playerHasRvInQ")?1:0}},{key:"pap",value:function(){return void 0!==this.adData.pap?parseInt(this.adData.pap):""}},{key:"mty",value:function(){return void 0!==this.adData.mty?parseInt(this.adData.mty):""}},{key:"esv",value:function(){return this.adData.esv?1:0}},{key:"rot",value:function(){return this.adData.rot}},{key:"roid",value:function(){return this.adData.roid}},{key:"rom",value:function(){return this.adData.rom}},{key:"tti",value:function(){return this.adData.timeToImpression}}])&&b(t.prototype,i),o}(s.a);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=i(5),V={viewability:{id:30,name:"viewability"},viewabilityOneS:{id:54,name:"viewabilityOneS"},viewability100:{id:63,name:"viewability100"},viewabilityAMP:{id:131,name:"viewabilityAMP"},noViewabilityAMP:{id:132,name:"noViewabilityAMP"},compView100:{id:107,name:"compView100"},pauseAfterPlay:{id:31,name:"pauseAfterPlay"},conversion:{id:32,name:"adPlay"},clickThru:{id:33,name:"clickThru"},fireSkipVimp1EligibilityLost:{id:43,name:"skipLostEligibility"},fireSkipVimp1Vimp0Playing:{id:44,name:"skipOtherPlaying"},unitImpression:{id:45,name:"unitImpression"},continueAd:{id:46,name:"continueAd"},continueAdInAnotherCard:{id:55,name:"continueAdInAnotherCard"},shouldContinueAdInAnotherCard:{id:56,name:"shouldContinueAdInAnotherCard"},lostCardEligibility:{id:57,name:"lostCardEligibil*ity"},adUnmuted:{id:58,name:"adUnmuted"},userAdUnmuted:{id:64,name:"userAdUnmuted"},learnMoreClick:{id:71,name:"learnMoreClick"},adTitleClick:{id:74,name:"adTitleClick"},adCtaButtonClick:{id:75,name:"adCtaButtonClick"},adDescriptionClick:{id:76,name:"adDescriptionClick"},adBrandingClick:{id:77,name:"adBrandingClick"},adIconClick:{id:78,name:"adIconClick"},detach:{id:79,name:"detach"},attach:{id:80,name:"attach"},sliderClosed:{id:81,name:"sliderClosed"},twoSecAfterPlay:{id:82,name:"twoSecAfterPlay"},adProgressionAfterBeginPredict:{id:84,name:"adProgressionAfterBeginPredict"},adProgressionBeforeEndPredict:{id:85,name:"adProgressionBeforeEndPredict"},adSwappedOut:{id:104,name:"adSwappedOut"},adSwappedIn:{id:105,name:"adSwappedIn"},pauseAfterPlayScrolledUp:{id:108,name:"pauseAfterPlayScrolledUp"},pauseAfterPlayScrolledDown:{id:109,name:"pauseAfterPlayScrolledDown"},pauseAfterPlaySwitchedTab:{id:110,name:"pauseAfterPlaySwitchedTab"},eligibilityLostScrolledUp:{id:111,name:"eligibilityLostScrolledUp"},eligibilityLostScrolledDown:{id:112,name:"eligibilityLostScrolledDown"},eligibilitySwitchedTab:{id:113,name:"eligibilitySwitchedTab"},oneSecondNoPlaySamePlace:{id:114,name:"oneSecondNoPlaySamePlace"},oneSecondNoPlayScrolledUp:{id:115,name:"oneSecondNoPlayScrolledUp"},oneSecondNoPlayScrolledDown:{id:116,name:"oneSecondNoPlayScrolledDown"},displayingFullNAS:{id:125,name:"displayingFullNAS"},displayingNASTitleOnly:{id:126,name:"displayingNASTitleOnly"},adPausedOtherUnitIsPlaying:{id:127,name:"adPausedOtherUnitIsPlaying"},rvBlockedInQ:{id:128,name:"rvBlockedInQ"},reportingObserver:{id:129,name:"reportingObserver"},noReplayForHipAdjacAd:{id:140,name:"noReplayForHipAdjacAd"},adPlayingNextAdReadyRV1:{id:142,name:"adPlayingNextAdReadyRV1"}},D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=O(e);if(t){var o=O(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return k(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e.model)).model=e.model,t.adData=e.adData,t.reportFunc=e.reportFunc,t.getAdData=e.getAdDataFunc,t.setDebugData=e.setDebugData,t.vpaidData=e.vpaidData,t.log=new a.a({unitType:t.model.get("unitType"),className:"oppsService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.oppManager=new p({"auc-dast":t.model.get("cmDast"),pt:I.crc32(t.model.get("abTest")||999)},{billableEvents:t.model.get("billableEvents"),oppUrl:t.model.get("player.urls.oppsRequest"),nonBllbOppUrl:t.model.get("player.urls.nonBllboppsRequest")}),t.isViewed=!1,t.hadConversion=!1,t.hadImpression=!1,t.isFirstPlayForAd=!0,t.pageEventHistory=window.cmTag.PEH,t.unifiedPlacementEH=window.cmTag.UPEH,t._bindEvents(),t._fireUnitImpression(),t}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"_fireUnitImpression",value:function(){this._fireOpp(V.unitImpression.id,V.unitImpression.name),this.reportFunc(V.unitImpression.name,{tab:this.model.get("isInTab"),eligibility:this.model.get("isEligibleToPlay"),gotVimpCountQ:this.model.get("impressionCount"),hadEligibility:this.model.get("hadEligibility"),hadLostEligibility:!!this.model.get("lostEligibilityTime")},!0),this.model.get("hadEligibility")||this.reportFunc("waitingForEligibilty",{tab:this.model.get("isInTab")},!1)}},{key:"fireSkipVimp1EligibilityLost",value:function(e){if(e){this._fireOpp(V.fireSkipVimp1EligibilityLost.id,V.fireSkipVimp1EligibilityLost.name);var t=this.subModel?this.subModel.get("videoViewContainer"):this.model.get("videoViewContainer");if(!t){var i=Object(n.a)(this.subModel?this.subModel.get("parentSelector"):this.model.get("parentSelector"));t=I.isArray(i)?i[0]:i}this.adData.pap=I.offsetFromBottomOfViewPort(t)+Object(n.a)(t).height()>0?1:0,this.model.get("isInTab")?this.adData.pap?(this._fireOpp(V.eligibilityLostScrolledUp.id,V.eligibilityLostScrolledUp.name),this.reportFunc(V.eligibilityLostScrolledUp.name,{},!0)):(this._fireOpp(V.eligibilityLostScrolledDown.id,V.eligibilityLostScrolledDown.name),this.reportFunc(V.eligibilityLostScrolledDown.name,{},!0)):(this._fireOpp(V.eligibilitySwitchedTab.id,V.eligibilitySwitchedTab.name),this.reportFunc(V.eligibilitySwitchedTab.name,{},!0))}this.reportFunc(V.fireSkipVimp1EligibilityLost.name,{},!1)}},{key:"fireSkipVimp1Vimp0Playing",value:function(e){e&&this._fireOpp(V.fireSkipVimp1Vimp0Playing.id,V.fireSkipVimp1Vimp0Playing.name),this.reportFunc(V.fireSkipVimp1Vimp0Playing.name,{otherAdRequiredViewbility:this.model.get("activeAdData.requiredViewability"),otherAdPlayerSequenceId:this.model.get("activeAdData.tagData.sequenceId"),otherAdDp:this.model.get("activeAdData.dp")},!1)}},{key:"fireLostCardEligibility",value:function(){this._fireOpp(V.lostCardEligibility.id,V.lostCardEligibility.name)}},{key:"onConversion",value:function(){this.hadConversion||(this.shouldFirePauseAfterPlay=!0,this.hadConversion=!0,this._fireOpp(V.conversion.id,V.conversion.name),this.reportFunc(V.conversion.name,{},!0))}},{key:"fireAdUnmuted",value:function(){this.adUnmutedOppFired||(this._fireOpp(V.adUnmuted.id,V.adUnmuted.name),this.adUnmutedOppFired=!0)}},{key:"fireUserAdUnmuted",value:function(){this.userAdUnmutedOppFired||(this._fireOpp(V.userAdUnmuted.id,V.userAdUnmuted.name),this.userAdUnmutedOppFired=!0)}},{key:"onFirstPauseAfterPlay",value:function(){if(this.shouldFirePauseAfterPlay&&!this.isViewed){this.shouldFirePauseAfterPlay=!1;var e=this.subModel?this.subModel.get("videoViewContainer"):this.model.get("videoViewContainer");e=I.isArray(e)?e[0]:e,this.adData.pap=I.offsetFromBottomOfViewPort(e)+Object(n.a)(e).height()>0?1:0,this._fireOpp(V.pauseAfterPlay.id,V.pauseAfterPlay.name),this.reportFunc(V.pauseAfterPlay.name,{tab:this.model.get("isInTab")},!0),this.model.get("isInTab")?this.adData.pap?(this._fireOpp(V.pauseAfterPlayScrolledUp.id,V.pauseAfterPlayScrolledUp.name),this.reportFunc(V.pauseAfterPlayScrolledUp.name,{},!0)):(this._fireOpp(V.pauseAfterPlayScrolledDown.id,V.pauseAfterPlayScrolledDown.name),this.reportFunc(V.pauseAfterPlayScrolledDown.name,{},!0)):(this._fireOpp(V.pauseAfterPlaySwitchedTab.id,V.pauseAfterPlaySwitchedTab.name),this.reportFunc(V.pauseAfterPlayScrolledUp.name,{},!0))}}},{key:"onViewabilityOneS",value:function(){this._fireOpp(V.viewabilityOneS.id,V.viewabilityOneS.name)}},{key:"onViewability",value:function(){this.isViewed=!0,this._fireOpp(V.viewability.id,V.viewability.name),this.reportFunc(V.viewability.name,{},!0)}},{key:"onTwoSecAfterPlay",value:function(){this.model.get("opps.twoSecAfterPlay.isFire")&&this._fireOpp(V.twoSecAfterPlay.id,V.twoSecAfterPlay.name)}},{key:"onViewability100",value:function(){this._fireOpp(V.viewability100.id,V.viewability100.name)}},{key:"onViewabilityAMP",value:function(){this._fireOpp(V.viewabilityAMP.id,V.viewabilityAMP.name)}},{key:"onNoViewabilityAMP",value:function(){this._fireOpp(V.noViewabilityAMP.id,V.noViewabilityAMP.name)}},{key:"onCompView100",value:function(){this._fireOpp(V.compView100.id,V.compView100.name)}},{key:"fireContinueAd",value:function(){this.isContinueAdFired||(this.isContinueAdFired=!0,this._fireOpp(V.continueAd.id,V.continueAd.name),this.reportFunc(V.continueAd.name,{tab:this.model.get("isInTab")},!0))}},{key:"onAdClicked",value:function(){this._fireOpp(V.clickThru.id),this.reportFunc(V.clickThru.name,{},!0),this.model.set("clickThruState",l.clickThruState.waiting)}},{key:"onAdDetached",value:function(){this.model.get("opps.detach.isFire")&&(this._fireOpp(V.detach.id),this.reportFunc(V.detach.name,{},!0))}},{key:"onAdAttached",value:function(){this.model.get("opps.attach.isFire")&&(this._fireOpp(V.attach.id),this.reportFunc(V.attach.name,{},!0))}},{key:"onAdSliderClosed",value:function(){this.model.get("opps.sliderClosed.isFire")&&(this._fireOpp(V.sliderClosed.id),this.reportFunc(V.sliderClosed.name,{},!0))}},{key:"fireLearnMoreClick",value:function(){this._fireOpp(V.learnMoreClick.id)}},{key:"fireTitleContaineClick",value:function(e){var t=V[e];t&&this._fireOpp(t.id,t.name)}},{key:"_fireOpp",value:function(e,t,i){if(this.adData&&e){t&&this.log.info("Fire ".concat(t," opps"));var n={rs:this.adData.sequenceId,st:m.ROLL_TYPE[this.adData.rollType],sts:this.model.get("playerRepeatCount"),os:Number(this.adData.waterfallTagId)+1,rst:e,d:Date.now()-this.adData.created,dast:this.adData.dast,vpd:this.adData.pubId,vptd:this.adData.tagId,pv:this.model.get("playerVersion"),dp:I.crc32(this.adData.dp),vmt:Number(this.adData.isRon)||0,abt:this._getAbTest(),vstt:this.model.get("isInTab")?1:0,agl:this.model.get("preset.level")?this.model.get("preset.level"):1,pdast:this.adData.pdast,ft:this.model.get("frameType"),ttv:this.adData.timeToVimp,bovpv:this.adData.bovpv,bovpg:this.adData.bovpg,be:this.model.get("playerHasRvInQ")?1:0,pap:void 0!==this.adData.pap?this.adData.pap:"",mty:this.adData.mty,extpvid:window.TRCImpl&&window.TRCImpl.external_page_view,rv:this.adData.requiredViewability};this._setSubUnitData(e,n),this._setCmTagParams(n),this._setModifiedPlacement(n),this._sendDebugDataReporting(n,e),!0===this.model.get("isOppsulaEnabled")&&u.a.oppsula&&!this.isBillableEvent(n.rst)?(n["auc-dast"]=this.model.get("cmDast")||void 0,u.a.oppsula.send(n)):this.oppManager.send(n,i)}}},{key:"_getAbTest",value:function(){return"".concat(this.model.get("abTest")).concat(this.adData.requiredViewabilityDrawn?"!ronrv":"").concat(this.adData.moatSampling?"!mtsmp":"")}},{key:"isBillableEvent",value:function(e){return this.model.get("billableEvents").indexOf(e)>-1}},{key:"setSubModel",value:function(e){this.subModel=e}},{key:"_onSecondsToCloseGlobal",value:function(){this.reportFunc("secondsToCloseGlobal",{},!0)}},{key:"_onCloseButtonClick",value:function(){this.reportFunc("closeButtonClick",{},!0)}},{key:"_setSubUnitData",value:function(e,t){var i=this.model.get("isFireSP");for(var n in i){if(e!==parseInt(n)||!i[n])break;var o=this.getAdData();void 0!==o.sp&&(t.sp=o.sp)}var r=this.model.get("subUnitType");this.model&&(r||0===r)&&(t.su=r)}},{key:"_setModifiedPlacement",value:function(e){var t=this.model.get("modifiedPlacement");t&&(e.mp=t)}},{key:"_setCmTagParams",value:function(e){var t=this.model.get("oppsQS")||{};I.assignWithoutUndefinedValues(e,t)}},{key:"fireContinueAdInAnotherCard",value:function(){this._fireOpp(V.continueAdInAnotherCard.id,V.continueAdInAnotherCard.name),this.reportFunc(V.continueAdInAnotherCard.name,{},!0)}},{key:"fireShouldContinueAdInAnotherCard",value:function(){this._fireOpp(V.shouldContinueAdInAnotherCard.id,V.shouldContinueAdInAnotherCard.name),this.reportFunc(V.shouldContinueAdInAnotherCard.name,{},!0)}},{key:"adProgressionBeforeEndPredict",value:function(){this.model.get("opps.adProgressionBeforeEndPredict.isFire")&&this._fireOpp(V.adProgressionBeforeEndPredict.id,V.adProgressionBeforeEndPredict.name)}},{key:"adProgressionAfterBeginPredict",value:function(){this.model.get("opps.adProgressionAfterBeginPredict.isFire")&&this._fireOpp(V.adProgressionAfterBeginPredict.id,V.adProgressionAfterBeginPredict.name)}},{key:"_sendDebugDataReporting",value:function(e,t){this._isSendDebugData()&&(e.dbg=this._getDebugData(),this.model.get("isSendDebugDataReportingLog")&&this.log.info("DBG-Opp ".concat(t," - ").concat(e.dbg)))}},{key:"_getDebugData",value:function(){return new T({model:this.model,subModel:this.subModel,adData:this.adData,onDebugDataChange:this.setDebugData,isViewed:this.isViewed}).getDebugData()}},{key:"_isSendDebugData",value:function(){if(this.model.get("isSendDebugDataReporting"))return!0;var e=this.model.get("debugData.advertisersToReport")||"",t=this.vpaidData.advId;return e.toString().indexOf(t)>-1}},{key:"adSwappedOut",value:function(){this._fireOpp(V.adSwappedOut.id,V.adSwappedOut.name),this.reportFunc(V.adSwappedOut.name,{},!0)}},{key:"adSwappedIn",value:function(){this._fireOpp(V.adSwappedIn.id,V.adSwappedIn.name),this.reportFunc(V.adSwappedIn.name,{},!0)}},{key:"onOneSecondNoPlaySamePlace",value:function(){this._fireOpp(V.oneSecondNoPlaySamePlace.id,V.oneSecondNoPlaySamePlace.name),this.reportFunc(V.oneSecondNoPlaySamePlace.name,{},!0)}},{key:"onOneSecondNoPlayScrolledUp",value:function(){this._fireOpp(V.oneSecondNoPlayScrolledUp.id,V.oneSecondNoPlayScrolledUp.name),this.reportFunc(V.oneSecondNoPlayScrolledUp.name,{},!0)}},{key:"onOneSecondNoPlayScrolledDown",value:function(){this._fireOpp(V.oneSecondNoPlayScrolledDown.id,V.oneSecondNoPlayScrolledDown.name),this.reportFunc(V.oneSecondNoPlayScrolledDown.name,{},!0)}},{key:"onDisplayingFullNAS",value:function(){this._fireOpp(V.displayingFullNAS.id,V.displayingFullNAS.name),this.reportFunc(V.displayingFullNAS.name,{},!0)}},{key:"onDisplayingNASTitleOnly",value:function(){this._fireOpp(V.displayingNASTitleOnly.id,V.displayingNASTitleOnly.name),this.reportFunc(V.displayingNASTitleOnly.name,{},!0)}},{key:"fireGenericOpp",value:function(e){var t=V[e];t&&(this._fireOpp(t.id,t.name),this.reportFunc(t.name,{},!0))}},{key:"fireBeaconOpp",value:function(e){var t=V[e];t&&(this._fireOpp(t.id,t.name,!0),this.reportFunc(t.name,{},!0))}},{key:"onHipAdjacAdWithoutReplay",value:function(){this._fireOpp(V.noReplayForHipAdjacAd.id,V.noReplayForHipAdjacAd.name),this.reportFunc(V.noReplayForHipAdjacAd.name,{},!0)}},{key:"onAdPlayingNextAdReadyRV1",value:function(){this._fireOpp(V.adPlayingNextAdReadyRV1.id,V.adPlayingNextAdReadyRV1.name),this.reportFunc(V.adPlayingNextAdReadyRV1.name,{},!0)}}])&&C(t.prototype,i),r}(s.a),R=i(20),x=i(48),N=i.n(x);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=i(5),W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(s,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=j(e);if(t){var o=j(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return B(this,i)}}(s);function s(e){var t,i=e.model,n=e.ppKey,r=e.adId,c=e.impressionCb,d=e.completeCb,u=e.kibana,h=e.predictName,f=e.getAdProperties;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,i)).model=i,t._handleKibana(u),t.getAdKey=isNaN(parseInt(n))?n:parseInt(n),t.adId=r,t.impressionCb=c,t.completeCb=d,t.predictName=h,t.scrollManager=new y.a,t.getAdProperties=f||{},t.handleAdjacencyAd(),t.log=new a.a({unitType:t.model.get("unitType"),className:"adService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.adState=l.readyState,t.getAdState=l.getAdState.notCalled,t.adQState=l.adQState.readyState,t.hadPlay=!1,t.isActive=!1,t.hadImpression=!1,t.sizeObj={},t.adClickCounter=1,t.onAdImpressionTimer=null,t._bindEvents(),t._onPlayerStateReady(),t._getAd(),t.isLostView100=!1,t}return t=s,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"adManagerState:paused",funcName:"_pauseGetAd",isListenOnce:!0},{event:"adManagerState:stopped",funcName:"_stopGetAd",isListenOnce:!0},{event:"playerState:ready",funcName:"_onPlayerStateReady",isListenOnce:!0},{event:"adViewabilityFired:true",funcName:"adViewabilityFired",isListenOnce:!0},{event:"adConversionFired:true",funcName:"adConversionFired",isListenOnce:!0}])}},{key:"_onPlayerStateReady",value:function(){!this.player&&u.a.player&&(this.player=u.a.player)}},{key:"_pauseGetAd",value:function(){this.cancelGetAd(),this.getAdState=l.getAdState.stopped,this.setToModel("getAdState",l.getAdState.stopped),this.model.get("isReplayAd")||(this.player=void 0)}},{key:"_stopGetAd",value:function(){this.cancelGetAd(),this.getAdState=l.getAdState.finished,this.player=void 0}},{key:"adViewabilityFired",value:function(){if(this._hasVpaidWrapper()&&this.vpaidWrapper.emit){this.vpaidWrapper.emit("unit::viewability");var e=this.vpaidWrapper.getVpaidData(),t=e&&e.eventTrackers&&e.eventTrackers.viewability;U.each(t,this._sendPixel,this)}this.isViewabilityFired=!0}},{key:"adConversionFired",value:function(){this._hasVpaidWrapper()&&this.vpaidWrapper.emit&&this.vpaidWrapper.emit("unit::conversion")}},{key:"_getAd",value:function(){if(!this._hasPlayer()||!this.player.getAd)return this.setToModel("getAdCurrId",this.adId),void setTimeout(this.setToModel.bind(this,"getAdState",l.getAdState.failed),0);if(this.getAdState!==l.getAdState.gettingAd){if(this.adRequestTime=Date.now(),this.model.get("bottomOfViewPortDebugSelector")){var e=Object(n.a)(this.model.get("bottomOfViewPortDebugSelector"));this.bottomOfViewPortOnGetAd=e.length>0&&U.offsetFromBottomOfViewPort(e[0])}this.log.info("GetAd was called, requiredViewability: ".concat(this.getAdKey,", time =").concat(this.adRequestTime," ")),this.getAdPPS=this.scrollManager.pps,this.getAdPPSChange=this.scrollManager.ppsChange,this.setToModel("lastGetAdKey",this.getAdKey),this.model.get("getAdState")===l.getAdState.gettingAd?this.model.trigger("change:getAdState",this.model,this.model.get("getAdState")):this.setToModel("getAdState",l.getAdState.gettingAd),this.getAdState=l.getAdState.gettingAd;var t=this.model.get("exploreMore")>0;"any"===this.getAdKey?this.getAdResult=this.player.getAd({getAdTimeout:this._getTimeOut(),adProperties:this.getAdProperties.adProperties,excAdProperties:this.getAdProperties.excAdProperties,forceWf:t}):this.getAdResult=this.player.getAd({requiredViewability:this.getAdKey,getAdTimeout:this._getTimeOut(),adProperties:this.getAdProperties.adProperties,excAdProperties:this.getAdProperties.excAdProperties,forceWf:t}),this._sendEventToKibana(this.kibanaEvents.getAd,{getAdKey:this.getAdKey,predictName:this.predictName}),this.getAdResult?this.getAdResult.then(this._getAdResult.bind(this)).catch(this._getAdCatch.bind(this)):this.log.error("getAd Failed in auction  manager")}else this.log.info("[adID=${trimmedBranch}]getAd was called while trying to get an ad from player",this.adId)}},{key:"_getAdResult",value:function(e){try{if(U.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoGotAd",m.TRC_PERFORMANCE_ACTIONS.START),this.vpaidWrapper=e,this._setAdTypeConfig(),this.rpox=e.tag.rpox,this.vpaidData=this.vpaidWrapper.getVpaidData(),this.adData=U.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon","requiredViewability","rpox"]),this.adData.cpm=this.vpaidWrapper.tag.vpaidWrapperData&&this.vpaidWrapper.tag.vpaidWrapperData.vastPrice?this.vpaidWrapper.tag.vpaidWrapperData.vastPrice:this.vpaidWrapper.tag.price,this.adData.requiredViewability=U.parseBool(this.adData.requiredViewability),this.adData.getAdPPS=this.getAdPPS,this.adData.getAdPPSChange=this.getAdPPSChange,this.adData.timeToVimp=Date.now()-this.adRequestTime,this.model.get("bottomOfViewPortDebugSelector")&&this.bottomOfViewPortOnGetAd){var t=Object(n.a)(this.model.get("bottomOfViewPortDebugSelector"));this.adData.bovpg=!!this.bottomOfViewPortOnGetAd&&parseInt(this.bottomOfViewPortOnGetAd),this.adData.bovpv=t.length>0&&parseInt(U.offsetFromBottomOfViewPort(t[0]))}this.adData.dast=this.vpaidWrapper.tag.vidDast||this.vpaidWrapper.tag.dast,this.adData.mty=this.vpaidWrapper.tag.vpaidWrapperData&&this.vpaidWrapper.tag.vpaidWrapperData.mediatype?this.vpaidWrapper.tag.vpaidWrapperData.mediatype:void 0,this.adData.moatSampling=this.vpaidWrapper.tag.moatSampling||!1,this.adData.requiredViewabilityDrawn=this.vpaidWrapper.tag.requiredViewabilityDrawn||!1,this.vpaidWrapper.playerDAST&&this.vpaidWrapper.playerDAST.get&&(this.adData.pdast=this.vpaidWrapper.playerDAST.get()),this._setDebugReportDataOnGotAd(),this.vpaidWrapper.vpaidLog.data.unit_history=[],this.reportToVpaid("gotAd",{tab:this.model.get("isInTab"),eligibility:this.model.get("isEligibleToPlay"),gotVimpCountQ:this.model.get("impressionCount"),hadEligibility:this.model.get("hadEligibility"),hadLostEligibility:!!this.model.get("lostEligibilityTime"),predictName:this.predictName,getAdKey:"any"===this.getAdKey?10:this.getAdKey},!1),this.adData&&(u.a.supportTool.dp[this.adId]=this.adData.dp),this.setToModel("lastGotAdData",this.adData),this.model.get("lastImpressionData.sequenceId")?this.sequenceId=this.model.get("lastImpressionData.sequenceId")+1:this.sequenceId=1;var i=void 0;return this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.data&&(i=this.vpaidWrapper.vpaidLog.data._id),this.lastImpressionData={predictPoint:this.predictPoint,requiredViewability:this.vpaidWrapper.tag.requiredViewability,getAdKey:"any"===this.getAdKey?10:this.getAdKey,sequenceId:this.sequenceId,dp:this.vpaidWrapper.tag.dp,tagData:U.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]),vpaidId:i,lineItemId:this.vpaidWrapper.tag.lineItemId,predictName:this.predictName},this.setToModel("lastImpressionData",this.lastImpressionData),this._sendEventToKibana(this.kibanaEvents.gotAd,this.lastImpressionData),this.setToModel("impressionCount",this.model.get("impressionCount")+1),this.oppsService=new D({model:this.model,adData:this.adData,vpaidData:this.vpaidData,reportFunc:this.reportToVpaid.bind(this),getAdDataFunc:this.getAdData.bind(this),setDebugData:this.vpaidWrapper.setDebugData.bind(this.vpaidWrapper)}),this.vpaidWrapper.setDebugDataFunc&&this.vpaidWrapper.setDebugDataFunc(this.oppsService._getDebugData.bind(this.oppsService)),this.log.info("GotAd requiredViewability: ".concat(e.tag.requiredViewability?1:0)),this.getAdState=l.getAdState.gotAd,this.setToModel("getAdState",l.getAdState.gotAd),this.getAdResult=void 0,this._registerListeners(),this._onAdImpression(e),this._setAdRV(),null}catch(e){this.log.error(e)}finally{U.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoGotAd",m.TRC_PERFORMANCE_ACTIONS.STOP)}}},{key:"_getAdCatch",value:function(e){this.hadImpression||(this.getAdResult=void 0,this.log.info("GetAd failed requiredViewability: ".concat(this.getAdKey),this.adId),this.getAdState=l.getAdState.failed,this.setToModel("getAdCurrId",this.adId),this.setToModel("getAdState",l.getAdState.failed))}},{key:"_registerListeners",value:function(){this.vpaidWrapper.on&&(this.vpaidWrapper.on("AdError",this._onAdError.bind(this)),this.vpaidWrapper.on("AdVideoFirstQuartile",this._onAdVideoFirstQuartile.bind(this)),this.vpaidWrapper.on("AdVideoMidpoint",this._onAdVideoMidpoint.bind(this)),this.vpaidWrapper.on("AdVideoThirdQuartile",this._onAdVideoThirdQuartile.bind(this)),this.vpaidWrapper.on("end",this._adVideoEnd.bind(this)),this.vpaidWrapper.on("AdClickThru",this._onAdClickThru.bind(this)),this.vpaidWrapper.on("activeAdCurrentTime",this._onActiveAdCurrentTime.bind(this)),this.vpaidWrapper.on("NewCompletion",this._onNewCompletion.bind(this)))}},{key:"_onActiveAdCurrentTime",value:function(e){this.isCompleted||(this.setToModel("activeAdCurrentTime",e.currentTime),this.setToModel("activeAdMaxTime",e.duration))}},{key:"_onAdImpression",value:function(e){this.vpaidWrapper.pauseAd(),this._sendEventToKibana(this.kibanaEvents.adPaused,{pauseReason:"pauseOnAdImpression"}),this.reportToVpaid("pauseAdCalled",{reason:"pauseOnAdImpression",tab:this.model.get("isInTab")},!1),this._bringToBack(),this.log.info("onAdImpression (got ad - pausing ad)",this.adId),this.hadImpression=!0,this.rpox=e.tag.rpox,this.adQState=l.adQState.impression;var t={lineItemId:this.model.get("lineItemId"),placement:this.model.get("placement"),redId:this.model.get("redId")};this.model.get("isSendCPM")&&(t.cpm=this.adData.cpm),r.a.trigger("onImpression",t);var i=e.getVpaidData();this.adData.timeToImpression=i.startTimestamp?Date.now()-i.startTimestamp:void 0,this.model.get("adQState")===l.adQState.impression?setTimeout(this.model.trigger.bind(this.model,"change:adQState",this.adQState),0):setTimeout(this.setToModel.bind(this,"adQState",this.adQState),0),this.impressionCb(this),U.sendingEventToTaboolaBridge("impression",this.adId),this.adData.requiredViewability&&this._startOneSecondNoPlayTimer()}},{key:"_onAdError",value:function(e){this.log.error("Vpaid Wrapper Error, key: "+this.getAdKey,this.adId),U.sendingEventToTaboolaBridge("adError",this.adId)}},{key:"_onAdVideoFirstQuartile",value:function(){this.hadPlay&&(this.adQState=l.adQState.q1,this.setToModel("adQState",l.adQState.q1,this.adId),this.log.info("AdVideoFirstQuartile"),U.sendingEventToTaboolaBridge("firstQuartile",this.adId))}},{key:"_onAdVideoMidpoint",value:function(){this.hadPlay&&(this.adQState=l.adQState.q2,this.setToModel("adQState",l.adQState.q2,this.adId),this.log.info("AdVideoMidpoint"),U.sendingEventToTaboolaBridge("midpoint",this.adId))}},{key:"_onAdVideoThirdQuartile",value:function(){this.hadPlay&&(this.adQState=l.adQState.q3,this.setToModel("adQState",l.adQState.q3,this.adId),this.log.info("AdVideoThirdQuartile"),U.sendingEventToTaboolaBridge("thirdQuartile",this.adId))}},{key:"_adVideoEnd",value:function(){if(this.player){var e=this.subModel||this.model;if(this.model.get("isReplayAd")||e.stopListening(e,"change:nativeAdClick"),this._setAdPlayingWithAdChoice(!1),this.log.info("on ad video end",this.adId),this.reportToVpaid("vpaidDone",{tab:this.model.get("isInTab")},!0),this.isCompleted=!0,!this.hadPlay)return this.adState=l.adState.autoKill,void this.completeCb(this,!0);this._sendEventToKibana(this.kibanaEvents.adComplete),this.setToModel("activeTag",void 0),this.adQState=l.adQState.completed,this.adState=l.adState.completed,this.completeCb(this,!1),this.model.get("isReplayAd")||(this.vpaidWrapper=void 0,this.setToModel("activeAdData",void 0)),this.setOrTrigger("adQState",this.adQState),this.setOrTrigger("adState",this.adQState),this.getAdState=l.getAdState.stopped,u.a.supportTool.dp[this.adId]=void 0,delete u.a.supportTool.dp[this.adId],U.sendingEventToTaboolaBridge("complete",this.adId),this.onCompView100(),this._stopRV1Observer()}}},{key:"_onAdClickThru",value:function(){1===this.adClickCounter?(this.setToModel("clickThruState",l.clickThruState.clicked),this.oppsService.onAdClicked(),U.sendingEventToTaboolaBridge("adClick",this.adId),this.reportToVpaid("firstAdClick",{number:this.adClickCounter},!1)):this.reportToVpaid("falseAdClick",{number:this.adClickCounter},!1),this.adClickCounter++}},{key:"_onTitleContainerClick",value:function(){if(this._hasVpaidWrapper()){var e=this.vpaidWrapper.getVpaidData(),t=this.getFromModel("adNativeSettings").link||e.vastClickThruLink;t&&this._clickThru(t);var i=this.getFromModel("nativeAdClick");this.oppsService.fireTitleContaineClick(i),this._onAdClickThru()}}},{key:"_clickThru",value:function(e){if(this.model.get("isInApp")&&window.taboolaMobile&&window.tbNativeBridge){var t=window.tbNativeBridge;if(t.invoke)return void t.invoke("onClick",["",e,e,!1,"0","video"])}window.open(e)}},{key:"_bringToFront",value:function(){if(this.vpaidWrapper.localTarget){var e=this.model.get("style.videoBackgroundColor");Object(n.a)(this.vpaidWrapper.localTarget).css({zIndex:1e3,display:"block",backgroundColor:e})}}},{key:"_bringToBack",value:function(){this.vpaidWrapper.localTarget&&Object(n.a)(this.vpaidWrapper.localTarget).css({zIndex:0})}},{key:"_hasVpaidWrapper",value:function(){return this._hasPlayer()&&this.vpaidWrapper}},{key:"_hasPlayer",value:function(){return this.player&&!this.player.playerIsClosed}},{key:"setActiveTag",value:function(){this.log.info("setActiveTag",this.adId);var e=U.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]);this.model.get("activeTag")!==e&&this.setToModel("activeTag",e)}},{key:"getAdData",value:function(){if(this.vpaidWrapper){var e=void 0;this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.data&&(e=this.vpaidWrapper.vpaidLog.data._id);var t={adId:this.adId,predictPoint:this.predictPoint,requiredViewability:this.vpaidWrapper.tag?U.parseBool(this.vpaidWrapper.tag.requiredViewability):void 0,getAdKey:"any"===this.getAdKey?10:this.getAdKey,sequenceId:this.sequenceId,dp:this.vpaidWrapper.tag?this.vpaidWrapper.tag.dp:void 0,rpox:this.rpox,isCompleted:this.isCompleted,tagData:U.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]),vpaidId:e};return this._setSubUnitData(t),t}}},{key:"isPWOV",value:function(){return!(!this.vpaidWrapper||!this.vpaidWrapper.pwov)&&this.model.get("isPWOV")&&U.isFactor(100/this.vpaidWrapper.pwov)}},{key:"pause",value:function(){if((this.model.get("isInTab")&&"continueAd"===this.model.get("onOutOfView")||this.isPWOV())&&this.isViewabilityFired&&!this.model.get("blockedByExternalUnit"))return this.log.info("onOutOfView continueAd",this.adId),this.setToModel("adState",l.adState.continueAd),this.adState=l.adState.continueAd,this.oppsService.fireContinueAd(),this._sendEventToKibana(this.kibanaEvents.continueAd),void(this.isLostView100=!0);this._hasVpaidWrapper()&&(this.log.info("Pause ad",this.adId),this.vpaidWrapper.pauseAd(),this.oppsService.onFirstPauseAfterPlay(),this._sendEventToKibana(this.kibanaEvents.adPaused,{pauseReason:"outOfView"}),this.reportToVpaid("pauseAdCalled",{reason:"outOfView",tab:this.model.get("isInTab")},!1)),this.setToModel("adState",l.adState.paused),this.adState=l.adState.paused}},{key:"skipAd",value:function(){this.log.info("Skip ad",this.adId),this.setToModel("isReplayAd",!1),this._hasVpaidWrapper()&&this.vpaidWrapper.skipAd(),this.setToModel("adState",l.adState.skipped)}},{key:"play",value:function(){this.clearOnAdImpressionTimer(),this.model.set("lastActiveAd",this.adId),this.log.info("playing ad",this.adId);var e=this.getAdData();this.setToModel("activeAdData",e),this._hasVpaidWrapper()&&(this._updateAdChoiceVisibility(),this._keepReplayableAdAlive()),this.hadPlay||(this.hadPlay=!0,this.log.info("Winning ad: "+this.getAdKey,this.adId),this.model.get("isMultiActiveAds")||(this._bringToFront(this.vpaidWrapper),Object(n.a)(this.vpaidWrapper.adTarget).removeClass("_cm-ad")),this.setActiveTag(),this._checkIfStartRV1Observer(),this.adQState=l.adQState.q0,this.setToModel("adQState",l.adQState.q0),this._setDebugReportDataOnConversion(e),this.oppsService.onConversion(),this.adConversionFired(),this.setAdParametersToModel(),setTimeout(this._fireTwoSecAfterPlay.bind(this),2e3)),this._hasVpaidWrapper()?(this.log.info("resumeAd VpaidWrapper is alive ",this.adId),this._bringToFront(this.vpaidWrapper),this.vpaidWrapper.resumeAd(),this.model.set("hadPlayedAd",!0),this.reportToVpaid("resumeAdCalled",{tab:this.model.get("isInTab")},!1),this._sendEventToKibana(this.kibanaEvents.adPlay)):this.log.warning("resumeAd failed VpaidWrapper is NOT alive ",this.adId),setTimeout(this._firePlayEvents.bind(this),0),this.start||(this.start=!0,U.sendingEventToTaboolaBridge("start",this.adId));var t=this.getCurrModel();this.isLostView100||(this.isLostView100=!t.get("isViewable100"),this.isViewabilityListenerSet||this.isLostView100||(t.on("change:isViewable100",this.onViewabile100Change.bind(this)),this.isViewabilityListenerSet=!0))}},{key:"_firePlayEvents",value:function(){this.adState=l.adState.playing,this.setToModel("adState",l.adState.playing),r.a.trigger("global:adState:playing")}},{key:"_fireTwoSecAfterPlay",value:function(){this.oppsService.onTwoSecAfterPlay()}},{key:"cancelGetAd",value:function(){this.getAdResult&&(this.log.info("GetAd was cancelled",this.adId),this.getAdResult.cancel(),this.getAdResult=void 0)}},{key:"setToModel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.model.set(e,t,i),this.subModel&&this.subModel.set(e,t,i)}},{key:"getFromModel",value:function(e){return this.subModel?this.subModel.get(e):this.model.get(e)}},{key:"setSubModel",value:function(e){this.subModel=e,this.oppsService&&this.oppsService.setSubModel(this.subModel)}},{key:"getCurrModel",value:function(){return this.subModel?this.subModel:this.model}},{key:"forceTrigger",value:function(e){this.model.trigger("change:"+e,this.model,this.model.get(e)),this.subModel&&this.subModel.trigger("change:"+e,this.subModel,this.subModel.get(e))}},{key:"setOrTrigger",value:function(e,t){this.model.get(e)===t?this.forceTrigger(e):this.setToModel(e,t)}},{key:"resize",value:function(e){e&&e.width&&e.height?this.sizeObj.width===e.width&&this.sizeObj.height===e.height||(this.sizeObj.width=e.width,this.sizeObj.height=e.height,this.log.info("resizing ad",n.a.extend({},e,{adId:this.adId,aspectRatio:this.aspectRatioString})),this.vpaidWrapper.resizeAd(e.width,e.height,this.aspectRatioString)):this.log.warning("resize was called with empty sizeObj!",e)}},{key:"recheckSize",value:function(){var e=this.sizeObj;this.sizeObj={},this.resize(e)}},{key:"mute",value:function(){this.vpaidWrapper&&(this.log.info("Mute Player"),this.vpaidWrapper.mute(),U.sendingEventToTaboolaBridge("volumeChange",0))}},{key:"unmute",value:function(){this.vpaidWrapper&&(this.log.info("UnMute Player"),this.vpaidWrapper.unmute(),this.oppsService.fireAdUnmuted(),U.sendingEventToTaboolaBridge("volumeChange",100))}},{key:"fireSkipVimp1EligibilityLost",value:function(e){this.clearOnAdImpressionTimer(),this.oppsService.fireSkipVimp1EligibilityLost(e)}},{key:"fireSkipVimp1Vimp0Playing",value:function(e){this.clearOnAdImpressionTimer(),this.oppsService.fireSkipVimp1Vimp0Playing(e)}},{key:"onViewability",value:function(){this.isViewed||(this.isViewed=!0,this.adViewabilityFired(),this.oppsService.onViewability(),this._sendEventToKibana(this.kibanaEvents.viewability))}},{key:"onViewabilityOneS",value:function(){this.isViewedOneS||(this.isViewedOneS=!0,this.oppsService.onViewabilityOneS())}},{key:"onViewability100",value:function(){this.isViewed100||(this.setToModel("viewability100",!0),this.isViewed100=!0,this.oppsService.onViewability100())}},{key:"onViewabilityAMP",value:function(){this.isViewedAMP||(this.isViewedAMP=!0,this.isNoViewedAMP=!0,this.oppsService.onViewabilityAMP())}},{key:"onNoViewabilityAMP",value:function(){this.isNoViewedAMP||(this.isNoViewedAMP=!0,this.oppsService.onNoViewabilityAMP())}},{key:"onCompView100",value:function(){this.isLostView100||this.isCompViewed100||(this.isCompViewed100=!0,this.oppsService.onCompView100())}},{key:"onDetached",value:function(){this.isDetached||(this.isDetached=!0,this.oppsService.onAdDetached())}},{key:"onAttached",value:function(){this.isDetached&&(this.isDetached=!1,this.oppsService.onAdAttached())}},{key:"onSliderClose",value:function(){this.isSliderClosed||(this.isSliderClosed=!0,this.oppsService.onAdSliderClosed())}},{key:"reportToVpaid",value:function(e,t,i){this._setSubUnitData(t),this._hasVpaidWrapper()&&this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.push&&(this.vpaidWrapper.vpaidLog.push("unit_".concat(e),t,!1),this.vpaidWrapper.vpaidLog.data&&this.vpaidWrapper.vpaidLog.data.unit_history&&this.vpaidWrapper.vpaidLog.data.unit_history.push&&this.vpaidWrapper.vpaidLog.data.unit_history.push(e),this.vpaidWrapper.vpaidLog.data.statuses.push(e),i&&this.vpaidWrapper.vpaidLog.push("unit_state",{status:e},i))}},{key:"fireSkipVimp1EligibilityLost",value:function(e){this.oppsService.fireSkipVimp1EligibilityLost(e)}},{key:"fireSkipVimp1Vimp0Playing",value:function(e){this.oppsService.fireSkipVimp1Vimp0Playing(e)}},{key:"reportRpoxSkip",value:function(e){this.reportToVpaid("skipRpox",{otherRpox:e.rpox,otherRequiredViewability:e.requiredViewability,otherAdDp:e.dp,otherSequenceId:e.sequenceId},!1)}},{key:"reportPpKeySkip",value:function(e){this.reportToVpaid("skipPpKey",{otherRpox:e.rpox,otherRequiredViewability:e.requiredViewability,otherAdDp:e.dp,otherSequenceId:e.sequenceId},!1)}},{key:"_setAdPlayingWithAdChoice",value:function(e){this.setToModel("adPlayingWithAdChoice",e)}},{key:"_updateAdChoiceVisibility",value:function(){this.vpaidWrapper.hasAdChoices?this._setAdPlayingWithAdChoice(!0):this._setAdPlayingWithAdChoice(!1)}},{key:"_setSubUnitData",value:function(e){var t=this.model.get("subUnitType");if(this.model&&(t||0===t)&&(e.su=t),this.subModel){var i=this.model.get("detachToSlider"),n=this.subModel.get("gotFirstEligibility");i&&i.isStartFromSlider&&i.isDetachToSlider?e.sp=n?this.subModel.get("cardNumber"):0:i&&i.isStartFromSlider&&!this.subModel.get("isEligibleToPlay")?e.sp=0:this.model.get("cardNumber")&&(e.sp=this.model.get("cardNumber"))}else this.model.get("MSNCard.row")&&(e.sp=this.model.get("MSNCard.row"))}},{key:"_handleKibana",value:function(e){this.kibanaEvents=m.KIBANA_EVENTS,e&&(this.kibana=e)}},{key:"_sendEventToKibana",value:function(e,t){this.kibana&&((t=t||{}).adId=this.adId,this.subModel&&this.subModel.get("cardNumber")&&(t.cardNumber=this.subModel.get("cardNumber")),this.kibana.adEvent(e,t))}},{key:"onCardSwap",value:function(){this.oppsService.fireContinueAdInAnotherCard()}},{key:"onShouldCardSwap",value:function(){this.oppsService.fireShouldContinueAdInAnotherCard()}},{key:"onLearnMoreClick",value:function(){this.oppsService.fireLearnMoreClick()}},{key:"_setDebugReportDataOnGotAd",value:function(){this.model.increaseCounter("sqv"),this.adData.requiredViewability?this.model.increaseCounter("rvvs1"):this.model.increaseCounter("rvvs0"),this.adData.pn=this.predictName,this.adData.adId=this.adId,this.adData.esv=this.vpaidData.earlySrcVPAID}},{key:"_setDebugReportDataOnConversion",value:function(){this.model.increaseCounter("conversionCount"),this.adData.requiredViewability?this.model.increaseCounter("rvps1"):this.model.increaseCounter("rvps0")}},{key:"_setAdRV",value:function(){this.adData.requiredViewability?this.setToModel("gotRvAd",!0):this.setToModel("gotNonRvAd",!0)}},{key:"_getTimeOut",value:function(){return this.model.get("vForce.secondsToGetAdFail.".concat(this.getAdKey))}},{key:"_setAdTypeConfig",value:function(){if(this.vpaidWrapper&&this.vpaidWrapper.getVpaidData){var e=this.vpaidWrapper.getVpaidData();for(var t in this.adTypeTranslator=new R.default({model:this.subModel||this.model}),this.adTypeConfig={},e)if(e[t]){var i=this.adTypeTranslator.getConfigForKey(t);if(U.isEmpty(i))continue;if(this.log.info("got adTypeConfig for key "+t,i),i.revertAfter){var n=this._createRevertAdType(i,t);this._setAdTypeConfigAfter(i.revertAfter,n)}i.setAdConfigAfter?this._setAdTypeConfigAfter(i.setAdConfigAfter,i):this.setToModel(i),this.adTypeConfig[t]=i}this.aspectRatioNum=this.getAspectRatioNum(e),this.log.info("Ad size received is - width: "+e.adWidth+"; height: "+e.adHeight),this._setAdTypeConfigAfter("setSubModel",{aspectRatioNum:this.aspectRatioNum}),this.supportVideoCurrentTimeEvents=e.supportVideoCurrentTimeEvents}}},{key:"_setAdTypeConfigAfter",value:function(e,t){var i=this[e];U.isFunction(i)&&(this[e]=function(){i.apply(this,arguments),this.setToModel(t),this.log.info("setting ad type config after ".concat(i.name," function"),t)})}},{key:"_createRevertAdType",value:function(e,t){var i={};for(var n in e)"setAdConfigAfter"!==n&&"revertAfter"!==n&&(i[n]=this.model.get(n));return i}},{key:"onAdSetToUnits",value:function(){}},{key:"_keepReplayableAdAlive",value:function(){var e=this.vpaidWrapper;e.dontDie&&this.model.get("isReplayAd")&&(e.isReplayable||this.model.get("isForceDontDie"))&&(e.dontDie(),this.model.set("dontRenderRepeatButton",!e.isReplayable))}},{key:"setAdParametersToModel",value:function(){if(this.model.get("components.nativeAd.isActive")){var e=this.vpaidWrapper.getVpaidData(),t=e.adNativeSettings||{},i=this.subModel||this.model;e.adNativeSettings&&this.model.set("continueToPlayInNexCard.isActive",!1),this.setNativeAdClickListener(),this.setToModel("adNativeSettings",void 0,{silent:!0}),this.setToModel("adNativeSettings",t,{silent:!0}),i.trigger("change:adNativeSettings",i,i.get("adNativeSettings"))}this.vpaidWrapper.clickThruUrl?(this.log.info("updated click through URL",this.vpaidWrapper.clickThruUrl),this.setToModel("adClickThroughUrl",this.vpaidWrapper.clickThruUrl)):this.setToModel("adClickThroughUrl",""),this.setToModel("activeAdRV",this.adData.requiredViewability)}},{key:"_setTagDataToStorage",value:function(){try{this.model.setStorage("activeAdData",this.vpaidWrapper.tag)}catch(e){this.log.error("error setting activeAdData",{error:e,tag:this.vpaidWrapper.tag})}}},{key:"setNativeAdClickListener",value:function(){var e=this.subModel||this.model;e.listenTo(e,"change:nativeAdClick",this._onTitleContainerClick.bind(this))}},{key:"_sendPixel",value:function(e){"img"===e.method?(new Image).src=e.pixel:"js"===e.method&&this._sendJSPixel(e.pixel)}},{key:"_sendJSPixel",value:function(e){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.async=!0,document.body.appendChild(t)}},{key:"getAspectRatioNum",value:function(e){return e&&e.supportVerticalVideo?(this.aspectRatioString=e.adWidth.toString()+":"+e.adHeight.toString(),e.adWidth/e.adHeight):this.aspectRatioNum?this.aspectRatioNum:(this.aspectRatioString="16:9",this.model.get("defaultAspectRatioNum"))}},{key:"onadProgressionAfterBeginPredict",value:function(){this.oppsService.adProgressionAfterBeginPredict()}},{key:"onadProgressionBeforeEndPredictPredict",value:function(){this.oppsService.adProgressionBeforeEndPredict()}},{key:"onAdSwappedOut",value:function(){this.oppsService.adSwappedOut()}},{key:"onAdSwappedIn",value:function(){this.oppsService.adSwappedIn()}},{key:"_startOneSecondNoPlayTimer",value:function(){var e=Object(n.a)(this.subModel?this.subModel.get("parentSelector"):this.model.get("parentSelector"));this.mesureElement=U.isArray(e)?e[0]:e,this.onImpressionPosition=U.offsetFromBottomOfViewPort(this.mesureElement),this.onAdImpressionTimer=setTimeout(this._reportOneSecondNoPlay.bind(this),1e3)}},{key:"_reportOneSecondNoPlay",value:function(){null!==this.onAdImpressionTimer&&(this.onOneSecondPosition=U.offsetFromBottomOfViewPort(this.mesureElement),this.onImpressionPosition===this.onOneSecondPosition&&this.oppsService.onOneSecondNoPlaySamePlace(),this.onImpressionPosition>this.onOneSecondPosition&&this.oppsService.onOneSecondNoPlayScrolledDown(),this.onImpressionPosition<this.onOneSecondPosition&&this.oppsService.onOneSecondNoPlayScrolledUp())}},{key:"clearOnAdImpressionTimer",value:function(){this.onAdImpressionTimer&&(clearTimeout(this.onAdImpressionTimer),this.onAdImpressionTimer=null)}},{key:"onViewabile100Change",value:function(){var e=this.getCurrModel();this.model.get("adState")===l.adState.paused||e.get("isViewable100")||(this.isLostView100=!0)}},{key:"_onNewCompletion",value:function(){this.onCompView100()}},{key:"handleAdjacencyAd",value:function(){this.model.get("hasScAdjacency")&&(this.getAdProperties=U.extend(this.getAdProperties,{excAdProperties:{adjacencyAd:[!0]}}))}},{key:"onDisplayingFullNAS",value:function(){this.firedDisplayingFullNAS||(this.firedDisplayingFullNAS=!0,this.oppsService.onDisplayingFullNAS())}},{key:"onDisplayingNASTitleOnly",value:function(){this.firedDisplayingNASTitleOnly||(this.firedDisplayingNASTitleOnly=!0,this.oppsService.onDisplayingNASTitleOnly())}},{key:"fireAdOppOnce",value:function(e){this["".concat(e,"Fired")]||(this["".concat(e,"Fired")]=!0,this.oppsService.fireGenericOpp(e))}},{key:"_stopRV1Observer",value:function(){this.AmpViewabilityHelper&&(this.AmpViewabilityHelper.stopObserver(this.targetElement),this.AmpViewabilityHelper=null)}},{key:"_checkIfStartRV1Observer",value:function(){this.model.get("frameType")===m.FRAME_TYPE.amp&&this.model.get("isUseAmpObserver")&&(this.AmpViewabilityHelper=new N.a({model:this.model,subModel:this.subModel}),this.targetElement=this.vpaidWrapper.adTarget?this.vpaidWrapper.adTarget:this.vpaidWrapper.localTarget,this.targetElement&&(this.log.info("Winning ad vpaidWrapper: ",this.targetElement),this.AmpViewabilityHelper.startObserver(this.targetElement)))}},{key:"onHipAdjacAdWithoutReplay",value:function(){this.oppsService.onHipAdjacAdWithoutReplay()}}])&&F(t.prototype,i),s}(s.a),H=i(10);function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==$(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K=i(5),Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Y(e);if(t){var o=Y(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return q(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e,t.log=new a.a({unitType:t.model.get("unitType"),className:"seerService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.activePredict={},t._createPlayerReadyPredict(),t._createRequestedPredictors(),t}return t=o,(i=[{key:"multiAd",value:function(){this.activePredict.multiAd||(this.activePredict.multiAd=[]);var e=this.model.get("predictors.multiAd.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"qState",predictArr:this.activePredict.multiAd,predict:H.p})}},{key:"emptyQueue",value:function(){this.activePredict.emptyQueue=this._createPredict(H.g,this.getAdProperties("emptyQueue"))}},{key:"getAdFail",value:function(){this.activePredict.getAdFailPredict=this._createPredict(H.l,this.getAdProperties("getAdFail"))}},{key:"repeat",value:function(){this.activePredict.repeatPredict=this._createPredict(H.r,this.getAdProperties("repeat"))}},{key:"loading",value:function(){this.activePredict.loadingPredict=this._createPredict(H.n,this.getAdProperties("loading"))}},{key:"autoKill",value:function(){this.activePredict.autoKillPredict=this._createPredict(H.c,this.getAdProperties("autoKill"))}},{key:"fullEligibility",value:function(){this.activePredict.fullEligibilityPredict=this._createPredict(H.k,this.getAdProperties("fullEligibility"))}},{key:"bForce",value:function(){this.activePredict.bForcePredict=this._createPredict(H.d,this.getAdProperties("bForce"))}},{key:"distancePercent",value:function(){this.activePredict.distancePercent||(this.activePredict.distancePercent=[]);var e=this.model.get("predictors.distancePercent.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"requirePercentageToSelector",predictArr:this.activePredict.distancePercent,predict:H.e})}},{key:"distancePixels",value:function(){this.activePredict.distancePixels||(this.activePredict.distancePixels=[]);var e=this.model.get("predictors.distancePixels.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"pixelsFromSelectors",predictArr:this.activePredict.distancePixels,predict:H.f})}},{key:"firstScroll",value:function(){this.activePredict.firstScrollPredict=this._createPredict(H.j,this.getAdProperties("firstScroll"))}},{key:"feedX",value:function(){this.activePredict.feedXPredict=this._createPredict(H.i,this.getAdProperties("feedX"))}},{key:"feedContainerChanged",value:function(){this.activePredict.feedContainerChanged=this._createPredict(H.h,this.getAdProperties("feedContainerChanged"))}},{key:"time",value:function(){this.activePredict.time||(this.activePredict.time=[]);var e=this.model.get("predictors.time.predictPoints");"number"==typeof e||Array.isArray(e)?this._createPredict(H.s,{}):this._createMultiPointPredict({predictPoints:e,predictArr:this.activePredict.time,predict:H.s})}},{key:"transition",value:function(){this.activePredict.transition||(this.activePredict.transition=[]);var e=this.model.get("predictors.transition.predictPoints");this._createMultiPointPredict({predictPoints:e,predictArr:this.activePredict.transition,predict:H.t})}},{key:"intersection",value:function(){this.activePredict.intersectionPredict||(this.activePredict.intersectionPredict=[]);var e=this.model.get("predictors.intersection.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"intersectionPercent",predictArr:this.activePredict.intersectionPredict,predict:H.m})}},{key:"adProgressionAfterBegin",value:function(){this.activePredict.adProgressionAfterBeginPredict||(this.activePredict.adProgressionAfterBeginPredict=[]);var e=this.model.get("predictors.adProgressionAfterBegin.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"secondsAfterBegin",predictArr:this.activePredict.adProgressionAfterBeginPredict,predict:H.a})}},{key:"adProgressionBeforeEnd",value:function(){this.activePredict.adProgressionBeforeEndPredict||(this.activePredict.adProgressionBeforeEndPredict=[]);var e=this.model.get("predictors.adProgressionBeforeEnd.predictPoints");this._createMultiPointPredict({predictPoints:e,pointKey:"secondsBeforeEnd",predictArr:this.activePredict.adProgressionBeforeEndPredict,predict:H.b})}},{key:"mp4",value:function(){this.activePredict.mp4Predict=this._createPredict(H.o,this.getAdProperties("mp4"))}},{key:"_createPlayerReadyPredict",value:function(){this.model.get("predictors.playerReady")&&this.model.get("predictors.playerReady.isActive")&&(this.activePredict.playerPredict=this._createPredict(H.q,this.getAdProperties("playerReady")))}},{key:"onPredict",value:function(e,t,i){this.model.get("stopPredicts")||(this.model.set("nextPredictName",t),this.model.set("nextPredict",e),this.model.set("nextAdProperties",i),this.model.increaseCounter("predictCounter"))}},{key:"startWF",value:function(){this.model.set("startWF",!0)}},{key:"_createRequestedPredictors",value:function(){if(this.model.get("playerState")===l.readyState){var e=this,t=this.model.get("predictors");Object.keys(t).forEach(function(i){var n=t[i];n&&e[i]&&(n.isActive||n.isStartWF)&&!e.activePredict[i]&&(this.log.info("Predict activePredict",i),e[i].call(e))}.bind(this))}else this.model.listenToOnce(this.model,"change:playerState",this._createRequestedPredictors.bind(this))}},{key:"_createMultiPointPredict",value:function(e){var t=this,i=e.predictPoints,n=e.pointKey,o=e.predictArr,r=e.predict;K.each(i,(function(e,i){o.push(t._createPredict(r,{predictPoint:e[n],predictKey:void 0!==e.key?e.key:i,adProperties:{adProperties:e.adProperties,excAdProperties:e.excAdProperties}}))}))}},{key:"_createPredict",value:function(e,t){return K.extend(t,{model:this.model,onPredict:this.onPredict,startWfFunc:this.startWF}),new e(t)}},{key:"getAdProperties",value:function(e){return{adProperties:{adProperties:this.model.get("predictors.".concat(e,".adProperties")),excAdProperties:this.model.get("predictors.".concat(e,".excAdProperties"))}}}}])&&z(t.prototype,i),o}(s.a),X=i(14),J=i(24);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ie(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?ne(e):t}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var re=i(5),se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(s,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=oe(e);if(t){var o=oe(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ie(this,i)}}(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).model=e,t.log=new a.a({unitType:t.model.get("unitType"),className:"pixelsService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.hadEligibility=!1,t.hadImpression=!1,t.playerHadRvInQ=!1,t.shouldFirePauseAfterPlay=!1,t.adsList={},t._bindEvents(),t.model.set("hadEligibility",!1),t.model.get("detachToSlider.isStartFromSlider")&&t._firePixel(t.model.getPixel("pixels.sliderFeedStartWithABT"),"slider to feed start with abTest"),t._fireCMPpixel(),r.a.once("window:resize:change",t._onWindowResize.bind(ne(t))),r.a.once("window:orientation:change",t._onDeviceOrientationChange.bind(ne(t))),t}return t=s,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"adQState:impression",funcName:"_onAdImpression"},{event:"adState:playing",funcName:"_onAdPlaying"},{event:"adState:completed",funcName:"_onAdCompleted"},{event:"loadingViewState:clicked",funcName:"_onRepeatClicked"},{event:"isEligibleToPlay",funcName:"_onEligibilityChange"},{event:"eligibilityValidation.isValid",funcName:"_onEligibilityValidationChange"},{event:"videoViewState:attached",funcName:"_fireAttachPixel",isListenOnce:!0},{event:"videoViewState:detached",funcName:"_fireDetachPixel",isListenOnce:!0},{event:"closeTimer",funcName:"_fireTimerPixel"},{event:"getAdState:gettingAd",funcName:"_fireGetAdPixel"},{event:"TRCResetCloseUnit:true",funcName:"_onTRCResetCloseUnit"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"},{event:"isSkippedDistancePredict:true",funcName:"_onSkipDistancePredict"},{event:"publisherVideoDetected:true",funcName:"_onPublisherVideoDetected"},{event:"rvHandlerTimerExpired:true",funcName:"_onRvHandlerTimerExpired"},{event:"playerHasRvInQ:true",funcName:"_onPlayerHasRvInQ"},{event:"fullEligibilityPredicted:true",funcName:"_onFullEligibilityPredicted"},{event:"publisherIframeVideoDetected:true",funcName:"_onPublisherIframeVideoDetected",isListenOnce:!0},{event:"compDetected",funcName:"_onCompetitionDetected"},{event:"progressLoaderInit:true",funcName:"_onProgressLoaderInit"},{event:"progressLoaderTimerReached:true",funcName:"_onProgressLoaderMove"},{event:"progressLoaderViewClosed:true",funcName:"_onProgressLoaderClose"},{event:"feedxToggle",funcName:"_onFeedxToggle"},{event:"isOrganicCardInjected:true",funcName:"_onOrganicCardInjected"},{event:"organicInjectorFail:true",funcName:"_onOrganicCardInjectionFail"},{event:"isTerminateOnResize:true",funcName:"_onTerminateOnResize"},{event:"generalError",funcName:"_onGeneralError"},{event:"exploreMore",funcName:"_onExploreMore"},{event:"foundUnitDimensions:true",funcName:"_onUnitDimensionsFound"},{event:"videoResetCloseUnit:true",funcName:"_onVideoResetCloseUnit"},{event:"hadForcedDetach:true",funcName:"_onForcedDetach"},{event:"misplacedVideoDetected:true",funcName:"_onMisplacedVideoDetected"},{event:"overlayDetected",funcName:"_onOverlayDetected"},{event:"noAdjacInFirstWFs:true",funcName:"_onNonAdjacInFirstWFs"}]),r.a.once("global:passback",this._onPassbackFunctionCalled.bind(this)),this.model.get("autoplaySoundOn")?this._onAutoplayVolumeStatus():this.createStateHandlers([{event:"autoplaySoundOn:true",funcName:"_onAutoplayVolumeStatus",isListenOnce:!0}])}},{key:"_onWindowResize",value:function(){this._firePixel(this.model.getPixel("pixels.windowResize"),"window.resize event triggered")}},{key:"_onDeviceOrientationChange",value:function(){this._firePixel(this.model.getPixel("pixels.deviceOrientationChange"),"Device orientation changed")}},{key:"_onAdImpression",value:function(){this._firePixel(this.model.getPixel("pixels.addImpresion"),"addImpresion (the player got an ad)")}},{key:"_onAdPlaying",value:function(){var e=this.model.get("activeAdData");this.adsList[e.adId]&&this.adsList[e.adId].hadPlay||(this.adsList[e.adId]=e,this.adsList[e.adId].hadPlay=!0,this._firePixel(this.model.getPixel("pixels.conversion"),"conversion (the ad is playing)"))}},{key:"_onAdCompleted",value:function(){this.isViewed=!1,this.activeTag=void 0}},{key:"_onOverlayDetected",value:function(e){e.get("adState")===l.adState.playing?this._onOverlayAfterImpression(e):this._onOverlayBeforeImpression(e)}},{key:"_onOverlayBeforeImpression",value:function(e){if(!this.firedOverlayBeforeImpressionPixel){this.firedOverlayBeforeImpressionPixel=!0;var t=this.model.get("overlay")||{};this._firePixel(this.model.getPixel("pixels.overlayDetected"),"Overlay detected",{debug:"".concat(t.overlayData,";ap:").concat(t.actualEligiblePercent)})}}},{key:"_onOverlayAfterImpression",value:function(e){if(!this.firedOverlayAfterImpressionPixel){var t=this.model.get("pixels.overlayDetectedAfterImpression");if(t.isFire&&re.rollNumbers(t.factor||0)){this.firedOverlayAfterImpressionPixel=!0;var i=this.model.get("overlay")||{};this._firePixel(this.model.getPixel("pixels.overlayDetectedAfterImpression"),"Overlay detected after impression",{debug:"".concat(i.overlayData,";ap:").concat(i.actualEligiblePercent)})}}}},{key:"_onEligibilityChange",value:function(e,t,i){this.stopSendingEligibility||(t&&!this.hadEligibility?this._onEligibility():!t&&this.hadEligibility&&i&&!i.isValidation&&(this._firePixel(this.model.getPixel("pixels.lostEligibility"),"Lost first eligible"),this.model.set("lostEligibilityTime",(new Date).getTime()),this.stopSendingEligibility=!0))}},{key:"_onEligibilityValidationChange",value:function(e,t){t?this.hadValidatedEligibility||(this.hadValidatedEligibility=!0,this._firePixel(this.model.getPixel("pixels.validEligibility"),"First validated eligible")):this._onEligibilityChange(e,!0,{isValidation:!0})}},{key:"_onEligibility",value:function(){this.model.set("hadEligibility",!0),this.hadEligibility=!0,this._firePixel(this.model.getPixel("pixels.eligible"),"First eligible")}},{key:"_onRepeatClicked",value:function(){this._firePixel(this.model.getPixel("pixels.repeatClick"),"repeat click Pixel")}},{key:"_onRenderWasCalled",value:function(){this._firePixel(this.model.getPixel("pixels.renderOnDemand"),"Render Was Called")}},{key:"_onPublisherVideoDetected",value:function(){this._firePixel(this.model.getPixel("pixels.publisherVideoDetected"),"Publisher Video Tag was Detected")}},{key:"_onPublisherIframeVideoDetected",value:function(){this._firePixel(this.model.getPixel("pixels.publisherIframeVideoDetected"),"Publisher Video Tag was Detected in iframe")}},{key:"_fireCMPpixel",value:function(){this.model.get("hasCMPonPage")?this._firePixel(this.model.getPixel("pixels.hasCMPonPage"),"GDPR - Has CMP on page"):this._firePixel(this.model.getPixel("pixels.noCMPonPage"),"GDPR - No CMP on page")}},{key:"_onForcedDetach",value:function(){this._firePixel(this.model.getPixel("pixels.forcedDetach"),"forced detach to slider")}},{key:"_onRecoReelNotFound",value:function(){this.recoReelNotFoundFired||(this.recoReelNotFoundFired=!0,this._firePixel(this.model.getPixel("pixels.recoReelNotFound"),"RecoReel Not Found Pixel"))}},{key:"_firePixel",value:function(e,t,i){e&&(e=this._setAdditionalData(e,i),this.log.pixel("firing pixel: "+t+" url: "+e),document.createElement("IMG").src=e)}},{key:"_setAdditionalData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.model.get("modifiedPlacement")&&(t.mp=this.model.get("modifiedPlacement")),this.model.get("subUnitType")&&(t.su=this.model.get("subUnitType")),this._addParametersToUrl(e,t,-1===e.indexOf("?"))}},{key:"_addParametersToUrl",value:function(e,t,i){var o=e;return o+=i?"?":"&",n.a.each(t,(function(e,t){void 0!==t&&""!==t&&(o+=e+"="+t+"&")})),o}},{key:"_fireAttachPixel",value:function(){this._firePixel(this.model.getPixel("pixels.attach"),"first attach")}},{key:"_fireDetachPixel",value:function(){this._firePixel(this.model.getPixel("pixels.detach"),"first detach")}},{key:"_fireTimerPixel",value:function(e,t){this.model.get("pixels.".concat(t,"Timer.isFire"))&&this._firePixel(this.model.getPixel("pixels.".concat(t,"Timer")),"".concat(t," timer"))}},{key:"_fireGetAdPixel",value:function(){var e={};this._setDebugReportData(e),"any"===this.model.get("lastGetAdKey")&&this.model.get("pixels.getAdAny.isFire")?this._firePixel(this.model.getPixel("pixels.getAdAny"),"getAd",e):0===this.model.get("lastGetAdKey")&&this.model.get("pixels.getAdNoRV.isFire")?this._firePixel(this.model.getPixel("pixels.getAdNoRV"),"getAd",e):1===this.model.get("lastGetAdKey")&&this.model.get("pixels.getAd.isFire")&&this._firePixel(this.model.getPixel("pixels.getAd"),"getAd",e)}},{key:"_onTRCResetCloseUnit",value:function(){this._firePixel(this.model.getPixel("pixels.TRCResetCloseUnit"),"TRCResetCloseUnit")}},{key:"_onVideoResetCloseUnit",value:function(){this._firePixel(this.model.getPixel("pixels.onVideoResetCloseUnit"),"VideoResetCloseUnit")}},{key:"_onParentSelectorLost",value:function(){this._firePixel(this.model.getPixel("pixels.onParentSelectorLost"),"onParentSelectorLost")}},{key:"_onRvHandlerTimerExpired",value:function(){this._firePixel(this.model.getPixel("pixels.rvHandlerTimerExpired"),"rvHandlerTimerExpired")}},{key:"_onPlayerHasRvInQ",value:function(){this.playerHadRvInQ||(this._firePixel(this.model.getPixel("pixels.onPlayerHasRVinQ"),"onPlayerHasRVinQ"),this.playerHadRvInQ=!0)}},{key:"_setDebugReportData",value:function(e){if(this.model.get("isSendDebugDataReporting")){var t=g.a.PREDICT_NAMES[this.model.get("nextPredictName")],i="pn:".concat(t,"!sqg:").concat(this.model.get("adId"),"!");for(var n in g.a.DEBUG_DATA_PIXELS){var o=this[n]();i+=void 0===o?"".concat(g.a.DEBUG_DATA[n],":!"):"".concat(g.a.DEBUG_DATA[n],":").concat(o,"!")}e.debug=i,this.model.get("isSendDebugDataReportingLog")&&this.log.info("DBG-Pixel getAd-".concat(this.model.get("lastGetAdKey")," - ").concat(i))}}},{key:"_onSkipDistancePredict",value:function(){this._firePixel(this.model.getPixel("pixels.skippedDistancePredict"),"onSkipDistancePredict")}},{key:"_onFullEligibilityPredicted",value:function(){this.model.get("pixels.fullEligibilityPredict.isFire")&&this._firePixel(this.model.getPixel("pixels.fullEligibilityPredict"),"fullEligibilityPredict")}},{key:"_onCompetitionDetected",value:function(){this._firePixel(this.model.getPixel("pixels.compDetectedOnPage"),"compDetectedOnPage")}},{key:"_onMisplacedVideoDetected",value:function(){var e={debug:"!url:"+(window&&window.location&&window.location.href?window.location.href:"")};this._firePixel(this.model.getPixel("pixels.misplacedVideoDetected"),"misplacedVideoDetected",e)}},{key:"ft",value:function(){return this.model.get("frameType")}},{key:"fsc",value:function(){var e=this.model.get("startCard");if(void 0!==e&&""!==e)return parseInt(e)}},{key:"fpc",value:function(){var e=this.model.get("permanentCard");if(void 0!==e&&""!==e)return parseInt(e)}},{key:"_onFeedxToggle",value:function(){this._firePixel(this.model.getPixel("pixels.feedxToggle"),"feedxToggled")}},{key:"_onExploreMore",value:function(){this._firePixel(this.model.getPixel("pixels.exploreMore"),"exploreMore")}},{key:"_onProgressLoaderInit",value:function(){this._firePixel(this.model.getPixel("pixels.progressLoaderInit"),"progressLoaderInit")}},{key:"_onProgressLoaderClose",value:function(){this._firePixel(this.model.getPixel("pixels.progressLoaderClose"),"progressLoaderClose")}},{key:"_onProgressLoaderMove",value:function(){this._firePixel(this.model.getPixel("pixels.progressLoaderMove"),"progressLoaderMove")}},{key:"_onOrganicCardInjected",value:function(){this._firePixel(this.model.getPixel("pixels.organicCardInjected"),"organicCardInjected")}},{key:"_onOrganicCardInjectionFail",value:function(){this._firePixel(this.model.getPixel("pixels.organicCardInjectionFail"),"organicCardInjectionFail")}},{key:"_onTerminateOnResize",value:function(){this._firePixel(this.model.getPixel("pixels.terminateOnResize"),"closeDueResize")}},{key:"_onUnitDimensionsFound",value:function(){this._firePixel(this.model.getPixel("pixels.onUnitDimensionsFound"),"UnitDimensionsFound")}},{key:"_onAutoplayVolumeStatus",value:function(){this.isSentAutoplayVolume||(this._firePixel(this.model.getPixel("pixels.autoplaySoundOn"),"autoplaySoundOn"),this.isSentAutoplayVolume=!0)}},{key:"_onGeneralError",value:function(){var e={debug:"ge:"+this.model.get("generalErrorData")};this._firePixel(this.model.getPixel("pixels.generalError"),"generalErrorData",e)}},{key:"_onPassbackFunctionCalled",value:function(){(re.isFunction(this.model.get("onPassback"))||this.model.get("isApiPassbackExist"))&&this._firePixel(this.model.getPixel("pixels.passbackFunctionCalled"),"passback function called")}},{key:"_onNonAdjacInFirstWFs",value:function(){this._firePixel(this.model.getPixel("pixels.noAdjacInFirstWFs"),"noAdjacInFirstWFs")}}])&&ee(t.prototype,i),s}(s.a),ae=i(26),le=i(9),ce=i.n(le);i(5);var de=(ae.a,i(17));i(5);de.a;i(5);var ue=(de.a,i(15));i(5);ue.a;i(5);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}ue.a;var ye=i(5),ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(s,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ge(e);if(t){var o=ge(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return me(this,i)}}(s);function s(e,t,i,r){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(l=o.call(this,e,i)).globalModel=i,l.onAdRvChange(r),l.model.set("isInTab",l.globalModel.get("isInTab")),l.log=new a.a({unitType:"Service",className:"SubFeedEligibility",version:l.model.get("version"),isDebug:l.model.get("isDebug")}),l.placeHolders=[Object(n.a)(t)[0]],l.isEligibile=null,l.isEligibileOldVal=null,l.bindEvent(),l.model.get("isUseObserver")?(l._initObserver(),l.observer.observe(l.placeHolders[0]),l.model.get("frameType")===m.FRAME_TYPE.amp&&l.setAMPObservers()):l._initEligibilityListener(),l}return t=s,(i=[{key:"bindEvent",value:function(){this.globalModel.listenTo(this.globalModel,"change:isInTab",this._onTabEvent.bind(this)),this.createStateHandlers([{event:"getAdState",funcName:"_calculateEligibility"}])}},{key:"_initEligibilityListener",value:function(){"rendered"===this.model.get("containerViewState")?this._calculateEligibility():this.createStateHandlers([{event:"containerViewState:rendered",funcName:"_calculateEligibility"}]),r.a.on("window:scroll:change",this._calculateEligibility.bind(this))}},{key:"_onTabEvent",value:function(e,t){this.model.set("isInTab",t),t?this._calculateEligibility():this.model.set("isEligibleToPlay",!1)}},{key:"_getInViewDiv",value:function(){for(var e=0;e<this.placeHolders.length;e++){var t=this.placeHolders[e],i=this._getDimensions(),n=ye.getViewPercent(t,i.width,i.height,this.model.get("scrollSelector"));this._printCurrentViewPercent("currViewPercent",n);var o=this.model.get("viewPercent")||100;if(this._shouldValidateEligibility(n)&&(n=this.eligibilityValidator.getViewablePercentForNonFullyViewableUnits(t,n),this._printCurrentViewPercent("currViewPercent - validated",n),this._onEligibilityValidation(o,n)),this.model.set("isViewable",this.model.get("viewabilityPercent")<=n),this.model.set("isViewable100",n>=this.model.get("100viewPercent")),this.model.get("stickyCard.isActive")){var r=n<this.model.get("stickyCard.attachPercent")&&this._canStickToTop(t);this.model.set("isEligibleToStick",r)}if(o<=n)return this.placeHolders[e]}}},{key:"_testEligibility",value:function(){this.inViewDiv?(this.isEligibile=!0,this.model.set("isEligibleToPlay",!0),!this.model.get("eligiblePlaceholder")&&ye.isModel("getAdState",l.getAdState.gotAd,this)&&this.model.set("eligiblePlaceholder",this.inViewDiv),this._switchObserverToScroll()):(this.isEligibile=!1,this.model.set("isEligibleToPlay",!1)),this.isEligibileOldVal!==this.isEligibile&&(this.log.info("Sub unit eligiblity="+this.isEligibile,"subUnitId="+this.model.get("subUnitId")),this.isEligibileOldVal=this.isEligibile)}},{key:"resetPlaceHolders",value:function(){this.placeHolders=[]}},{key:"setAMPObservers",value:function(){var e=this.model.get("cardNumber"),t=Object(n.a)('[data-card-index="'.concat(e+.5,'"]')).get(0);this.AMPBelowObserver=new IntersectionObserver(this.AMPElemBelowCallback.bind(this),{rootMargin:"0px",threshold:[0]}),this.log.info("AMP IntersectionObserver was created"),this.AMPBelowObserver.observe(t)}},{key:"AMPElemBelowCallback",value:function(e){this.model.set("AMPElemBelowVisible",e[0].intersectionRatio>0)}},{key:"_switchObserverToScroll",value:function(){this.observer&&(this._stopObserver(),this.observer=void 0,this._setToModel("isUseObserver",!1),r.a.on("window:scroll:change",this._calculateEligibility.bind(this)))}},{key:"onAdRvChange",value:function(e){this.adRv=e}},{key:"_shouldValidateEligibility",value:function(e){return!!(this.isEligibilityValidatorActive&&this.model.get("viewabilityPercent")<=e)&&(!this.validateEligibilityOnlyForRV||(void 0!==this.adRv?this.adRv:this._getFromModel("playerHasRvInQ")))}}])&&fe(t.prototype,i),s}(ue.a);function be(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i(5),s.a,i(21);var _e=i(5),Se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new a.a({unitType:this.model.get("unitType"),className:"playerLoaderService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this._createLoaders(),this._loadPlayer()}var t,i;return t=e,(i=[{key:"_createLoaders",value:function(){var e=this;this.loaders={SR:function(e){},AV:function(e){},DP:function(t){var i=e.model.get("player.urls.playerLocation");e.dependencies=[i+"/OvaMediaPlayer.js"],window.OvaMediaPlayer?t():_e.loadJsArr(e.dependencies,t.bind(e))}}}},{key:"_loadPlayer",value:function(){var e=this.loaders[this.model.get("mobilePlayer")];this.model.get("isMobile")&&e?e(this._onPlayerLoaded.bind(this)):this.loaders.DP(this._onPlayerLoaded.bind(this))}},{key:"_onPlayerLoaded",value:function(){this.model.set("isPlayerLoaded",!0)}}])&&be(t.prototype,i),e}();function we(e){return(we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e,t){return!t||"object"!==we(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ee=i(5),ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ce(e);if(t){var o=Ce(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Pe(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e.model)).model=e.model,t.log=new a.a({unitType:t.model.get("unitType"),className:"PlayPriorityHandler",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.isRvPriority=t.model.get("isRvPriority")&&t._isAllowedInFT(),t.isHadFirstSetAd=!1,t.detachToSlider=t.model.get("detachToSlider"),t.isStickyCardActive=t.model.get("stickyCard.isActive"),t.isDetachActive=t.detachToSlider&&(t.detachToSlider.isStartFromSlider||t.detachToSlider.isDetachToSlider),t.isForceDetachOnGotAd=(t.isDetachActive||t.isStickyCardActive)&&t.model.get("detachToSlider.forceDetach.isActive"),t._bindEvents(),t}return t=o,(i=[{key:"_isAllowedInFT",value:function(){return!!this.model.get("playPriority.isAllowInIframes")||this.model.get("frameType")===m.FRAME_TYPE.plainPage}},{key:"_bindEvents",value:function(){}},{key:"setNextAd",value:function(e){this.lastAd=e,this._isForceAdToDetach(e)?this._setReadyAd(e):this.isRvPriority&&!this.isHadFirstSetAd?this._handleRvPriority(e):this._setReadyAd(e)}},{key:"_isForceAdToDetach",value:function(e){if(!this.isForceDetachOnGotAd||this.model.get("hadStickyDetach"))return!1;var t=this.model.get("detachToSlider.forceDetach.restrictions.rv"),i="any"===t||t===e.adData.requiredViewability;return this.log.info("force ad detach:",{isForced:i,activeAdRV:e.adData.requiredViewability}),i}},{key:"_setReadyAd",value:function(e){e.onAdSetToUnits(),this.lastSetAdId=e.adId;var t=e.adData.requiredViewability;this.model.setNextAd(e),setTimeout(function(){this.model.set("isNextAdRV",t),this.model.set("hasReadyAd",!0)}.bind(this),0)}},{key:"_handleRvPriority",value:function(e){var t=!1;if(e.adData.requiredViewability)t=!0;else{var i=this._isAtDecisionPoint();t=this._shouldSetReadyAd(i)}t&&(this._setReadyAd(e),e._bringToFront(),this.isHadFirstSetAd=!0)}},{key:"_shouldSetReadyAd",value:function(e){return!!e&&(this.model.get("playPriority.isAlwaysWaitForRv")?!this.model.get("playerHasRvInQ"):!this.model.get("playerHasRvInQ")||this.model.get("isSkippedDistancePredict")||this._isLoaderInRequiredPercentage())}},{key:"_isAtDecisionPoint",value:function(){if(!this.model.get("playPriority.checkForRvPriority"))return!1;var e=this.model.get("playPriority.checkForRvPriority");return this[m.CHECK_FOR_RV_PRIORITY[e]].bind(this)()}},{key:"_reCheckAd",value:function(e){this.isHadFirstSetAd||(this.hasListener=!1,this.setNextAd(this.lastAd))}},{key:"hasReachedEligibility",value:function(){return!(!this.model.get("isEligibleToPlay")&&!this.model.get("hadEligibility"))||(this.hasListener?void 0:(this._waitForEligibility(),this.hasListener=!0,!1))}},{key:"_waitForEligibility",value:function(){this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_reCheckAd",isListenOnce:!0}])}},{key:"hasReachedPixelsFromSelector",value:function(){if(void 0===this.model.get("playPriority.pixelsFromSelector"))return!1;var e=Ee.hasPassedPixelFromSelector(this.model.get("parentSelector"),this.model.get("scrollSelector"),this.model.get("playPriority.pixelsFromSelector"),this.model.get("isNeedValidateParentSelector"));return e||this.hasListener||(this.hasListener=!0,r.a.once("window:scroll:change",this._reCheckAd.bind(this))),e}},{key:"intersectionPercent",value:function(){if(void 0===this.model.get("playPriority.intersectionPercent"))return!1}},{key:"_activeSecondsToGetRVTime",value:function(){}},{key:"_secondsAfterGetAdRv",value:function(){}},{key:"beforeLoaderEnd",value:function(){return!!this._isLoaderInRequiredPercentage()||(this.createStateHandlers([{event:"loaderCurrCount",funcName:"_reCheckAd",isListenOnce:!0}]),!1)}},{key:"_isLoaderInRequiredPercentage",value:function(){return this.model.get("loaderCurrCount")>=this.model.get("playPriority.loaderPercent")}}])&&Ae(t.prototype,i),o}(s.a);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe=i(5),Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Re(e);if(t){var o=Re(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return De(this,i)}}(o);function o(e,t,i){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this,e)).model=e,r.kibana=t,r.eligibilityService=i,r.log=new a.a({unitType:r.model.get("unitType"),className:"adsManager",version:r.model.get("version"),isDebug:r.model.get("isDebug")}),r.model.set("adState",c.a.readyState),r.model.set("getAdState",c.a.getAdState.notCalled),r.model.set("adManagerState",c.a.adManagerState.empty,{silent:!0}),r._createAdsList(),r.model.set("nextPredict",NaN),r.adId=0,r.currentAdIndex=-1,r.model.set("activeTag",!1),r.model.set("activeAd",!1),r.model.set("impressionCount",0),r.playPriorityHandler=new ke({model:r.model}),r._bindEvents(),u.a.supportTool=u.a.supportTool||{},u.a.supportTool.dp={},xe.sendingEventToTaboolaBridge("sessionStart",r.model.get("unitName")),r}return t=o,(i=[{key:"_createAdsList",value:function(){for(var e in this.adsList={},g.a.RV_TYPES)this.adsList[g.a.RV_TYPES[e]]=[]}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"predictCounter",funcName:"adPredict"},{event:"getAdState:failed",funcName:"_onFailedToGetAd"},{event:"hasReadyAd:false",funcName:"_updateNextAd"},{event:"cancelRV:true",funcName:"_cancelAllRVCalls"},{event:"adState:playing",funcName:"_onFirstAdPlay",isListenOnce:!0},{event:"onadProgressionAfterBeginPredict",funcName:"_onadProgressionAfterBeginPredict"},{event:"onadProgressionBeforeEndPredictPredict",funcName:"_onadProgressionBeforeEndPredictPredict"},{event:"exploreMore",funcName:"_onExploreMore"}])}},{key:"adPredict",value:function(){var e=this;if(!(this._countReadyAdsByRV(!1,g.a.RV_TYPES.RV)>=this.model.get("maxVimpsInQueue")&&this._countReadyAdsByRV(!1,g.a.RV_TYPES.NON_RV)>=this.model.get("maxNonRvVimpsInQueue"))){var t=this.model.get("nextPredict");this.firstGetAdFired||(this.log.info("First Get Ad Fired"),this.model.set("firstGetAdFired",!0),this.firstGetAdFired=!0),this._checkIfAlreadyHas1InList(),xe.isArray(t)?xe.forEach(t,(function(t){(!e.alreadyHas1InList||e.alreadyHas1InList&&0===t)&&(e.createNewAd(t),e._checkIfAlreadyHas1InList())}),this):(!this.alreadyHas1InList||this.alreadyHas1InList&&0===t)&&this.createNewAd(t),"mp4Predict"===this.model.get("nextPredictName")?this.model.set("mp4Predict",!0):this.model.set("mp4Predict",!1)}}},{key:"createNewAd",value:function(e){var t=this.model.get("nextPredictName"),i=this.model.get("nextAdProperties");if(this.model.get("isAllowDuplicateKey")||!this.adsList[e].some((function(t,i,n){return(t.adQState===c.a.adQState.readyState||t.adQState===c.a.adQState.impression)&&t.getAdKey===e}))){this.model.set("adId",this.adId);var n=new W({model:this.model,ppKey:e,adId:this.adId,impressionCb:this.onAdImpression.bind(this),completeCb:this.onAdComplete.bind(this),kibana:this.kibana,predictName:t,getAdProperties:i});this.adsList[e].push(n),this.adId++}}},{key:"_checkIfAlreadyHas1InList",value:function(){var e=this;this.alreadyHas1InList=!1,xe.forEach(this.adsList[g.a.RV_TYPES.RV],(function(t){if("multiAdPredict"!==e.model.get("nextPredictName"))return e.alreadyHas1InList=!0,!1}),this)}},{key:"onAdImpression",value:function(e){e.setActiveTag(),this._updateNextAd(),this.model.set("adManagerState",c.a.adManagerState.hasAds),this.model.get("hadReady")||this.model.get("isEligibilityNomination")||this.model.get("isRvPriority")||(this.eligibilityService?(this.eligibilityService._calculateEligibility(),this.model.get("isEligibleToPlay")?this._triggerReady():this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_triggerReady",isListenOnce:!0}])):this._triggerReady(),this.model.set("hadReady",!0));var t=e.getAdData();if("any"===e.getAdKey&&this._moveAdFromAnyQueue(e,t.requiredViewability),e.rv=t.requiredViewability,this.model.increaseCounter(t.requiredViewability?"adsList.rvAds":"adsList.nonRvAds"),!this.model.get("isEligibleToPlay")&&this.model.get("lostEligibilityTime")&&e.fireSkipVimp1EligibilityLost(t.requiredViewability),t.requiredViewability){var i=this.isPlayingAdNotRV();e.fireSkipVimp1Vimp0Playing(i)}}},{key:"_triggerReady",value:function(){r.a.trigger("ready")}},{key:"_moveAdFromAnyQueue",value:function(e,t){var i=this;xe.each(this.adsList[g.a.RV_TYPES.ANY],(function(t,n){t.adId===e.adId&&i.adsList[g.a.RV_TYPES.ANY].splice(n,1)})),this.adsList[t?g.a.RV_TYPES.RV:g.a.RV_TYPES.NON_RV].push(e)}},{key:"isPlayingAdNotRV",value:function(){var e=!1;return xe.size(this.adsList[g.a.RV_TYPES.NON_RV])>0&&xe.forEach(this.adsList[g.a.RV_TYPES.NON_RV],(function(t){t.adState===c.a.adState.playing&&(e=!0)})),e}},{key:"onAdComplete",value:function(e,t){this._removeAd(e.adId,e.adData&&void 0!==e.adData.requiredViewability?e.adData.requiredViewability:e.getAdKey,!1),this.model.get("hasReadyAd")&&this.model.getStorage("nextAd").adId===e.adId&&this.model.set("hasReadyAd",!1),t&&!this.model.get("hasReadyAd")&&(this.model.set("lastAutoKilledPredict",e.getAdKey),this.model.set("adState",e.adState))}},{key:"close",value:function(){this.model.set("adManagerState",c.a.adManagerState.stopped),this.model.set("closeState",c.a.closeState.adManagerStop)}},{key:"pauseGetAds",value:function(){for(var e in this.model.set("adManagerState",c.a.adManagerState.paused),this.adsList)this.adsList[e]=[];this.model.set("hasReadyAd",!1)}},{key:"_cancelAllRVCalls",value:function(){xe.forEach(this.adsList[g.a.RV_TYPES.RV],function(e){e.cancelGetAd(),this._removeAd(e.adId,g.a.RV_TYPES.RV,!0)}.bind(this)),this.model.set("cancelRV",!1)}},{key:"_removeAdsByKeyAndStatus",value:function(e,t){xe.forEach(this.adsList[e],function(i){t.indexOf(i.getAdState)>-1&&(i.cancelGetAd(),this._removeAd(i.adId,e,!0))}.bind(this))}},{key:"_onFailedToGetAd",value:function(){var e,t=this.model.get("getAdCurrId");for(var i in this.adsList)e||(e=xe.find(this.adsList[i],(function(e){return e.adId===t}),this));this.model.set("lastFailedPredictProperties",e.getAdProperties),this.model.set("lastFailedPredict",e.getAdKey),this._removeAd(t,e.adData&&void 0!==e.adData.requiredViewability?e.adData.requiredViewability:e.getAdKey,!0)}},{key:"_removeAd",value:function(e,t,i){var n=this,o=t?g.a.RV_TYPES.RV:g.a.RV_TYPES.NON_RV;xe.size(this.adsList[o])>0&&(this.adsList[o]=this.adsList[o].filter((function(t){return t.adId===e&&n.model.decreaseCounter(t.rv?"adsList.rvAds":"adsList.nonRvAds"),t.adId!==e}))),0===this.countReadyAds(i)&&this.model.set("adManagerState",c.a.adManagerState.empty)}},{key:"_updateNextAd",value:function(){var e=this,t=[];for(var i in this.adsList)t=t.concat(this.adsList[i].filter((function(t){return t.adQState===c.a.adQState.impression&&!t.isUsed&&e._isAllowAd(t)})));var n=this._chooseBestAd(t),o=t[n];o&&(this.playPriorityHandler.setNextAd(o),o.getAdKey&&o.getAdKey===g.a.RV_TYPES.RV&&this._countReadyAdsByRV(!0,g.a.RV_TYPES.RV)>1&&o.oppsService.onAdPlayingNextAdReadyRV1());var r=o;if(this.model.get("hasReadyAd")){var s=this.model.get("playPriority.type");for(var i in this.adsList)xe.each(this.adsList[i],function(e,t){n===t&&i==o.getAdKey||e.adQState===c.a.adQState.impression&&r&&r.getAdData&&("rpox"===s?e.reportRpoxSkip(r.getAdData()):"ppKey"===s&&e.reportPpKeySkip(r.getAdData()))}.bind(this))}}},{key:"_chooseBestAd",value:function(e){var t=this,i=0;if(1===xe.size(e))return i;var n=this.model.get("playPriority.type")||"rpox";if("ppKey"===n)xe.find(e,(function(e,n){e.getAdKey===t.model.get("playPriority.key")&&(i=n)}));else if("function"===n){var o=this.model.get("playPriority.func");i=o(e)}else"rpox"===n&&(i=this.priorityByRpox(e));return i}},{key:"priorityByRpox",value:function(e){var t=0,i=(this.model,0);return xe.each(e,(function(e,n){e.rpox>=i&&(i=e.rpox,t=n)})),t}},{key:"_hasPlayingAd",value:function(){return!!this.model.get("activeTag")}},{key:"countReadyAds",value:function(e){var t=0;for(var i in this.adsList)t+=this._countReadyAdsByRV(e,i);return t}},{key:"_countReadyAdsByRV",value:function(e,t){var i=0;return xe.forEach(this.adsList[t],(function(t){(e&&t.adQState!==c.a.adQState.readyState||t.adQState===c.a.adQState.impression)&&i++}),this),i}},{key:"_onFirstAdPlay",value:function(){this.model.set("hadPlayedAd",!0)}},{key:"_isAllowAd",value:function(e){return this._isAllowSingleAd(e)}},{key:"_isAllowSingleAd",value:function(e){var t=e.adTypeConfig&&e.adTypeConfig.singleAd&&e.adTypeConfig.singleAd.isPlacementSingleAd;return!(t&&this.model.get("hadPlayedAd")||this.model.get("isPreventNextAd")||t&&this._isAdTypeDropped(ce.a.singleAd.name))}},{key:"_isAdTypeDropped",value:function(e){var t=this.model.get("droppedAdTypes");return!!xe.isArray(t)&&0!==(t=t.filter((function(t){return e===t}))).length}},{key:"_onadProgressionAfterBeginPredict",value:function(){var e=this._getLastActiveAd();e[0]&&e[0].onadProgressionAfterBeginPredict()}},{key:"_onadProgressionBeforeEndPredictPredict",value:function(){var e=this._getLastActiveAd();e[0]&&e[0].onadProgressionBeforeEndPredictPredict()}},{key:"_getLastActiveAd",value:function(){var e=this;for(var t in this.adsList){var i=this.adsList[t].filter((function(t){return t.adId===e.model.get("lastActiveAd")}));if(i&&i[0])return i}return[]}},{key:"_onExploreMore",value:function(){this.model.get("exploreMoreConfig.clearAdsQ")&&this._removeAdsByKeyAndStatus(g.a.RV_TYPES.NON_RV,["gotAd","waiting","failed","stopped","finished"]);var e=this.model.get("exploreMoreConfig.maxNonRvVimpsInQueue");e&&this.model.set("maxNonRvVimpsInQueue",e)}}])&&Ie(t.prototype,i),o}(s.a);function Me(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Fe=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new a.a({unitType:this.model.get("unitType"),className:"ObserverService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.options=i,this.setObserver()}var t,i;return t=e,(i=[{key:"observe",value:function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)e[t].dataset.elViewPercent||this.observer.observe(e[t])}},{key:"unobserve",value:function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this.observer.unobserve(e[t])}},{key:"setObserver",value:function(){this.setDefaults(),this.observer=new IntersectionObserver(this.observerCallback.bind(this),this.options);var e=this.options.targetEl;this.observe(e)}},{key:"setDefaults",value:function(){var e=this.options;e.threshold=e.threshold||[0,this.model.get("viewPercent")/100,this.model.get("viewabilityPercent")/100],e.rootMargin=e.rootMargin||"0px",e.targetEl=Array.isArray(e.targetEl)?e.targetEl:[e.targetEl]}},{key:"observerCallback",value:function(e,t){this.options.callback&&this.options.callback(e,t),e.forEach((function(e){e.target.dataset.elViewPercent=e.intersectionRatio.toString()}))}},{key:"getViewPercent",value:function(e){return 100*parseFloat(e.dataset.elViewPercent)}},{key:"isElIntersectingViewport",value:function(e){return this.getViewPercent(e)>0}},{key:"isElViewPercentReached",value:function(e){return this.getViewPercent(e)>this.model.get("viewPercent")}},{key:"isElViewabilityPercentReached",value:function(e){return this.getViewPercent(e)>this.model.get("viewabilityPercent")}}])&&Me(t.prototype,i),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e){return function(e){if(Array.isArray(e))return je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return je(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?je(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Ue(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?$e(e):t}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e){return(ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ge=i(5),qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(s,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ze(e);if(t){var o=ze(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return He(this,i)}}(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).model=e,t.log=new a.a({unitType:t.model.get("unitType"),className:"CardLocator",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.noAboveSelector=t.model.get("fmNoAboveSelector"),t.noBelowSelector=t.model.get("fmNoBelowSelector"),t.isSingleFeed=t._isSingleFeed(),t._resetCardLocatorParams(),t.maxPPS=t.model.get("getCardMaxPPS"),t.scrollManager=new y.a,t._setMinDistance(),t._decisionCallbacks=[{callback:t._biggerThenLastCard,onFalseRunNext:!1},{callback:t._isCardInViewPort,onFalseRunNext:!1},{callback:t._biggerThenMinDistance,onFalseRunNext:!1},{callback:t._canHaveVideoBrotherAbove.bind($e(t)),onFalseRunNext:!1},{callback:t._isAtViewPercent,onFalseRunNext:!1}],t._decisionCallbacksOutOfView=[{callback:t._biggerThenLastCard,onFalseRunNext:!1},{callback:t._biggerThenMinDistance,onFalseRunNext:!1},{callback:t._canHaveVideoBrotherOutOfView.bind($e(t)),onFalseRunNext:!1},{callback:t._isCardInViewPortOutOfView,onFalseRunNext:!1}],t._isGetCardOnEligibility=t.model.get("isGetCardOnEligibility"),t._isGetCardOnEligibility&&(t._viewPercent=t.model.get("cardEligibilityPercent")),t._isStartFromSlider=t.model.get("detachToSlider.isStartFromSlider"),t._setFeedContainer(),t._startCard=parseInt(t.model.get("startCard"))||0,t._isOpenInViewPort=t.model.get("isOpenInViewPort"),t._permanentCard=t.model.get("permanentCard"),void 0===t._isOpenInViewPort&&(t._isOpenInViewPort=!0),t._initCardsObserver(),t}return t=s,(i=[{key:"_setFeedContainer",value:function(){this._feedContainer=this.model.get("feedContainer");var e=this.model.get("feedContainerChanged")>0;Ge.isElement(this._feedContainer)&&!e&&(this._setFeedContainers(),this._setFeedCardsElementArray()),this._validateContainer(),this.isSingleFeed&&this._overwriteVideoContainerSelector(),this._resetCardLocatorParams()}},{key:"_setFeedCardsElementArray",value:function(){var e=this;this._feedContainer=void 0,this._feedCardsElementArray=[],Ge.each(this._feedContainers,(function(t){var i,n=t.querySelectorAll(e.model.get("feedCardSelector"));n.length>0&&(e._feedContainer||(e._feedContainer=t),(i=e._feedCardsElementArray).push.apply(i,Be(n)))}))}},{key:"_initCardsObserver",value:function(){this.model.get("isUseObserverForCardLocator")&&(this.cardObserver=new Fe(this.model,{targetEl:this._getCardsElemArr()}))}},{key:"_setMinDistance",value:function(){this._minDistance=this.model.get("cardsMinDistance");var e=Object(n.a)(window).height();this._minDistance<e&&(this._minDistance=e,this.model.set("cardsMinDistance",e))}},{key:"_bindListeners",value:function(){r.a.on("window:orientation:change",this._getCardOnDomEvent,this),r.a.on("window:resize:change",this._getCardOnDomEvent,this),r.a.on("window:scroll:change",this._getCardOnDomEvent,this),r.a.on("feed:resize:change",this._getCardOnDomEvent,this),this.maxPPS&&void 0===this.scrollEndIndex&&(this.scrollEndIndex=this.scrollManager.registerForScrollEnd(this._getCardOnDomEvent.bind(this))),this._listenersBinded=!0}},{key:"_unBindListeners",value:function(){r.a.off("window:orientation:change",this._getCardOnDomEvent,this),r.a.off("window:resize:change",this._getCardOnDomEvent,this),r.a.off("window:scroll:change",this._getCardOnDomEvent,this),r.a.off("feed:resize:change",this._getCardOnDomEvent,this),this.maxPPS&&void 0!==this.scrollEndIndex&&(this.scrollManager.deRegisterForScrollEnd(this._getCardOnDomEvent.bind(this)),this.scrollEndIndex=void 0),this._listenersBinded=!1}},{key:"_biggerThenLastCard",value:function(e){return!this._lastCardElement||this._getCardNumber(e)>this._getCardNumber(this._lastCardElement)}},{key:"_isCardInViewPort",value:function(e){return!!e&&this.getViewPercentMethod(e)>0}},{key:"_isCardInViewPortOutOfView",value:function(e,t){var i=this.getViewPercentMethod(e),n=this.getViewPercentMethod(t);return i>0&&i<99.9&&n<=0}},{key:"_biggerThenMinDistance",value:function(e){return!this._lastCardElement||this._isMinDistancePassed(e)}},{key:"_isMinDistancePassed",value:function(e){return!(Object(n.a)(e)[0].offsetTop-(Object(n.a)(this._lastCardElement)[0].offsetTop+Object(n.a)(this._lastCardElement).height())<this._minDistance)}},{key:"_canHaveVideoBrotherAbove",value:function(e,t){var i=!e.hasAttribute(this.noAboveSelector);if(!t)return i;var n=!t.hasAttribute(this.noBelowSelector);return i&&n}},{key:"_canHaveVideoBrotherOutOfView",value:function(e,t){var i=!e.hasAttribute(this.noBelowSelector);if(!t)return i;var n=!t.hasAttribute(this.noAboveSelector);return i&&n}},{key:"_isCurrentCardIsValid",value:function(e,t){var i;i=this._isOpenInViewPort?this._decisionCallbacks:this._decisionCallbacksOutOfView;for(var n=0;n<i.length;n++){var o=i[n];if(!1===o.callback.call(this,e,t)&&!1===o.onFalseRunNext)return!1}return!0}},{key:"_getCardNumber",value:function(e){return Object(n.a)(e).data("card-index")}},{key:"_getCardOnDomEvent",value:function(e){this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS||(this._isOpenInViewPort?this._searchCard():this._searchCardPerf())}},{key:"_searchCard",value:function(e){var t=this.getCardsArray(this._feedCardsElementArray);if(this.observeCards(t),this._permanentCard&&this._permanentCard>0)return this._getPermanentCard(t);t=t.reverse(),e&&(this._lastCardElement=this._getLastCardInViewPort(t),this.log.info("Once out of view - Last card updated to - ",this._getCardNumber(this._lastCardElement)));for(var i=0;i<t.length;i++){var n=t[i],o=t[i+1];if(this._isCurrentCardIsValid(n,o)){this._insert="before";var r=this._isCardInViewPort(t[1]);if(0===i&&!r&&t.length>1){if(n.hasAttribute(this.noBelowSelector))continue;this._insert="after"}return this._updateLastCard(n),this._unBindListeners(),this.log.info("found valid card: "+this._lastCardElementId),this.model.set("hasValidCard",this._lastCardElementId),{cardElement:n,cardNumber:this._lastCardElementId,insert:this._insert}}}if(this._isForceAdDetach()||!this._isGetCardOnEligibility||this._isStartFromSlider&&!this._lastCardElement){var s=this._tryFirstCard(t[t.length-1]);if(s)return s;var a=this._tryLastCard(t[0]);if(a)return a}}},{key:"_isForceAdDetach",value:function(){return this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("detachToSlider.forceDetach.isActive")&&!this._isFeedContainerBelowViewport()}},{key:"_isFeedContainerBelowViewport",value:function(){return this._feedContainer.getBoundingClientRect().top>0}},{key:"_searchCardPerf",value:function(){var e=this.getCardsArray(this._feedCardsElementArray);if(this.observeCards(e),this._permanentCard&&this._permanentCard>0)return this._getPermanentCard(e);e=e.reverse();for(var t=1;t<e.length;t++){var i=e[t],n=e[t-1];if(this._isCurrentCardIsValid(i,n)){if(i=e[t-1],this._insert="before",1===t){if(i.hasAttribute(this.noBelowSelector))continue;this._insert="after"}return this._updateLastCard(i),this._unBindListeners(),this.log.info("found valid card: "+this._lastCardElementId),this.model.set("hasValidCard",this._lastCardElementId),{cardElement:i,cardNumber:this._lastCardElementId,insert:this._insert}}}var o=this._tryFirstCard(e[e.length-1]);return o||(this._tryLastCardPerf(e[0])||void 0)}},{key:"_tryFirstCard",value:function(e){if(!this._lastCardElement&&this.isFeedNotInViewport()&&this._isCloseToTop()){if(!this._canHaveVideoBrotherAbove(e))return;return this._unBindListeners(),this._updateLastCard(e),this._insert="before",this.model.set("hasValidCard",this._lastCardElementId),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}}}},{key:"_tryLastCard",value:function(e){if(this.isFeedNotInViewport()&&!this._isCloseToTop())return this._getIfLastCard(e)}},{key:"_tryLastCardPerf",value:function(e){if((this._isCardInViewPort(e)||this.isFeedNotInViewport())&&!this._isCloseToTop())return this._getIfLastCard(e)}},{key:"_getIfLastCard",value:function(e){if(!e.hasAttribute(this.noBelowSelector))return!this._lastCardElement||this._isMinDistancePassed(e)&&this._lastCardElement!==e?(this._unBindListeners(),this._updateLastCard(e),this._insert="after",this.model.set("hasValidCard",this._lastCardElementId),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}):void 0}},{key:"_getCardByCardNumber",value:function(e){if(this.log.info("getCard by number was called. cardNumber = "+e),e==this._lastCardElementId)return this._unBindListeners(),this.model.set("hasValidCard",void 0,{silent:!0}),{cardElement:this._lastCardElement,cardNumber:this._lastCardElementId,insert:this._insert}}},{key:"_updateLastCard",value:function(e){this._lastCardElement=e,this._lastCardElementId=this._getCardNumber(e)}},{key:"getCard",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isOpenInViewPort=this.model.get("isOpenInViewPort"),t.cardNumber?this._getCardByCardNumber(t.cardNumber):this.isOpenOnCardFound?void this.log.info("Has permanent card already - ",this._permanentCard):(this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS?this.log.info("Can't get card scroll is to fast waiting for user to slow down"):(this.log.info("getCard was called"),e=this._isOpenInViewPort?this._searchCard(t.onceOutOfView):this._searchCardPerf()),e||this._listenersBinded||(this.log.info("Waiting for valid card - binding listeners"),this._bindListeners()),e)}},{key:"_isCloseToTop",value:function(){var e=document.body,t=document.documentElement,i=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)/2;return Object(n.a)(window).height()/2+Object(n.a)(window).scrollTop()<=i}},{key:"isFeedNotInViewport",value:function(){return this._feedContainer&&this.getViewPercentMethod(this._feedContainer)<=0}},{key:"_getPermanentCard",value:function(e){for(var t=0;t<e.length;t++)if(this._permanentCard===this._getCardNumber(e[t])){if(this._isGetCardOnEligibility&&!this._isAtViewPercent(e[t]))return;return this._unBindListeners(),this._lastCardElement=e[t],this._lastCardElementId=this._permanentCard,this._insert="before",this.isOpenOnCardFound=!0,this.model.set("hasValidCard",this._permanentCard),{cardElement:e[t],cardNumber:this._permanentCard,insert:this._insert}}}},{key:"_getLastCardInViewPort",value:function(e){for(var t,i=0;i<e.length;i++)if(this._isCardInViewPort(e[i])){t=e[i];break}return!t||this._getCardNumber(t)<this._lastCardElementId?this._lastCardElement:t}},{key:"_isAtViewPercent",value:function(e){if(!this._isGetCardOnEligibility)return!0;var t=Object(n.a)(window),i={top:t.scrollTop(),left:t.scrollLeft()};i.right=i.left+t.width(),i.bottom=i.top+t.height();var o=Object(n.a)(e).width(),r=Ge.getVideoHeight(o)+25;if(!o||!r)return!1;var s=Object(n.a)(e).offset();s.right=s.left+o,s.bottom=s.top+r;var a=Math.min(1,(s.bottom-i.top)/r),l=Math.min(1,(i.bottom-s.top)/r),c=(Math.min(1,(s.right-i.left)/o),Math.min(1,(i.right-s.left)/o),a*l*100);return this.log.info("Video card view percent - ",c),c>=this._viewPercent}},{key:"_sliceByStartCard",value:function(e){return this._startCard>0?e.slice(this._startCard-1):e}},{key:"getCardsArray",value:function(e){this._setFeedCardsElementArray();var t=Array.prototype.slice.call(e);return this._sliceByStartCard(t)}},{key:"getViewPercentMethod",value:function(e){return this.model.get("isUseObserverForCardLocator")?this.cardObserver.getViewPercent(e):Ge.getViewPercent(e,e.offsetWidth,e.offsetHeight)}},{key:"_getCardsElemArr",value:function(){var e=this.getCardsArray(this._feedCardsElementArray);return e.push.apply(e,Be(this._feedContainers)),e}},{key:"observeCards",value:function(e){this.cardObserver&&this.cardObserver.observe(e)}},{key:"_unObserveCards",value:function(e){this.cardObserver&&this.cardObserver.unobserve(e)}},{key:"updateFeedSelector",value:function(){this._unObserveCards(this._getCardsElemArr()),this._setFeedContainer(),this.observeCards(this._getCardsElemArr())}},{key:"_resetCardLocatorParams",value:function(){this._lastCardElement=null,this._startCard=parseInt(this.model.get("startCard"))||0,this._isFeedHasScCard()}},{key:"getSpecificCard",value:function(e){var t=this;if(this.lastSpecificCard===e)return r.a.off("window:scroll:change",this.getSpecificCard.bind(this,e)),void r.a.off("feed:resize:change",this.getSpecificCard.bind(this,e));var i=Object(n.a)('[data-card-index="'.concat(e,'"]'))[0];if(i&&(this._isCurrentCardIsValid(i)||this._tryFirstCard(i)))return this._updateLastCard(i),setTimeout((function(){t.hasListenersForSpecific=!1}),0),r.a.off("window:scroll:change",this.getSpecificCard.bind(this,e)),r.a.off("feed:resize:change",this.getSpecificCard.bind(this,e)),this._insert="before",this.lastSpecificCard=e,this.model.set("hasValidCard",this._lastCardElementId),{cardElement:i,cardNumber:e,insert:"before"};this.hasListenersForSpecific||(this.hasListenersForSpecific=!0,r.a.on("window:scroll:change",this.getSpecificCard.bind(this,e)),r.a.on("feed:resize:change",this.getSpecificCard.bind(this,e)))}},{key:"_isSingleFeed",value:function(){var e=Object(n.a)(this.model.get("parentSelector"));return e&&1===e.length}},{key:"_setFeedContainers",value:function(){var e=this._feedContainer.getAttribute(["data-feed-main-container-id"]),t=document.querySelectorAll("[data-feed-main-container-id='".concat(e,"']"));this._feedContainers=Array.prototype.slice.call(t)}},{key:"_setFeedContainersByPlacement",value:function(){var e=this.model.get("parentSelector"),t=this._getPlacement(),i=document.querySelectorAll("".concat(e,"[data-parent-placement-name='").concat(t,"']"));this._feedContainers=Array.prototype.slice.call(i)}},{key:"_overwriteVideoContainerSelector",value:function(){(!this.model.get("detachToSlider.isStartFromSlider")||!this.model.get("detachToSlider.isDetachToSlider"))&&!1!==this.model.get("videoContainerSelector")&&this.model.set("videoContainerSelector",this.model.get("parentSelector"))}},{key:"_validateContainer",value:function(){var e=!this._feedCardsElementArray||0===this._feedCardsElementArray.length,t=this.model.get("feedContainerChanged")>0;if((e||t)&&(this._setFeedContainersByPlacement(),this._setFeedCardsElementArray(),0===this._feedCardsElementArray.length)){var i={debug:"!url:"+(window&&window.location&&window.location.href?window.location.href:"")};Ge.firePixel(this.model.getPixel("pixels.feedHasNoCardsToOpen"),"feedHasNoCardsToOpen",i)}}},{key:"_getPlacement",value:function(){var e=this.model.get("placement");return(e=e.replace("Feed - ","")).split(" |")[0]}},{key:"_isFeedHasScCard",value:function(){this.model.get("placementWithScAdjacency")===this._getPlacement()&&(this.model.set("hasScAdjacency",!0),this.model.set("startCard",3))}}])&&Ue(t.prototype,i),s}(s.a);function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xe(e,t){return!t||"object"!==Ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ze=i(5),et=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Je(e);if(t){var o=Je(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Xe(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e,document.hidden?t.model.set("isInTab",!1):t.model.set("isInTab",!0),t.log=new a.a({unitType:t.model.get("unitType"),className:"tabStatusService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.bindEvent(),t}return t=o,(i=[{key:"bindEvent",value:function(){this.model.listenTo(r.a,"window:tab:change",this._onTabEvent.bind(this))}},{key:"_onTabEvent",value:function(e){this.model.set("tabState",Ze.find(Object.keys(g.a.TAB_STATE),(function(t){return g.a.TAB_STATE[t]===e}))),e===g.a.TAB_STATE.tabOut?this.model.set("isInTab",!1):this.model.set("isInTab",!0)}}])&&Ke(t.prototype,i),o}(s.a);function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var st=i(5),at=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=rt(e);if(t){var o=rt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ot(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e,t.log=new a.a({unitType:t.model.get("unitType"),className:"GDPRManager",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._init(),t}return t=o,(i=[{key:"_init",value:function(){var e=window.__cmp,t=g.a.UNIT_TYPES[this.model.get("unitType")],i=t===g.a.UNIT_TYPES.EXPANDABLE||t===g.a.UNIT_TYPES.EXPANDABLE_MOBILE,n=t===g.a.UNIT_TYPES["300X600"]||t===g.a.UNIT_TYPES["300X600_MOBILE"];(i||n)&&!this.model.get("isStayInIframe")&&this._isInFriendlyIframe()&&(e=st.getTopWindow().__cmp),void 0!==e?(this.model.set("hasCMPonPage",!0),e("getConsentData",null,this._getConsentDataCB.bind(this))):(this.model.set("hasCMPonPage",!1),this.model.set("canStartPlayer",!0))}},{key:"_getConsentDataCB",value:function(e){var t=e.gdprApplies,i=e.consentData||"";this._setPlayerParams(t,i)}},{key:"_setPlayerParams",value:function(e,t){u.a.player?(u.a.player.set("gdprApplies",e),u.a.player.set("cdb",t)):(this.model.set("gdprApplies",e),this.model.set("consentDaisyBit",t),this.model.set("canStartPlayer",!0))}},{key:"_isInFriendlyIframe",value:function(){return this._isInIframe()&&cmTag.config.iframeData.isFriendlyIframe}},{key:"_isInIframe",value:function(){return cmTag.config.iframeData.inIframe||cmTag.config.iframeData.inDFP}}])&&it(t.prototype,i),o}(s.a);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t){return!t||"object"!==lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(22);var ft,pt=i(5),mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ht(e);if(t){var o=ht(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ut(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e.model)).version=e.version,t.model=e.model,t.oppsulaLoaded=!1,t.log=new a.a({unitType:t.model.get("unitType"),className:"OppsulaManager",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.oppsArr=[],t._bindEvents(),t.serviceLoader=u.a.serviceLoader,t._loadService(),t}return t=o,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"isOppsulaLoaded:true",funcName:"_sendOppsFromArr"}])}},{key:"_loadService",value:function(){this.serviceLoader.get("oppsula",this.version,this._onOppsulaLoaded.bind(this),this._onLoadOppsulaError.bind(this))}},{key:"_onOppsulaLoaded",value:function(e){this.oppsula=new e(this.model),this.oppsulaLoaded=!0,this.log.info("Oppsula Loaded",this.oppsula),this._sendOppsFromArr()}},{key:"_onLoadOppsulaError",value:function(){this.log.error("Error while loading Oppsula from service loader")}},{key:"send",value:function(e){!0===this.oppsulaLoaded?this.oppsula.send(e):this.oppsArr.push(e)}},{key:"_sendOppsFromArr",value:function(){0!==this.oppsArr.length&&(pt.forEach(this.oppsArr,this.send,this),this.oppsArr=[])}}])&&ct(t.prototype,i),o}(s.a),gt=function(e){return ft||(ft=new mt(e)),ft};function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _t(e,t){return!t||"object"!==yt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wt=i(5),At=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(s,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=St(e);if(t){var o=St(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return _t(this,i)}}(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).model=e,t.videoElements=[],t.log=new a.a({unitType:t.model.get("unitType"),className:"PublisherVideoDetector",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.pubVideoTagsSelector=t.model.get("publisherVideoSelector")||"video",t._registerHooks(),t.isPublisherVideoDetected(),t._bindEvents(),t}return t=s,(i=[{key:"_bindEvents",value:function(){this.model.get("isDetectIframeVideos")&&this.createStateHandlers([{event:"adState:playing",funcName:"_detectIframeVideos"},{event:"adQState:q1",funcName:"_detectIframeVideos"},{event:"adQState:q2",funcName:"_detectIframeVideos"},{event:"adQState:q3",funcName:"_detectIframeVideos"}])}},{key:"isPublisherVideoDetected",value:function(){return this.pubVideoTags=Object(n.a)(this.pubVideoTagsSelector),this._findPubVideo(this.pubVideoTags),this.model.get("isDetectPubIframeVideo")&&this._iframeIterator(window.document,this._findPubVideo),!!this.model.get("publisherVideoDetected")&&(this._monitorPubVideos(),!0)}},{key:"_findPubVideo",value:function(e){(!this.model.get("publisherVideoDetected")&&e.length>0||wt.isFunction(this.isPubVideoDetectedHook)&&this.isPubVideoDetectedHook())&&(this.model.set("publisherVideoDetected",!0),this.log.info("found Pub Video in:",e))}},{key:"_monitorPubVideos",value:function(){if(!this.model.get("isNoPubVideoInView")&&!this.isLookingForPubVideo){var e=Object(n.a)(this.pubVideoTagsSelector).last()[0],t=e&&e.getBoundingClientRect(),i=this.model.get("pubVidDetectorThreshold");t&&t.bottom<=i?(this.log.info("started Publisher Video Detector Timer"),this.isLookingForPubVideo=!0,setTimeout(this.isPubVideoInView.bind(this),this.model.get("publisherDetectorDelayInMs"))):r.a.once("window:scroll:change",this._monitorPubVideos.bind(this))}}},{key:"isPubVideoInView",value:function(){return this.pubVideoTags=Object(n.a)(this.pubVideoTagsSelector),this._filterCmAdPlayerVideo(),this.model.set("isPubVideoViewable",!1),this._isViewableElements(this.pubVideoTags),this.isLookingForPubVideo=!1,this.model.get("isPubVideoViewable")?(this.log.info("Timeout - Publisher Video in View"),r.a.once("window:scroll:change",this._monitorPubVideos.bind(this)),!0):(this.model.set("isNoPubVideoInView",!0),this.log.info("No publisher video in view - can continue with regular flow"),!1)}},{key:"_filterCmAdPlayerVideo",value:function(){this.pubVideoTags&&0!==this.pubVideoTags.length&&(this.pubVideoTags=this.pubVideoTags.toArray().filter((function(e){return e.className.indexOf("cm-ad-player")<0})))}},{key:"_detectIframeVideos",value:function(){this.model.get("publisherIframeVideoDetected")||(this.iframeWithVideos=[],this._getIframeWithVideos(window.document,"iframe",this.pubVideoTagsSelector),this._isViewableElements(this.iframeWithVideos))}},{key:"_iframeIterator",value:function(e,t){try{wt.DOMIterator(e,"iframe",t.bind(this),this.pubVideoTagsSelector)}catch(e){}}},{key:"_getIframeWithVideos",value:function(e,t,i){try{var n=wt.getIframeDocument(e)||e;if(!n)return;for(var o=n.querySelectorAll(t),r=0;r<o.length;r++)(wt.getIframeDocument(o[r])||o[r]).querySelectorAll(i).length>0&&!this._isCurrentUnit(o[r])&&this.iframeWithVideos.push(o[r]),wt.DOMIterator(o[r],t,i)}catch(e){return}}},{key:"_isCurrentUnit",value:function(e){var t=Object(n.a)(e).parents(),i=this.model.get("videoViewContainer");for(var o in t)if(t[o]===i)return!0;return!1}},{key:"_isViewableElements",value:function(e){if(e){for(var t=this.model.get("pubViewabilityPercent"),i=0;i<e.length;i++){var o=Object(n.a)(e[i]),r=parseInt(o.width()),s=parseInt(o.height());if(t<wt.getViewPercent(e[i],r,s,this.model.get("scrollSelector")))return this.model.set("isPubVideoViewable",!0),void("iframe"===e[i].tagName.toLowerCase()&&this.model.set("publisherIframeVideoDetected",!0))}wt.isFunction(this.isPubVideoInViewHook)&&this.isPubVideoInViewHook()?this.model.set("isPubVideoViewable",!0):this.model.set("isPubVideoViewable",!1)}}},{key:"_registerHooks",value:function(){wt.isFunction(this.model.get("isPubVideoDetectedHook"))&&(this.isPubVideoDetectedHook=this.model.get("isPubVideoDetectedHook")),wt.isFunction(this.model.get("isPubVideoInViewHook"))&&(this.isPubVideoInViewHook=this.model.get("isPubVideoInViewHook"))}}])&&vt(t.prototype,i),s}(s.a);function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ct(e,t){return(Ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Et(e,t){return!t||"object"!==Tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ot=i(5),It=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ct(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=kt(e);if(t){var o=kt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Et(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e,t.log=new a.a({unitType:t.model.get("unitType"),className:"competitionDetector",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.competitionDetector=t.model.get("compToDetect"),t.competitionList=t._createCompetitionList(),t._startDetectCompetition(),t}return t=o,(i=[{key:"_createCompetitionList",value:function(){var e=[];return Ot.forEach(this.competitionDetector,(function(t){var i={};i.selector=t,i.isFound=!1,i.tries=0,e.push(i)})),e}},{key:"_startDetectCompetition",value:function(){Ot.forEach(this.competitionList,this._detectCompetition.bind(this))}},{key:"_detectCompetition",value:function(e){if(!e.isFound){var t=e.selector;e.tries++,document.querySelectorAll(t).length>0?(this.model.set("lastCompDetected",t),this.model.increaseCounter("compDetected"),e.isFound=!0):e.tries<=this.model.get("maxTriesForDetectingComp")&&setTimeout(this._detectCompetition.bind(this,e),1e3*this.model.get("timeBetweenDetectionCompSeconds"))}}}])&&Pt(t.prototype,i),o}(s.a);function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xt(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Mt=i(5),Ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Nt(e);if(t){var o=Nt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).model=e,t.adjacCardPlacement=t.model.get("adjacCardPlacement"),t.log=new a.a({unitType:t.model.get("unitType"),className:"organicCardInjector",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._bindEvents(),t}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"injectOrganicCard",value:function(e){if(this.adjacCardPlacement=this.model.get("adjacCardPlacement")||this.adjacCardPlacement,!this._isCardOrganic(this.adjacCardPlacement)&&!this.isOrganicCardInjected){this.organicContainer=Object(n.a)(e)[0];var t=Mt.getOrganicCard();if(!t)return this.log.error("missing mode can't inject organic"),!1;if(!this.organicContainer)return this.log.error("missing container to inject an organic card"),!1;var i=document.createElement("div");i.id="taboola-adjacent-organic-card",i.classList.add("tbl-feed-card"),i.dataset.cardIndex=this.adjacCardPlacement-.25,this.organicContainer.insertAdjacentElement("afterend",i),window._taboola=window._taboola||[];var o=this._getPlacementName();return this.isOrganicCardInjected=!0,this.model.set("isOrganicCardInjected",!0),_taboola.push({mode:t,container:"taboola-adjacent-organic-card",placement:o,target_type:"mix"}),!0}}},{key:"_getPlacementName",value:function(){var e=Object(n.a)(this.model.get("parentSelector"))[0];if(e&&e.dataset&&e.dataset.parentPlacementName)return e.dataset.parentPlacementName+" | Card 0"}},{key:"_isCardOrganic",value:function(e){var t=Object(n.a)('[data-card-index="'.concat(e,'"]'))[0];return!(!t||!t.querySelector(".trc-content-organic"))}}])&&Dt(t.prototype,i),r}(s.a),Lt=function(){var e;return function(t){return e||(e=new Ft(t)),e}}();function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ut(e,t){return(Ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wt(e,t){return!t||"object"!==Bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(23);var $t=i(5),zt="tbl-data-mutation-observer",Gt={attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["style"]},qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ht(e);if(t){var o=Ht(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Wt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this)).model=e.model,t.globalModel=e.globalModel,t.log=new a.a({unitType:t.model.get("unitType"),className:t.constructor.name,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._bindEvents(),t.validVideoClass=t.model.get("eligibilityValidator.validVideoClass")||["cm-vpaid-iframe","cm-ad-player","cm_video_content_video_element","_cm-loading","_cm-native-ad","_cm-background-filler","_cm-components-holder"],t.observers=[],t.observerThrottle=t.model.get("eligibilityValidator.observers.mutation.throttle")||200,t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"closeState:terminate",funcName:"_clearObservers"}]),this.model.get("videoValidator.isActive")&&(this.model.set("videoValidator.isActive",!1),this.createStateHandlers([{event:"adState:playing",funcName:"_triggerVideoValidation",isListenOnce:!0}]))}},{key:"_isElementTheTopMostElement",value:function(e){return this.elementData.topMostEl===e||this._isElementDecedentOfTopMostEl(e)||this._isValidVideoEl(this.elementData.topMostEl)||this._isValidElementInVideoPlaceholderOverlay(this.elementData.topMostEl)||this._isValidRboxElement(this.elementData.topMostEl)||this._isInlineUnitPushingDownTopMostEl(this.elementData.topMostEl)}},{key:"_isElementDecedentOfTopMostEl",value:function(e){return e.className&&this.elementData.topMostEl.querySelector&&!!this.elementData.topMostEl.querySelector(this._getQuerySelectorFromElementClassName(e))}},{key:"_isValidElementInVideoPlaceholderOverlay",value:function(e){var t=this.model.get("videoViewContainer");return Array.isArray(t)&&(t=t[0]),this.elementData.topMostEl.className&&t&&t.querySelector&&t.querySelector(this._getQuerySelectorFromElementClassName(this.elementData.topMostEl))}},{key:"_getQuerySelectorFromElementClassName",value:function(e){return".".concat(e.className.trim().replace(/\s+/g," ").split(" ").join("."))}},{key:"_isInlineUnitPushingDownTopMostEl",value:function(e){return"INLINE_INSTREAM"===this.model.get("unitType")&&"fixed"!==e.style.position}},{key:"_isValidRboxElement",value:function(e){for(;e.parentElement;){if(e.className.indexOf("trc_rbox_container")>-1)return!0;e=e.parentElement}return!1}},{key:"_handleTopElement",value:function(e){return this._clearObservers(),e}},{key:"_handleElementIsNotOnTop",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=this._calcEligiblePercent(e,this.elementData,i/100);return t&&!this._isEligiblePercentValid(n)&&(this._fireOverlayPixel(n),this._setMutationObserver(this._getElToObserve(this.elementData.topMostEl))),n}},{key:"getViewablePercentForNonFullyViewableUnits",value:function(e,t){try{return $t.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled")&&!this.measured,"videoEligibilityValidationCalc",g.a.TRC_PERFORMANCE_ACTIONS.START),this._setElementEligibilityDataByViewabilityPercent(e),this._isElementTheTopMostElement(e)?this._handleTopElement(t):this._handleElementIsNotOnTop(e,this._isEligiblePercentValid(t),t)}catch(e){this.log.error(e)}finally{$t.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled")&&!this.measured,"videoEligibilityValidationCalc",g.a.TRC_PERFORMANCE_ACTIONS.STOP),this.measured=!0}}},{key:"getViewablePercent",value:function(e){try{if(Object(n.a)(e).show(),this._setElementEligibilityData(e),this._isElementTheTopMostElement(e))return Object(n.a)(e).hide(),this._handleTopElement(100);var t=this._handleElementIsNotOnTop(e,!0);return Object(n.a)(e).hide(),t}catch(t){this.log.error(t),Object(n.a)(e).hide()}}},{key:"validateVideoIsTopEle",value:function(e){try{return this._setElementEligibilityData(e),this._isValidVideoEl(this.elementData.topMostEl)}catch(e){this.log.error(e)}}},{key:"_setElementEligibilityDataByViewabilityPercent",value:function(e){this.elementData={},this.elementData.elementBound=e.getBoundingClientRect(),this.elementData.elementBound.height=this.elementData.elementBound.height||this.model.get("height"),this.elementData.elementBound.width=this.elementData.elementBound.width||this.model.get("width"),this.elementData.samplePoint=this._getSamplePointByViewabilityPercent(e,this.elementData.elementBound),this.elementData.topMostEl=this._findTopMostEl(this.elementData.samplePoint.x,this.elementData.samplePoint.y)}},{key:"_findTopMostEl",value:function(e,t){for(var i=this._getTopMostElementAtPoint(e,t);i&&i.parentElement&&i.parentElement!==document.body&&this._isParentContainingChild(i);)i=i.parentElement;return i}},{key:"_isParentContainingChild",value:function(e){try{var t=e.getBoundingClientRect(),i=e.parentElement.getBoundingClientRect();return i.x<=t.x&&i.y<=t.y&&i.x+i.width>=t.x+t.width&&i.y+i.height>=t.y+t.height}catch(e){}return!1}},{key:"_setElementEligibilityData",value:function(e){this.elementData={},this.elementData.elementBound=e.getBoundingClientRect(),this.elementData.samplePoint=this._getSamplePoint(e,this.elementData.elementBound),this.elementData.topMostEl=this._getTopMostElementAtPoint(this.elementData.samplePoint.x,this.elementData.samplePoint.y)}},{key:"_isValidVideoEl",value:function(e){return!!this._isElementHasValidClasses(e)||this._isElementHasValidClasses(this._getVideoEl(e))}},{key:"_isElementHasValidClasses",value:function(e){for(var t in this.validVideoClass)if(Object(n.a)(e).hasClass(this.validVideoClass[t]))return!0;return!1}},{key:"_calcEligiblePercent",value:function(e,t,i){var n=this._getIntersectionRatio(e,this.elementData.elementBound,this.elementData.topMostEl),o=Math.max(100*(i-n),0);return this.log.warning("video ad is not the top most element",{validPercent:o}),o}},{key:"_isEligiblePercentValid",value:function(e){return e>=(this.model.get("viewabilityPercent")||100)}},{key:"_setMutationObserver",value:function(e){this._isSetObserver(e)&&(this.observer||this._initMutationObserver(),e.setAttribute(zt,!0),this.mutationsObserver.observe(e,Gt))}},{key:"_initMutationObserver",value:function(){var e=$t.throttle(this._onOverlayChange.bind(this),this.observerThrottle);this.mutationsObserver=new MutationObserver(e)}},{key:"_isSetObserver",value:function(e){var t=e&&e.getAttribute(zt);return this.model.get("eligibilityValidator.observers.mutation.isActive")&&!t&&$t.isObserverSupported("IntersectionObserver")}},{key:"_getElToObserve",value:function(e){if(this.model.get("eligibilityValidator.observers.mutation.isObserveParent")){var t=e.parentElement;if(["HTML"].indexOf(t.tagName)<0)return t}return e}},{key:"_fireOverlayPixel",value:function(e){this._setToModel("overlay",{overlayData:this._getOverlayData(this.elementData.topMostEl),actualEligiblePercent:parseInt(e)}),this._setToModel("overlayDetected",!0)}},{key:"_setToModel",value:function(e,t){this.model.set(e,t),this.globalModel&&this.globalModel.set(e,t)}},{key:"_getOverlayData",value:function(e){return"id@".concat(e.id,";cl@").concat(e.className).slice(0,100)}},{key:"_getVideoEl",value:function(e){var t=e.tagName.toLowerCase();return"video"===t?e:"iframe"===t?e.contentDocument&&e.contentDocument.querySelector&&e.contentDocument.querySelector("video"):e&&e.querySelector&&e.querySelector("video")}},{key:"_getTopMostElementAtPoint",value:function(e,t){return $t.getTopWindow().document.elementFromPoint(e,t)}},{key:"_getSamplePoint",value:function(e,t){var i=Math.min(this.model.get("eligibilityValidator.yThreshold"),t.height)||10;return{x:t.x+t.width/2,y:t.y+t.height-i}}},{key:"_getSamplePointByViewabilityPercent",value:function(e,t){var i=(100-this.model.get("viewabilityPercent"))/100,n=t.height*i,o=t.width*i,r=Math.min(this.model.get("eligibilityValidator.yThreshold"),t.height)||10,s=Math.min(this.model.get("eligibilityValidator.xThreshold"),t.width)||10,a=t.x+t.width-o-s,l=t.y+t.height-n-r;return{x:Math.min(a,window.innerWidth-1),y:Math.min(l,window.innerHeight-1)}}},{key:"_getIntersectionRatio",value:function(e,t,i){var n=t.width*t.height;return this._getElementsIntersectionArea(i,e,t)/n}},{key:"_getElementsIntersectionArea",value:function(e,t,i){if(!e||!t)return 0;var n=e.getBoundingClientRect(),o=i||t.getBoundingClientRect(),r=n.left,s=n.top,a=n.left+n.width,l=n.top+n.height,c=o.left,d=o.top,u=o.left+o.width,h=o.top+o.height;return Math.max(0,Math.min(a,u)-Math.max(r,c))*Math.max(0,Math.min(l,h)-Math.max(s,d))}},{key:"_clearObservers",value:function(){Object(n.a)("[".concat(zt,"]")).removeAttr(zt),this.mutationsObserver&&this.mutationsObserver.disconnect()}},{key:"_onOverlayChange",value:function(e,t){var i=this;$t.forEach(e,(function(e){var t=e.removedNodes&&$t.contains(e.removedNodes,i.elementData.topMostEl);(e.target===i.elementData.topMostEl||t)&&i.model.increaseCounter("overlayMutation")}))}},{key:"_validateVideoPosition",value:function(){var e=this.model.get("containerViewPlaceHolder")||this.model.get("videoViewContainer");this.validateVideoIsTopEle(e)||this.model.set("misplacedVideoDetected",!0)}},{key:"_triggerVideoValidation",value:function(){var e=this;setTimeout((function(){e.model.get("adState")===c.a.adState.playing&&e._validateVideoPosition()}),this.model.get("videoValidator.timeToValidation")||500)}}])&&jt(t.prototype,i),r}(s.a);function Yt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kt=i(5),Qt=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new a.a({unitType:this.model.get("unitType"),className:"MutationObserverService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.options=i,this.setObserver()}var t,i;return t=e,(i=[{key:"setObserver",value:function(){var e=Kt.throttle((this.options.callback||this._observerCallback).bind(this),100);this.config={attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0},this.observer=new MutationObserver(e)}},{key:"observe",value:function(e){e&&this.observer.observe(e,this.config)}},{key:"_observerCallback",value:function(e){this._trigger("publisher:dom:change",{})}},{key:"_trigger",value:function(e,t){r.a.trigger(e,t)}}])&&Yt(t.prototype,i),e}()},function(e,t){e.exports={player:void 0,oppsula:void 0,pms:void 0,serviceLoader:void 0,microServices:{base_url:"//vidstat.taboola.com/",async:!0,PMS:{version:"2.2.1"}}}},function(e,t){var i;function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var o={singleAd:{name:"singleAd",playerType:"singleAd",priority:1,defaultConfigFile:"./SingleAd/DefaultSingleAdConfig",unitsConfigFiles:(i={FEED_MANAGER:"./SingleAd/units/SingleAdFeedManagerConfig",FEED_MANAGER_MOBILE:"./SingleAd/units/SingleAdFeedManagerConfig",WIDGET_ITEM:"./SingleAd/units/SingleAdWidgetItemConfig",WIDGET_ITEM_MOBILE:"./SingleAd/units/SingleAdWidgetItemConfig",INLINE_INSTREAM:"./SingleAd/units/SingleAdInlineConfig",INLINE_MOBILE:"./SingleAd/units/SingleAdInlineConfig"},n(i,"WIDGET_ITEM_MOBILE","./SingleAd/units/SingleAdWidgetItemConfig"),n(i,"SLIDER_INSTREAM","./SingleAd/units/SingleAdSliderConfig"),n(i,"SLIDER_MOBILE","./SingleAd/units/SingleAdSliderConfig"),i)},rv:{name:"rv",priority:3},adjacency:{name:"adjacency",playerType:"adjacencyAd",priority:2,defaultConfigFile:"./Adjacency/DefaultAdjacencyConfig.js",unitsConfigFiles:{FEED_MANAGER:"./Adjacency/units/AdjacFeedManagerConfig.js",FEED_MANAGER_MOBILE:"./Adjacency/units/AdjacFeedManagerConfig.js",WIDGET_ITEM:"./Adjacency/units/AdjacencyWidgetItemConfig",WIDGET_ITEM_MOBILE:"./Adjacency/units/AdjacencyWidgetItemConfig",RECO_REEL_WIDGET:"./Adjacency/units/AdjacencyRecoReelWidgetConfig.js"}},replayable:{name:"replayable",defaultConfigFile:"./Replayable/DefaultReplayableConfig.js",unitsConfigFiles:{FEED_MANAGER:"./Replayable/units/ReplayableAdFeedManagerConfig.js",FEED_MANAGER_MOBILE:"./Replayable/units/ReplayableAdFeedManagerConfig.js",INLINE_INSTREAM:"./Replayable/units/ReplayableAdInlineConfig.js",INLINE_MOBILE:"./Replayable/units/ReplayableAdInlineConfig.js",WIDGET_ITEM:"./Replayable/units/ReplayableAdWidgetItemConfig.js",WIDGET_ITEM_MOBILE:"./Replayable/units/ReplayableAdWidgetItemConfig.js"},priority:4}};e.exports=o},function(e,t,i){"use strict";i.d(t,"e",(function(){return L})),i.d(t,"f",(function(){return z})),i.d(t,"l",(function(){return J})),i.d(t,"n",(function(){return oe})),i.d(t,"p",(function(){return de})),i.d(t,"q",(function(){return ge})),i.d(t,"r",(function(){return we})),i.d(t,"c",(function(){return v})),i.d(t,"j",(function(){return ke})),i.d(t,"g",(function(){return xe})),i.d(t,"k",(function(){return We})),i.d(t,"m",(function(){return tt})),i.d(t,"d",(function(){return Ye})),i.d(t,"i",(function(){return at})),i.d(t,"a",(function(){return Vt})),i.d(t,"b",(function(){return Pt})),i.d(t,"s",(function(){return Ft})),i.d(t,"h",(function(){return ft})),i.d(t,"o",(function(){return Ht})),i.d(t,"t",(function(){return Kt}));var n=i(6),o=i(4),r=i(2);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=i(5),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=d(e);if(t){var o=d(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return c(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e.model)).model=e.model,t.onPredict=e.onPredict,t.adProperties=e.adProperties,t.currentKey=0,t.log=new o.a({unitType:t.model.get("unitType"),className:"basePredictService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._bindEvents(),t}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"_setCuerrentKey",value:function(e){this.currentKey=u.last(e.split(".")),this.model.set("adsManagerLastPredictKey",this.currentKey)}},{key:"_predicted",value:function(e){if(this.model.set("lastPredictPoint",e),this.model.set("lastPredictPath",this.predictPath),this.model.get(this.predictPath+".isStartWF")&&this.startWf&&(this.log.info("startWF predicted"),this.startWf()),this._checkIsGet1OnlyOnAdLoaded()&&1===parseInt(e)&&!this.model.get("playerHasRvInQ"))return this.log.warning("no rv=1 in adLoaded skipping predict"),void this.model.set("isSkippedDistancePredict",!0);this.predictPath&&!this.model.get(this.predictPath+".isActive")||(this._logPredict(e),this.onPredict(e,this.log.className,this.adProperties))}},{key:"_checkIsGet1OnlyOnAdLoaded",value:function(){var e=this.model.get("predictors.isGet1OnlyAfterAdLoaded");return this.predictPath&&void 0!==this.model.get("".concat(this.predictPath,".isGet1OnlyAfterAdLoaded"))&&(e=this.model.get("".concat(this.predictPath,".isGet1OnlyAfterAdLoaded"))),e}},{key:"_logPredict",value:function(e){var t="predicted with key: "+e;this.adProperties?this.log.info(t+" with properties: ",this.adProperties):this.log.info(t)}}])&&a(t.prototype,i),r}(n.a);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=y(e);if(t){var o=y(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return g(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"autoKillPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint="predictors.autoKill.predictPoint",t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"adState:autoKill",funcName:"_onAutoKillPredict"}])}},{key:"_onAutoKillPredict",value:function(){setTimeout(this._predicted.bind(this,this.model.get("lastAutoKilledPredict")),0)}}])&&p(t.prototype,i),r}(h),b=i(0),_=i(3),S=i.n(_),w=i(5),A=function(e,t){return e.model=t,e.parentSelectorStr=void 0,e.model.get("permanentCard")?e.parentSelectorStr='[data-card-index="'.concat(e.model.get("permanentCard"),'"]'):e.model.get("startCard")>1?e.parentSelectorStr='[data-card-index="'.concat(e.model.get("startCard"),'"]'):e.model.get("predictors.isUseWidgetSelector")?e.parentSelectorStr=e.model.get("widgetSelector"):e.parentSelectorStr=e.model.get("parentSelector"),{getParentSelector:function(){if(e.parentSelectorStr){var t=e.parentSelectorStr.toString(),i=Object(b.a)(t);return e.model.get("predictors.isNeedValidateParentSelector")?w.getValidSelectorElements(i)[0]:i[0]}},calcPredicts:function(){var t=e.model.get(e.predictPoints);w.each(t,(function(t,i){e._calcPredict(t,i)}))}}},T=i(12);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=O(e);if(t){var o=O(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return k(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"baseDistancePredicts",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t}return t=r,(i=[{key:"_initPredict",value:function(e){this.predictPoint=e.predictPoint,this.predictKey=e.predictKey,this.startWf=e.startWfFunc,this.utils=A(this,this.model),this.scrollManager=new T.a,this._setParentSelector()}},{key:"_setParentSelector",value:function(){if(!this.isSelectorFound){var e=this.utils.getParentSelector();e?(this.isSelectorFound=!0,this.parentSelector=e,this.log.info("parentSelector found staring to predict viewability"),this._bindEvents(),this._calcPredict()):(this.log.info("no parentSelector can't predict distance waiting for parentSelector"),S.a.once("window:scroll:change",this._setParentSelector.bind(this)),this.model.listenToOnce(this.model,"change:parentSelector",this._setParentSelector.bind(this)))}}},{key:"_bindEvents",value:function(){this.parentSelector&&(window.taboolaBridge&&!this.registeredOnNotifyExternalRects&&(this.registeredOnNotifyExternalRects=!0,window.taboolaBridge.on("notifyExternalRects",this._calcPredict.bind(this))),S.a.once("window:scroll:change",this._calcPredict.bind(this)))}},{key:"_calcPredict",value:function(){}},{key:"_onDistancePredicted",value:function(e){if(this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS)return this.log.warning("Distance Predicted, speed is too high",this.scrollManager.pps),void this.model.set("isSkippedDistancePredict",!0);this.log.warning("Distance Predicted, speed is OK",this.scrollManager.pps),this._predicted(e)}}])&&C(t.prototype,i),r}(h);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){return!t||"object"!==V(t)&&"function"!=typeof t?N(e):t}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=i(5),L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=M(e);if(t){var o=M(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return x(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"distancePercentPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.distancePercent",t.maxPPS=t.model.get("predictors.distancePercent.maxPPS"),t.utils=A(N(t),t.model),t._initPredict(e),t}return t=r,(i=[{key:"_calcPredict",value:function(){if(!this.isPredicted){var e=Object(b.a)(this.model.get("scrollSelector"))[0],t=void 0!==e,i=t?e.clientHeight:window.innerHeight,n=t?i+e.scrollTop:i+window.pageYOffset,o=100/(this.predictPoint||1),r=F.getTopOfEl(this.parentSelector),s=r+this.model.get("height")/(100/this.model.get("viewPercent")||1),a=i+(s-i)/o;this.model.get("logViewabilityCalc")&&this.log.info("\ntopParentSelector: "+r+",\neligibilityPoint: "+s+",\nstartPoint: "+i+",\nbottomViewPort: "+n+",\npredictionPoint: "+a+",\ncalc: predictionPoint <= bottomViewPort: "+(a<=n)),a<=n?(this.model.set("distancePercentPredictData",{topParentSelector:r,bottomViewPort:n,eligibilityPoint:s,startPoint:i,predictionPoint:this.predictionPoint,predictKey:this.predictKey}),this.isPredicted=!0,this._onDistancePredicted(this.predictKey)):this._bindEvents()}}}])&&D(t.prototype,i),r}(I);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $=i(5),z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=H(e);if(t){var o=H(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return W(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"distancePixelsPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.distancePixels",t.maxPPS=t.model.get("predictors.distancePixels.maxPPS"),t._initPredict(e),t}return t=r,(i=[{key:"_calcPredict",value:function(){this.isPredicted||($.hasPassedPixelFromSelector(this.parentSelectorStr,this.model.get("scrollSelector"),this.predictPoint,this.model.get("predictors.isNeedValidateParentSelector"))?(this.model.set("distancePixelPredictData",{predictionPoint:this.predictionPoint,predictKey:this.predictKey}),this.isPredicted=!0,this._onDistancePredicted(this.predictKey)):this._bindEvents())}}])&&j(t.prototype,i),r}(I);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var X=i(5),J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Q(e);if(t){var o=Q(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return K(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"getAdFailPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.allowedPredictPoints="predictors.getAdFail.allowedPredictPoints",t.keysToPredict=t.model.get(t.allowedPredictPoints),t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"getAdState:failed",funcName:"_onFailedToGetAd"}])}},{key:"_onFailedToGetAd",value:function(){var e=this.model.get("lastFailedPredict");this._shouldPredict(e)&&(this.adProperties=this.model.get("lastFailedPredictProperties"),setTimeout(this._predicted.bind(this,this.model.get("lastFailedPredict")),200))}},{key:"_shouldPredict",value:function(e){return Array.isArray(this.keysToPredict)?X.contains(this.keysToPredict,e):"any"===this.keysToPredict.toString()||this.keysToPredict===e}}])&&q(t.prototype,i),r}(h);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ie(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ne(e);if(t){var o=ne(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ie(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"loadingPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint="predictors.loading.predictPoint",t.predictKey=t.model.get("predictors.loading.predictPoints"),t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"playerState:restarted",funcName:"_onLoadingClick"}])}},{key:"_incrementAd",value:function(){var e=this.model.get("predictors.loading.counterAd");e=e?++e:1,this.model.set("predictors.loading.counterAd",e)}},{key:"_onLoadingClick",value:function(){this._predicted(this.predictKey)}}])&&ee(t.prototype,i),r}(h);function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ce(e);if(t){var o=ce(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return le(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"multiAdPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.adQState=e.predictPoint,t.predictKey=e.predictKey,t.predictPath="predictors.multiAd",t._bindPredictAdQState(),t}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"_bindPredictAdQState",value:function(){var e=this.adQState;this.createStateHandlers([{event:"adQState:".concat(e),funcName:"_onPredictPoint"}])}},{key:"_allowPredict",value:function(){return this.model.get("isMultiAd")}},{key:"_onPredictPoint",value:function(){this._allowPredict()&&this._predicted(this.predictKey)}}])&&se(t.prototype,i),r}(h);function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=me(e);if(t){var o=me(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return pe(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"playerReadyPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.playerReady",t.startWf=e.startWfFunc,t.predictKey=t.model.get(t.predictPath+".predictPoint"),t.predictPoint=t.predictPath+".predictPoint",t}return t=r,(i=[{key:"_bindEvents",value:function(){"ready"===this.model.get("playerState")?this._onPlayerReady():this.createStateHandlers([{event:"playerState:ready",funcName:"_onPlayerReady",isListenOnce:!0}])}},{key:"_onPlayerReady",value:function(){this._predicted(this.predictKey)}}])&&he(t.prototype,i),r}(h);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _e(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Se(e);if(t){var o=Se(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return _e(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"repeatPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint="predictors.repeat.predictPoint",t.predictKey=t.model.get("predictors.repeat.predictPoints"),t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"repeatState:spinning",funcName:"_onRepeatSpinning"}])}},{key:"_incrementAd",value:function(){var e=this.model.get("predictors.repeat.counterAd");e=e?++e:1,this.model.set("predictors.repeat.counterAd",e)}},{key:"_allowPredict",value:function(){return!this.model.get("isMultiAd")}},{key:"_onRepeatSpinning",value:function(){this._allowPredict&&this._predicted(this.predictKey)}}])&&ve(t.prototype,i),r}(h);function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ce(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ee(e);if(t){var o=Ee(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ce(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"firstScrollPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.firstScroll",t.predictPoints=t.predictPath+".predictPoints",t.predictKey=t.model.get(t.predictPath+".predictPoints"),t.startWf=e.startWfFunc,t.isPredicted=!1,t.model.get("isEligibleToPlay")?t._callPredict():t._onFirstScroll(),t}return t=r,(i=[{key:"_bindEvents",value:function(){S.a.once("window:scroll:change",this._onFirstScroll.bind(this)),this.createStateHandlers([{event:"isEligibleToPlay:true",funcName:"_callPredict"}])}},{key:"_onFirstScroll",value:function(){if(!this.isPredicted){var e=window.pageYOffset,t=5,i=Object(b.a)(this.model.get("scrollSelector"))[0];if(void 0!==i){var n=i.clientHeight;e=n+i.scrollTop,t=n+5}t<=e?this._callPredict():this._bindEvents()}}},{key:"_callPredict",value:function(){this.isPredicted||(this.isPredicted=!0,this._predicted(this.predictKey))}}])&&Te(t.prototype,i),r}(h);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(s,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Re(e);if(t){var o=Re(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return De(this,i)}}(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"emptyQueuePredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._bindEmptyQueuePredict(),t}return t=s,(i=[{key:"_bindEvents",value:function(){}},{key:"_bindEmptyQueuePredict",value:function(){this.createStateHandlers([{event:"adManagerState:".concat(r.adManagerState.empty),funcName:"_onQEmpty"}])}},{key:"_allowPredict",value:function(){return this.model.get("isMultiAd")}},{key:"_onQEmpty",value:function(){this.model.get("getAdState")!==r.getAdState.gettingAd&&this._onPredictPoint()}},{key:"_onPredictPoint",value:function(){this._allowPredict()&&this._predicted(this.model.get("predictors.emptyQueue.predictPoints"))}}])&&Ie(t.prototype,i),s}(h),Ne=i(1),Me=i.n(Ne);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function je(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var We=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(s,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ue(e);if(t){var o=Ue(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return je(this,i)}}(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"fullEligibilityPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint=e.predictPoint,t.predictKey=t.model.get("predictors.fullEligibility.predictPoints"),t.predictPath="predictors.fullEligibility",t.startWf=e.startWfFunc,t.hadGetAdRv=!1,t.maxPPS=t.model.get("predictors.fullEligibility.maxPPS"),t.scrollManager=new T.a,t._bindEvents(),t}return t=s,(i=[{key:"_bindEvents",value:function(){this.scrollManager&&(this.createStateHandlers([{event:"getAdState:".concat(r.getAdState.gettingAd),funcName:"_onGettingAd",isListenOnce:!0}]),this.model.get("frameType")===Me.a.FRAME_TYPE.plainPage?(S.a.once("window:scroll:change",this._calcPredict.bind(this)),this.scrollManager.registerForScrollEnd(this._calcPredict.bind(this))):this.calcPredictInterval=setInterval(this._calcPredict.bind(this),1e3*this.model.get("predictors.fullEligibility.checkPredictsSeconds")))}},{key:"_onGettingAd",value:function(){1!==this.model.get("lastGetAdKey")?this.createStateHandlers([{event:"getAdState:".concat(r.getAdState.gettingAd),funcName:"_onGettingAd",isListenOnce:!0}]):this.hadGetAdRv=!0}},{key:"_calcPredict",value:function(){this.hadGetAdRv||this.isPredicted||(this._canPredict()&&this.maxPPS&&Math.abs(this.scrollManager.pps)<this.maxPPS?(this.isPredicted=!0,this.calcPredictInterval&&(clearInterval(this.calcPredictInterval),this.calcPredictInterval=void 0),this.model.set("fullEligibilityPredicted",!0),this._predicted(this.predictKey)):S.a.once("window:scroll:change",this._calcPredict.bind(this)))}},{key:"_canPredict",value:function(){var e=this.model.get("adState")===r.adState.playing,t=this.model.get("isEligibleToPlay")&&this.model.get("isSkippedDistancePredict")&&!e;return t&&this._checkIsGet1OnlyOnAdLoaded()&&(t=t&&this.model.get("playerHasRvInQ")),t}}])&&Le(t.prototype,i),s}(h);function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=qe(e);if(t){var o=qe(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ge(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"bForcePredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint="predictors.bForce.predictPoints",t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"canGetRv:true",funcName:"_onCanGetRv"}])}},{key:"_onCanGetRv",value:function(){this._predicted(this.model.get(this.predictPoint))}}])&&$e(t.prototype,i),r}(h);function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?Ze(e):t}function Ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=et(e);if(t){var o=et(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Je(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"intersectionPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPoint=e.predictPoint,t.predictKey=e.predictKey,t.predictPath="predictors.intersection",t.startWf=e.startWfFunc,t.utils=A(Ze(t),t.model),t._setSelector(),t}return t=r,(i=[{key:"_initObserver",value:function(){var e={rootMargin:"0px",threshold:[0,this.predictPoint/100]};this.observer=new IntersectionObserver(this._observerCallback.bind(this),e),this.observer.observe(this.parentSelector)}},{key:"_setSelector",value:function(){if(!this.isSelectorFound){var e=this.utils.getParentSelector();e?(this.isSelectorFound=!0,this.selectorTimeOut&&(clearTimeout(this.selectorTimeOut),this.selectorTimeOut=void 0),this.parentSelector=e,this.log.info("parentSelector found staring to predict viewability"),this._bindEvents(),this._initObserver()):(this.log.info("no parentSelector can't predict distance waiting for parentSelector"),this.model.listenToOnce(this.model,"change:parentSelector",this._setSelector.bind(this)),this.selectorTimeOut=setTimeout(this._setSelector.bind(this),1e3))}}},{key:"_observerCallback",value:function(e,t){this.isPredicted||100*e[0].intersectionRatio>=this.predictPoint&&(this.isPredicted=!0,this._predicted(this.predictKey),this.observer.disconnect())}}])&&Qe(t.prototype,i),r}(h);function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e,t){return!t||"object"!==it(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var at=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=st(e);if(t){var o=st(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return rt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"feedXPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.feedX",t.predictPoints=t.predictPath+".predictPoints",t.predictKey=t.model.get(t.predictPath+".predictPoints"),t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"feedxToggle",funcName:"_onFeedxToggle"}])}},{key:"_onFeedxToggle",value:function(){this.model.get("feedxToggle")%2==1&&this._predicted(this.predictKey)}}])&&nt(t.prototype,i),r}(h);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t){return!t||"object"!==lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ht(e);if(t){var o=ht(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return ut(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:t.constructor.name,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.feedContainerChanged",t.predictPoints=t.predictPath+".predictPoints",t.predictKey=t.model.get(t.predictPath+".predictPoints"),t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"feedContainerChanged",funcName:"_onFeedContainerChanged"}])}},{key:"_onFeedContainerChanged",value:function(){this._predicted(this.predictKey)}}])&&ct(t.prototype,i),r}(h);function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gt(e,t){return(gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function yt(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=vt(e);if(t){var o=vt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return yt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"baseAdProgressionPredicts",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t}return t=r,(i=[{key:"_initPredict",value:function(e){this.requestedTime=e.predictPoint,this.predictKey=e.predictKey,this._bindPredictAdDuration()}},{key:"_bindPredictAdDuration",value:function(){this.createStateHandlers([{event:"activeAdCurrentTime",funcName:"_onPredictPoint"},{event:"lastActiveAd",funcName:"_onAdCompleted"}])}},{key:"_onPredictPoint",value:function(){this._allowPredict()&&this._predicted(this.predictKey)}},{key:"_allowPredict",value:function(){}},{key:"_onAdCompleted",value:function(){this.isPredicted=!1}}])&&mt(t.prototype,i),r}(h);function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Tt(e);if(t){var o=Tt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return At(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"adProgressionBeforeEndPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.adProgressionBeforeEnd",t._initPredict(e),t}return t=r,(i=[{key:"_allowPredict",value:function(){if(this.isPredicted)return!1;var e=this.model.get("activeAdMaxTime"),t=this.model.get("activeAdCurrentTime");return!!(e&&t&&e-this.requestedTime<=t)&&(this.isPredicted=!0,this.model.increaseCounter("onadProgressionBeforeEndPredictPredict"),!0)}}])&&St(t.prototype,i),r}(bt);function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e,t){return!t||"object"!==Ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=It(e);if(t){var o=It(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ot(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"adProgressionAfterBeginPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.adProgressionAfterBegin",t._initPredict(e),t}return t=r,(i=[{key:"_allowPredict",value:function(){if(this.isPredicted)return!1;var e=this.model.get("activeAdCurrentTime");return!!(e&&this.requestedTime<=e)&&(this.isPredicted=!0,this.model.increaseCounter("onadProgressionAfterBeginPredict"),!0)}}])&&Et(t.prototype,i),r}(bt);function Dt(e){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nt(e,t){return!t||"object"!==Dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Mt(e);if(t){var o=Mt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Nt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"timePredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.time",t.modelKey=e.modelKey?e.modelKey:e.predictKey?"".concat(t.predictPath,".predictPoints.").concat(e.predictKey):t.predictPath,t.predictKey=e.predictKey||t.model.get("".concat(t.modelKey,".predictPoints")),t.isActive=t.model.get("".concat(t.modelKey,".isActive")),t.isActive?(t.length=1e3*t.model.get("".concat(t.modelKey,".lengthInSeconds")),t.length?(t.repeat=t.model.get("".concat(t.modelKey,".repeat"))||1,t._bindTimePredict(),t._startPredictTimer(),t):Nt(t)):Nt(t)}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"_bindTimePredict",value:function(){this.createStateHandlers([{event:"time:".concat(this.predictPath),funcName:"_startPredictTimer"}])}},{key:"_canRepeatPredict",value:function(){return this.repeat>0}},{key:"_canStartTimer",value:function(){return!this.stopped&&this._canRepeatPredict()}},{key:"_startPredictTimer",value:function(){var e=this;this._canStartTimer()&&(this.timer&&(this.timer=clearTimeout(this.timer)),this.log.info("Starting timer",this.predictKey),this.timer=setTimeout((function(){--e.repeat,e._predicted(e.predictKey),e._startPredictTimer()}),this.length))}},{key:"stop",value:function(){this.log.info("Timer predict stopped"),this.timer=clearTimeout(this.timer),this.stopped=!0}}])&&Rt(t.prototype,i),r}(h);function Lt(e){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e,t){return!t||"object"!==Lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wt(e){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var Ht=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Wt(e);if(t){var o=Wt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ut(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"mp4Predict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.mp4",t.predictKey=t.model.get(t.predictPath+".predictPoint"),t.predictPoint=t.predictPath+".predictPoint",t}return t=r,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"playerQueue",funcName:"_onPlayerQueueStatusChange"}])}},{key:"_onPlayerQueueStatusChange",value:function(){this.adsListFromPlayer=this.model.get("playerQueue"),this._allowPredict()&&(this._predicted(this.predictKey),this.model.stopListening(this.model,"change:playerQueue"))}},{key:"_allowPredict",value:function(){var e=this.adsListFromPlayer[this.adsListFromPlayer.length-1];return!0===e.rv&&"video"===e.mt}}])&&Bt(t.prototype,i),r}(h);function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gt(e,t){return(Gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e,t){return!t||"object"!==$t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gt(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Yt(e);if(t){var o=Yt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return qt(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).log=new o.a({unitType:t.model.get("unitType"),className:"transitionPredict",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.predictPath="predictors.transition",t.isActive=t.model.get("".concat(t.predictPath,".isActive")),t.isActive?(t.predictPoints="".concat(t.predictPath,".predictPoints"),t.predictKey=e.predictKey,t.predictOptions=t.model.get("".concat(t.predictPoints,".").concat(t.predictKey)),t.predictOptions.container?(t.container=document.querySelector(t.predictOptions.container),t.container?(t.predictOptions.event=t.predictOptions.event||"start",t.predictOptions.requireEligibility=t.predictOptions.requireEligibility||!1,t.predictOptions.repeat=t.predictOptions.repeat||0,t.predictOptions.checkQueueForSameRv=t.predictOptions.checkQueueForSameRv||!1,t._startTransitionPredictor(),t):qt(t)):qt(t)):qt(t)}return t=r,(i=[{key:"_bindEvents",value:function(){}},{key:"_startTransitionPredictor",value:function(){this.animationEventDetector=TRC.dom.detectAnimationEvent(this.container,this.predictOptions.event),this._bindedOnAnimationEvent=this._onAnimationEvent.bind(this,this.predictOptions.event),TRC.dom.on(this.container,this.animationEventDetector,this._bindedOnAnimationEvent)}},{key:"_onAnimationEvent",value:function(e){if(!this.stopped){var t=(new Date).getTime();this.lastPredicted&&t-this.lastPredicted<1e3||this._isRequireEligibilityMatch()&&(this._isQueueContainSameRv()||(this.lastPredicted=t,this._predicted(this.predictKey),--this.predictOptions.repeat<0&&(this.stopped=!0,TRC.dom.off(this.container,this.animationEventDetector,this._bindedOnAnimationEvent))))}}},{key:"_isRequireEligibilityMatch",value:function(){return!this.predictOptions.requireEligibility||this.model.get("isEligibleToPlay")}},{key:"_isQueueContainSameRv",value:function(){return!!this.predictOptions.checkQueueForSameRv&&this.model.get(0==this.predictKey?"adsList.nonRvAds":"adsList.rvAds")>0}}])&&zt(t.prototype,i),r}(h)},function(e,t){function i(e){window.cmTag=window.cmTag||{},e=e||{},this.unitType=e.unitType,this.className=this.className||e.className}i.prototype.info=function(e,t){this.hasLoggerMethod("info")&&window.cmTag.logger.info("unit type: "+this.unitType+" class name: "+this.className+" - "+e,t)},i.prototype.debug=function(e,t){this.hasLoggerMethod("info")&&window.cmTag.logger.info("unit type: "+this.unitType+" class name: "+this.className+" - "+e,t)},i.prototype.error=function(e,t){this.hasLoggerMethod("error")&&window.cmTag.logger.error("unit type: "+this.unitType+" class name: "+this.className+" - "+e,t)},i.prototype.hasLoggerMethod=function(e){return window.cmTag&&window.cmTag.logger&&window.cmTag.logger[e]&&"function"==typeof window.cmTag.logger[e]},e.exports=i},function(e,t,i){"use strict";var n=i(4),o=i(0);function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s,a=i(5),l=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.conf=t,this.log=new n.a({unitType:"Manager",className:"ScrollManager",version:this.conf.version,isDebug:this.conf.isDebug}),this.log.info("Created"),this.window=i||window,this.$window=Object(o.a)(window),this.windowHeight=this.$window.height(),this.windowWidth=this.$window.width(),this.scrollElement=a.isEmpty(r)?this.window:Object(o.a)(r)[0],this.$scrollElement=Object(o.a)(this.scrollElement),this.timeBetweenEvents=100,this.lastTimeStamp=0,this.lastScrollTop=0,this.pps=0,this.ppsChange=0,this.vms=1/0,this.direction=1,this.maxMSBetweenEvents=2e3,this.scrollEndTimeout=500;var s=a.throttle(this.onScroll.bind(this),this.timeBetweenEvents);this.scrollElement.addEventListener("scroll",s)}var t,i;return t=e,(i=[{key:"onScroll",value:function(e){clearTimeout(this.scrollEnd);var t=e.timeStamp-this.lastTimeStamp;this.lastTimeStamp=e.timeStamp;var i=this.$scrollElement.scrollTop()-this.lastScrollTop;this.lastScrollTop=this.$scrollElement.scrollTop(),this.direction=i<0?-1:1,t<this.maxMSBetweenEvents&&this.changePPS(i/t*1e3),a.parseBool(this.conf.isLogScroll)&&this.log.info("onScroll - pps: "+this.direction*this.pps),this.scrollEnd=setTimeout(this.onScrollEnd.bind(this),this.scrollEndTimeout)}},{key:"onScrollEnd",value:function(){a.parseBool(this.conf.isLogScroll)&&this.log.warning("onScrollEnd"),this.changePPS(0),a.forEach(this.onScrollEndCBList,function(e){e()}.bind(this))}},{key:"changePPS",value:function(e){this.ppsChange=e-this.pps,this.pps=e,0===this.pps&&(this.vms=1/0),this.vms=this.windowHeight/this.pps*1e3,a.forEach(this.onScrollPPSChange,(function(e){setTimeout(e,0)}))}},{key:"registerForPPSChange",value:function(e){this.onScrollPPSChange=this.onScrollPPSChange||[];var t=this.onScrollPPSChange.indexOf(e);return-1!==t?t:this.onScrollPPSChange.push(e)-1}},{key:"deRegisterForPPSChange",value:function(e){var t=this.onScrollPPSChange.indexOf(e);this.onScrollPPSChange.splice(t,1)}},{key:"registerForScrollEnd",value:function(e){this.onScrollEndCBList=this.onScrollEndCBList||[];var t=this.onScrollEndCBList.indexOf(e);return-1!==t?t:this.onScrollEndCBList.push(e)-1}},{key:"deRegisterForScrollEnd",value:function(e){var t=this.onScrollEndCBList.indexOf(e);this.onScrollEndCBList.splice(t,1)}}])&&r(t.prototype,i),e}();t.a=function(e,t,i){return s||(s=new l(e,t,i)),s}},function(e,t,i){"use strict";function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}i.d(t,"a",(function(){return s}));var r=i(5),s=function(e,t){if(e.model&&r.isArray(t)){var i=function(e){var t,i=e.self,o=e.funcName,s=e.withBind,a=e.args;r.isString(o)&&r.isFunction(i[o])&&(s?(t=i[o]).bind.apply(t,[i].concat(n(a)))():i[o].apply(i,n(a)))};r.each(t,function(t){var n=t.event,o=t.funcName,s=t.isListenOnce,a=void 0!==s&&s,l=t.withBind,c=void 0===l||l;if(r.isArray(n)&&function(t){var n=t.event,o=t.funcName,s=t.isListenOnce,a=t.withBind,l=s?"listenToOnce":"listenTo",c=!0,d=!1,u=[];r.forEach(n,function(e){var t=e.split(":")[0],i=e.split(":")[1];u.push({eventName:t,stateName:i})}.bind(e));var h=function(t){if(!s||!d){var n=!0;r.forEach(u,(function(t){(void 0!==e.model.get(t.eventName)?e.model.get(t.eventName).toString():void 0)!==t.stateName&&(n=!1)})),n&&c?(c=!1,d=!0,i({self:e,funcName:o,withBind:a,args:arguments})):n||t()}};r.forEach(n,function(t){!function(e){var t=e.self,i=e.event,n=e.func,o=e.listen,r=e.isListenOnce,s=e.onEventNotEqual,a=i.split(":")[0],l=i.split(":")[1],c=function(){var e=function(){};r&&(e=function(){t.model.listenToOnce(t.model,"change:".concat(a),c)}),t.model.get(a).toString()===l?n.call(t,e):r?(s(),e()):s()}.bind(t);t.model[o](t.model,"change:".concat(a),c)}({self:e,func:h,event:t,withBind:a,listen:l,isListenOnce:s,onEventNotEqual:function(){c=!0}.bind(e)})}.bind(e))}({event:n,funcName:o,isListenOnce:a,withBind:c}),r.isString(n)&&r.isString(o)){var d=a?"listenToOnce":"listenTo";n.match(":")?function(e){var t=e.self,n=e.funcName,o=e.event,r=e.withBind,s=e.listen,a=e.isListenOnce,l=o.split(":")[0],c=o.split(":")[1],d=function(){t.model.get(l).toString()==c?i({self:t,funcName:n,withBind:r,args:arguments}):a&&t.model.listenToOnce(t.model,"change:".concat(l),d)}.bind(t);t.model[s](t.model,"change:".concat(l),d)}({self:e,funcName:o,event:n,withBind:c,listen:d,isListenOnce:a}):e.model[d](e.model,"change:".concat(n),function(){i({self:e,funcName:o,withBind:c,args:arguments})}.bind(e))}}.bind(e))}}},function(e,t,i){"use strict";var n=i(4),o=i(2);function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(t,i,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new n.a({unitType:this.model.get("unitType"),className:"timerService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.doneFunction=r||function(){},this.time=s||0,this.conditions=i||{startCondition:{stateToListen:"",state:""},pauseCondition:{stateToListen:"",state:""},continueCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:"",state:""},isStartOnce:!1},this._startListeningToConditions(),this.timerState=o.readyState}var t,i;return t=e,(i=[{key:"_startListeningToConditions",value:function(){this.conditions.startCondition&&(this.conditions.isStartOnce?this.model.listenToOnce(this.model,"change:"+this.conditions.startCondition.state,this.start.bind(this)):this.model.listenTo(this.model,"change:"+this.conditions.startCondition.state,this.start.bind(this))),this.conditions.pauseCondition&&this.model.listenTo(this.model,"change:"+this.conditions.pauseCondition.state,this.pause.bind(this)),this.conditions.continueCondition&&this.model.listenTo(this.model,"change:"+this.conditions.continueCondition.state,this.continue.bind(this)),this.conditions.stopCondition&&this.model.listenTo(this.model,"change:"+this.conditions.stopCondition.state,this.stop.bind(this))}},{key:"start",value:function(e,t){this.conditions.startCondition.stateToListen!==t&&"any"!==this.conditions.startCondition.stateToListen||(this.timerState=o.timerState.working,this.stTime=(new Date).valueOf(),this.timeout=setTimeout(this.done.bind(this),this.time),this.timeLeft=this.time)}},{key:"pause",value:function(e,t){if(this.timerState===o.timerState.working&&(!t||this.conditions.pauseCondition.stateToListen===t)){this.timerState=o.timerState.paused,this._clearTimer();var i=(new Date).valueOf()-this.stTime;this.timeLeft-=i}}},{key:"continue",value:function(e,t){this.timerState===o.timerState.paused&&(!t||t&&this.conditions.continueCondition.stateToListen===t)&&(this.timerState=o.timerState.working,this.timeout=setTimeout(this.done.bind(this),this.timeLeft),this.stTime=(new Date).valueOf())}},{key:"stop",value:function(e,t,i,n){this.timeout&&(n||this.conditions.stopCondition.stateToListen===t)&&(this.timerState=o.timerState.stopped,this._clearTimer())}},{key:"done",value:function(){this.timerState=o.timerState.done,this.doneFunction(),this.timeout=void 0}},{key:"getTimerState",value:function(){return this.timerState}},{key:"_clearTimer",value:function(){clearTimeout(this.timeout),this.timeout=void 0}},{key:"isTimerActive",value:function(){return this.timerState===o.timerState.working||this.timerState===o.timerState.paused}}])&&r(t.prototype,i),e}();t.a=s},function(e,t,i){"use strict";var n=i(0),o=i(6),r=i(3),s=i.n(r),a=i(7);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=i(5),m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=f(e);if(t){var o=f(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return h(this,i)}}(r);function r(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=o.call(this,e)).model=e,i.globalModel=t,i.model.set("isEligibleToPlay",!1),i.model.get("isTestParentSelector")&&i._bindScroll(),i.model.get("isInAppBridgeOn")&&window.taboolaBridge&&i._observeInAppIntersectionChange(),i.oldRect={},i.viewabilityPercent=i.model.get("viewabilityPercent"),i.printCurrentViewPercent=i.model.get("printCurrentViewPercent"),i.isEligibilityValidatorActive=i.model.get("eligibilityValidator.isActive"),i.isEligibilityValidatorActive&&(i.validateEligibilityOnlyForRV=i.model.get("eligibilityValidator.isRvOnly"),i.eligibilityValidator=new a.e({model:i.model,globalModel:i.globalModel})),i}return t=r,(i=[{key:"_bindScroll",value:function(){this._testTopParentSelector(),s.a.on("window:scroll:change",this._testTopParentSelector.bind(this))}},{key:"_initObserver",value:function(){var e={rootMargin:"0px",threshold:[0,this.model.get("viewPercent")/100,this.model.get("viewabilityPercent")/100,this.model.get("100viewPercent")/100]};if(this.model.get("stickyCard.isActive")){var t,i=this.model.get("stickyCard.observerThreshold");i&&(t=e.threshold).push.apply(t,function(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(i))}this.observer=new IntersectionObserver(this._observerCallback.bind(this),e),this.log.info("IntersectionObserver was created")}},{key:"bindEvent",value:function(){}},{key:"_getDimensions",value:function(e){var t=Object(n.a)(e);return{width:t.width()||this.model.get("width"),height:t.height()||this.model.get("height")}}},{key:"_calculateEligibility",value:function(){this.model.get("isUseObserver")||(this.inViewDiv=this._getInViewDiv()),this._testEligibility()}},{key:"_onTabEvent",value:function(e){}},{key:"_printCurrentViewPercent",value:function(e,t){this.printCurrentViewPercent&&this.log.info("".concat(e,": "),t||0)}},{key:"_getInViewDiv",value:function(){for(var e=0;e<this.placeHolders.length;e++){var t=this.placeHolders[e],i=this._getDimensions(t),n=p.getViewPercent(t,i.width,p.getVideoHeight(i.width),this.model.get("scrollSelector"));this._printCurrentViewPercent("currViewPercent",n);var o=this.model.get("viewPercent")||100;if(this._shouldValidateEligibility(n)&&(n=this.eligibilityValidator.getViewablePercentForNonFullyViewableUnits(t,n),this._printCurrentViewPercent("currViewPercent - validated",n),this._onEligibilityValidation(o,n)),this.model.set("isViewable",this.viewabilityPercent<=n),this.model.set("isViewable100",n>=this.model.get("100viewPercent")),this.model.get("stickyCard.isActive")){var r=n<this.model.get("stickyCard.attachPercent")&&this._canStickToTop(t);this.model.set("isEligibleToStick",r)}if(o<=n)return this.placeHolders[e]}}},{key:"_onEligibilityValidation",value:function(e,t){this.model.set("eligibilityValidation.isValid",e<=t)}},{key:"_observerCallback",value:function(e,t){this.inViewDiv=void 0;for(var i=!1,n=0;n<e.length;n++){var o=100*e[n].intersectionRatio;if(this._shouldValidateEligibility(o)&&(i=!0,o=this.eligibilityValidator.getViewablePercentForNonFullyViewableUnits(e[n].target,o)),this.model.set("isViewable100",o>=this.model.get("100viewPercent")),this.model.set("isViewable",this.viewabilityPercent<=o),this.model.get("stickyCard.isActive")){var r=o<this.model.get("stickyCard.attachPercent")&&e[n].boundingClientRect.top<=0;this.model.set("isEligibleToStick",r)}if(o>=this.model.get("viewPercent")){this.inViewDiv=e[n];break}}!this.inViewDiv&&i&&s.a.once("window:scroll:change",this._observerCallback.bind(this,e,t)),this._testEligibility()}},{key:"_testEligibility",value:function(){}},{key:"_testTopParentSelector",value:function(){var e=this._getTopParentSelector();this.topParentSelector||(this.topParentSelector=e),this.topParentSelector&&!e&&this.model.get("isCheckTopParentSelectorLost")&&(this.model.set("topParentSelectorLost",!0),this._stopObserver())}},{key:"_getTopParentSelector",value:function(){var e=this.model.get("parentSelector");return e=p.isArray(e)?e[0]:e,e=Object(n.a)(e)[0],p.getTopOfEl(e)}},{key:"_observeInAppIntersectionChange",value:function(){window.taboolaBridge.on("intersectionChanged",this._onIntersectionChanged.bind(this)),window.taboolaBridge.active=!0}},{key:"_onIntersectionChanged",value:function(e){var t=e.rects.boundingClientRect,i={width:function(){return t.width},height:function(){return Math.abs(t.top-window.taboolaBridge.data.rootBounds.height)},top:function(){var e=0;return t.top<0&&(e-=t.top),e}};this.model.set("scrollSelector",i),this._calculateEligibility()}},{key:"_canStickToTop",value:function(e){return!!e&&e.getBoundingClientRect().top<=0}},{key:"_shouldValidateEligibility",value:function(e){if(this.isEligibilityValidatorActive&&this.viewabilityPercent<=e){if(!this.validateEligibilityOnlyForRV)return!0;var t=this.model.get("activeAdData");return t?t.requiredViewability:this.model.get("playerHasRvInQ")}return!1}},{key:"_getFromModel",value:function(e){return(this.globalModel||this.model).get(e)}},{key:"_stopObserver",value:function(){this.observer&&this.observer.disconnect&&this.observer.disconnect()}},{key:"_setToModel",value:function(e,t){this.model.set(e,t),this.globalModel&&this.globalModel.set(e,t)}},{key:"onAttach",value:function(){this._checkSliderEligibilityOnScroll&&(s.a.off("window:scroll:change",this._checkSliderEligibilityOnScroll),this.isListenToSliderEligiilityChange=!1)}},{key:"checkSliderEligibility",value:function(){this.isListenToSliderEligiilityChange||(this.isListenToSliderEligiilityChange=!0,this._checkSliderEligibilityOnScroll=this.checkSliderEligibility.bind(this),s.a.on("window:scroll:change",this._checkSliderEligibilityOnScroll));var e=this.isSliderEligibleToPlay();return e?(this._removeSliderPlaceholder(),this._setToModel("isSliderEligibleToPlay",!0)):this._setToModel("isSliderEligibleToPlay",!1),e}},{key:"isSliderEligibleToPlay",value:function(){if(!this._shouldValidateEligibility(100))return!0;this.sliderPlaceholder||this._createSliderPlaceholder();var e=this.eligibilityValidator.getViewablePercentForNonFullyViewableUnits(this.sliderPlaceholder,100);return this.viewabilityPercent<=e}},{key:"_createSliderPlaceholder",value:function(){var e=this.model.get("detachToSlider");this.sliderPlaceholder=document.createElement("div"),this.sliderPlaceholder.style[e.position.horizontal]=e.position.horizontalOffset+"px",this.sliderPlaceholder.style[e.position.vertical]=e.position.verticalOffset+"px",this.sliderPlaceholder.style.width=e.width+"px",this.sliderPlaceholder.style.height=e.height+"px",this.sliderPlaceholder.style.position="fixed",this.sliderPlaceholder.style.zIndex=this._getPlaceholderZIndex(),document.body.appendChild(this.sliderPlaceholder)}},{key:"_removeSliderPlaceholder",value:function(){this.sliderPlaceholder&&this.sliderPlaceholder.parentElement&&(this.sliderPlaceholder.parentElement.removeChild(this.sliderPlaceholder),this.sliderPlaceholder=void 0)}},{key:"_getPlaceholderZIndex",value:function(){var e=this.model.get("videoViewContainer");Array.isArray(e)&&(e=e[0]);var t=e.querySelectorAll('[class*="VpaidWrapper"]')[0];return t?t.style.zIndex:0}}])&&d(t.prototype,i),r}(o.a);t.a=m},function(e,t,i){"use strict";var n=i(3),o=i.n(n),r=i(11),s=i.n(r),a=i(8),l=i.n(a),c=i(1),d=i.n(c),u=i(2),h=i.n(u),f=i(5),p=o.a.DeepModel.extend({STATE:{READY:0,GOT_AD:1,PLAYING:2,PAUSED:3,PAUSED_BY_USER:4,STOPPED_BY_USER:5,DETACHED:6,ATTACHED:7,DONE:8,PLAYER_READY:9,PLAYER_CLOSE:10,PLAYER_STOP:11,AD_STOPPED:12,OPT_OUT:13,OPEN_WITH_PAUSE:14,WAITING_FOR_EXPAND:15,REPEAT_STAND_BY:16,REPEAT_SPINNING:17,SKIPPED_BY_USER:18},defaults:{abTest:"",adMaxPlaySeconds:181,adTitle:"Video",adVolume:"auto",aspectRatio:"16:9",aspectRatioNum:"{{defaultAspectRatioNum}}",defaultAspectRatioNum:16/9,autoPlay:!0,baseReportD:"basebanner.com",oppsDataCenter:"la",cfr:0,country:"",clickTestSeconds:.5,defaultAdParameters:"",defaultTagTimeout:20,gaFactor:1e4,gaFrameSrc:"{{urls.base}}/release-r1/assets/ga.html#page={{gaVertical}}&category={{gaVertical}}",gaVertical:"source",height:0,interruptLoading:!0,ip:"",isAllowDuplicateKey:!0,isDebug:!1,isFirePixel:!0,isHideIframe:!1,isMobile:!1,isMobileMacros:!1,isPlayerViewable:!1,isProtectedInIframe:!0,isRepeat:!0,isResponsive:!0,isCallIDLE:!1,isShowOnAd:!1,isShowOnAdLocation:"begin",isSoundOnHover:!1,isUnitEligible:!1,isUnitViewable:!1,isUseObserver:!1,isUseNonNativeObserver:!1,kbnul:"//vidanalytics.taboola.com",lineItemId:"",loaderImage:"",logViewabilityCalc:!1,mfp:4,mobilePlayer:"DP",mobileSpriteTimeoutSeconds:20,mute:!0,noaop:2,noDebugReport:!1,openingEffect:0,originId:15,placement:"",playerContainer:"body",playerEndSeconds:0,playerVolume:0,printCurrentViewPercent:!1,predefinedSettings:{level:1},repeat:!0,retriesLWF:5,reportTimerSeconds:10,ronPercent:5,secondsBW:10,secondsInView:2,secondsLWF:.1,secondsToClose:0,secondsToCloseGlobal:0,sortOrderType:0,state:null,timeBetweenAds:1,totalTimeout:60,traceViewabilitySeconds:2,traceViewability100Seconds:2,ulog:[""],vastRetry:2,version:"158_allow_sec",vertical:"source",viewabilityPercent:50,volumeMuted:!0,wfManual:!1,volume:"onHover",width:0,maxVimpsInQueue:2,autoplayDetectorTimeoutSec:1,billableEvents:[1,21,22,23,24,25,30,32],useSwfVideoJs:!0,isPWOV:!1,frameType:d.a.FRAME_TYPE.plainPage,"100viewPercent":100,mpgclrslv:["gcdn.2mdn.net"],cnvsldrt:5,gtvid:"//cnv.tcsrv.com/getvid?url",playerTextAlign:!0,cookieMatchActive:!1,fmNoAboveSelector:"no-vabove",fmNoBelowSelector:"no-vbelow",vForce:{isActive:!1,getAdTimeoutSeconds:10},detach:{width:320,position:{horizontal:"right",vertical:"bottom"}},customization:{unitContainer:{},adTitle:{},placeHolder:{},playerView:{}},midrollCollapse:{isActive:!1,time:5},pixels:{D2DFallback:{id:31468623,type:5,isFire:!0},conversion:{id:31425418,type:2,isFire:!0},close:{id:31579687,type:5,isFire:!0},timeout:{id:31574457,type:5,isFire:!0},optOut:{id:31530958,type:5,isFire:!0},optOutNever:{id:31419288,type:5,isFire:!0},addImpresion:{id:31579657,type:5,isFire:!0},eligible:{id:31579697,type:16,isFire:!0},networkError:{type:42},lostEligibility:{type:43,isFire:!0},fraudDetection:{type:32},clickthrough:{type:44},error:{id:31608187,type:5,isFire:!0},quarterly1:{id:31608197,type:5,isFire:!0},quarterly2:{id:31608207,type:5,isFire:!0},quarterly3:{id:31608217,type:5,isFire:!0},complete:{id:31608237,type:5,isFire:!0},render:{id:31608177,type:5,isFire:!0},startWithABT:{id:31589837,type:45,isFire:!1},repeatClick:{type:46},renderOnDemand:{type:51},stopUnit:{type:52},getAdAny:{type:53,isFire:!1},getAdNoRV:{type:54,isFire:!1},getAd:{type:55,isFire:!1},secondsToCloseTimer:{type:56,isFire:!1},secondsToCloseGlobalTimer:{type:57,isFire:!1},midrollCollapseTimer:{type:58,isFire:!1},attach:{type:61},detach:{type:62},D2DClick:{type:63},D2DClickSuspicious:{type:68},TRCResetCloseUnit:{type:64},sliderFeedStartWithABT:{type:65},onParentSelectorLost:{type:66},adChoice:{type:67},noCMPonPage:{type:72},hasCMPonPage:{type:73,isFire:!0},rvHandlerTimerExpired:{type:74},onPlayerHasRVinQ:{type:75},skippedDistancePredict:{type:76},publisherVideoDetected:{type:78},publisherIframeVideoDetected:{type:79},compDetectedOnPage:{type:80},feedxToggle:{type:82},testPixels:{type:100},fullEligibilityPredict:{type:77,isFire:!1},progressLoaderInit:{type:83},progressLoaderMove:{type:84},progressLoaderClose:{type:85},organicCardInjected:{type:86},organicCardInjectionFail:{type:87},terminateOnResize:{type:89},unitDelayed:{type:93},unitLoadAfterDelay:{type:94},autoplaySoundOn:{type:95},generalError:{type:96},exploreMore:{type:98},passbackFunctionCalled:{type:99,isFire:!0},onUnitDimensionsFound:{type:116},onVideoResetCloseUnit:{type:117},forcedDetach:{type:118},unitLoaded:{type:120},unitLoadedWithFill:{type:121},feedHasNoCardsToOpen:{type:122},recoReelNotFound:{type:127,name:"recoReelNotFound",isFire:!0},misplacedVideoDetected:{type:132,isFire:!0},reportingObserver:{type:134,name:"reportingObserver",isFire:!1},overlayDetectedAfterImpression:{type:135,name:"overlayDetectedAfterImpression",isFire:!1,factor:0},validEligibility:{type:136,name:"validEligibility",isFire:!1},noAdjacInFirstWFs:{type:140,name:"noAdjacInFirstWFs",isFire:!0},url:"//conv{{dataCenter}}mp.{{baseReportD}}/st"},closeButton:{hasCloseButton:!0,secondsToCloseButton:5},urls:{base:"//vidstat.taboola.com",staticImage:""},player:{versions:{vplayer:"v12.1.1",content:"26_1_18m"},urls:{vplayerLocation:"{{urls.base}}/vpaid/vPlayer",vpaidLocation:"{{player.urls.vplayerLocation}}/vpaidjs/{{player.versions.vplayer}}/main-vpaid.js",playerLocation:"{{player.urls.vplayerLocation}}/player/{{player.versions.vplayer}}",contentVideosLocation:"//vidstat.taboola.com/vid",oppsBasePath:"//opps.{{baseReportD}}",nonBllbOppsBasePath:"//{{oppsDataCenter}}-vid-events.taboola.com",oppsRequest:"{{player.urls.oppsBasePath}}/OpportunityServlet",nonBllboppsRequest:"{{player.urls.nonBllbOppsBasePath}}/OpportunityServlet",wfBasePath:"//wf.{{baseReportD}}",domainWfBasePath:"//{{oppsDataCenter}}-wf.{{baseReportD}}",wfRequest:"{{player.urls.wfBasePath}}/VideoBidRequestHandlerServlet"},settings:{dlgverr:!0},b2b:1,bfFactor:15,hasAdControls:!0,hasBFeature:!0,hasControls:!0,isBypassFlash:!0,isFire99:!0,isFlashPlayer:!0,minVpaidRunTime:4},components:{D2DFallbackView:{pubId:127968,pubTagId:756668,height:"{{height}}",width:"{{width}}",location:"//15.{{baseReportD}}/WhiteLabelBidRequestHandlerServlet"},OptOut:{hasOptOut:!0,pubId:0,pubTagId:0,imageLocation:"{{urls.base}}/fp/img/closeVideo.png"},CloseButtonView:{hasCloseButton:!1,delay:1500,imageLocation:"{{urls.base}}/assets/x-close-24.png"},TimerView:{hasTimer:!1,time:3,countdownAction:"closeButton"},DetachButtonView:{hasDetuchView:!1,time:1,imageLocation:"{{urls.base}}/assets/ContractButton32.png"},Repeat:{isActive:!1,repalyIcon:"{{urls.base}}/assets/replay-button.svg",replayHoverIcon:"{{urls.base}}/assets/replay-button-hover.svg",learnMoreIcon:"{{urls.base}}/assets/learn-more-button.svg",learnMoreHoverIcon:"{{urls.base}}/assets/learn-more-button-hover.svg",backgroundImage:"{{urls.base}}/assets/blurry-image.png"},PosterView:{isActive:!1,imageLocation:"{{urls.base}}/img/play_image_4.jpg",defaultLocation:"{{urls.base}}/img/play_image_3.jpg"},Loading:{type:"img",imgUrl:"{{urls.base}}/assets/loading2.png",staticUrl:"{{urls.base}}/assets/repeat1.PNG"},contentVideo:{loadingImgae:"{{components.Loading.imgUrl}}",muteImgUrl:"{{urls.base}}/assets/video_controls/desk_muted2.svg",unmuteImgUrl:"{{urls.base}}/assets/video_controls/desk_playing2.svg",pauseImgUrl:"{{urls.base}}/assets/video_controls/pause2.svg"},contentCarousel:{backgroundImage:"{{urls.base}}/img/play_image_3.jpg"}},content:{playClicked:!0},noSoundBrowsers:{chrome:{minVersion:66},safari:{minVersion:11},firefox:{minVersion:66}},microServices:{base_url:"//vidstat.taboola.com/",async:!0,oppsula:{version:"1.2.8"},videoElement:{version:"2.2.17"},autoplayDetector:{version:"1.0.0"}},ms_data:{opps_base_path:"//{{oppsDataCenter}}-vid-events.taboola.com"},style:{videoBackgroundColor:"black"},isUseCrossUnitCommunication:!0,isObserveCrossUnitCommunication:!0,isUpdateCrossUnitCommunication:!0,blockedByExternalUnit:!1,playingNowString:"NOW <br/> PLAYING"},storage:{},initialize:function(){this.log=new s.a({unitType:this.get("unitType"),className:"BaseUnitModel"}),this._parseFrameType();var e=this.get("demo");e&&this.set("preset.demo",e),this.get("isDebug")&&this.set("preset.isDebug",1);var t=this.get("isFireAllPixels");t&&this.set("preset.isFireAllPixels",t);var i=this.get("predictorsPresets");i&&this.set("preset.predictorsPresets",i);var n=this._getSettingsByConditions();this.set(n.preset);var o=this._getPresets(l.a.pms);for(var r in this.log.info("Presets Settings: ",[o.weakerThenSetByCon,o.strongerThenSetByCon]),o.weakerThenSetByCon)this.set(o.weakerThenSetByCon[r].presetData);for(var a in this.set(n.settings),o.strongerThenSetByCon)this.set(o.strongerThenSetByCon[a].presetData);this._setUrlParameters(),this._processPushArray(),this.get("baseReport")&&this.get("oppsBasePath)")&&this.set("oppsBasePath",this.get("baseReport")),this.set("isUseObserverChanged",!1),this.get("isUseObserver")&&!f.isObserverSupported("IntersectionObserver",this.get("isUseNonNativeObserver"))&&(this.set("isUseObserver",!1),this.set("isUseObserverChanged",!0)),this.get("isUseObserverForCardLocator")&&!f.isObserverSupported("IntersectionObserver",this.get("isUseNonNativeObserver"))&&this.set("isUseObserverForCardLocator",!1),this.volume=this.get("volume"),this.set("volume","off"),this._bindEvents(),this.log.info("unit model created:",this.attributes),this._handleABTest(),this._handleLiteUnitPixels(),(this.get("isApiPassbackExist")||this.get("onPassback"))&&(this.set("dlywf",!1),this.set("player.settings.rvfrquesttsemttr","any")),"body"===String(this.get("videoContainerSelector")).toLowerCase()&&this.set("videoContainerSelector",!1),this._setQueriesFunctions(),this._setCrossUnitCommunication()},get:function(e){var t=o.a.DeepModel.prototype.get.call(this,e);if(!t||"string"!=typeof t)return t;for(var i=t.match(/\{\{(.*?)\}\}/g);i;){for(var n=0;n<i.length;n++){var r=i[n].substr(2,i[n].length-4),s=o.a.DeepModel.prototype.get.call(this,r);s||(s=""),t=t.replace(i[n],s)}i=t.match(/\{\{(.*?)\}\}/g)}return t},_setQueriesFunctions:function(){var e=this;f.forEach(d.a.UNIT_QUERY_LANGUAGE.SUPPORTED_CONFIG_FLAGS,(function(t){var i=e.get("".concat(t,".restrictions"));f.forEach(i,(function(i,n,o){var r="".concat(t,".restrictions.").concat(n),s=e.get("".concat(r,".queries"));if(s){var a=e.get("".concat(r,".default"));a=f.isBoolean(a)?a:'"'.concat(a,'"');var l=e._getQueryFunction(s,a);e.set("".concat(r,".decisionFunction"),l)}}))}))},_getQueryFunction:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="";f.forEach(e,(function(e){n+=t._getQueryIfStatment(e)})),i=void 0!==i?"return ".concat(i,";"):"";var o="".concat(n,"\n").concat(i);return new Function("model","activeAd",o)},_getQueryIfStatment:function(e){var t=e.rule,i=e.valueIfTrue;return i=f.isBoolean(i)?i:'"'.concat(i,'"'),f.forEach(d.a.UNIT_QUERY_LANGUAGE.MAPPING,(function(e){t=t.split(e.search).join(e.replaceWith)}),this),"if(".concat(t,"){return ").concat(i,"};\n")},getPixel:function(e){!this.pixel&&this._createPixel();var t=this.get(e);if("pixels.conversion"===e&&o.a.trigger("global:creativeEvent",{type:"conversion"}),t.isFire)return this.pixel({type:t.type||"",pixelId:t.id,timestamp:Date.now(),subUnit:this.get("subUnitType")})},_createPixel:function(){var e=this.get("pixels.url")+"?cijs=convusmp&ttype={{type}}&cisd=convusmp&cipid="+this.get("cipid")+"&crid="+this.get("creativeId")+"&dast="+this.get("dast")+"&cmcv=&pix={{pixelId}}&cb={{timestamp}}&uv="+this.get("unitVersion")+"&tms={{timestamp}}&su={{subUnit}}";this.get("abTest")&&(e+="&abt="+this.get("abTest")),this.get("referrerUrl")&&(e+="&ru="+this.get("referrerUrl")),e+="&ft="+this.get("frameType"),e=this._addPixelParameter("tagCpmFloor","cft",e),e=this._addPixelParameter("unitId","blid",e),e=this._addPixelParameter("unitName","unm",e),e=this._addPixelParameter("debugKey1","dk1",e),e=this._addPixelParameter("debugKey2","dk2",e),e=this._addPixelParameter("order","order",e),this.pixel=f.template(e)},_addPixelParameter:function(e,t,i){return(this.get(e)||0===this.get(e)||!1===this.get(e))&&(i+="&"+t+"="+this.get(e)),i},getImpressionPixel:function(){this.get("player.isFire99")},_getSchedule:function(e,t,i){return{roll_type:e,url:this.get("player.urls.vpaidLocation"),volume:"on"===this.get("volume")?100:0,mute:"on"!==this.get("volume"),oid:this.get("originId"),mfp:this.get("mfp"),sortOrderType:this.get("sortOrderType"),ad_parameters:JSON.stringify(this.get("demandConfig")),pubid:t,tagid:i,defaultTagTimeout:this.get("defaultTagTimeout"),totaltimeout:this.get("totalTimeout"),noaop:this.get("noaop"),skip_vast:!0}},_handleABTest:function(){if(this.get("abTest")&&this.get("pixels.startWithABT.isFire")){window.cmTag.customDataForTest.startWithABT=!0;var e={debug:"pn:!sqg:!torgn:"+(window.performance.timeOrigin?window.performance.timeOrigin:"")+"!ts:"+Date.now()};f.firePixel(this.getPixel("pixels.startWithABT"),"AB Test started",e)}},_handleLiteUnitPixels:function(){f.firePixel(this.getPixel("pixels.unitLoaded"),"Unit loaded from lite unit",{mntl:this.get("preset.level")}),f.firePixel(this.getPixel("pixels.unitLoadedWithFill"),"Unit loaded from lite unit with fill")},_processPushArray:function(){var e=this.get("pushedArr")||[];"FEED_MANAGER"!==this.get("unitType")&&"INLINE_FEED"!==this.get("unitType")&&"MSN_WIDGET"!==this.get("unitType")&&"WIDGET_ITEM"!==this.get("unitType")||this._setFeedManagerSubType(e);var t={};if(e)for(var i in e.forEach((function(e){var i=Object.keys(e)[0];t[i]||(t[i]=[]),t[i].push(e[i])})),t){var n=t[i],o=this.get(i);o&&n.push(o);var r=n.sort().join("!");this.set(i,r)}},_setFeedManagerSubType:function(e){var t=this.get("stickyCard.isActive"),i=this.get("detachToSlider.isDetachBelow"),n=this.get("detachToSlider.isDetachAbove"),o=this.get("detachToSlider.isStartFromSlider"),r=this.get("detachToSlider.isDetachToSlider"),s="ufm";t||o||r?t||!o||r?t||o||!r?!t&&o&&r?s+="_vD":t&&i&&!n?s+="_vE":t&&!i&&n?s+="_vF":t&&i&&n&&(s+="_vG"):s+="_vC":s+="_vB":s+="_vA",e.push({abTest:s})},_removeSoundOnHover:function(){var e,t=this.get("wurfl.browser.name").toLowerCase(),i=this.get("wurfl.browser.version"),n=this.get("noSoundBrowsers");n&&n[t]&&(e=n[t].minVersion),i>=e&&this.set("volume","off")},setStorage:function(e,t){this.storage[e]=t},getStorage:function(e){return this.storage[e]},setNextAd:function(e){this.setStorage("nextAd",e)},getNextAd:function(){var e=this.getStorage("nextAd");return e&&(this.log.info("NEXT AD TYPE = "+parseInt(e.adData.requiredViewability?"1":"0"),e),e.isUsed=!0),this.setStorage("nextAd",void 0),setTimeout(this.set.bind(this,"hasReadyAd",!1),0),e},getNextAdRv:function(){var e=this.getStorage("nextAd");if(e)return e.adData.requiredViewability},peekNextAd:function(){return this.getStorage("nextAd")},_bindEvents:function(){this.on("change:getAdState",this._onAdImpression)},_onAdImpression:function(){"gotAd"!==this.get("getAdState")||this._gotAd||(this.log.info("Triggering filledImpression event."),o.a.trigger("filledImpression",{lineItemId:this.get("lineItemId"),placement:this.get("placement"),redId:this.get("redId")}),this._gotAd=!0)},_setUrlParameters:function(){for(var e,t,i,n=this._getWindow(),o=n.location.href.slice(n.location.href.indexOf("?")+1).split("&"),r=0;r<o.length;r++)0===(t=(e=o[r].split("="))[0]).indexOf("cm_")&&(t=t.slice(3),i=decodeURIComponent(e[1]),this.set(t,i))},_getWindow:function(){var e=this.get("isStayInIframe"),t=this.get("iframeData");return!0===e&&f.isInFriendlyIframe(t)||!f.getTopWindow?window:f.getTopWindow()},_getPresets:function(e){var t={strongerThenSetByCon:[],weakerThenSetByCon:[]},i=this.get("isMobile")?"Mobile":"Desktop";for(var n in this.get("preset")){var o=e.getPreset({key:n,value:this.get("preset.".concat(n)),unitType:this.get("unitName"),platform:i});o&&(o.strength>100?t.strongerThenSetByCon.push(o):t.weakerThenSetByCon.push(o))}return t.strongerThenSetByCon=f.sortBy(t.strongerThenSetByCon,"strength"),t.weakerThenSetByCon=f.sortBy(t.weakerThenSetByCon,"strength"),t},increaseCounter:function(e){var t=this.get(e);t?t++:t=1,this.set(e,t)},decreaseCounter:function(e){var t=this.get(e);!t||t<=0||(t--,this.set(e,t))},_parseFrameType:function(){var e=d.a.FRAME_TYPE.plainPage;void 0!==window.taboolaMobile?e=d.a.FRAME_TYPE.inApp:window.TRC&&window.TRC.isAMP?e=d.a.FRAME_TYPE.amp:f.isInIframe(this.get("iframeData"))&&(e=f.isInFriendlyIframe(this.get("iframeData"))?d.a.FRAME_TYPE.friendlyIframe:d.a.FRAME_TYPE.nonFriendlyIframe),this.set("frameType",e),this.set("player.settings.frameType",e)},_getSettingsByConditions:function(){var e={preset:{},settings:{}},t=this.get("settingsByConditions");if(t&&t.length>0)for(var i=0;i<t.length;i++){var n=t[i].conditions,o=t[i].settings;if(this._checkConditions(n))for(var r in o)-1!==r.indexOf("preset")?e.preset[r]=o[r]:e.settings[r]=o[r]}return e},_checkConditions:function(e){for(var t=!0,i=0;i<e.length;i++)if(e[i].val&&"function"==typeof e[i].val){var n=e[i].val(this);this.get(e[i].key)!==n&&(t=!1)}else this.get(e[i].key)!==e[i].val&&(t=!1);return t},fireUnitDelayedPixel:function(){f.firePixel(this.getPixel("pixels.unitDelayed"),"unit delayed")},fireUnitLoadAfterDelayPixel:function(){f.firePixel(this.getPixel("pixels.unitLoadAfterDelay"),"unit delayed")},isLoadcomponent:function(e,t){return this.get("displayFiller."+t)===e},appendArray:function(e,t,i){var n=this.get(e);f.isArray(n)||(n=[]),i&&n.includes(t)||(n.push(t),this.set(e,n))},handleAutoPlayData:function(e){this.log.info("autoplayDetector returned",e),this.set("AutoPlayDetectorData",e),e&&e.unmuted&&e.unmuted.supported?(this.set("volume",this.volume),this.set("autoplaySoundOn",!0)):(this.set("volume","off"),this.set("autoplaySoundOn",!1)),this.log.info("Unit set volume to: ",this.get("volume"))},_setStickyCardParams:function(){this.set("detachToSlider.isDetachAbove",!1),this.set("detachToSlider.isDetachBelow",!0),this.set("detachToSlider.isDetachToSlider",!0),this.set("detachToSlider.isStartFromSlider",!1),this.set("animation.detach",150)},_setCrossUnitCommunication:function(){if(this.get("isUseCrossUnitCommunication")){if(0===document.querySelectorAll("._cm-communication-input").length){var e=document.createElement("div");e.className="_cm-communication-input",e.setAttribute("data-unit-info",""),document.querySelector("body").appendChild(e)}this._observeCrossUnitCommunication()}},_observeCrossUnitCommunication:function(){if(this.get("isObserveCrossUnitCommunication")){var e=document.querySelector("._cm-communication-input");this.crossUnitCommunicatioObserver=new MutationObserver(this._updateCrossUnitData.bind(this)),this.crossUnitCommunicatioObserver.observe(e,{attributes:!0,childList:!1,subtree:!1}),this.on("closeState:".concat(h.a.closeState.terminate),this._stopCrossUnitCommunicationObserver),this._updateCrossUnitData()}},_updateCrossUnitCommunication:function(e){this.get("isUseCrossUnitCommunication")&&this.get("isUpdateCrossUnitCommunication")&&document.querySelector("._cm-communication-input").setAttribute("data-cross-unit-info",JSON.stringify(e))},_updateCrossUnitData:function(e,t){var i=document.querySelector("._cm-communication-input").dataset.crossUnitInfo;i&&i.unit!==this.get("unitType")&&this.set("crossUnitInfo",JSON.parse(i))},_stopCrossUnitCommunicationObserver:function(){this.crossUnitCommunicatioObserver.disconnect()}}),m=i(22),g=(i(10),i(0)),y=(i(3),i(5));t.a=p.extend({defaults:g.a.extend(!0,{},p.prototype.defaults,{bfFactor:0,isMultiAd:!0,kibanaEventsToSend:"all",runWfWhenEmpty:!0,viewPercent:20,wfDynamicPause:!1,isCheckTopParentSelectorLost:!0,predictors:{isGet1OnlyAfterAdLoaded:!1,autoKill:{isActive:!0},bForce:{isActive:!1,predictPoints:1},getAdFail:{isActive:!0,allowedPredictPoints:"any"},multiAd:{isActive:!0,predictPoints:{}},emptyQueue:{isActive:!0,predictPoints:"any"},loading:{isActive:!0,predictPoints:"any"},repeat:{isActive:!0,predictPoints:"any"},playerReady:{isActive:!0,predictPoint:0},distancePercent:{isActive:!1,predictPoints:{}},distancePixels:{isActive:!1,predictPoints:{}},firstScroll:{isActive:!1,predictPoints:0},fullEligibility:{isActive:!1,predictPoints:1,maxPPS:1,checkPredictsSeconds:.5},intersection:{isActive:!1},feedX:{isActive:!0,predictPoints:"any"}},playPriority:{type:"ppKey",key:1,checkForRvPriority:"onEligibility"},vForce:{isActive:!0,getAdTimeoutSeconds:60,secondsToGetAdFail:{0:60,1:60}},player:{urls:{blankLocation:"{{player.urls.contentVideosLocation}}/blackScreen60.mp4",contentLocation:"{{urls.base}}/content{{player.versions.content}}.js",contentImagesLocation:"{{player.urls.contentVideosLocation}}/img"},hasAdControls:!0,settings:{queue_size:6,max_ready_vpaid:3,mprdct:.025,isMultiVpaidUnit:!1},playlist:[]},rboxCssSelectors:{title:".video-label.video-title",description:".video-label.video-description",branding:".video-label-box .branding"},secondsToWaitForRV:5,timeBetweenDetectionCompSeconds:5,maxTriesForDetectingComp:10,renderLearnMore:!0,nativeAdMapping:{title:"title",ctaButtone:"ctatext",description:"desc",branding:"sponsored",icon:"icon"},isViewableAMP:!1,isUseAmpObserver:!1}),initialize:function(){p.prototype.initialize.call(this),this.set("player.playlist",[{url:this.get("player.urls.blankLocation"),name:"Blank",title:"Blank",type:"video/mp4"}]),this.get("isEligibilityNomination")&&(this._initBforce(),this.RvHandler=new m.a(this)),this.get("frameType")!==d.a.FRAME_TYPE.plainPage?(window.taboolaBridge||(this.set("predictors.distancePixels.isActive",!1),this.set("predictors.distancePixels.isStartWF",!1)),this.set("predictors.distancePercent.isActive",!1),this.set("predictors.distancePercent.isStartWF",!1)):(this.set("predictors.intersection.isActive",!1),this.set("predictors.intersection.isStartWF",!1)),window.category=this.get("category"),y.loadJs(this.get("player.urls.contentLocation"),this._onContentLoad.bind(this))},_initBforce:function(){this.set("startListenToEligibility",!1),this.listenTo(this,"change:preEligibility",this._onPreEligibility.bind(this)),this.listenTo(this,"change:playerHasRvInQ",this._onHasPotentialAd.bind(this)),this.listenTo(this,"change:gotNonRvAd",this._onHasPotentialAd.bind(this))},_onHasPotentialAd:function(){this.get("rvHandlerState")!==u.rvHandlerState.working&&this.get("preEligibility")&&(this.get("playerHasRvInQ")?this.RvHandler.onPreEligibility():this.get("gotNonRvAd")&&this.set("startListenToEligibility",!0))},_onPreEligibility:function(){this.get("rvHandlerState")!==u.rvHandlerState.working&&(this.get("playerHasRvInQ")?this.RvHandler.onPreEligibility():this.get("gotNonRvAd")&&this.set("startListenToEligibility",!0))},getScheduleArr:function(){var e=[];return e.push(this._getSchedule("pre-roll",this.get("pubId"),this.get("pubTagId"))),e},_onContentLoad:function(){window.playlist.forEach((function(e,t,i){i[t].image=this.get("player.urls.contentImagesLocation")+"/"+e.image,i[t].title=e.title.replace(/([A-Z])/g,"$1").replace(/^./,(function(e){return e.toUpperCase()})),i[t].url=this.get("player.urls.contentVideosLocation")+"/"+i[t].filename,i[t].name=i[t].filename,i[t].type="video/mp4"}),this),this.set("player.playlist",window.playlist)},isVerticalVideoEnabled:function(e){return(e||this.get("videoPlaceholderSize.width"))<=this.get("verticalWidthThreshold")}})},function(e,t,i){"use strict";var n=i(2),o=i(0),r=i(1),s=i.n(r),a=i(9),l=i.n(a),c=i(26);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=i(5),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,i,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=m(e);if(t){var o=m(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return p(this,i)}}(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this,e))._init(),t}return t=a,(i=[{key:"_bindEvents",value:function(){h(m(a.prototype),"_bindEvents",this).call(this),this.createStateHandlers([{event:"getAdState:stopped",funcName:"_pausePlayer"},{event:"adState:playing",funcName:"_onFirstAdPlay",isListenOnce:!0}])}},{key:"_onPlayerLoaded",value:function(){this.extraData={vpdcntrcstmcss:this.model.get("vpaidDivCss"),target_id:this.getTarget()},h(m(a.prototype),"_onPlayerLoaded",this).call(this)}},{key:"_onPlayerReady",value:function(){h(m(a.prototype),"_onPlayerReady",this).call(this),this._canGetAdjacCard()||(this.log.info("drop adjacency ad from player"),this._dropAdFromPlayer(l.a.adjacency.name+"Ad")),this.model.get("wurfl.browser.name")===s.a.BROWSER.IE&&Object(o.a)(".vpaid-player-container").addClass("vpaid-player-container-ie-fix")}},{key:"close",value:function(){setTimeout(function(){this.player&&(this.player.closeCleanPlayer(),this.player=null,this.model.set("closeState",n.closeState.playerClosed),this.model.set("playerState",n.playerState.closed),this.log.info("player was closed"),this.createStateHandlers([{event:"loadingViewState:clicked",funcName:"_onLoadingClick",isListenOnce:!0}]),"onHover"===this.model.get("volume")&&this.model.stopListening(this.model,"change:isMouseOn"))}.bind(this),0)}},{key:"_pausePlayer",value:function(){!this.model.get("isReplayAd")||this.model.get("topParentSelectorLost")||this.model.get("isReasonSecondsToCloseGlobal")?this.close():(this.player.startIdleMode(),this.createStateHandlers([{event:"loadingViewState:clicked",funcName:"_stopIdlemode",isListenOnce:!0}]))}},{key:"_stopIdlemode",value:function(){this.model.get("replayAdClick")!=s.a.REPLAY_AD_CLICK.ALL&&this.model.get("replayAdClick")!=s.a.REPLAY_AD_CLICK.RESTART_PLAYER||this.player.stopIdleMode()}},{key:"getTarget",value:function(){if(this.model.get("targetId"))return this.model.get("targetId").toString();if(this.model.get("isVpaidNoContainerMode"))return this.model.get("videoContainerSelector")?this.model.get("videoContainerSelector").toString():"body";var e=g.now().toString(),t=Object(o.a)("<div>");t.attr("id",e);var i=0,n=Object(o.a)("body");if(n.length>0&&this.model.get("isPlayerOutOfViewport")){var r=n[0].getBoundingClientRect();i=window.innerHeight+-1*r.top+100}this.model.set("topOffsetPosition",i);var s=this.model.get("width")+"px";window.TRC&&!0===window.TRC.isAMP&&(s="100%"),t.css({width:s,height:0,position:"absolute",top:i+"px",left:0}),"FEED_MANAGER"!==this.model.get("unitType")?t.css({display:"none"}):t.addClass("_cm-ad-feed-manager");var a=this.model.get("additionalCss");if(a){var l=a["z-index"]||a.zIndex;l&&t.css({"z-index":l})}var c=this.model.get("videoContainerSelector")||"body";return t.appendTo(c),this.playerDiv=t,e}},{key:"_alignPlayer",value:function(){var e=this.player.store.get("dataSaver"),t=this.player.store.get("forcecnvsmpg");(e||t)&&this.model.get("playerTextAlign")&&this.playerDiv.css({"text-align":"left"})}},{key:"_onFirstAdPlay",value:function(){this._dropAdFromPlayer(l.a.singleAd.name),this.log.info("first ad play - dropping single ads from player Q")}},{key:"_dropAdFromPlayer",value:function(e){this.player&&this.player.dropAds&&this.player.dropAds(e)}},{key:"_canGetAdjacCard",value:function(){var e=!(1!==this.model.get("startCard")&&this.model.get("startCard")||1!==this.model.get("permanentCard")&&this.model.get("permanentCard")),t=this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider");return!!g.getOrganicCard()&&e||t}},{key:"updatePlacement",value:function(){var e=this.model.get("modifiedPlacement");this.model.get("updatePlacementOnContainerChange")&&this._updateWfParameter("pstn",e),this.player.set("modifiedPlacement",e)}},{key:"_updateWfParameter",value:function(e,t){this.player&&this.player.updateWfParameter&&this.player.updateWfParameter(e,t)}}])&&u(t.prototype,i),a}(c.a);t.a=y},function(e,t){e.exports='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="_x2014__x5F_1" xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 99 99" xml:space="preserve">\n      <style type="text/css">.st0 {\n          fill: #FFFFFF;\n      }</style>\n    <g>\n     <g stroke="null" id="svg_1">\n      <g stroke="null" id="svg_2">\n       <path stroke="null" id="svg_3" d="m82.77256,91.4817c-1.64243,0 -3.25444,-0.644 -4.50148,-1.9964l-65.57555,-69.42328c-2.49406,-2.6404 -2.49406,-6.92301 0,-9.56341c2.49406,-2.6404 6.53931,-2.6404 9.03337,0l65.57555,69.45548c2.49406,2.6404 2.49406,6.92301 0,9.56341c-1.24703,1.3202 -2.88946,1.9642 -4.53189,1.9642z" class="st0"/>\n      </g>\n      <g stroke="null" id="svg_4">\n       <path stroke="null" id="svg_5" d="m17.19702,91.4817c-1.64243,0 -3.25444,-0.644 -4.50148,-1.9964c-2.49406,-2.6404 -2.49406,-6.92301 0,-9.56341l65.57555,-69.42328c2.49406,-2.6404 6.53931,-2.6404 9.03337,0c2.49406,2.6404 2.49406,6.92301 0,9.56341l-65.57555,69.45548c-1.24703,1.3202 -2.88946,1.9642 -4.53189,1.9642z" class="st0"/>\n      </g>\n     </g>\n    </g>\n</svg>'},function(e,t,i){"use strict";var n=i(0),o=i(3),r=i.n(o),s=i(1),a=i.n(s);function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c,d=i(5),u=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.window=t||window,this.$window=Object(n.a)(window),this.windowHeight=this.$window.height(),this.windowWidth=this.$window.width(),this.setScrollableSelector(i),this._timeBetweenEvents=100,this.keyPressMap={17:!1,18:!1,84:!1,86:!1},this._setScrollListener(),this._setMouseMoveListener(),this._setKeyPressListener(),this._setTabViewListener(),this._setOrientationChangeListener(),this._setResizeListener(),this._setTaboolaReadMoreListener()}var t,i;return t=e,(i=[{key:"_setScrollListener",value:function(){var e=d.throttle(this._trigger.bind(this,"window:scroll:change"),this._timeBetweenEvents);this.scrollSelector.addEventListener("scroll",e)}},{key:"_setMouseMoveListener",value:function(){var e=d.throttle(this._trigger.bind(this,"window:mouse:move"),this._timeBetweenEvents);this.window.addEventListener("mousemove",e)}},{key:"_setKeyPressListener",value:function(){var e=this;this.window.addEventListener("keyup",(function(t){e._trigger.bind(e,"window:key:press"),t.keyCode in e.keyPressMap&&(e.keyPressMap[t.keyCode]=!1)})),this.window.addEventListener("keydown",(function(t){t.keyCode in e.keyPressMap&&(e.keyPressMap[t.keyCode]=!0,e.keyPressMap[17]&&e.keyPressMap[18]&&e.keyPressMap[84]&&e.keyPressMap[86]&&(r.a.trigger("supportTool:event","open"),e.keyPressMap[17]=e.keyPressMap[18]=e.keyPressMap[84]=e.keyPressMap[86]=!1))}))}},{key:"_setOrientationChangeListener",value:function(){var e=d.throttle(this._trigger.bind(this,"window:orientation:change"),this._timeBetweenEvents);window.addEventListener("orientationchange",e)}},{key:"_setResizeListener",value:function(){var e=d.throttle(this._handleResizeEvent.bind(this),this._timeBetweenEvents);window.addEventListener("resize",e)}},{key:"_setTabViewListener",value:function(){this.isTabOut=document.hidden,this.window.document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this)),this.window.addEventListener("focus",this._handleTabEvents.bind(this),!0),this.window.addEventListener("blur",this._handleTabEvents.bind(this),!0)}},{key:"_handleResizeEvent",value:function(e){var t=this.$window.height(),i=t-this.windowHeight;this.windowHeight=t;var n=this.$window.width(),o=n-this.windowWidth;this.windowWidth=n,this._trigger("window:resize:change",{heightChange:i,widthChange:o})}},{key:"_handleVisibilityChange",value:function(e){this.isTabOut=document.hidden,this._handleTabEvents(e)}},{key:"_handleTabEvents",value:function(e){this.isTabOut?this._trigger("window:tab:change",a.a.TAB_STATE.tabOut):"focus"===e.type?this._trigger("window:tab:change",a.a.TAB_STATE.focus):this._trigger("window:tab:change",a.a.TAB_STATE.blur)}},{key:"_trigger",value:function(e,t){r.a.trigger(e,t)}},{key:"_setTaboolaReadMoreListener",value:function(){window._taboola=window._taboola||[],_taboola.push({listenTo:"readmore.click",handler:function(){r.a&&r.a.trigger("taboola:readmore:click")}})}},{key:"setScrollableSelector",value:function(e){this.scrollSelector="document"===e?document:d.isEmpty(e)?this.window:Object(n.a)(e)[0]}}])&&l(t.prototype,i),e}();t.a=function(e,t){return c||(c=new u(e,t)),c}},function(e,t,i){"use strict";i.r(t);var n=i(4),o=i(6),r=i(9),s=i.n(r);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f,p=i(5),m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(a,e);var t,o,r=d(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this)).model=e.model||{},t.log=new n.a({unitType:t.model.get("unitType"),className:constructor.name,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.configHierarchy=t._getConfigHierarchy(),t}return t=a,(o=[{key:"_getConfigHierarchy",value:function(){return p.sortBy(s.a,(function(e){return e.priority})).reverse()}},{key:"getConfig",value:function(e){var t={};for(var i in this.configHierarchy){var n=this.configHierarchy[i].name,o=e[n],r=s.a[n];o&&r&&(this.log.info("creating config for",n),p.extend(t,this._getDefaultConfig(n)),p.extend(t,this._getUnitConfig(n)))}return t}},{key:"getConfigForKey",value:function(e){var t={},i=s.a[e]&&s.a[e].name;return i&&(this.log.info("creating config for",i),p.extend(t,this._getDefaultConfig(i)),p.extend(t,this._getUnitConfig(i))),t}},{key:"_getDefaultConfig",value:function(e){var t=s.a[e].defaultConfigFile;return this.loadFile(t)}},{key:"_getUnitConfig",value:function(e){var t=this.model.get("unitType"),i=s.a[e]&&s.a[e].unitsConfigFiles,n=i&&i[t];return this.loadFile(n)}},{key:"loadFile",value:function(e){if(e)return i(75)("./".concat(e.replace("./","").replace(".js",""))).default}}])&&l(t.prototype,o),a}(o.a);t.default=function(e){return f||(f=new m(e)),f}},function(e,t,i){"use strict";var n=i(0),o=i(3),r=i.n(o),s=i(4),a=i(15);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(1);var f=i(5),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(a,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}(a);function a(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(i=o.call(this,e)).log=new s.a({unitType:"Service",className:"FeedEligibility",version:i.model.get("version"),isDebug:i.model.get("isDebug")}),i.placeHolder=Object(n.a)(i.model.get("parentSelector"))[0],i.bindEvent(),i.model.get("isUseObserver")?(i._initObserver(),i.observer.observe(i.placeHolder)):i._initEligibilityListener(),i}return t=a,(i=[{key:"bindEvent",value:function(){this.createStateHandlers([{event:"getAdState",funcName:"_calculateEligibility"},{event:"feedxToggle",funcName:"_updateFeedSelector"},{event:"feedContainerChanged",funcName:"_updateFeedSelector"},{event:"isInTab",funcName:"_onTabEvent"}])}},{key:"_initEligibilityListener",value:function(){this._calculateEligibility(),r.a.on("window:scroll:change",this._calculateEligibility.bind(this))}},{key:"_onTabEvent",value:function(e,t){t?this._calculateEligibility():this.model.set("isEligibleToPlay",!1)}},{key:"_getInViewDiv",value:function(){var e=window.innerHeight+window.pageYOffset;if(f.getTopOfEl(this.placeHolder)+1<=e)return this.placeHolder}},{key:"_observerCallback",value:function(e,t){this.inViewDiv=void 0;for(var i=0;i<e.length;i++)if(e[i].isIntersecting){this.inViewDiv=e[i];break}this._testEligibility()}},{key:"_testEligibility",value:function(){this.inViewDiv?(this.model.set("isEligibleToPlay",!0),this.model.set("isEligibleToPlayFirstTime",!0)):this.model.set("isEligibleToPlay",!1)}},{key:"_testTopParentSelector",value:function(){var e=this,t=!1,i=this.model.get("ParentSelector"),o=Object(n.a)(i);f.forEach(o,(function(i){f.getTopOfEl(i)&&(e.hadValidParent=!0,t=!0)})),this.hadValidParent&&!t&&this.model.get("isCheckTopParentSelectorLost")&&(this.model.set("topParentSelectorLost",!0),this.observer&&this.observer.disconnect&&this.observer.disconnect())}},{key:"_updateFeedSelector",value:function(){this.placeHolder=Object(n.a)(this.model.get("parentSelector"))[0],this.observer&&this.observer.observe(this.placeHolder),this._calculateEligibility()}}])&&c(t.prototype,i),a}(a.a);t.a=p},function(e,t,i){"use strict";var n=i(4),o=i(2),r=i(6),s=(i(8),i(12));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(a,e);var t,i,r=d(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this,e)).model=e,t.log=new n.a({unitType:t.model.get("unitType"),className:"RvHandler",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.model.set("rvHandlerState",o.readyState),t.maxPPS=t.model.get("predictors.bForce.maxPPS"),t.scrollManager=new s.a,t._bindEvents(),t}return t=a,(i=[{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"gotRvAd:true",funcName:"_gotRvAd"}])}},{key:"onPreEligibility",value:function(){var e=this.maxPPS&&Math.abs(this.scrollManager.pps)>this.maxPPS,t=this.model.get("rvHandlerState")!==o.rvHandlerState.working;if(e)return this.log.warning("Scroll speed is too high",this.scrollManager.pps),void this.scrollManager.registerForPPSChange(this._onPPSChange.bind(this));if(t){this.model.set("rvHandlerState",o.rvHandlerState.working),this.model.set("canGetRv",!0);var i=1e3*this.model.get("secondsToWaitForRV");this._startTimer(i)}}},{key:"_onPPSChange",value:function(){this.maxPPS&&Math.abs(this.scrollManager.pps)<=this.maxPPS&&(this.log.info("Scroll speed decreased - continue with bForce flow"),this.scrollManager.deRegisterForPPSChange(this._onPPSChange),this._onPPSDecreased())}},{key:"_onPPSDecreased",value:function(){this.model.get("lostEligibilityTime")?(this.log.info("lostEligibility - checking if gotNonRvAd",this.model.get("gotNonRvAd")),this.model.get("gotNonRvAd")&&(this.log.info("got non-RV ad - start listening to eligibility"),this.model.set("startListenToEligibility",!0))):(this.log.info("isEligibleToPlay - calling onPreEligibility"),this.onPreEligibility())}},{key:"_startTimer",value:function(e){this.model.set("rvHandlerTimerExpired",!1),this.timeout=setTimeout(this._onFailToGetAd.bind(this),e)}},{key:"_onFailToGetAd",value:function(){this.model.set("canGetRv",!1),this.model.set("playerHasRvInQ",!1),this.model.set("rvHandlerTimerExpired",!0),this.model.set("rvHandlerState",o.rvHandlerState.idle),this.log.info("Timer over - failed getting RV ad"),this.model.get("adManagerState")===o.adManagerState.hasAds&&this.model.set("startListenToEligibility",!0)}},{key:"_gotRvAd",value:function(){clearTimeout(this.timeout),this.timeout=void 0,this.model.set("rvHandlerState",o.rvHandlerState.idle),this.model.set("startListenToEligibility",!0),this.log.info("Got RV Ad - started listening to eligibility")}}])&&l(t.prototype,i),a}(r.a);t.a=f},function(e,t,i){"use strict";i(0),i(3);var n=i(6),o=i(4),r=i(2),s=i(1);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(5);var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(a,e);var t,i,n=d(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=n.call(this,e.model)).model=e.model,t.log=new o.a({unitType:t.model.get("unitType"),className:"viewabilityService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.timers={},t.isAmp=t.model.get("frameType")===s.FRAME_TYPE.amp&&t.model.get("isUseAmpObserver"),t.onViewability=e.onViewability||function(){},t}return t=a,(i=[{key:"updateActiveAd",value:function(e){this.activeAdId!==e.adId&&(this.activeAd||this._bindEvents(),this.activeAd=e,this.activeAdId=e.adId,this.activeAd.supportVideoCurrentTimeEvents&&this.model.get("isUseNewViewabilityCalc")?this._bindPlay():this._startViewabilityTimers())}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"activeAdCurrentTime",funcName:"_checkViewability"},{event:"isViewable:true",funcName:"_updateViewabilityTimes"},{event:"isViewable100",funcName:"_update100ViewabilityTime"},{event:"videoViewState:".concat(r.videoViewState.detached),funcName:"_update100ViewabilityTime"}]),this.isAmp&&this.createStateHandlers([{event:"isViewableAMP:true",funcName:"_updateAMPViewabilityTime"},{event:"isViewableAMP:false",funcName:"_onNoViewabilityAMP"}])}},{key:"_bindPlay",value:function(){this.model.get("adState")===r.adState.playing?this._startTestingViewability():this.createStateHandlers([{event:"adState:".concat(r.adState.playing),funcName:"_startTestingViewability",isListenOnce:!0}])}},{key:"_startTestingViewability",value:function(){this._updateViewabilityTimes(),this._checkViewability(),this._bindPause()}},{key:"_updateViewabilityTimes",value:function(){this._updateViewabilityTime(),this._updateOneSecViewabilityTime(),this._update100ViewabilityTime(),this.isAmp&&this._updateAMPViewabilityTime()}},{key:"_updateViewabilityTime",value:function(){if(this.model.get("isViewable")||this.model.get("videoViewState")===r.videoViewState.detached){var e=this.model.get("activeAdCurrentTime");this.activeAdViewabilityTime=e+this.model.get("traceViewabilitySeconds")}else this.activeAdViewabilityTime=void 0}},{key:"_updateOneSecViewabilityTime",value:function(){if(this.model.get("isViewable")||this.model.get("videoViewState")===r.videoViewState.detached){var e=this.model.get("activeAdCurrentTime");this.activeAdOneSecViewabilityTime=e+1}else this.activeAdOneSecViewabilityTime=void 0}},{key:"_update100ViewabilityTime",value:function(){if(this.model.get("isViewable100")||this.model.get("videoViewState")===r.videoViewState.detached){var e=this.model.get("activeAdCurrentTime");this.activeAd100ViewabilityTime=e+this.model.get("traceViewabilitySeconds")}else this.activeAd100ViewabilityTime=void 0}},{key:"_updateAMPViewabilityTime",value:function(){if(this.model.get("isViewableAMP")){var e=this.model.get("activeAdCurrentTime");this.activeAdAMPiewabilityTime=e+this.model.get("traceViewabilitySeconds")}else this.activeAdAMPiewabilityTime=void 0}},{key:"_checkViewability",value:function(){if(this.activeAd){var e=this.model.get("activeAdCurrentTime");this._checkNormalViewability(e),this._checkOneSecViewability(e),this._check100Viewability(e),this.isAmp&&this._checkAmpViewability(e)}}},{key:"_checkNormalViewability",value:function(e){this._testViewability(this.model.get("isViewable"),e,this.activeAdViewabilityTime,this.activeAd.isViewed)&&this._onViewability()}},{key:"_checkOneSecViewability",value:function(e){this._testViewability(this.model.get("isViewable"),e,this.activeAdOneSecViewabilityTime,this.activeAd.isViewedOneS)&&this._onViewabilityOneS()}},{key:"_check100Viewability",value:function(e){this._testViewability(this.model.get("isViewable100"),e,this.activeAd100ViewabilityTime,this.activeAd.isViewed100)&&this._onViewability100()}},{key:"_checkAmpViewability",value:function(e){this._testViewabilityAMP(this.model.get("isViewableAMP"),e,this.activeAdAMPiewabilityTime,this.activeAd.isViewedAMP)&&this._onViewabilityAMP()}},{key:"_testViewability",value:function(e,t,i,n){return(e||this.model.get("videoViewState")===r.videoViewState.detached)&&t>=i&&!n}},{key:"_testViewabilityAMP",value:function(e,t,i,n){return e&&t>=i&&!n}},{key:"_bindPause",value:function(){this.model.get("adState")===r.adState.paused?this._stopAllViewability():this.createStateHandlers([{event:"adState:".concat(r.adState.paused),funcName:"_stopAllViewability",isListenOnce:!0}])}},{key:"_stopAllViewability",value:function(){this._bindPlay()}},{key:"_onViewability",value:function(){this.activeAd&&(this.isAmp||this.activeAd.onViewability(),this.onViewability())}},{key:"_onViewabilityOneS",value:function(){this.activeAd&&this.activeAd.onViewabilityOneS()}},{key:"_onViewability100",value:function(){this.activeAd&&this.activeAd.onViewability100()}},{key:"_onViewabilityAMP",value:function(){this.activeAd&&this.activeAd.onViewability()}},{key:"_onNoViewabilityAMP",value:function(){this.activeAd&&this.activeAd.onNoViewabilityAMP()}},{key:"_startViewabilityTimers",value:function(){this.model.get("isViewable")||this.model.get("videoViewState")===r.videoViewState.detached?this._startViewabilityTime():this.createStateHandlers([{event:"isViewable:true",funcName:"_startViewabilityTime"},{event:"isViewable:false",funcName:"_clearViewabilityTime"},{event:"videoViewState:detached",funcName:"_startViewabilityTime",isListenOnce:!0}]),(this.model.get("isViewable100")||this.model.get("videoViewState")===r.videoViewState.detached)&&this._startViewability100Time(),this.createStateHandlers([{event:"videoViewState:detached",funcName:"_startViewability100Time",isListenOnce:!0},{event:"isViewable100:true",funcName:"_startViewability100Time"},{event:"isViewable100:false",funcName:"_clearViewability100"},{event:"adState:".concat(r.adState.paused),funcName:"clearAllViewabilityTimers",isListenOnce:!0}]),this.isAmp&&this.createStateHandlers([{event:"isViewableAMP:true",funcName:"_startViewabilityAMPTime"},{event:"isViewableAMP:false",funcName:"_clearViewabilityAMP"}])}},{key:"_startViewabilityTime",value:function(){if(!this.activeAd.isViewed&&this.activeAd){var e=this.model.get("traceViewabilitySeconds");this._startViewabilityTimer(s.TIMER_NAMES.viewability,this._onViewabilityOld.bind(this),e),this._startViewabilityTimer(s.TIMER_NAMES.viewabilityOneS,this._onViewabilityOneSOld.bind(this),1),this.isAmp&&(this.model.get("isViewableAMP")?this._startViewabilityTimer(s.TIMER_NAMES.viewabilityAMP,this._onViewabilityAMPOLD.bind(this),e):this._onNoViewabilityAMP())}}},{key:"_startViewability100Time",value:function(){if(!this.activeAd.isViewed&&this.activeAd){var e=this.model.get("traceViewability100Seconds");this._startViewabilityTimer(s.TIMER_NAMES.viewability100,this._onViewability100Old.bind(this),e)}}},{key:"_startViewabilityAMPTime",value:function(){if(!this.activeAd.isViewed&&this.activeAd){var e=this.model.get("traceViewabilitySeconds");this._startViewabilityTimer(s.TIMER_NAMES.viewabilityAMP,this._onViewabilityAMPOld.bind(this),e)}}},{key:"_startViewabilityTimer",value:function(e,t,i){this.timers[e]||(this.timers[e]=setTimeout(t,1e3*i))}},{key:"clearAllViewabilityTimers",value:function(){this._clearViewabilityTime(),this._clearViewability100(),this.isAmp&&this._clearViewabilityAMP()}},{key:"_clearViewabilityTime",value:function(){this._clearViewabilityTimer(s.TIMER_NAMES.viewability),this._clearViewabilityTimer(s.TIMER_NAMES.viewabilityOneS)}},{key:"_clearViewability100",value:function(){this._clearViewabilityTimer(s.TIMER_NAMES.viewability100)}},{key:"_clearViewabilityAMP",value:function(){this._clearViewabilityTimer(s.TIMER_NAMES.viewabilityAMP),this._onNoViewabilityAMPOLD()}},{key:"_clearViewabilityTimer",value:function(e){this.timers[e]&&(clearTimeout(this.timers[e]),this.timers[e]=void 0)}},{key:"_onViewabilityAMPOLD",value:function(){this.timers[s.TIMER_NAMES.viewabilityAMP]=void 0,this.activeAd.onViewability()}},{key:"_onNoViewabilityAMPOLD",value:function(){this.timers[s.TIMER_NAMES.viewabilityAMP]=void 0,this.activeAd.onNoViewabilityAMP()}},{key:"_onViewabilityOld",value:function(){this.timers[s.TIMER_NAMES.viewability]=void 0,this.isAmp||this.activeAd.onViewability()}},{key:"_onViewabilityOneSOld",value:function(){this.timers[s.TIMER_NAMES.viewabilityOneS]=void 0,this.activeAd.onViewabilityOneS()}},{key:"_onViewability100Old",value:function(){this.timers[s.TIMER_NAMES.viewability100]=void 0,this.activeAd.onViewability100()}},{key:"_onViewabilityAMPOld",value:function(){this.timers[s.TIMER_NAMES.viewabilityAMP]=void 0,this.activeAd.onViewability()}}])&&l(t.prototype,i),a}(n.a);t.a=f},function(e,t,i){"use strict";var n=i(6),o=i(0),r=i(1),s=i.n(r);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=i(5),f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var o=u(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return d(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).model=e.model,t.events=s.a.KIBANA_EVENTS,t.startTime=e.startTime,t.predictors=e.predictors,t.adsList=[],t.getAdCount=0,t.impressionCount=0,t.dirtyAds=[],t._createEventList(),t}return t=r,(i=[{key:"_getAd",value:function(e){this.createAd(e.adId),this.getAdCount++;var t="any"===e.getAdKey?10:e.getAdKey,i={isEligible:this.model.get("isEligibleToPlay"),timeFromStart:e.eventTime-this.startTime,getAdTime:e.eventTime,getAdCount:this.getAdCount,predictPointKey:t,predictName:e.predictName,isInTab:this.model.get("isInTab"),topParentSelector:e.scrollData.topParentSelector};this.model.get("distancePercentPredictData")&&"distancePercentPredict"===e.predictName&&h.extend(i,this.model.get("distancePercentPredictData")),this.model.get("distancePixelPredictData")&&"distancePixelsPredict"===e.predictName&&h.extend(i,this.model.get("distancePixelPredictData")),h.extend(i,this._checkIsFirstGetAdType(e.getAdKey)),this._addDataToAd(this.events.getAd,e.adId,i,{hadImpression:!1,getAdKey:t}),this.isFirstGetAd&&(this.isFirstGetAd=!1)}},{key:"_checkIsFirstGetAdType",value:function(e){var t={isFirstGetAd:!1,isFirstNonRv:!1,isFirstRv:!1};return void 0===this.isFirstGetAd&&(t.isFirstGetAd=!0,this.isFirstGetAd=!1),0===e&&void 0===this.isFirstNonRv?(t.isFirstNonRv=!0,this.isFirstNonRv=!1):1===e&&void 0===this.isFirstRv&&(t.isFirstRv=!0,this.isFirstRv=!1),t}},{key:"_gotAd",value:function(e){this.createAd(e.adId),this.impressionCount++;var t={isEligible:this.model.get("isEligibleToPlay"),timeFromGetAd:e.eventTime-this.adsList[e.adId].getAd.getAdTime,adImpressionTime:e.eventTime,scrollPercentageFromSelector:e.scrollData.scrollPercentageFromSelector,bottomViewPort:e.scrollData.bottomViewPort,topParentSelector:e.scrollData.topParentSelector,isInTab:this.model.get("isInTab"),isFirstImpression:1===this.impressionCount,isFirstRv:this.adsList[e.adId].getAd.isFirstRv,isFirstNonRv:this.adsList[e.adId].getAd.isFirstNonRv};t.hadLostEligibility=!!this.model.get("lostEligibilityTime"),this.model.get("lostEligibilityTime")&&(t.timeFromLostEligibility=e.eventTime-this.model.get("lostEligibilityTime")),h.extend(t,e);var i={hadImpression:!0,lineItemId:e.lineItemId,requiredViewability:e.requiredViewability};t.isFirstRv?(i.hadRvVimp=!0,this.hadRvVimp=!0):t.isFirstNonRv&&(i.hadNonRvVimp=!0,this.hadNonRvVimp=!0),e.requiredViewability?i.hadNonRvVimpBefore=this.hadNonRvVimp||!1:i.hadRvVimpBefore=this.hadRvVimp||!1,this._addDataToAd(this.events.gotAd,e.adId,t,i)}},{key:"_adPlay",value:function(e){this.createAd(e.adId);var t=!this.adsList[e.adId].hadConversion,i={timeFromAdImpression:e.eventTime-this.adsList[e.adId].gotAd.adImpressionTime,adPlayTime:e.eventTime,isInTab:this.model.get("isInTab"),isFirstConversion:!this.hadConversion,playPauseReason:this.model.get("playPauseReason")};h.extend(i,e);var n={hadConversion:!0};t&&(n.conversionTime=e.eventTime,this._addDataToAd(this.events.conversion,e.adId,i,n)),i.isFirstPlayForAd=t,this._addDataToAd(this.events.adPlay,e.adId,i,n),this.hadConversion||(this.hadConversion=!0)}},{key:"_adPaused",value:function(e){this.createAd(e.adId);var t={isInTab:this.model.get("isInTab"),pauseReason:e.pauseReason,playPauseReason:"pauseOnAdImpression"!==e.pauseReason?this.model.get("playPauseReason"):e.pauseReason};this.adsList[e.adId].conversionTime?t.timeFromAdPlay=e.eventTime-this.adsList[e.adId].conversionTime:t.timeFromAdImpression=e.eventTime-this.adsList[e.adId].gotAd.adImpressionTime,h.extend(t,e),this._addDataToAd(this.events.adPaused,e.adId,t)}},{key:"_viewability",value:function(e){this.createAd(e.adId);var t={timeFromAdPlay:e.eventTime-this.adsList[e.adId].conversionTime};h.extend(t,e),this._addDataToAd(this.events.viewability,e.adId,t,{hadViewability:!0})}},{key:"_completed",value:function(e){this.createAd(e.adId);var t={timeFromAdPlay:e.eventTime-this.adsList[e.adId].conversionTime};h.extend(t,e),this._addDataToAd(this.events.adComplete,e.adId,t,{isCompleted:!0})}},{key:"_continueAd",value:function(e){}},{key:"createAd",value:function(e){var t=this.adsList[e];return t||((t={adId:e,_id:h.generateGuid(10),countChanges:0,hadImpression:!1,hadConversion:!1,abTest:this.model.get("abTest"),pageUrl:window.location.href}).conf=this._createConf(),this.adsList[e]=t),t}},{key:"_createConf",value:function(){return{predictors:this.predictors,detachToSlider:this.model.get("detachToSlider"),unitType:this.model.get("unitType"),version:this.model.get("version")}}},{key:"_createEventList",value:function(){this.adEvents={},this.adEvents[this.events.getAd]=this._getAd.bind(this),this.adEvents[this.events.gotAd]=this._gotAd.bind(this),this.adEvents[this.events.viewability]=this._viewability.bind(this),this.adEvents[this.events.adPlay]=this._adPlay.bind(this),this.adEvents[this.events.adPaused]=this._adPaused.bind(this),this.adEvents[this.events.adComplete]=this._completed.bind(this),this.adEvents[this.events.continueAd]=this._continueAd.bind(this)}},{key:"pushEvent",value:function(e,t){this.adEvents[e]&&this.adEvents[e](t)}},{key:"_addDataToAd",value:function(e,t,i,n){var o=this.adsList[t];o[e]?h.isArray(o[e])?o[e].push(i):o[e]=[o[e],i]:o[e]=i,o.redId=this.model.get("redId"),o.abTest=this.model.get("abTest"),this._addCardData(i,n),h.extend(o,n),o.countChanges++,this.adsList[t]=o,this.dirtyAds[t]=!0}},{key:"_addCardData",value:function(e,t){if(e.cardNumber){var i=this._getCardInfo(e.cardNumber);e.scrollData=e.scrollData||{},h.extend(e.scrollData,i),t&&(t.cardInfo=t.cardInfo||{},h.extend(t.cardInfo,i))}}},{key:"_getCardInfo",value:function(e){var t=("#cm_place_holder_"+e).replace(".",""),i=Object(o.a)(t)[0],n=h.getTopOfEl(i),r=window.innerHeight+window.pageYOffset;return{distanceToEligibility:n-r,eligibilityPercentage:r/n*100,cardTopPixels:n,cardNumber:e}}},{key:"getAdsData",value:function(){return{adsList:this.adsList}}},{key:"saveAdsData",value:function(e){this.adsList.length&&h.forEach(this.adsList,function(t,i){t.hadImpression&&this.dirtyAds[i]&&(this.dirtyAds[i]=!1,o.a.ajax({type:"POST",url:e+"/putes/units-ads-analytics",data:JSON.stringify(h.extend(t,{timestamp:(new Date).toISOString()})),contentType:"text/plain"}))}.bind(this))}}])&&l(t.prototype,i),r}(n.a);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=i(5),_=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(r,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=v(e);if(t){var o=v(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return y(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this,e)).model=e.model,t.getAdCount=0,t.impressionCount=0,t.isFirstImpression=!0,t.isFirstPlay=!0,t.isFirstPauseAfterPlay=!0,t.isFirstisEligiblilty=!0,t.hadLostEligibility=!1,t.eventsToSend=t.model.get("kibanaEventsToSend")||"all",t.isDirty=!1,t.changesCount=0,t.totalData={_id:b.generateGuid(10),redId:t.model.get("redId")},t.startTime=t._getCurrentTime(),t._createAdsEvents(),t.kibanaAdsService=new f({model:t.model,startTime:t.startTime,predictors:t._parsePredicts(t.model.get("predictors"))}),t._start(),t._bindEvents(),t}return t=r,(i=[{key:"_start",value:function(){this._saveDataToStorage(s.a.KIBANA_EVENTS.start,{isEligible:this.model.get("isEligibleToPlay")||!1,startTime:this.startTime,pageUrl:window.location.href,selector:this.model.get("parentSelector")?this.model.get("parentSelector").toString():"",predictors:this._parsePredicts(this.model.get("predictors")),viewPercent:this.model.get("viewPercent"),viewabilityPercent:this.model.get("viewabilityPercent"),creativeId:this.model.get("creativeId"),unitType:this.model.get("unitType"),abTest:this.model.get("abTest"),playerType:this.model.get("mobilePlayer"),playerVersions:this.model.get("player.versions"),urlPrefix:this.model.get("urlPrefix"),version:this.model.get("version"),vForce:this.model.get("vForce"),isInTab:this.model.get("isInTab"),detachToSlider:this.model.get("detachToSlider"),scrollSelector:this.model.get("scrollSelector"),isUseObserver:this.model.get("isUseObserver"),isUseObserverChanged:this.model.get("isUseObserverChanged"),documentReadyState:this.model.get("documentReadyState"),lineItemId:this.model.get("lineItemId"),isAMP:window.TRC&&window.TRC.isAMP,isEligibilityNomination:this.model.get("isEligibilityNomination")||!1,secondsToWaitForRV:this.model.get("secondsToWaitForRV")},!0)}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"renderWasCalled:true",funcName:"_onRenderCalled"},{event:"getAdState:failed",funcName:"_getAdFailed"},{event:"isEligibleToPlay:true",funcName:"_onFirstEligibility"},{event:"closeState:closeButtonClicked",funcName:"_closeButtonClicked"},{event:"getAdState:stopped",funcName:"_unitClosedByMidRollTimeOut"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"},{event:"playerWidthLost:true",funcName:"_onLostPlayerSize"},{event:"playerHeightLost:true",funcName:"_onLostPlayerSize"},{event:"invalidCDBobject",funcName:"_onInvalidCDBobject"},{event:"playerHasRvInQ",funcName:"_onPlayerHasRvInQ"},{event:"rvHandlerState",funcName:"_onRvHandlerStateChange"},{event:"rvHandlerTimerExpired",funcName:"_onRvHandlerTimerExpired"}])}},{key:"_getCurrentTime",value:function(){return(new Date).getTime()}},{key:"_onRenderCalled",value:function(){this.renderCallTime=this._getCurrentTime();var e={isEligible:this.model.get("isEligibleToPlay"),timeFromAdImpression:this.renderCallTime-this.adImpressionTime,isInTab:this.model.get("isInTab")};this._saveDataToStorage(s.a.KIBANA_EVENTS.renderWasCalled,e)}},{key:"_getAdFailed",value:function(){this.getAdFailTime=this._getCurrentTime();var e={isEligible:this.model.get("isEligibleToPlay"),timeFromGetAd:this.getAdFailTime-this.getAdTime,isInTab:this.model.get("isInTab"),width:this.model.get("width"),height:this.model.get("height")};this._saveDataToStorage(s.a.KIBANA_EVENTS.getAdFailed,e)}},{key:"getAdCalled",value:function(e){this.getAdCount++,this.getAdTime=this._getCurrentTime();var t=this._getTopParentSelector();t=t||-999;var i={isEligible:this.model.get("isEligibleToPlay"),timeFromStart:this.getAdTime-this.startTime,getAdCount:this.getAdCount,predictPointKey:"any"===e.getAdKey?10:e.getAdKey,predictName:e.predictName,isInTab:this.model.get("isInTab"),topParentSelector:t,adId:e.adId};this.model.get("distancePercentPredictData")&&"distancePercentPredict"===e.predictName&&b.extend(i,this.model.get("distancePercentPredictData")),this.model.get("distancePixelPredictData")&&"distancePixelsPredict"===e.predictName&&b.extend(i,this.model.get("distancePixelPredictData")),this._saveDataToStorage(s.a.KIBANA_EVENTS.getAd,i)}},{key:"gotAd",value:function(e){this.isFirstImpression=!1,this.adImpressionTime=this._getCurrentTime();var t=this._calcScrollPercentage(),i={isEligible:this.model.get("isEligibleToPlay"),timeFromGetAd:this.adImpressionTime-this.getAdTime,scrollPercentageFromSelector:t.scrollPercentageFromSelector,bottomViewPort:t.bottomViewPort,topParentSelector:t.topParentSelector,isInTab:this.model.get("isInTab")};i.hadLostEligibility=!!this.model.get("lostEligibilityTime"),this.model.get("lostEligibilityTime")&&(i.timeFromLostEligibility=this.adImpressionTime-this.model.get("lostEligibilityTime")),this.playerHadRvInQTime&&this.model.get("gotRvAd")&&(i.timeFromPlayerHasRV=this.adImpressionTime-this.playerHadRvInQTime),e&&b.extend(i,e),this._saveDataToStorage(s.a.KIBANA_EVENTS.gotAd,i,!1),this.impressionCount++}},{key:"adPlaying",value:function(e){this.hadPlay=!0,this.adPlayingTime=this._getCurrentTime();var t={timeFromAdImpression:this.adPlayingTime-this.adImpressionTime,isInTab:this.model.get("isInTab"),isFirstPlay:this.isFirstPlay};e&&b.extend(t,e),this.isFirstPlay=!1,this._saveDataToStorage(s.a.KIBANA_EVENTS.adPlay,t)}},{key:"adPaused",value:function(e){if(this.hadPlay){this.adPausedAfterPlayTime=this._getCurrentTime();var t={timeFromAdPlay:this.adPausedAfterPlayTime-this.adPlayingTime,isInTab:this.model.get("isInTab"),pauseReason:e.pauseReason};e&&b.extend(t,e),this._saveDataToStorage(s.a.KIBANA_EVENTS.adPaused,t)}}},{key:"_onFirstEligibility",value:function(){if(this.isFirstisEligiblilty){this.isFirstisEligiblilty=!1,this.firstEligibilityTime=this._getCurrentTime();var e={timeFromStart:this.firstEligibilityTime-this.startTime};this._saveDataToStorage(s.a.KIBANA_EVENTS.firstEligibility,e)}}},{key:"_closeButtonClicked",value:function(){this._unitClose(s.a.KIBANA_EVENTS.unitCloseByUser)}},{key:"_unitClosedByMidRollTimeOut",value:function(){this._unitClose(s.a.KIBANA_EVENTS.unitClosedByMidRollTimeOut)}},{key:"_unitClose",value:function(e){this.closeTime=this._getCurrentTime();var t={impressionCount:this.impressionCount,timeFromAdPlay:this.closeTime-this.adPlayingTime};this._saveDataToStorage(e,t,!0),clearInterval(this.updateTimer),this.updateTimer=void 0}},{key:"onViewability",value:function(e){this.viewabilityTime=this._getCurrentTime();var t={timeFromAdPlay:this.viewabilityTime-this.adPlayingTime};e&&b.extend(t,e),this._saveDataToStorage(s.a.KIBANA_EVENTS.viewability,t,!1)}},{key:"onD2DClick",value:function(e,t){var i={isTrusted:e,isNewTab:t};this._saveDataToStorage(EVENTS.D2DClick,i,!1)}},{key:"_onParentSelectorLost",value:function(){this.lostTime=this._getCurrentTime();var e=this._getTopParentSelector();e=e||-999;var t={isEligible:this.model.get("isEligibleToPlay"),timeFromStart:this.lostTime-this.startTime,isInTab:this.model.get("isInTab"),topParentSelector:e,isTop0Left0:this.model.get("top0Left0")};this._saveDataToStorage(s.a.KIBANA_EVENTS.topParentSelectorLost,t,!0)}},{key:"_onLostPlayerSize",value:function(){var e=s.a.KIBANA_EVENTS.playerHeightLost;this.model.get("playerWidthLost")&&(e=s.a.KIBANA_EVENTS.playerWidthLost),this.lostTime=this._getCurrentTime();var t=this._calcScrollPercentage();t.topParentSelector=t.topParentSelector?t.topParentSelector:-999;var i={isEligible:this.model.get("isEligibleToPlay"),timeFromStart:this.lostTime-this.startTime,isInTab:this.model.get("isInTab"),scrollPercentageFromSelector:t.scrollPercentageFromSelector,bottomViewPort:t.bottomViewPort,topParentSelector:t.topParentSelector};this._saveDataToStorage(e,i)}},{key:"_getTopParentSelector",value:function(){var e=this.model.get("parentSelector");return e=b.isArray(e)?e[0]:e,e=Object(o.a)(e)[0],b.getTopOfEl(e)}},{key:"_calcScrollPercentage",value:function(){var e=this._getTopParentSelector();e=e||-999;var t=window.innerHeight+window.pageYOffset;return{scrollPercentageFromSelector:t/e*100,topParentSelector:e,bottomViewPort:t}}},{key:"_onInvalidCDBobject",value:function(){var e=s.a.KIBANA_EVENTS.invalidCDBobject,t=this._getCurrentTime(),i={cdbObject:this.model.get("invalidCDBobject"),timeFromStart:t-this.startTime};this._saveDataToStorage(e,i)}},{key:"_onRvHandlerStateChange",value:function(e,t){var i=s.a.KIBANA_EVENTS.rvHandlerState,n={rvHandlerState:t,timeFromStart:this._getCurrentTime()-this.startTime,gotRvAd:this.model.get("gotRvAd"),gotNonRvAd:this.model.get("gotNonRvAd")};this._saveDataToStorage(i,n)}},{key:"_onPlayerHasRvInQ",value:function(e,t){var i=s.a.KIBANA_EVENTS.playerHasRvInQ,n=this._getCurrentTime();this.playerHadRvInQTime=n;var o={rvHandlerState:this.model.get("rvHandlerState"),timeFromStart:n-this.startTime,gotRvAd:this.model.get("gotRvAd"),gotNonRvAd:this.model.get("gotNonRvAd")};this._saveDataToStorage(i,o)}},{key:"_onRvHandlerTimerExpired",value:function(){var e=s.a.KIBANA_EVENTS.rvHandlerTimerExpired,t={timeFromStart:this._getCurrentTime()-this.startTime,gotNonRvAd:this.model.get("gotNonRvAd")};this._saveDataToStorage(e,t)}},{key:"_parsePredicts",value:function(e){var t=o.a.extend(!0,{},e);return"any"===t.playerReady.predictPoint&&(t.playerReady.predictPoint=10),t}},{key:"_createAdsEvents",value:function(){this.adEvents={},this.adEvents[s.a.KIBANA_EVENTS.getAd]=this.getAdCalled.bind(this),this.adEvents[s.a.KIBANA_EVENTS.gotAd]=this.gotAd.bind(this),this.adEvents[s.a.KIBANA_EVENTS.viewability]=this.onViewability.bind(this),this.adEvents[s.a.KIBANA_EVENTS.adPlay]=this.adPlaying.bind(this),this.adEvents[s.a.KIBANA_EVENTS.adPaused]=this.adPaused.bind(this)}},{key:"adEvent",value:function(e,t){var i={eventTime:this._getCurrentTime(),scrollData:this._calcScrollPercentage()};b.extend(t,i),this.kibanaAdsService.pushEvent(e,t),this.adEvents[e]&&this.adEvents[e](t)}},{key:"_saveDataToStorage",value:function(e,t,i){("all"===this.eventsToSend||b.contains(this.eventsToSend,e))&&(this.totalData[e]?b.isArray(this.totalData[e])?this.totalData[e].push(t):this.totalData[e]=[this.totalData[e],t]:this.totalData[e]=t,i?this._saveDataToLogServer(i):this.isDirty=!0)}},{key:"_saveDataToLogServer",value:function(e){if(e||this.isDirty){this.changesCount++,this.totalData.redId=this.model.get("redId"),this.totalData.countChanges=this.changesCount,this.totalData.abTest=this.model.get("abTest"),this.totalData.age=this._getCurrentTime()-this.startTime;var t=this.model.get("kbnul");this.kibanaAdsService.saveAdsData(t),o.a.ajax({type:"POST",url:t+"/putes/unitsanalytics",data:JSON.stringify(b.extend(this.totalData,{timestamp:(new Date).toISOString()})),contentType:"text/plain"}),this.isDirty=!1,this.updateTimer||(this.updateTimer=setInterval(this._saveDataToLogServer.bind(this),1e3*this.model.get("reportTimerSeconds")))}}}])&&m(t.prototype,i),r}(n.a);t.a=_},function(e,t,i){"use strict";function n(e,t,i){return(n=o()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&r(o,i.prototype),o}).apply(null,arguments)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"a",(function(){return x}));var a=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"instance"in this.constructor)throw new Error("Cannot instantiate more than one '".concat(this.constructor.name,"'"));if("Singleton"==this.constructor.name)throw new Error("Cannot instantiate abstract class 'Singleton'");this.constructor.instance=this}var t,i;return t=e,i=[{key:"getInstance",value:function(){return"instance"in this||this.create.apply(this,arguments),this.instance}},{key:"create",value:function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return n(e,i)}}],null&&s(t.prototype,null),i&&s(t,i),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,i){return(c=f()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&u(o,i.prototype),o}).apply(null,arguments)}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(a,e);var t,i,n,o,r,s=(t=a,i=f(),function(){var e,n=p(t);if(i){var o=p(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return h(this,e)});function a(e,t){var i,n,o,r,l,c,d;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(i=s.call(this)).version=e,i.isGa=t,i.isGa&&(window.ga&&"function"==typeof window.ga||(n=window,o=document,r="script","//www.google-analytics.com/analytics.js",l="ga",n.GoogleAnalyticsObject=l,n.ga=n.ga||function(){(n.ga.q=n.ga.q||[]).push(arguments)},n.ga.l=1*new Date,c=o.createElement(r),d=o.getElementsByTagName(r)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",d.parentNode.insertBefore(c,d),window.ga("create","UA-66399520-1","auto"),window.ga("send","pageview")),i._setup()),i}return n=a,r=[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return c(a,t)}}],(o=[{key:"_setup",value:function(){window.ga("create","UA-66399520-1","auto",{name:"cmGa"}),window.ga("cmGa.send","pageview")}},{key:"send",value:function(e,t){this.isGa&&window.ga("cmGa.send","event",e+" "+this.version,t,location.host)}}])&&d(n.prototype,o),r&&d(n,r),a}(a),g=i(0);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,i){return(v=w()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&_(o,i.prototype),o}).apply(null,arguments)}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(a,e);var t,i,n,o,r,s=(t=a,i=w(),function(){var e,n=A(t);if(i){var o=A(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return S(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this)}return n=a,r=[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return v(a,t)}}],(o=[{key:"send",value:function(e,t,i){i||(i="ul");var n=JSON.stringify({timestamp:(new Date).toISOString(),type:e,data:t});g.a.ajax({type:"POST",url:"//vidanalytics.taboola.com/putes/"+i,data:n,contentType:"text/plain"})}}])&&b(n.prototype,o),r&&b(n,r),a}(a);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,i){return(C=V()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&O(o,i.prototype),o}).apply(null,arguments)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function V(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=i(5),x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(a,e);var t,i,n,o,r,s=(t=a,i=V(),function(){var e,n=D(t);if(i){var o=D(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return I(this,e)});function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.addTrace,n=void 0!==i&&i,o=t.isDebug,r=void 0!==o&&o,l=t.isConsole,c=void 0===l?r:l,d=t.isSaveLog,u=void 0===d?r:d,h=t.extraLogGA,f=void 0!==h&&h,p=t.version,g=t.isGA;return E(this,a),(e=s.call(this)).addTrace=n,e.isDebug=R.parseBool(r),e.isConsole=R.parseBool(c),e.isSaveLog=R.parseBool(u),e.isGA=R.parseBool(g),e.extraLogGA=f,e._ga=m.getInstance(p,e.isGA),e._ul=T.getInstance(),e.dataIndexName="units_debug_logs",e.isDebug&&(window.cmLogs=window.cmLogs||[]),e.initModel={},e}return n=a,r=[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return C(a,t)}}],(o=[{key:"pushLog",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(window.cmLogs.push({ts:(new Date).getTime(),message:e,obj:t}),"cmTag: init"===e&&(this.initModel=t,this.initModel["debugDataStore.indexName"]&&(this.dataIndexName=this.initModel["debugDataStore.indexName"]),console.log("cmTag: init obj:",JSON.stringify(t)),this.sessionID=this.getUniqSessionId(),this.showSessionID()),this.initModel["debugDataStore.isActive"]&&this.sendToServer(e,t))}},{key:"info",value:function(e,t){this.isDebug&&this._hasConsoleMethod("info")&&(console.info("cmTag: ".concat(e),t),this.pushLog("cmTag: ".concat(e),t),this.addTrace&&this._hasConsoleMethod("trace")&&console.trace())}},{key:"debug",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: RoyalBlue",t),this.pushLog("cmTag: ".concat(e),t))}},{key:"error",value:function(e,t){this._hasConsoleMethod("error")&&(console.error("cmTag: ".concat(e),t),this.pushLog("cmTag: ".concat(e),t))}},{key:"ga",value:function(e,t,i){return this.extraLogGA&&this.info("GA extra log",{unitType:e,action:t,version:i}),this._ga.send(e,t,i)}},{key:"ul",value:function(e,t,i){return this._ul.send(e,t,i)}},{key:"success",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: green",t),this.pushLog("cmTag: ".concat(e),t))}},{key:"important",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: purple",t),this.pushLog("cmTag: ".concat(e),t))}},{key:"warning",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: orange",t),this.pushLog("cmTag: ".concat(e),t))}},{key:"pixel",value:function(e,t){this.isDebug&&this._hasConsoleMethod("log")&&(console.log("%ccmTag: ".concat(e),"color: #00A0B2",t),this.pushLog("cmTag: ".concat(e),t))}},{key:"sendToServer",value:function(e,t){var i="no data";try{var n=JSON.stringify(t);t&&(i=n)}catch(e){}var o="".concat(this.initModel["player.settings.kbnul"],"/putes/").concat(this.dataIndexName);g.a.ajax({type:"POST",url:o,data:JSON.stringify({message:e,dataObject:i,timestamp:(new Date).toISOString(),sessionID:this.sessionID}),contentType:"text/plain"})}},{key:"getUniqSessionId",value:function(){return"".concat(this.getRandomNumber()).concat(this.getRandomNumber()).concat(this.getRandomNumber())}},{key:"showSessionID",value:function(){var e=document.createElement("div");e.setAttribute("id","_cm-session-id-div"),e.setAttribute("style","background: black; color: wheat; position: fixed; top: 0; left: 0;z-index:999999999");var t=document.createTextNode("SessionID: ".concat(this.sessionID)),i=document.createElement("button");i.innerHTML="X",i.addEventListener("click",(function(){document.querySelector("#_cm-session-id-div").remove()})),e.appendChild(t),e.appendChild(i),document.querySelector("body").appendChild(e)}},{key:"getRandomNumber",value:function(){return Math.floor(10*Math.random())}},{key:"_hasConsoleMethod",value:function(e){return console&&console[e]&&"function"==typeof console[e]}}])&&k(n.prototype,o),r&&k(n,r),a}(a)},function(e,t,i){"use strict";var n=i(4),o=i(2),r=i(8),s=i.n(r),a=i(6),l=i(0),c=i(7),d=i(9),u=i.n(d),h=i(1),f=i.n(h);function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m,g=i(5),y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adsList=[],this.listeners=[],this.registerIndex=0,this.model=t}var t,i;return t=e,(i=[{key:"updateAdsList",value:function(e){e&&!g.isEmpty(e)?(this.adsList=e.items,this._notifyListeners(e)):(this.model.set("generalErrorData",1),this.model.increaseCounter("generalError"))}},{key:"_notifyListeners",value:function(e){var t=this;this.isPlayerHasRvInQ(e);var i=[];this.listeners.forEach((function(e){var n=t._findAdsByStatusAndType(e.type,e.typeValue,e.status,e.cb);e.isListenOnce&&n&&i.push(e.index)})),i.forEach((function(e){return t.unregisterToPlayerQueueStatusChange(e)}))}},{key:"_findAdsByStatusAndType",value:function(e,t,i,n){var o=this,r=!1,s=[];return this.adsList.forEach((function(n){(!e||o[e]&&o[e](n,t))&&(!i||f.a.AD_STATUS[i]&&n.vw&&n.vw.st===f.a.AD_STATUS[i])&&(s.push(n),r=!0)})),r&&g.isFunction(n)&&n(s),r}},{key:"singleAd",value:function(e,t){return!!(t&&e.sa||!t&&!e.sa)}},{key:"adjacency",value:function(e,t){return!!(t&&e.adjc||!t&&!e.adjc)}},{key:"registerIsPlayerHasRvInQ",value:function(e){this.isPlayerHasRvInQCb=e}},{key:"isPlayerHasRvInQ",value:function(e){this.isPlayerHasRvInQCb&&e.requiredViewabilityCount&&this.isPlayerHasRvInQCb()}},{key:"registerToPlayerQueueStatusChange",value:function(e){var t=e.type,i=e.typeValue,n=e.status,o=void 0===n?f.a.AD_STATUS.new:n,r=e.cb,s=e.isListenOnce,a={type:t,typeValue:i,status:o,cb:r,isListenOnce:void 0!==s&&s,index:this.registerIndex};return this.registerIndex=this.registerIndex+1,this.listeners.push(a),a.index}},{key:"unregisterToPlayerQueueStatusChange",value:function(e){this.listeners=this.listeners.filter((function(t){return t.index!==e}))}}])&&p(t.prototype,i),e}(),v=function(e){return m||(m=new y(e)),m},b=i(3),_=i.n(b);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=i(5),E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(a,e);var t,i,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=P(e);if(t){var o=P(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return T(this,i)}}(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=r.call(this,e)).model=e,t.log=new n.a({unitType:t.model.get("unitType"),className:"playerService",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.isRestarted=!1,t}return t=a,(i=[{key:"_init",value:function(){this._bindEvents(),this.model.get("isPlayerLoaded")&&this._onPlayerLoaded()}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"isPlayerLoaded",funcName:"_onPlayerLoaded"},{event:"getAdState:stopped",funcName:"_pausePlayer"},{event:"isInTab",funcName:"_onTabEvent"},{event:"startWF",funcName:"startWf"},{event:"canStartPlayer:true",funcName:"_onPlayerLoaded"}])}},{key:"_onPlayerLoaded",value:function(){if(this.model.get("isPlayerLoaded")&&this.model.get("canStartPlayer")&&!this.player&&this._validatePlayerSize()){if(this.isMuted="on"!==this.model.get("volume"),this.volume="off"!==this.model.get("volume")?40:0,this.contentIndex=0,this.playlist=this.model.get("player.playlist"),this.playlist&&C.isEmpty(this.playlist))return void this.model.listenToOnce(this.model,"change:player.playlist",this._onPlayerLoaded.bind(this));C.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoPlayerInit",f.a.TRC_PERFORMANCE_ACTIONS.START);var e=this.playlist[this.contentIndex];this.model.set("isInIdleMode",!this.model.get("isInTab")&&this.model.get("isCallIDLE"));var t=this._getAdTypesToDrop();this.data={abTest:this.model.get("abTest"),ad_controls:this.model.get("player.hasAdControls"),aspect_ratio:this.model.get("aspectRatio"),auc_dast:this.model.get("cmDast"),autostart:this.model.get("autoPlay"),base_url:this.model.get("urls.base"),bf_factor:this.model.get("player.bfFactor"),bug_feature:this.model.get("player.hasBFeature"),cfr:this.model.get("cfr"),cipid:this.model.get("cipid"),cirf:decodeURIComponent(this.model.get("referrer")),creativeId:this.model.get("creativeId"),controls:this.model.get("player.hasControls"),country:this.model.get("country"),debug:this.model.get("isDebug")?["*"]:[],default_ad_parameters:this.model.get("defaultAdParameters"),default_ad_timeout:this.model.get("adMaxPlaySeconds"),default_b2b:this.model.get("player.b2b"),fire99:this.model.get("player.isFire99"),ga_factor:this.model.get("gaFactor"),ga_frame_src:this.model.get("gaFrameSrc"),image:this.model.get("loaderImage"),interrupt_loading:this.model.get("interruptLoading"),ip:this.model.get("ip"),isViewable:this.model.get("isPlayerViewable"),keywords:this.model.get("adTitle"),min_vpaid_run_time:this.model.get("player.minVpaidRunTime"),no_debug_report:this.model.get("noDebugReport"),oid:this.model.get("originId"),opps_base_path:this.model.get("player.urls.oppsBasePath"),non_bllb_opps_base_path:this.model.get("player.urls.nonBllbOppsBasePath"),page_url:decodeURIComponent(this.model.get("referrer")),referrer:decodeURIComponent(this.model.get("referrer")),repeat:this.model.get("repeat"),ron_percent:this.model.get("ronPercent"),schedule_auto:this.model.get("timeBetweenAds"),tags:this.model.get("tags"),time_between_waterfall:this.model.get("secondsBW"),use_flash_bypass:this.model.get("player.isBypassFlash"),use_flash_player:this.model.get("player.isFlashPlayer"),version:this.model.get("adTitle"),vertical:this.model.get("vertical"),wf_base_path:this.model.get("player.urls.wfBasePath"),domain_wf_base_path:this.model.get("player.urls.domainWfBasePath"),wf_url:this.model.get("player.urls.wfRequest"),opps_url:this.model.get("player.urls.oppsRequest"),height:""+parseInt(this.model.get("height")),width:""+parseInt(this.model.get("width")),dplayerSettings:this.model.get("player.settings"),loadrsrc:!0,preset:this.model.get("preset"),isDFP:this.model.get("iframeData.inDFP"),can_opt_out:!1,description:e.title,domain:window.location.hostname,mute:this.isMuted,title:e.title,volume:this.volume,isIdleMode:this.model.get("isInIdleMode"),dlywf:this.model.get("dlywf"),target_id:this.getTarget(),schedule:this.model.getScheduleArr(),dtagid:this.model.get("dtagid"),dpubid:this.model.get("dpubid"),isMobile:this.model.get("isMobile"),queue_size:this.model.get("player.settings.queueSize"),max_ready_vpaid:this.model.get("player.settings.maxReadyVpaid"),adto:this.model.get("player.settings.adto"),vakll:this.model.get("player.settings.vakll"),mintimwf:this.model.get("player.settings.mintimwf"),agressiveLevel:this.model.get("preset.level"),suppressContentZindex:this._getSuppressContentZindex(),vimpFireEvent:this.model.get("vimpFireEvent"),subUnitType:this.model.get("subUnitType"),vForce:this.model.get("vForce.isActive"),get_ad_timeout_seconds:this.model.get("vForce.getAdTimeoutSeconds"),wf_manual:this.model.get("wfManual"),wf_dynmc_ps:this.model.get("wfDynamicPause"),run_wf_when_empty:this.model.get("runWfWhenEmpty"),rndmt:this.model.get("rndmt"),unit_name:this.model.get("unitName"),unit_loader_version:this.model.get("version"),unit_main_version:this.model.get("unitVersion"),mprdct:this.model.get("player.settings.mprdct"),gdprApplies:this.model.get("gdprApplies"),cdb:this.model.get("consentDaisyBit"),oppsQS:this.model.get("oppsQS"),adTypesToDrop:t,red_id:this.model.get("redId"),files:[e],pixelsUrl:this.model.get("pixels.url"),numOfWfUntilDcSwitch:this.model.get("numOfWfUntilDcSwitch"),onPlayerClose:this._onPlayerClose.bind(this),onPlayerError:this._onPlayerError.bind(this),onPlayerReady:this._onPlayerReady.bind(this),onPlayerStop:this._onPlayerStop.bind(this)},C.extend(this.data,this.extraData||{}),C.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoOvaMediaPlayerInit",f.a.TRC_PERFORMANCE_ACTIONS.START),this.player=new OvaMediaPlayer(this.data),C.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoOvaMediaPlayerInit",f.a.TRC_PERFORMANCE_ACTIONS.STOP),s.a.player=this.player,this.player.on("AdClickThru",this._onAdClickThru.bind(this)),this.player.on("emptyFirstWaterfall",this._triggerPassback.bind(this)),this._alignPlayer(),C.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoPlayerInit",f.a.TRC_PERFORMANCE_ACTIONS.STOP)}}},{key:"_validatePlayerSize",value:function(){var e=this.model.get("width"),t=this.model.get("height"),i=!0;return C.isWidthValid(e)?C.isHeightValid(t)||(this.model.set("height",C.getVideoHeight(e)),this.model.set("playerHeightLost",!0)):(i=!1,this.model.set("playerWidthLost",!0)),i}},{key:"_getSuppressContentZindex",value:function(){return this.model.get("suppressContentZindex")&&this.model.get("vForce.isActiv")||!1}},{key:"_onAdClickThru",value:function(){this.model.set("clickThruState",o.clickThruState.clicked)}},{key:"_onPlayerReady",value:function(){this.playerQueueSeeker=new v(this.model),this.playerQueueSeeker.registerIsPlayerHasRvInQ(this.isPlayerHasRvInQ.bind(this)),this.playerQueueSeeker.registerToPlayerQueueStatusChange({instance:this,type:void 0,typeValue:void 0,status:"adLoaded",cb:this.isFirstAdLoaded.bind(this),isListenOnce:!0}),this._onTabEvent(this.model,this.model.get("isInTab")),this.model.set("playerVersion",this.player.get("player_version")),this.model.set("playerRepeatCount",this.player.repeatCount),this.model.set("playerState",o.readyState),this.player.on("AdVolumeChange",this._onVolumeChange.bind(this)),this.player.on("AdPaused",this._onAdPaused.bind(this)),this.player.on("AdPlaying",this._onAdPlaying.bind(this)),this.player.on("UserInteractionPauseState",this._onPausedChanged.bind(this)),this.player.on("queueStatus",this.playerQueueSeeker.updateAdsList.bind(this.playerQueueSeeker)),this.player.on("queueStatus",this._onQueueStatusChange.bind(this)),this.player.setDebugData&&(this.debugData=new c.d({model:this.model,onDebugDataChange:this.player.setDebugData.bind(this.player)}),this.player.setDebugDataFunc&&this.player.setDebugDataFunc(this.debugData.getDebugData.bind(this.debugData))),this.isRestarted?(this.model.set("playerState",o.playerState.restarted),this.model.get("player.settings.dlywf")&&this.startWf()):this.model.set("playerState",o.readyState),this.model.get("isContainerRatioNotValidForTakeOver")&&this.dropAds(u.a.adjacency.name)}},{key:"_onQueueStatusChange",value:function(e){this.model.set("playerQueue",e.items)}},{key:"_onPausedChanged",value:function(e){this.model.set("generalPlayingUnitState",!e)}},{key:"_onAdPaused",value:function(){this.model.set("generalPlayingUnitState",!1)}},{key:"_onAdPlaying",value:function(){this.model.set("generalPlayingUnitState",!0)}},{key:"_onPlayerClose",value:function(){this._setGeneralPlayingUnitState(!1),this.model.set("playerState",o.playerState.closed)}},{key:"_setGeneralPlayingUnitState",value:function(e){this.model.set("generalPlayingUnitState",null),this.model.set("generalPlayingUnitState",e)}},{key:"_onPlayerStop",value:function(){this.model.set("playerState",o.playerState.stopped)}},{key:"_onPlayerError",value:function(){this.model.set("playerState",o.playerState.error)}},{key:"isPlayerHasRvInQ",value:function(){this.model.set("playerHasRvInQ",!0)}},{key:"isFirstAdLoaded",value:function(){this.model.set("isFirstAdLoaded",!0)}},{key:"close",value:function(){setTimeout(function(){this.player&&(this.player.closeCleanPlayer(),this.player=null,this.model.set("closeState",o.closeState.playerClosed),this.model.set("playerState",o.playerState.closed),this.log.info("player was closed"))}.bind(this),0)}},{key:"_pausePlayer",value:function(){this.close()}},{key:"_onLoadingClick",value:function(){this.isRestarted=!0,setTimeout(this._onPlayerLoaded.bind(this),0)}},{key:"_hasPlayer",value:function(){return this.player&&!this.player.playerIsClosed}},{key:"_onVolumeChange",value:function(e){this.isMuted=0===e.adVolume}},{key:"getTarget",value:function(){if(this.model.get("targetId"))return this.model.get("targetId").toString();var e=C.now().toString(),t=Object(l.a)("<div>");return t.attr("id",e),t.css({width:this.model.get("width")+"px",height:0,position:"absolute",top:0,left:0,display:"none"}),"FEED_MANAGER"!==this.model.get("unitType")&&t.css({}),t.appendTo("body"),this.playerDiv=t,e}},{key:"_onTabEvent",value:function(e,t){this.model.get("isCallIDLE")&&this.player&&this.player.startIdleMode&&this.player.stopIdleMode&&(t?(this.player.stopIdleMode(),this.model.set("isInIdleMode",!1),this.log.info("Stop idle mode")):(this.player.startIdleMode(),this.model.set("isInIdleMode",!0),this.log.info("Start idle mode")))}},{key:"startWf",value:function(){this._hasPlayer()&&this.player.startWf&&!this.model.get("isInIdleMode")?(this.log.info("Starting Waterfall"),this.player.startWf()):this.model.get("isInIdleMode")&&this.createStateHandlers([{event:"isInIdleMode:false",funcName:"startWf",isListenOnce:!0}])}},{key:"_alignPlayer",value:function(){if(this.playerDiv||this.targetElem){var e=this.playerDiv||this.targetElem.parent(),t=this.player.store.get("dataSaver"),i=this.player.store.get("forcecnvsmpg");(t||i)&&this.model.get("playerTextAlign")&&e.css({"text-align":"left"})}}},{key:"_getAdTypesToDrop",value:function(){var e=[];return this._canGetAdjacCard()||e.push(u.a.adjacency.name+"Ad"),e}},{key:"_triggerPassback",value:function(){var e=this.model.get("isApiPassbackExist");!this.model.get("isFirstAdLoaded")&&e&&(this.log.info("Waterfall returned Empty"),_.a.trigger("global:passback",{isApiPassbackExist:e}),this.model.set("closeState",o.closeState.terminate))}}])&&w(t.prototype,i),a}(a.a);t.a=E},function(e,t){e.exports='<div id="_cm-css-reset" class="_cm-repeat-div">\n    <div class="_cm-repeat-view-wrapper">\n        <div class="_cm-repeat-buttons-wrapper">\n            <img class="_cm-repeat-button"></img>\n            <img class="_cm-repeat-button-hover"></img>\n        </div>\n        <div class="_cm-learn-more-buttons-wrapper">\n            <img class="_cm-learn-more-button"></img>\n            <img class="_cm-learn-more-button-hover"></img>\n        </div>\n    </div>\n</div>'},function(e,t,i){window,e.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./index.js":function(e,t,i){"use strict";var n=i("./options.js"),o=i("./utils.js"),r=function(e,t){if("trc"===n.mcrsrvcsnmspc)try{return window.TRC[e][t]}catch(e){}if("cmTag"===n.mcrsrvcsnmspc)try{return window.cmTag.config.ms[e][t]}catch(e){}return null};e.exports={get:function(e,t,i,s){e=o.cleanServiceName(e),t=t||function(e){return n.serviceDefaultVersion[e]}(e);var a=r(e,t);if(a)i&&i(a);else{var l=document.createElement("script"),c=o.setUrlPrefix(n.base_url);l.async=n.async,l.type="text/javascript",l.src=c+(/.*\/$/g.test(c)?"":"/")+e+"/"+t+"/"+e+".js",l.onload=function(){document.head.removeChild(l);try{i&&i(r(e,t))}catch(e){s&&s()}},l.onerror=function(){document.head.removeChild(l),s&&s()},document.head.appendChild(l)}},init:function(e){for(var t in n)e.hasOwnProperty(t)&&(n[t]=e[t])}}},"./options.js":function(e,t,i){"use strict";e.exports={base_url:"//vidstat.taboola.com/",async:!0,mcrsrvcsnmspc:"trc",serviceDefaultVersion:{oppsula:"1.0.1"}}},"./utils.js":function(e,t,i){"use strict";e.exports={setUrlPrefix:function(e){return"string"!=typeof e||0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e},cleanServiceName:function(e){return e.replace(/.js$/,"")}}},0:function(e,t,i){e.exports=i("./index.js")}})},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";i.r(t),t.default={"stickyCard.isActive":!1,"stickyCard.restrictions.adTypeNotAllowed":!0,disableDetachForSession:!0}},function(e,t,i){"use strict";i.r(t),t.default={setAdConfigAfter:"onAdSetToUnits",revertAfter:"_adVideoEnd",isNeedAdjacCard:!0,adjacCardPlacement:1}},function(e,t,i){"use strict";i.r(t),t.default={isReplayAd:!0,isMultiAd:!1}},function(e,t,i){"use strict";i.r(t),t.default={setAdConfigAfter:"onAdSetToUnits",isTakeoverWidget:!0,isForceDontDie:!0,"detachToSlider.isDetachToSlider":!1,isMultiAd:!1,isReplayAd:!0,isKeepViewOnMidroll:!0}},function(e,t,i){"use strict";i.r(t),t.default={}},function(e,t,i){"use strict";i.r(t),t.default={setAdConfigAfter:"setSubModel",isReplayable:!0}},function(e,t,i){"use strict";i.r(t),t.default={isReplayable:!0}},function(e,t,i){"use strict";i.r(t),t.default={isReplayable:!0}},function(e,t,i){"use strict";i.r(t),t.default={isMultiAd:!1}},function(e,t,i){"use strict";i.r(t),t.default={setAdConfigAfter:"setSubModel",isPlacementSingleAd:!0,"continueToPlayInNexCard.isActive":!1}},function(e,t,i){"use strict";i.r(t),t.default={isMultiAd:!1,isReplayAd:!0}},function(e,t,i){"use strict";i.r(t),t.default={isReplayAd:!0}},function(e,t,i){"use strict";i.r(t),t.default={setAdConfigAfter:"onAdSetToUnits",stopPredicts:!0,isKeepViewOnMidroll:!0,isKeepUnitOnMidroll:!0,isPlacementSingleAd:!0,isReplayAd:!0,isPreventNextAd:!0}},function(e,t,i){var n=i(3),o=i(5),r=i(11),s=i(90);e.exports=n.View.extend({className:"_cm-brand-logo",events:{"click ":"_onClick"},initialize:function(e){this.log=new r({unitType:e.unitType,className:"branLogoView"}),this.model=e.model,this.container=e.container,this.options=this.model.get("components.BrandLogo")||{},this.options.imageSrc=this.model.get("components.BrandLogo.imageSrc"),this.openUrl=this._getOpenUrl(),this.render(),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){this.template=o.template(s),this.$el.append(this.template(this.options)),this.options.style&&this.$el.css(this.options.style),this.options.imageStyle&&this.$el.find("a>img").css(this.options.imageStyle),this.container.appendChild(this.el)},_onClick:function(){window.open(this.openUrl,"_blank")},_getOpenUrl:function(){var e=this.model.get("clickUrl"),t=this.options.logoLander,i=this.options.fallBackClickUrl,n=this._getClickUrlQueryStrings(t);return e&&e.length>0&&-1===e.indexOf("_#")?decodeURIComponent(e)+encodeURIComponent(i)+n:i+n},_getClickUrlQueryStrings:function(e){return"?ttype=1&cipid="+this.model.get("cipid")+"&ttype=1&crid="+this.model.get("creativeId")+"&dast="+this.model.get("dast")+"&tgtf="+encodeURIComponent(e)},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}})},function(e,t,i){var n=i(3),o=(i(5),i(11));e.exports=n.View.extend({className:"_cm-detach",events:{"click ":"_onClick"},initialize:function(e){this.log=new o({unitType:e.unitType,className:"detachButtonView"}),this.container=e.container,this._rendered=!1},render:function(){if(!this._rendered){var e=this.model.get("components.DetachButtonView.imageLocation");this.$el.css("background-image",'url("'+e+'") !important'),this.container.appendChild(this.el)}},_onClick:function(){this.$el.trigger("cm:detach:click")},hide:function(){this.$el.hide()}})},function(e,t,i){"use strict";var n=i(3);e.exports=n.DeepModel.extend({defaults:{id:0,filename:"",image:"",title:"",vidlength:"",active:!1,clicked:!1}})},function(e,t){e.exports='<div class="_cm-ad-loading-progress-container">\n    <div class="_cm-ad-loading-progress-bar-container">\n        <div class="_cm-ad-loading-progress-title">\n            <span class="_cm-ad-loading-progress_title_span"></span>\n            <span class="_cm-ad-loading-progress_percent_span">0%</span>\n        </div>\n        <div class="_cm-ad-loading-progress-bar">\n            <div class="_cm-ad-loading-progress-bar-loaded">\n            </div>\n        </div>\n    </div>\n</div>'},function(e,t,i){var n=i(3),o=i(5),r=i(11),s=i(99);e.exports=n.View.extend({className:"_cm-click-blocker-container",initialize:function(e){this.log=new r({unitType:e.unitType,className:"clickBlockerView"}),this.options=e,this.model=e.model,this.container=e.container,this.render()},render:function(){this.template=o.template(s),this.$el.append(this.template(this.options)),this.SetClickBlockerDivStyle(),this.options.style&&this.$el.css(this.options.style),this.container.appendChild(this.el)},SetClickBlockerDivStyle:function(){var e=this;this.containerDimentions=this.container.getBoundingClientRect();var t=this.$el.children();t.forEach((function(t){return e.setBasicBlockerDivStyle(t)}));var i=this.model.get("components.ClickBlocker.blockPercent.vertical"),n=this.model.get("components.ClickBlocker.blockPercent.horizontal");t[0].style.height=this.containerDimentions.height*i+"px",t[1].style.height=this.containerDimentions.height*i+"px",t[2].style.width=this.containerDimentions.width*n+"px",t[3].style.width=this.containerDimentions.width*n+"px"},setBasicBlockerDivStyle:function(e){e.style.width=this.containerDimentions.width+"px",e.style.height=this.containerDimentions.height+"px"}})},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t.model,this.subModel=t.subModel?t.subModel:null,this.observerOptions={root:null,rootMargin:"0px",threshold:this.buildThresholdList()},this.createObserver()}var t,n;return t=e,(n=[{key:"createObserver",value:function(){this.intersectionObserver=new IntersectionObserver(function(e){var t=this;e.map((function(e){t.updateModel("isViewableAMP",e.intersectionRatio>.5)}))}.bind(this),this.observerOptions)}},{key:"startObserver",value:function(e){this.updateModel("isViewableAMP",!1),this.intersectionObserver.observe(e)}},{key:"stopObserver",value:function(e){this.intersectionObserver.unobserve(e),this.intersectionObserver.disconnect()}},{key:"buildThresholdList",value:function(){for(var e=[],t=1;t<=20;t++){var i=t/20;e.push(i)}return e.push(0),e}},{key:"updateModel",value:function(e,t){null!=this.subModel&&this.subModel.set(e,t),this.subModel.set(e,t)}}])&&i(t.prototype,n),e}();e.exports=n},function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i(1);var o=i(76),r=(i(5),i(82)),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.opions=t}var t,i;return t=e,(i=[{key:"getPreset",value:function(e){var t=e.key,i=e.value,n=e.unitType,s=e.platform;if(o[t]&&o[t][i]){var a=o[t],l=o[t].strength||1,c=o[t].atr||{};return c=r(c,a[i].atr),a[i]&&a[i].units&&(c=this._getFromUnits(c,a[i].units,n,s)||c),{presetData:c,strength:l}}}},{key:"_getFromUnits",value:function(e,t,i,n){if(t[i]){var o=t[i].atr||{};return e=r(e,o),t[i].platform&&(e=this._getByPlatform(e,t[i].platform,n)||e),e}}},{key:"_getByPlatform",value:function(e,t,i){if(t[i]){var n=t[i].atr||{};return r(e,n)}}}])&&n(t.prototype,i),e}();e.exports=s},function(e,t){e.exports='<div class="_cm-ad-title"></div>\n<div class="_cm-feed-manager-video-placeHolder">\n</div>'},function(e,t){e.exports='<div class="_cm-feed-manager-video-placeHolder">\n</div>\n<div class="_cm-ad-title"></div>'},function(e,t){e.exports='<div class="_cm-loading-div">\n</div>'},function(e,t,i){"use strict";var n=i(3),o=i(45);e.exports=n.Collection.extend({model:o})},function(e,t){e.exports='<ul class="_cm-playlist-list">\n</ul>'},function(e,t){e.exports='<div class="title text opt-out-hidden">{text}</div>'},function(e,t){e.exports='<img src="{{urls.staticImage}}">\n'},function(e,t){e.exports='<div class="cm_video_content_wrapper">\n    <div class="_cm-background-loading"></div>\n    <video class="cm_video_content_video_element"></video>\n</div>\n'},function(e,t){e.exports='<div class="_cm-skip-ad-border">\n    <div class="_cm-skip-ad-text">{{skipAdText}}</div>\n    <div class="_cm-skip-ad-icon">\n        <svg width="14" height="12" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 200">\n            <line x1="2" y1="2" x2="98" y2="110" style="stroke:#FFFEFD;stroke-width:40" />\n            <line x1="2" y1="198" x2="98" y2="90" style="stroke:#FFFEFD;stroke-width:40" />\n            Sorry, your browser does not support inline SVG.\n        </svg>\n</div>'},function(e,t){e.exports='<div class="video_controls video_controls_main_area">\n    <div class="cm_video_controls_progressbar_area">\n        <div class="cm_video_controls_progressbar_bg white_bg"></div>\n        <div class="cm_video_controls_progressbar blue_bg"></div>\n    </div>\n    <div class="cm_video_controls_mute interactive">\n        <div class="cm_video_controls_volume display_mute"></div>\n        <div class="cm_video_controls_volume display_unmute"></div>\n    </div>\n    <div class="cm_video_controls_playpause interactive show">\n        <div class="pause show"></div>\n        <div class="play hide"></div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="_cm-native-ad-bottom">\n    <div class="_cm-native-ad-title" data-click-name="adTitleClick"></div>\n    <div class="_cm-native-ad-cta-wrapper">\n        <div class="_cm-native-ad-cta-button" data-click-name="adCtaButtonClick"></div>\n    </div>\n    <div class="_cm-native-ad-description" data-click-name="adDescriptionClick"></div>\n    <div class="_cm-native-ad-icon">\n    </div>\n    <div class="_cm-native-ad-branding" data-click-name="adBrandingClick"></div>\n    <div class="_cm-ad-choice"></div>\n</div>'},function(e,t){e.exports='<div class="_cm-native-ad-top">\n    <div class="_cm-native-ad-title" data-click-name="adTitleClick"></div>\n    <div class="_cm-native-ad-cta-wrapper">\n        <div class="_cm-native-ad-cta-button" data-click-name="adCtaButtonClick"></div>\n    </div>\n    <div class="_cm-native-ad-description" data-click-name="adDescriptionClick"></div>\n    <div class="_cm-native-ad-icon">\n    </div>\n    <div class="_cm-native-ad-branding" data-click-name="adBrandingClick"></div>\n    <div class="_cm-ad-choice"></div>\n</div>'},function(e,t){e.exports='<div class="_cm-msn-native-ad-top">\n    <div class="_cm-native-ad-title" data-click-name="adTitleClick"></div>\n</div>'},function(e,t){e.exports='<div class="_cm-content-carousel-items-container-wrapper">\n    <div class="_cm-content-carousel-items-container">\n    </div>\n</div>\n<div class=\'_cm-content-carousel-arrows\'>\n    <div class="_cm-content-carousel-arrow _cm-content-carousel-arrow-left">\n        <svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M0.999999 12L7 6.5L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"  transform="rotate(-180 4,6.5) "/>\n        </svg>\n    </div>\n    <div class="_cm-content-carousel-arrow _cm-content-carousel-arrow-right">\n        <svg width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M0.999999 12L7 6.5L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n    </div>\n</div>\n<div class="_cm-content-carousel-blocker">\n\n</div>\n'},function(e,t){e.exports='<img src="{{image}}" height="70" width="120" class="_cm-content-carousel-item-image" />\n<div class="_cm-content-carousel-item-description {{selected}}">\n    {{title}}\n</div>\n<div class="_cm-content-carousel-item-play-icon {{selected}}">\n    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8 0C3.6 0 0 3.6 0 8C0 12.4 3.6 16 8 16C12.4 16 16 12.4 16 8C16 3.6 12.4 0 8 0ZM6 12V4L11.5 8L6 12Z" fill="white"/>\n    </svg>\n</div>\n<div class="_cm-content-carousel-item-playing-now {{selected}}">\n    {{playingNowString}}\n</div>'},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.timeoutDebounce=!1,this.timeoutThrottle=!1,this.isTimeoutThrotle=!1,this.arr=[],this.docHeight=0,this.createElementsOnPage()}var t,n;return t=e,(n=[{key:"createElementsOnPage",value:function(){this.ampHelperContainer=document.createElement("div"),this.ampHelperContainer.className="_cm-amp-helper-container",document.querySelector("body").appendChild(this.ampHelperContainer),this.createObserver(),this.createObserverElementsObservers(),this.createPageObserver()}},{key:"createObserver",value:function(){this.intersectionObserver=new IntersectionObserver(function(e){var t=this;e.map((function(e){t.arr[e.target.dataset.indexNumber]={intersect:e.isIntersecting,off:e.target.offsetTop},t.callFindIndex()}))}.bind(this))}},{key:"callFindIndex",value:function(){clearTimeout(this.timeoutDebounce),this.timeoutDebounce=setTimeout(this.findIndex.bind(this),this.model.get("detachToSlider.amp.timeoutDebounce")),!this.isTimeoutThrotle&&this.model.get("detachToSlider.amp.timeoutThrottle")&&(this.isTimeoutThrotle=!0,this.timeoutThrottle=setTimeout(this.findIndex.bind(this),this.model.get("detachToSlider.amp.timeoutThrottle")))}},{key:"createObserverElementsObservers",value:function(){for(var e=document.body.clientHeight,t=this.docHeight,i=t;i<e;i++){var n=document.createElement("div");n.className="_cm-amp-helper-observer",n.setAttribute("data-index-number",i),this.ampHelperContainer.appendChild(n)}for(var o=document.querySelectorAll("._cm-amp-helper-observer"),r=t;r<o.length;r++)this.intersectionObserver.observe(o[r]);this.docHeight=document.body.clientHeight}},{key:"findIndex",value:function(){clearTimeout(this.timeoutThrottle),this.isTimeoutThrotle=!1;for(var e=0,t=0,i=0;i<this.arr.length;i++)if(this.arr[i].intersect){e=i;break}for(var n=e;n<this.arr.length&&(t=n,this.arr[n].intersect);n++);this.model.set("ampPageTopLimit",this.arr[e].off),this.model.set("ampPageBottomLimit",this.arr[t].off)}},{key:"createPageObserver",value:function(){var e=document.querySelector(this.model.get("parentSelector"));new MutationObserver(function(e,t){this.createObserverElementsObservers()}.bind(this)).observe(e,{attributes:!0,childList:!0,subtree:!1})}},{key:"getArr",value:function(){return this.arr}}])&&i(t.prototype,n),e}();e.exports=n},function(e,t,i){"use strict";i.r(t);var n=i(1),o=i.n(n),r=i(0);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=i(5),l=a.flatten;a.mixin({parseBool:function(e){return"true"===e||!0===e||1===e||"1"===e},hasFlash:function(){return void 0===navigator.plugins||0==navigator.plugins.length?function(){try{return!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return!1}}():!!navigator.plugins["Shockwave Flash"]},el:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement(e);for(var n in t)null!=t[n]&&(i[n]=t[n]);return i},loadJs:function(e,t){return document.head.appendChild(a.el("script",{src:e,onload:t}))},loadCss:function(e,t){return document.head.appendChild(a.el("link",{href:e,onload:t,rel:"stylesheet",type:"text/css"}))},loadJsArr:function(e,t){var i;t&&(i=e.length);for(var n=0;n<e.length;n++)e[n].indexOf(".css")>-1?a.loadCss(e[n],o):a.loadJs(e[n],o);function o(){0==--i&&t()}},getUrlVars:function(e){for(var t,i=[],n=(e=e||window).location.href.slice(e.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)t=n[o].split("="),i.push(t[0]),i[t[0]]=t[1];return i},firePixelConditional:function(e,t,i,n){e&&a.firePixel(t,i,n)},firePixel:function(e,t,i){e&&(i&&(e=a.addParametersToUrl(e,i,-1===e.indexOf("?"))),cmTag.logger.pixel("firing pixel: "+t+" url: "+e),document.createElement("IMG").src=e)},fireIframePixel:function(e,t){if(e){cmTag.logger.pixel("firing pixel: "+t+" url: "+e);var i=document.createElement("iframe");i.src=e,i.style.display="none";var n=document.getElementsByTagName("body")[0];n||(n=document.getElementsByTagName("html")[0]),n||(n=document.getElementsByTagName("div")[0]),n?n.appendChild(i):cmTag.logger.debug("fireIframePixel","Failed to fire iframe pixel.")}else cmTag.logger.pixel("fireIframePixel","Url empty.")},getViewabilityPercent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.offsetHeight,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.offsetWidth,n=e.getBoundingClientRect(),o={top:Math.max(0,n.top),bottom:Math.min(a.viewport().height,n.bottom),left:Math.max(0,n.left),right:Math.min(a.viewport().width,n.right)};return 100*(o.bottom-o.top)*(o.right-o.left)/(t*i)},isVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.offsetHeight,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.offsetWidth,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50;return a.getViewabilityPercent(e,t,i)>=n},viewport:function(){return{get height(){return a.viewport().object.document.documentElement.clientHeight},get width(){return a.viewport().object.document.documentElement.clientWidth},get object(){return top}}},getVideoHeight:function(e){var t=parseInt(9/16*e);return isNaN(t)?0:t},getVideoWidth:function(e){var t=parseInt(16/9*e);return isNaN(t)?0:t},getVideoBestSize:function(e,t){var i=this.getVideoHeight(e);return t>=i?t=i:e=this.getVideoWidth(t),{width:e,height:t}},getVideoHeightByRatio:function(e,t){var i=parseInt(1/t*e);return isNaN(i)?0:i},getVideoWidthByRatio:function(e,t){var i=parseInt(t*e);return isNaN(i)?0:i},isElementInHead:function(e){if(!e)return!1;for(;e!==document.body&&e!==document.head;)e=e.parentNode;return e===document.head},getViewPercent:function(e,t,i,n){var o,s=a.isEmpty(n)?Object(r.a)(this.getTopWindow()):Object(r.a)(n);o=window.taboolaBridge&&window.taboolaBridge.active?this.calcViewportPositionInApp(n):{top:0,left:0,right:s.width(),bottom:s.height()};var l=Number(i)||0,c=Number(t)||0,d=e.getBoundingClientRect(),u={top:d.top,left:d.left};if(u.right=u.left+c,u.bottom=u.top+l,o.right<u.left||o.left>u.right||o.bottom<u.top||o.top>u.bottom)return 0;var h=Math.min(1,(u.bottom-o.top)/l),f=Math.min(1,(o.bottom-u.top)/l);return Math.min(1,(u.right-o.left)/c)*Math.min(1,(o.right-u.left)/c)*h*f*100},isViewable:function(e,t,i,n){var o=a.getViewPercent(e,t,i);return!(o<=0)&&o>=(n||100)},getViewPercentageDeltas:function(e,t,i){var n=Object(r.a)(window),o={top:n.scrollTop(),left:n.scrollLeft()};o.right=o.left+n.width(),o.bottom=o.top+n.height();var s=Number(i)||0,a=Number(t)||0,l=Object(r.a)(e).offset();return l.right=l.left+a,l.bottom=l.top+s,{top:Math.min(1,(l.bottom-o.top)/s),bottom:Math.min(1,(o.bottom-l.top)/s),left:Math.min(1,(l.right-o.left)/a),right:Math.min(1,(o.right-l.left)/a)}},getValidSelectorElements:function(e,t,i){var n=[];return t=t||100,i=i||0,e&&a.isArray(e)&&(n=a.filter(e,(function(e){var n=e.getBoundingClientRect();return n.width>=t&&n.height>=i&&!a.has(o.a.INVALID_SELECTOR_TAG_NAMES,e.tagName)}))),n},filterObject:function(e,t){if(e){for(var i={},n=0;n<t.length;n++){var o=e[t[n]];void 0!==o&&(i[t[n]]=o)}return i}},assignWithoutUndefinedValues:function(e,t){for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e},stripObject:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;if(e){var s={};for(var l in e)if(!(l in t)){var c=e[l];n&&a.isElement(c)||i&&a.isFunction(c)||(o&&!a.isFunction(c)&&a.isObject(c)&&(c=r>0?this.stripObject(c,[],i,n,o,r--):"{stripElements} - value is Object, but max depth reached."),s[l]=c)}return s}},arrayToObj:function(e){if(e){for(var t={},i=0;i<e.length;i++)void 0!==e[i]&&(t[i]=e[i]);return t}},getTopOfEl:function(e){if(e){var t=e,i=0;if(document.getElementById||document.all)do{for(e.offsetLeft,e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent,t=a.getParentNode(t);t!=e;)t.scrollLeft,i-=t.scrollTop,t=a.getParentNode(t)}while(e&&e.offsetParent);else document.layers&&(i+=e.y,e.x);return i}},getParentNode:function(e){return e.parentNode&&e.parentNode.host?e.parentNode.host:e.parentNode},getLeftOfEl:function(e){return window.pageXOffset+e.getBoundingClientRect().left},PrefixedEvent:function(e,t,i,n){i=i.toLowerCase(),a.each(["webkit","moz","MS","o",""],(function(o){e[t](o+i,n)}))},oneAnimationEnd:function(e,t){var i=a.debounce(t,200);this.PrefixedEvent(e,"one","transitionend",i),this.PrefixedEvent(e,"one","animationend",i)},addParametersToUrl:function(e,t,i){var n=e;return n+=i?"?":"&",r.a.each(t,(function(e,t){void 0!==t&&""!==t&&(n+=e+"="+t+"&")})),n},skipTransitionCss:function(e,t){e.addClass("none-transition"),e.css(t),this.flushCss(e[0]),e.removeClass("none-transition")},flushCss:function(e){e.offsetHeight},getTopWindow:function(){var e=window;try{for(;e.document!==e.top.document;)e=e.top;return e}catch(e){return window}},isInIframe:function(e){return!!e&&(e.inIframe||e.inDFP)},isInFriendlyIframe:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cmTag.config.iframeData;return!!e&&this.isInIframe(e)&&e.isFriendlyIframe},hideDFPIframe:function(e){if(this.isInFriendlyIframe(e)){e.iframe.style.display="none";for(var t=e.iframe.parentNode;a.some(o.a.DFP_KEYWORDS,(function(e){return-1!==t.id.indexOf(e)}));)t.style.display="none",t=t.parentNode}},onceDocReady:function(e){return/complete|loaded|interactive/.test(document.readyState)&&document.body?e():Object(r.a)("document").one("DOMContentLoaded",e),this},crc32:function(e){if(!e||"string"!=typeof e)return 0;var t;void 0===t&&(t=0);var i=0;t^=-1;for(var n=0,o=(e=this.utf8Encode(e)).length;n<o;n++)i=255&(t^e.charCodeAt(n)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);return-1^t},utf8Encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},isMouseOver:function(e){return 0!==e.filter(":hover").length},rollNumbers:function(e){return!!e&&100*Math.random()<e},isFactor:function(e){return a.isNumber(e)&&e===a.random(1,e)},sendMail:function(e,t,i){function n(){emailjs.init("user_kHlYxxusLRTxC6yr3PjQl"),emailjs.send("gmail","units_support",e).then(t,i)}t=t||function(){},i=i||function(){},window.emailjs?n():a.loadJs("//cdn.emailjs.com/dist/email.min.js",n)},isValidEmail:function(e){return!0},toCssObj:function(e){return"string"==typeof e?JSON.parse(e):e},isLayerVisible:function(e){function t(e,t){return window.getComputedStyle?document.defaultView.getComputedStyle(e,null)[t]:e.currentStyle?e.currentStyle[t]:void 0}return function e(i,n,o,r,s,a,l){var c=i.parentNode;return!!function(e){for(;e=e.parentNode;)if(e===document)return!0;return!1}(i)&&(9===c.nodeType||"0"!==t(i,"opacity")&&"none"!==t(i,"display")&&"hidden"!==t(i,"visibility")&&(void 0!==n&&void 0!==o&&void 0!==r&&void 0!==s&&void 0!==a&&void 0!==l||(n=i.offsetTop,s=i.offsetLeft,r=n+i.offsetHeight,o=s+i.offsetWidth,a=i.offsetWidth,l=i.offsetHeight),!c||("hidden"!==t(c,"overflow")&&"scroll"!==t(c,"overflow")||!(s+2>c.offsetWidth+c.scrollLeft||s+a-2<c.scrollLeft||n+2>c.offsetHeight+c.scrollTop||n+l-2<c.scrollTop))&&(i.offsetParent===c&&(s+=c.offsetLeft,n+=c.offsetTop),e(c,n,o,r,s,a,l))))}(e)},getOffset:function(e,t){if(e&&Array.isArray(e)&&e[0]&&(e=e[0]),e){if(1===t)return Object(r.a)(e).offset();var i=e,n=e,o=0,s=0;if(document.getElementById||document.all)do{for(s+=e.offsetLeft-e.scrollLeft,o+=e.offsetTop-e.scrollTop,e=e.offsetParent,n=a.getParentNode(n);n&&n!=e;)s-=n.scrollLeft,o-=n.scrollTop,n=a.getParentNode(n)}while(e&&e.offsetParent);else document.layers&&(o+=e.y,s+=e.x);return{top:o,left:Object(r.a)(i).offset().left||s}}},flatten:function(e){var t={};for(var i in e)t[i]=e[i];return t},cssObjToString:function(e){var t=!!document.documentMode,i=!t&&!!window.StyleMedia,n=window.navigator.userAgent.indexOf("Firefox")>-1;return(t||i||n)&&(e=this.flatten(e)),JSON.stringify(e)},isModel:function(e,t,i){return i?i.model.get(e)===t:this.model.get(e)===t},generateGuid:function(e,t){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),n=[],o=0;for(t=t||i.length,e=e||22,o=0;o<e;o++)n[o]=i[0|Math.random()*t];return n.join("")},isObserverSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=window[e],n=void 0!==i,o=!1;n&&(o=-1!==i.toString().indexOf("[native code]"));var r=o||t&&n;return r},isHeightValid:function(e){var t=!0;return e||(t=!1),t},isWidthValid:function(e){var t=!0;return e||(t=!1),t},setTrcObserver:function(e){s(TRC.intersections)&&TRC.intersections.observe&&TRC.intersections.observe(e)},dispatchTRC:function(e){TRC&&TRC.dispatch&&(TRC.dispatch(e),cmTag.logger&&cmTag.logger.info&&cmTag.logger.info("dispatched TRC event: ".concat(e)))},dispatchTRCWithPayload:function(e,t){TRC&&TRC.dispatch&&(TRC.dispatch(e,t),cmTag.logger&&cmTag.logger.info&&cmTag.logger.info("dispatched TRC event: ".concat(e)))},getOffsetWithContainer:function(e,t,i){if(!i)return this.getOffset(e,t);var n=this.getOffset(e,t),o=this.getOffset(Object(r.a)(i));return{top:n.top-o.top,left:n.left-o.left}},getIframeDocument:function(e){try{if(e.tagName&&"iframe"==e.tagName.toLowerCase())return e.contentWindow.console.error&&(e.contentWindow.console.error=function(){}),e.contentDocument}catch(e){return null}},DOMIterator:function(e,t,i,n){var o=this;try{var r=this.getIframeDocument(e)||e;if(!r)return;r.querySelectorAll(t).forEach((function(e){o.DOMIterator(e,t,i,n)})),i(r.querySelectorAll(n))}catch(e){}},isBrowserIE11:function(e){return-1!==e.name.indexOf("ie")&&11===e.version},forceElementRedrawWithBorderChange:function(e,t,i){if(this.isBrowserIE11(e)&&!i){var n=Object(r.a)(t);n&&n.css&&(n.css("border","1px solid transparent"),setTimeout(function(){n&&n.css&&n.css("border","none")}.bind(n)))}},hasPassedPixelFromSelector:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;if(e){var o=e.toString(),s=Object(r.a)(o),a=s;n&&(a=this.getValidSelectorElements(s));var l=a[0];if(t=Object(r.a)(t)[0],window.taboolaBridge){var c=taboolaBridge.data,d=c.boundingClientRect.top-c.rootBounds.bottom,u=d<i;return cmTag.logger.info("###hasPassedPixelsFromSelector"+u+" - "+d+"/"+i),u}var h=void 0!==t,f=h?t.clientHeight:window.innerHeight,p=h?f+t.scrollTop:f+window.pageYOffset,m=i,g=this.getTopOfEl(l),y=g-m;return y<=p}},getViewportHeight:function(e){return void 0!==(e=Object(r.a)(e)[0])?e.clientHeight:window.innerHeight},calcViewportPositionInApp:function(e){var t=window.taboolaBridge.data,i=t.boundingClientRect;return{top:i.y<0?0-i.y:0,left:0,right:i.width,bottom:i.y>t.rootBounds.height?0:Math.abs(i.y-t.rootBounds.height)}},getOrganicCard:function(){var e=TRCImpl.boxes||{};for(var t in e){var i=e[t]||{},n=i.isFeedCard,o=!1;if(i.itemsTypes&&i.itemsTypes["is-organic"]&&(o=i.itemsTypes["is-organic"]),o&&n&&i.boxes.length)return i.mode}},getRootElementFontSize:function(){return parseFloat(getComputedStyle(document.documentElement).fontSize)},convertRem:function(e){return e*this.getRootElementFontSize()},flattenArray:function(e,t){return l(e,t,!1)},offsetFromBottomOfViewPort:function(e){return e.getBoundingClientRect().top-(window.innerHeight||document.documentElement.clientHeight)},sendingEventToTaboolaBridge:function(e,t){window.taboolaBridge&&window.taboolaBridge.emit("videoEvent",{type:e,value:t})},recoReelPlayStateAnimation:function(e,t,i){var n=Object(r.a)('[data-progress-bar-index="'.concat(t,'"] .tbl-progress-runner'),e)[0],o=Object(r.a)(".videoCube_".concat(t+1,"_child .thumbBlock"),e)[0];n&&(n.style.webkitAnimationPlayState=i,n.style.animationPlayState=i),o&&(o.style.webkitAnimationPlayState=i,o.style.animationPlayState=i)},getRandomFromList:function(e){return!(e.length<1)&&e[Math.floor(Math.random()*e.length)]},isSendBeaconSupported:function(){return!(!navigator||!a.isFunction(navigator.sendBeacon))},getSubUnitType:function(e){var t=e.isSticky,i=e.isDetachBelow,n=e.isDetachAbove,r=e.isStartFromSlider,s=e.isDetachToSlider;return t||!r||s?t||r||!s?!t&&r&&s?o.a.SUB_UNIT_TYPE.SUPER_SLIDER:t&&i&&!n?o.a.SUB_UNIT_TYPE.STICKY_BELOW:t&&!i&&n?o.a.SUB_UNIT_TYPE.STICKY_ABOVE:t&&i&&n?o.a.SUB_UNIT_TYPE.STICKY_BELOW_ABOVE:void 0:o.a.SUB_UNIT_TYPE.DETACH_TO_SLIDER:o.a.SUB_UNIT_TYPE.START_FROM_SLIDER},trcPerformanceMeasurement:function(e,t,i){try{if(e&&a.isTRCPerformanceEnabled()){var n="".concat(t).concat(i);window.TRC.performance.mark(n,null,"","",t,window.TRC.PerfEvenType[i.toUpperCase()])}}catch(e){}},isTRCPerformanceEnabled:function(){return window.TRC&&window.TRC.performance&&window.TRC.performance.mark},copyCSSFromPlaceholder:function(e,t,i){if(e&&t&&i&&0!==i.length){var n=window.getComputedStyle(t),o={};a.forEach(i,(function(e){o[e]=n[e]})),e.css(o)}}})},function(e,t,i){var n=i(5);n.mixin({createVpaidLog:function(e,t){var i=null,o=e,r=e.model,s=Date.now(),a=!1,l=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vastFilterdByRegex","queExpierd","queTrimmed","tagError","tagFlashError","vpaidFlashClientError","queueTrimmed","tillAdstartTimeout","timeoutAutoKill","error_vpaidGeneralError","error_vpaidLoadError","error_vpaidLoadTimeout","error_vpaidInitAdError","error_vpaidInitAdTimeout","error_vpaidStartAdError","error_vpaidStartAdTimeout","error_vpaidPlayError","adStopped"],c={BfRon:!0};delete t.conversionPixels,t.dp=(t.lp&&t.lp.length>0?t.lp[0]:"").replace(/http:\/\/|.com|https:\/\/|.com/g,"")||"na";var d={tag:t,created:(new Date).toISOString(),dp:t.dp,status:"new",unitType:r.get("unitType"),connectionType:-1},u=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(u){var h=u.type||-1;d.connectionType=h}d.hasFetch=Boolean(window.fetch),d.url=window.location.href,screen&&(d.screen={},d.screen.Size=screen.width+"X"+screen.height||-1,d.screen.PixelDepth=screen.pixelDepth||-1,d.screen.orientation=screen.orientation?screen.orientation.type:"not-found");var f=r.get("session_started")||Date.now(),p=function(e,t){(function(){if(null!==i)return i;var e=parseInt(r.get("gaFactor"))||1e3;if(1===e)return i=!0;e>100&&(e=100),r.get("abTest")&&(e=50);var t,n=(0,t=e,Math.floor(Math.random()*(t-0+1))+0);return i=n===e})()&&function(e,t){var i=o.version,n=r.get("abTest")||"",s=new XMLHttpRequest,a=r.get("kbnul");s.open("POST",a+"/putes/mobileanalytics",!0);var l={event:e,timestamp:(new Date).toISOString(),version:i,abTest:n};l=Object.assign(l,t),s.send(JSON.stringify(l))}(e,t)},m=function(e){var t=r.get(d.dp+e)||0,i=r.get(d.tag.lineItemId+e)||0;r.set(d.dp+e,t+1),r.set(d.tag.lineItemId+e,i+1)};return{push:function(e,t){if(d){t=t||{},e.indexOf("Error")>-1||"event_SoundViolation"===e?d.status=function(e,t){return"error_"+(t.errType?t.errType:e)}(e,t):this.eventToStatus.hasOwnProperty(e)&&"conversion"!==d.status?d.status=this.eventToStatus[e]:c.hasOwnProperty(e)&&(d["is"+e]=!0);var i=Date.now()-f,n=Date.now()-s;if(t.time=n,t.globalTime=i,d.hasOwnProperty(e))return Array.isArray(!d[e])||(d[e]=[d[e]]),void d[e].push(t);d[e]=t,-1!==l.indexOf(d.status)&&function(){if(!a){var e=d.tag;a=!0,m(".tries"),"conversion"===d.status?(m(".conversions"),r.set(d.dp+".failsRow",0),r.set(e.lineItemId+".failsRow",0)):(m(".fails"),m(".failsRow"));var t=r.get(d.dp)||{fails:0,failsRow:0,conversions:0},i=Object.assign(r.get(e.lineItemId.toString()),{fails:0,failsRow:0,conversions:0});t.lineItems=t.lineItems||[],i.conversions=t.conversions=t.conversions||0,i.fails=t.fails=t.fails||0,i.failsRow=t.failsRow=t.failsRow||0,-1===t.lineItems.indexOf(e.lineItemId)&&t.lineItems.push(e.lineItemId),d.dpLog=t;var n=r.get("lineItems")||[];-1===n.indexOf(e.lineItemId)&&(n.push(e.lineItemId),r.set("lineItems",n)),r.set(e.lineItemId,i)}}()}},saveToDb:function(){if(d){var e;try{e=n.getLoopTime()}catch(e){}e&&(d.loopTime=e),p("VpaidLog",d),t=null,d=null}},eventToStatus:{event_AdImpression:"conversion",event_SoundViolation:"soundViolation",vpaidGeneralError:"vpaidGeneralError",vpaidLoadError:"vpaidLoadError",vpaidLoadTimeout:"vpaidLoadTimeoutError",vpaidInitAdError:"vpaidInitAdError",vpaidInitAdTimeout:"vpaidInitAdTimeoutError",vpaidStartAdError:"vpaidStartAdError",vpaidStartAdTimeout:"vpaidStartAdTimeoutError",vpaidPlayError:"vpaidPlayError",event_AdLoaded:"adLoaded",fetchVast:"fetchVast",adStopped:"adStopped"}}}})},function(e,t,i){var n,o,r;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=i(5),l=i(3);(function(){var e,t,i,n,o,r,s,c=[].slice;i=function(e){var t,n;return!a.isObject(e)||a.isFunction(e)||e instanceof l.Collection||e instanceof l.Model?e:a.isDate(e)?new Date(e.getTime()):a.isRegExp(e)?new RegExp(e.source,e.toString().replace(/.*\//,"")):e instanceof HTMLElement||e.nodeType&&1===e.nodeType?e:e instanceof CSSStyleDeclaration?JSON.stringify(s(e)):(n=a.isArray(e||a.isArguments(e)),t=function(e,t,o){return n?e.push(i(t)):e[o]=i(t),e},a.reduce(e,t,n?[]:{}))},s=function(e){var t=!!document.documentMode,i=!t&&!!window.StyleMedia;if(!t&&!i)return e;var n={};for(var o in e)n[o]=e[o];return n},r=function(e){return null!=e&&(e.prototype==={}.prototype||e.prototype===Object.prototype)&&a.isObject(e)&&!a.isArray(e)&&!a.isFunction(e)&&!a.isDate(e)&&!a.isRegExp(e)&&!a.isArguments(e)},t=function(e){return a.filter(a.keys(e),(function(t){return r(e[t])}))},e=function(e){return a.filter(a.keys(e),(function(t){return a.isArray(e[t])}))},o=function(i,n,r){var s,l,c,d,u,h,f,p;if(null==r&&(r=20),r<=0)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),a.extend(i,n);for(l=function(e){return n[e]=o(i[e],n[e],r-1)},u=0,f=(d=a.intersection(t(i),t(n))).length;u<f;u++)l(d[u]);for(s=function(e){return n[e]=a.union(i[e],n[e])},h=0,p=(c=a.intersection(e(i),e(n))).length;h<p;h++)s(c[h]);return a.extend(i,n)},n=function(){var e,t,n,r;if(n=2<=arguments.length?c.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],a.isNumber(t)||(n.push(t),t=20),n.length<=1)return n[0];if(t<=0)return a.extend.apply(this,n);for(e=n.shift();n.length>0;)e=o(e,i(n.shift()),t);return e},a.mixin({deepClone:i,isBasicObject:r,basicObjects:t,arrays:e,deepExtend:n})}).call(this),o=[i(5),i(3)],void 0===(r="function"==typeof(n=function(t,i){function n(e){var i={},o=d.keyPathSeparator;for(var r in e){var s=e[r];if(s&&s.constructor===Object&&!t.isEmpty(s)){var a=n(s);for(var l in a){var c=a[l];i[r+o+l]=c}}else i[r]=s}return i}function o(e,i,n){for(var o=d.keyPathSeparator,r=i.split(o),s=e,a=0,l=r.length;a<l;a++){if(n&&!t.has(s,r[a]))return!1;if(null==(s=s[r[a]])&&a<l-1&&(s={}),void 0===s)return!!n||s}return!!n||s}function r(e,i,n,o){o=o||{};for(var r=d.keyPathSeparator,s=i.split(r),a=e,l=0,c=s.length;l<c&&void 0!==a;l++){var u=s[l];l===c-1?o.unset?delete a[u]:a[u]=n:(void 0!==a[u]&&t.isObject(a[u])||(a[u]={}),a=a[u])}}function a(e){var i={};return"object"!==s(e)?e:(t.each(e,(function(e,t,n){i[t]=l(e)})),i)}function l(e){if(e&&"["===e[0]&&"]"===e[e.length-1]){var i;try{i=JSON.parse(e)}catch(t){i=e}e=i}if(t.isArray(e)){var n=[];return t.each(e,(function(e){n.push(l(e))})),n}return"object"!==s(e)||t.isElement(e)?"true"===e||!0===e||"false"!==e&&!1!==e&&(""===e||isNaN(e)?e:Number(e)):a(e)}function c(e,t){r(e,t,null,{unset:!0})}var d=i.Model.extend({constructor:function(e,i){var n,o=e||{};this.cid=t.uniqueId("c"),this.attributes={},i&&i.collection&&(this.collection=i.collection),i&&i.parse&&(o=this.parse(o,i)||{}),(n=t.result(this,"defaults"))&&(o=t.deepExtend({},n,o)),this.set(o,i),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(e){return t.deepClone(this.attributes)},get:function(e){return o(this.attributes,e)},set:function(e,i,l){var u,h,f,p,m,g,y,v;if(null==e)return this;if("object"===s(e)?(h=e,l=i||{}):(h={})[e]=i,h=a(h),l||(l={}),!this._validate(h,l))return!1;for(u in f=l.unset,m=l.silent,p=[],g=this._changing,this._changing=!0,g||(this._previousAttributes=t.deepClone(this.attributes),this.changed={}),v=this.attributes,y=this._previousAttributes,this.idAttribute in h&&(this.id=h[this.idAttribute]),h=n(h))i=h[u],t.isEqual(o(v,u),i)||p.push(u),t.isEqual(o(y,u),i)?c(this.changed,u):r(this.changed,u,i),f?c(v,u):r(v,u,i);if(!m){p.length&&(this._pending=!0);for(var b=d.keyPathSeparator,_=0,S=p.length;_<S;_++){e=p[_],this.trigger("change:"+e,this,o(v,e),l);for(var w=e.split(b),A=w.length-1;A>0;A--){var T=t.first(w,A).join(b),P=T+b+"*";this.trigger("change:"+P,this,o(v,T),l),this.trigger("change:"+T,this,o(v,e),l)}}}if(g)return this;if(!m)for(;this._pending;)this._pending=!1,this.trigger("change",this,l);return this._pending=!1,this._changing=!1,this},clear:function(e){var i={},o=n(this.attributes);for(var r in o)i[r]=void 0;return this.set(i,t.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!t.isEmpty(this.changed):void 0!==o(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n(this.changed);var i=this._changing?this._previousAttributes:this.attributes;e=n(e),i=n(i);var o,r=!1;for(var s in e)t.isEqual(i[s],o=e[s])||((r||(r={}))[s]=o);return r},previous:function(e){return null!=e&&this._previousAttributes?o(this._previousAttributes,e):null},previousAttributes:function(){return t.deepClone(this._previousAttributes)}});return d.keyPathSeparator=".",i.DeepModel=d,e.exports=d,i})?n.apply(t,o):n)||(e.exports=r)},function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=i(5),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,(i=[{key:"addUnit",value:function(e,t){o.isEmpty(window.TRC.videoUnitList)&&(window.TRC.videoUnitList={}),this.unitsList=window.TRC.videoUnitList||{},this.unitsList[e]=t,window.TRC.videoUnitList=this.unitsList,this._listenUnitsEvents(e)}},{key:"_listenUnitsEvents",value:function(e){this.unitsList[e].on("change:isUnitEligible",this._onUnitEligibilityChange.bind(this,e))}},{key:"_onUnitEligibilityChange",value:function(e,t,i){o.size(this.unitsList)>1&&(!0===i||!1===i)&&this._decidePlayOrPause()}},{key:"_decidePlayOrPause",value:function(){var e=this,t=[];o.each(this.unitsList,(function(i){var n=i.get("redId"),o="CUSTOM"==e._getUnitType(n);e._isUnitEligibleToPlay(n)?t.push({redId:n,viewPercent:i.get("unitViewablePercent"),isCustomVideo:o}):o&&e._pauseUnit(n)})),t.length>0&&(t=this._sortViewableUnits(t),o.each(t,(function(t,i){0===i?e._playUnit(t.redId):t.isCustomVideo&&e._pauseUnit(t.redId)})))}},{key:"_sortViewableUnits",value:function(e){return e.sort((function(e,t){return e.isCustomVideo===t.isCustomVideo?t.viewPercent-e.viewPercent:!e.isCustomVideo&&t.isCustomVideo?-1:1}))}},{key:"_pauseUnit",value:function(e){this.unitsList[e].set("multiUnitManager.state","pause")}},{key:"_playUnit",value:function(e){this.unitsList[e].set("multiUnitManager.state","play")}},{key:"_isUnitEligibleToPlay",value:function(e){return this.unitsList[e].get("isEligibleToPlay")||this.unitsList[e].get("isUnitEligible")||this.unitsList[e].get("isUnitViewable")}},{key:"_isUnitAllowToPlay",value:function(e){return"pause"!=this.unitsList[e].get("multiUnitManager.state")&&this._isUnitEligibleToPlay(e)}},{key:"_isUnitPlaying",value:function(e){return this.unitsList[e].get("generalPlayingUnitState")}},{key:"_getUnitType",value:function(e){return this.unitsList[e].get("unitType")}}])&&n(t.prototype,i),e}();cmTag.multiUnitManager=cmTag.multiUnitManager||new r,e.exports=cmTag.multiUnitManager},function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=i(3),r=i(5),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callBacks={},this._mapCallbackNames(),this._setCallbacks(t)}var t,i;return t=e,(i=[{key:"_setCallbacks",value:function(e){this.isValidCallback(e,this.callbackNames.conversion)&&(this.callBacks.onConversion=e.onConversion,o.on("global:creativeEvent",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.conversion))),this.isValidCallback(e,this.callbackNames.fill)&&(this.callBacks.onFilledImpression=e.onFilledImpression,o.on("filledImpression",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.fill))),this.isValidCallback(e,this.callbackNames.impression)&&(this.callBacks.onImpression=e.onImpression,o.on("onImpression",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.impression))),this.isValidCallback(e,this.callbackNames.play)&&(this.callBacks.onPlay=e.onPlay,o.on("global:adState:playing",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.play))),this.isValidCallback(e,this.callbackNames.terminate)&&(this.callBacks.onTerminate=e.onTerminate,o.once("global:closeState:changed",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.terminate))),this.isValidCallback(e,this.callbackNames.passback)&&(this.callBacks.onPassback=e.onPassback,o.once("global:passback",this._onGlobalCreativeEvent.bind(this,e,this.callbackNames.passback)))}},{key:"_onGlobalCreativeEvent",value:function(e,t,i){t=t||{},this.callBacks[t.type]&&this.callBacks[t.type](i),t.name&&TRC&&TRC.dispatch&&TRC.dispatch("api::video."+t.name,e)}},{key:"isValidCallback",value:function(e,t){if("string"==typeof e[t.type]){var i=this._getCallbackFunction(e[t.type]),n=new Function("additionalData",i);delete e[t.type],Object.defineProperty(e,t.type,{value:n})}return!(!r.isFunction(e[t.type])&&!this._isApiCallbackExist(t.name))}},{key:"_getCallbackFunction",value:function(e){var t=e.substr(e.indexOf("{")+1);return t.substr(0,t.lastIndexOf("}"))}},{key:"_isApiCallbackExist",value:function(e){if(TRC&&TRC._taboolaClone)for(var t=0;t<TRC._taboolaClone.length;t++)if(TRC._taboolaClone[t].listenTo=="video."+e)return!0;return!1}},{key:"_mapCallbackNames",value:function(){this.callbackNames={conversion:{type:"onConversion",name:"conversion"},fill:{type:"onFilledImpression",name:"fill"},impression:{type:"onImpression",name:"impression"},play:{type:"onPlay",name:"play"},terminate:{type:"onTerminate",name:"terminate"},passback:{type:"onPassback",name:"passback"}}}}])&&n(t.prototype,i),e}();e.exports=s},function(e,t,i){e.exports={beforeCMTag:i(72)}},function(e,t,i){var n=i(5),o=i(1),r=i(73),s=i(74);e.exports=function(e){n.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoBeforeCMTagNativeCode",o.TRC_PERFORMANCE_ACTIONS.START),r.set("Function","bind"),r.set("Event","constructor",!0),r.set("Array","forEach",!1),r.set("Array","every",!1),r.setWindowFunctions(e.nativeFunctions),n.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoBeforeCMTagNativeCode",o.TRC_PERFORMANCE_ACTIONS.STOP),new s,window.cmTag.customDataForTest={startWithABT:!1},e.gaFactor&&n.isFactor(parseInt(e.gaFactor))&&window.addEventListener("error",(function(t){try{if(-1==t.filename.indexOf("infra/cmTag"))return;var i={timestamp:(new Date).toISOString(),message:t.message,lineNum:t.lineno,fullUrl:window.location.href,userAgent:window.navigator.userAgent,firedStartWithABT:window.cmTag.customDataForTest.startWithABT,unitType:e.unitType};t.error&&(i.callStack=t.error.stack);var n=new XMLHttpRequest;n.open("POST","//vidanalytics.taboola.com/putes/cm_units_error_logs",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded");var o=JSON.stringify(i);n.send(o)}catch(t){}}))}},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=null,o=function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},r=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n||(n=this),n}var t,r;return t=e,(r=[{key:"set",value:function(e,t,i){o(window[e])&&o(window[e].prototype[t])||(this.iframe||this.createIframe(),this.iframe.contentWindow[e].prototype[t]&&(window[e].prototype||(window[e]=function(){}),window[e].prototype[t]=this.iframe.contentWindow[e].prototype[t],i&&(window[e]=this.iframe.contentWindow[e])))}},{key:"setWindowFunctions",value:function(e){e&&(this.iframe||this.createIframe(),e.split(",").forEach(function(e){var t=e.split(".");this.setWindowNestedFunctions(window,t)}.bind(this)))}},{key:"createIframe",value:function(){this.iframe=document.createElement("iframe"),this.iframe.style.width=0,this.iframe.style.height=0,this.iframe.style.visibility="hidden",this.iframe.style.display="none",document.body.appendChild(this.iframe)}},{key:"setWindowNestedFunctions",value:function(e,t){var i=t.shift();0==t.length?e[i]=this.iframe.contentWindow[i]:this.setWindowNestedFunctions(e[i],t)}}])&&i(t.prototype,r),e}();e.exports=new r},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.arrayFrom()}var t,n;return t=e,(n=[{key:"arrayFrom",value:function(){var e,t,i,n;Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},i=Math.pow(2,53)-1,n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),i)},function(e){var i=this,o=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!t(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}for(var a,l=n(o.length),c=t(i)?Object(new i(l)):new Array(l),d=0;d<l;)a=o[d],c[d]=s?void 0===r?s(a,d):s.call(r,a,d):a,d+=1;return c.length=l,c}))}}])&&i(t.prototype,n),e}();e.exports=n},function(e,t,i){var n={"./AdTypeConfig":9,"./AdTypeConfig.js":9,"./AdTypeTranslator":20,"./AdTypeTranslator.js":20,"./Adjacency/DefaultAdjacencyConfig":30,"./Adjacency/DefaultAdjacencyConfig.js":30,"./Adjacency/units/AdjacFeedManagerConfig":31,"./Adjacency/units/AdjacFeedManagerConfig.js":31,"./Adjacency/units/AdjacencyRecoReelWidgetConfig":32,"./Adjacency/units/AdjacencyRecoReelWidgetConfig.js":32,"./Adjacency/units/AdjacencyWidgetItemConfig":33,"./Adjacency/units/AdjacencyWidgetItemConfig.js":33,"./Replayable/DefaultReplayableConfig":34,"./Replayable/DefaultReplayableConfig.js":34,"./Replayable/units/ReplayableAdFeedManagerConfig":35,"./Replayable/units/ReplayableAdFeedManagerConfig.js":35,"./Replayable/units/ReplayableAdInlineConfig":36,"./Replayable/units/ReplayableAdInlineConfig.js":36,"./Replayable/units/ReplayableAdWidgetItemConfig":37,"./Replayable/units/ReplayableAdWidgetItemConfig.js":37,"./SingleAd/DefaultSingleAdConfig":38,"./SingleAd/DefaultSingleAdConfig.js":38,"./SingleAd/units/SingleAdFeedManagerConfig":39,"./SingleAd/units/SingleAdFeedManagerConfig.js":39,"./SingleAd/units/SingleAdInlineConfig":40,"./SingleAd/units/SingleAdInlineConfig.js":40,"./SingleAd/units/SingleAdSliderConfig":41,"./SingleAd/units/SingleAdSliderConfig.js":41,"./SingleAd/units/SingleAdWidgetItemConfig":42,"./SingleAd/units/SingleAdWidgetItemConfig.js":42};function o(e){var t=r(e);return i(t)}function r(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=75},function(e,t,i){var n={};n.demo=i(77),n.level=i(78),n.isFireAllPixels=i(79),n.predictorsPresets=i(80),n.isDebug=i(81),e.exports=n},function(e,t){e.exports={strength:101,atr:{},1:{atr:{originId:15,"preroll.pubId":133128,"preroll.pubTagId":779408,"midroll.pubId":133128,"midroll.pubTagId":779408,"postroll.pubId":133128,"postroll.pubTagId":779408,pubId:133128,pubTagId:779408,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1,mntmbtwfs:999,mintimwf:999e3,mxtmbtwfs:999,time_between_waterfall:999}},onOutOfView:"pause",isPWOV:!1,noaop:1}},2:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":779408,"midroll.pubId":133128,"midroll.pubTagId":779408,"postroll.pubId":133128,"postroll.pubTagId":779408,pubId:133128,pubTagId:779408,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause"}},3:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":1184655,"midroll.pubId":133128,"midroll.pubTagId":1184655,"postroll.pubId":133128,"postroll.pubTagId":1184655,pubId:133128,pubTagId:1184655,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},isPWOV:!1}},4:{atr:{isDebug:!0,originId:15,"preroll.pubId":133128,"preroll.pubTagId":1046821,"midroll.pubId":133128,"midroll.pubTagId":1046821,"postroll.pubId":133128,"postroll.pubTagId":1046821,pubId:133128,pubTagId:1046821,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause"}},5:{atr:{originId:15,"preroll.pubId":133128,"preroll.pubTagId":1633025,"midroll.pubId":133128,"midroll.pubTagId":1633025,"postroll.pubId":133128,"postroll.pubTagId":1633025,pubId:133128,pubTagId:1633025,player:{settings:{mprdct:0,cmbopps:!1,encwfrs:!1}},onOutOfView:"pause",isPWOV:!1}}}},function(e,t){var i={atr:{},platform:{Desktop:{atr:{}},Mobile:{atr:{secondsBW:20}}}},n={strength:1,atr:{},101:{atr:{pubId:165757,pubTagId:946347,preroll:{pubId:165757,pubTagId:946347},midroll:{pubId:165757,pubTagId:946347},postroll:{pubId:165757,pubTagId:946347}}},2:{atr:{secondsToClose:120,secondsBW:20}},3:{atr:{secondsToClose:120,pubId:208401,pubTagId:1047981,preroll:{pubId:208401,pubTagId:1047981},midroll:{pubId:208401,pubTagId:1047981},postroll:{pubId:208401,pubTagId:1047981}},units:{FEED_MANAGER:i,INLINE_INSTREAM_OLD:i,INLINE_INSTREAM_VFORCE:i,SLIDER_INSTREAM:i,SLIDER_OUTSTREAM:i,WIDGET_ITEM:i}},4:{atr:{pubId:292045,pubTagId:1565025,preroll:{pubId:292045,pubTagId:1565025},midroll:{pubId:292045,pubTagId:1565025},postroll:{pubId:292045,pubTagId:1565025}}},5:{atr:{pubId:383725,pubTagId:2077655,preroll:{pubId:383725,pubTagId:2077655},midroll:{pubId:383725,pubTagId:2077655},postroll:{pubId:383725,pubTagId:2077655}}}};e.exports=n},function(e,t){e.exports={strength:101,atr:{},1:{atr:{pixels:{startWithABT:{isFire:!0},getAdAny:{isFire:!0},getAdNoRV:{isFire:!0},getAd:{isFire:!0},secondsToCloseTimer:{isFire:!0},secondsToCloseGlobalTimer:{isFire:!0},midrollCollapseTimer:{isFire:!0}}}},2:{atr:{pixels:{getAdAny:{isFire:!0},getAdNoRV:{isFire:!0},getAd:{isFire:!0}}}}}},function(e,t){e.exports={strength:101,1:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}}}}},2:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q0"}}},playerReady:{isActive:!1},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}},firstScroll:{isActive:!0,predictPoints:[0,0]}}}},3:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q0"}}},playerReady:{isActive:!0,predictPoint:"any"},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},4:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:"any"},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},5:{atr:{predictors:{multiAd:{isActive:!1},playerReady:{isActive:!0,predictPoint:"any"},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},99:{atr:{predictors:{autoKill:{isActive:!1},getAdFail:{isActive:!1},multiAd:{isActive:!1},loading:{isActive:!1},repeat:{isActive:!1},playerReady:{isActive:!1},distancePercent:{isActive:!1},distancePixels:{isActive:!1},firstScroll:{isActive:!1}}}},101:{atr:{predictors:{multiAd:{isActive:!0,predictPoints:{any:{qState:"q1"}}},playerReady:{isActive:!0,predictPoint:0},distancePixels:{isActive:!0,predictPoints:{1:{pixelsFromSelectors:10}}}}}}}},function(e,t){e.exports={strength:102,1:{atr:{player:{settings:{encwfrs:!1}}}}}},function(e,t,i){"use strict";(function(t){function i(e){return e instanceof t||e instanceof Date||e instanceof RegExp}function n(e){if(e instanceof t){var i=t.alloc?t.alloc(e.length):new t(e.length);return e.copy(i),i}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);throw new Error("Unexpected situation")}function o(e){var t=[];return e.forEach((function(e,r){"object"==typeof e&&null!==e?Array.isArray(e)?t[r]=o(e):i(e)?t[r]=n(e):t[r]=s({},e):t[r]=e})),t}function r(e,t){return"__proto__"===t?void 0:e[t]}var s=e.exports=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var e,t,a=arguments[0],l=Array.prototype.slice.call(arguments,1);return l.forEach((function(l){"object"!=typeof l||null===l||Array.isArray(l)||Object.keys(l).forEach((function(c){return t=r(a,c),(e=r(l,c))===a?void 0:"object"!=typeof e||null===e?void(a[c]=e):Array.isArray(e)?void(a[c]=o(e)):i(e)?void(a[c]=n(e)):"object"!=typeof t||null===t||Array.isArray(t)?void(a[c]=s({},e)):void(a[c]=s(t,e))}))})),a}}).call(this,i(83).Buffer)},function(e,t,i){"use strict";(function(e){var n=i(84),o=i(85),r=i(86);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return c(this,e,t,i)}function c(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t),e}(e,t,i,n):"string"==typeof t?function(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,i),o=(e=a(e,n)).write(t,i);return o!==n&&(e=e.slice(0,o)),e}(e,t,i):function(e,t){if(l.isBuffer(t)){var i=0|f(t.length);return 0===(e=a(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):h(e,t);if("Buffer"===t.type&&r(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(d(t),e=a(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function h(e,t){var i=t.length<0?0:0|f(t.length);e=a(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return W(e).length;default:if(n)return U(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,i);case"utf8":case"utf-8":return C(this,t,i);case"ascii":return k(this,t,i);case"latin1":case"binary":return O(this,t,i);case"base64":return P(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function y(e,t,i,n,o){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=o?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(o)return-1;i=e.length-1}else if(i<0){if(!o)return-1;i=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:v(e,t,i,n,o);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):v(e,[t],i,n,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,i,n,o){var r,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var d=-1;for(r=i;r<a;r++)if(c(e,r)===c(t,-1===d?0:r-d)){if(-1===d&&(d=r),r-d+1===l)return d*s}else-1!==d&&(r-=r-d),d=-1}else for(i+l>a&&(i=a-l),r=i;r>=0;r--){for(var u=!0,h=0;h<l;h++)if(c(e,r+h)!==c(t,h)){u=!1;break}if(u)return r}return-1}function b(e,t,i,n){i=Number(i)||0;var o=e.length-i;n?(n=Number(n))>o&&(n=o):n=o;var r=t.length;if(r%2!=0)throw new TypeError("Invalid hex string");n>r/2&&(n=r/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[i+s]=a}return s}function _(e,t,i,n){return H(U(t,e.length-i),e,i,n)}function S(e,t,i,n){return H(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function w(e,t,i,n){return S(e,t,i,n)}function A(e,t,i,n){return H(W(t),e,i,n)}function T(e,t,i,n){return H(function(e,t){for(var i,n,o,r=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(i=e.charCodeAt(s))>>8,o=i%256,r.push(o),r.push(n);return r}(t,e.length-i),e,i,n)}function P(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function C(e,t,i){i=Math.min(e.length,i);for(var n=[],o=t;o<i;){var r,s,a,l,c=e[o],d=null,u=c>239?4:c>223?3:c>191?2:1;if(o+u<=i)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(r=e[o+1]))&&(l=(31&c)<<6|63&r)>127&&(d=l);break;case 3:r=e[o+1],s=e[o+2],128==(192&r)&&128==(192&s)&&(l=(15&c)<<12|(63&r)<<6|63&s)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:r=e[o+1],s=e[o+2],a=e[o+3],128==(192&r)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&r)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(d=l)}null===d?(d=65533,u=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),o+=u}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);for(var i="",n=0;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=E));return i}(n)}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,i){return c(null,e,t,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,i){return function(e,t,i,n){return d(t),t<=0?a(e,t):void 0!==i?"string"==typeof n?a(e,t).fill(i,n):a(e,t).fill(i):a(e,t)}(null,e,t,i)},l.allocUnsafe=function(e){return u(null,e)},l.allocUnsafeSlow=function(e){return u(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,o=0,r=Math.min(i,n);o<r;++o)if(e[o]!==t[o]){i=e[o],n=t[o];break}return i<n?-1:n<i?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!r(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=l.allocUnsafe(t),o=0;for(i=0;i<e.length;++i){var s=e[i];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,o),o+=s.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,i,n,o){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||i>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=i)return 0;if(n>=o)return-1;if(t>=i)return 1;if(this===e)return 0;for(var r=(o>>>=0)-(n>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(r,s),c=this.slice(n,o),d=e.slice(t,i),u=0;u<a;++u)if(c[u]!==d[u]){r=c[u],s=d[u];break}return r<s?-1:s<r?1:0},l.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},l.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},l.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},l.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var o=this.length-t;if((void 0===i||i>o)&&(i=o),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return _(this,e,t,i);case"ascii":return S(this,e,t,i);case"latin1":case"binary":return w(this,e,t,i);case"base64":return A(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,i);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function k(e,t,i){var n="";i=Math.min(e.length,i);for(var o=t;o<i;++o)n+=String.fromCharCode(127&e[o]);return n}function O(e,t,i){var n="";i=Math.min(e.length,i);for(var o=t;o<i;++o)n+=String.fromCharCode(e[o]);return n}function I(e,t,i){var n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var o="",r=t;r<i;++r)o+=j(e[r]);return o}function V(e,t,i){for(var n=e.slice(t,i),o="",r=0;r<n.length;r+=2)o+=String.fromCharCode(n[r]+256*n[r+1]);return o}function D(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,i,n,o,r){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<r)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function x(e,t,i,n){t<0&&(t=65535+t+1);for(var o=0,r=Math.min(e.length-i,2);o<r;++o)e[i+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function N(e,t,i,n){t<0&&(t=4294967295+t+1);for(var o=0,r=Math.min(e.length-i,4);o<r;++o)e[i+o]=t>>>8*(n?o:3-o)&255}function M(e,t,i,n,o,r){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function F(e,t,i,n,r){return r||M(e,0,i,4),o.write(e,t,i,n,23,4),i+4}function L(e,t,i,n,r){return r||M(e,0,i,8),o.write(e,t,i,n,52,8),i+8}l.prototype.slice=function(e,t){var i,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=l.prototype;else{var o=t-e;i=new l(o,void 0);for(var r=0;r<o;++r)i[r]=this[r+e]}return i},l.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||D(e,t,this.length);for(var n=this[e],o=1,r=0;++r<t&&(o*=256);)n+=this[e+r]*o;return n},l.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||D(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},l.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||D(e,t,this.length);for(var n=this[e],o=1,r=0;++r<t&&(o*=256);)n+=this[e+r]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||D(e,t,this.length);for(var n=t,o=1,r=this[e+--n];n>0&&(o*=256);)r+=this[e+--n]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,i,n){e=+e,t|=0,i|=0,n||R(this,e,t,i,Math.pow(2,8*i)-1,0);var o=1,r=0;for(this[t]=255&e;++r<i&&(o*=256);)this[t+r]=e/o&255;return t+i},l.prototype.writeUIntBE=function(e,t,i,n){e=+e,t|=0,i|=0,n||R(this,e,t,i,Math.pow(2,8*i)-1,0);var o=i-1,r=1;for(this[t+o]=255&e;--o>=0&&(r*=256);)this[t+o]=e/r&255;return t+i},l.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*i-1);R(this,e,t,i,o-1,-o)}var r=0,s=1,a=0;for(this[t]=255&e;++r<i&&(s*=256);)e<0&&0===a&&0!==this[t+r-1]&&(a=1),this[t+r]=(e/s>>0)-a&255;return t+i},l.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*i-1);R(this,e,t,i,o-1,-o)}var r=i-1,s=1,a=0;for(this[t+r]=255&e;--r>=0&&(s*=256);)e<0&&0===a&&0!==this[t+r+1]&&(a=1),this[t+r]=(e/s>>0)-a&255;return t+i},l.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,i){return F(this,e,t,!0,i)},l.prototype.writeFloatBE=function(e,t,i){return F(this,e,t,!1,i)},l.prototype.writeDoubleLE=function(e,t,i){return L(this,e,t,!0,i)},l.prototype.writeDoubleBE=function(e,t,i){return L(this,e,t,!1,i)},l.prototype.copy=function(e,t,i,n){if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var o,r=n-i;if(this===e&&i<t&&t<n)for(o=r-1;o>=0;--o)e[o+t]=this[o+i];else if(r<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<r;++o)e[o+t]=this[o+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+r),t);return r},l.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var r;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(r=t;r<i;++r)this[r]=e;else{var s=l.isBuffer(e)?e:U(new l(e,n).toString()),a=s.length;for(r=0;r<i-t;++r)this[r+t]=s[r%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var i;t=t||1/0;for(var n=e.length,o=null,r=[],s=0;s<n;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!o){if(i>56319){(t-=3)>-1&&r.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&r.push(239,191,189);continue}o=i;continue}if(i<56320){(t-=3)>-1&&r.push(239,191,189),o=i;continue}i=65536+(o-55296<<10|i-56320)}else o&&(t-=3)>-1&&r.push(239,191,189);if(o=null,i<128){if((t-=1)<0)break;r.push(i)}else if(i<2048){if((t-=2)<0)break;r.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;r.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return r}function W(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,i,n){for(var o=0;o<n&&!(o+i>=t.length||o>=e.length);++o)t[o+i]=e[o];return o}}).call(this,i(29))},function(e,t,i){"use strict";t.byteLength=function(e){var t=c(e),i=t[0],n=t[1];return 3*(i+n)/4-n},t.toByteArray=function(e){var t,i,n=c(e),s=n[0],a=n[1],l=new r(function(e,t,i){return 3*(t+i)/4-i}(0,s,a)),d=0,u=a>0?s-4:s;for(i=0;i<u;i+=4)t=o[e.charCodeAt(i)]<<18|o[e.charCodeAt(i+1)]<<12|o[e.charCodeAt(i+2)]<<6|o[e.charCodeAt(i+3)],l[d++]=t>>16&255,l[d++]=t>>8&255,l[d++]=255&t;return 2===a&&(t=o[e.charCodeAt(i)]<<2|o[e.charCodeAt(i+1)]>>4,l[d++]=255&t),1===a&&(t=o[e.charCodeAt(i)]<<10|o[e.charCodeAt(i+1)]<<4|o[e.charCodeAt(i+2)]>>2,l[d++]=t>>8&255,l[d++]=255&t),l},t.fromByteArray=function(e){for(var t,i=e.length,o=i%3,r=[],s=16383,a=0,l=i-o;a<l;a+=s)r.push(d(e,a,a+s>l?l:a+s));return 1===o?(t=e[i-1],r.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[i-2]<<8)+e[i-1],r.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),r.join("")};for(var n=[],o=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)n[a]=s[a],o[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function d(e,t,i){for(var o,r,s=[],a=t;a<i;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(r=o)>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,n,o){var r,s,a=8*o-n-1,l=(1<<a)-1,c=l>>1,d=-7,u=i?o-1:0,h=i?-1:1,f=e[t+u];for(u+=h,r=f&(1<<-d)-1,f>>=-d,d+=a;d>0;r=256*r+e[t+u],u+=h,d-=8);for(s=r&(1<<-d)-1,r>>=-d,d+=n;d>0;s=256*s+e[t+u],u+=h,d-=8);if(0===r)r=1-c;else{if(r===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),r-=c}return(f?-1:1)*s*Math.pow(2,r-n)},t.write=function(e,t,i,n,o,r){var s,a,l,c=8*r-o-1,d=(1<<c)-1,u=d>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:r-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+u>=1?h/l:h*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=d?(a=0,s=d):s+u>=1?(a=(t*l-1)*Math.pow(2,o),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,o),s=0));o>=8;e[i+f]=255&a,f+=p,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[i+f]=255&s,f+=p,s/=256,c-=8);e[i+f-p]|=128*m}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t){e.exports='<div class="_cm-panel-heading">\n    <strong>\n        <span>Taboola Video Support</span>\n    </strong>\n    <strong class="_cm-close-button">x</strong>\n</div>\n\n<div class="_cm-panel-body">\n    <div class="_cm-panel-header">Use this form to report an issue with Taboola Video. </div>\n    <div class="_cm-panel-row">\n        <label>Name:</label>\n        <input type="text" class="_cm-panel-name">\n    </div>\n    <div class="_cm-panel-row">\n        <label>Email:</label>\n        <input type="email" class="_cm-panel-email">\n    </div>\n    <div class="_cm-panel-row">\n        <label>Details:</label>\n        <textarea  class="_cm-panel-details"></textarea>\n    </div>\n    <div class="_cm-panel-row">\n       <input type="button" class="_cm-panel-submit" value="Send">\n    </div>\n\n    <div class="_cm-panel-notifications">\n        <div class="_cm-panel-notifications-sending">Sending message, please wait. </div>\n        <div class="_cm-panel-notifications-success">Thank you! Your message has been successfully sent. </div>\n        <div class="_cm-panel-notifications-error">Error - Something went wrong... Your message was not sent.  </div>\n    </div>\n</div>'},function(e,t,i){"use strict";i.r(t);var n=i(16),o=i(0),r=(i(3),i(5));t.default=n.a.extend({defaults:o.a.extend(!0,{},n.a.prototype.defaults,{animation:{onTransitionOpen:!1,onTransitionClose:!1,transitionAnimationTime:500,detach:500,firstDetach:1e3,slideOut:500,attach:500},organicCardPlacementName:"Organic card below video",onTimerClose:"close",openingEffect:1,bfFactor:0,noaop:2,wfDynamicPause:!1,wfManual:!0,runWfWhenEmpty:!0,viewPercent:20,allowedHeightChange:75,isMultiActiveAds:!0,parentSelector:".tbl-feed-container:not(.tbl-feedx-container)",isObserveFeedParent:!1,feedCardSelector:"[data-card-index]",isOpenInViewPort:!0,isOpenFloatingViewInViewPort:!0,isOpenMP4OutOfViewPort:!0,kibanaEventsToSend:"all",predictors:{autoKill:{isActive:!0},getAdFail:{isActive:!0},multiAd:{isActive:!0,predictPoints:{}},loading:{isActive:!0,predictPoints:"any"},repeat:{isActive:!0,predictPoints:"any"},playerReady:{isActive:!0,predictPoint:0},distancePercent:{isActive:!1,predictPoints:{}},distancePixels:{isActive:!1,predictPoints:{}}},playPriority:{type:"ppKey",key:1},vForce:{isActive:!0,getAdTimeoutSeconds:60},components:{disclosureText:{text:"ADVERTISEMENT"},CloseButtonView:{delay:3e3},adChoice:{isActive:!0,fallbackUrl:"https://popup.taboola.com/en",icon:"http://cdn.taboola.com/static/c5/c5ef96bc-30ab-456a-b3d5-a84f367c6a46.svg",position:"above",title:{isActive:!1,text:"Sponsored Video by Taboola",style:{},logoStyle:{},adViewStyle:{}},videoAd:{isActive:!1,text:"Ad",style:{},logoStyle:{}},slider:{isActive:!0,text:"Ad",style:{},logoStyle:{}}},volume:{isActive:!1,expandedText:"Unmute",timeToMinimize:2e3,style:{border:{},mute:{},unmute:{},text:{}}}},hasCloseButton:!1,detachToSlider:{isStartFromSlider:!1,isDetachToSlider:!1,isDetachAbove:!1,isDetachBelow:!0,width:250,height:250,position:{horizontal:"right",vertical:"bottom",horizontalOffset:0,verticalOffset:0},liquidSize:{isActive:!1,widthPercent:33,minWidth:200,heightPercent:30,maxHeight:350},customCss:null,animation:!0,hasCloseButton:!0,onOutOfView:"pause",isCheckForFirstOnPage:!0,isCheckForTopCard:!0,components:{disclosureText:{text:"ADVERTISEMENT"}},forceDetach:{isActive:!1,restrictions:{rv:!0}},amp:{timeoutDebounce:150,timeoutThrottle:2e3,detachAnimationTime:1e3,correctionAnimationTime:150,animationStyle:"cubic-bezier(0,.59,.72,1)"}},category:"blankblack5",isMultiAd:!0,pubId:198827,pubTagId:1020237,preroll:{pubId:198827,pubTagId:1020237},midroll:{pubId:198827,pubTagId:1020237},postroll:{pubId:198827,pubTagId:1020237},secondsToClose:200,secondsToCloseFeed:20,contentTimerSeconds:20,isMobile:!1,onOutOfView:"pause",unitTitle:"",vertical:"_#VERTICAL#_",player:{hasControls:!1,urls:{blankLocation:"{{player.urls.contentVideosLocation}}/blackScreen5.mp4"},bfFactor:0,settings:{vakll:24e4,time_between_waterfall:1,mintimwf:1e4,bfFactor:0,ad_loaded_method:!0,wf_manual:!1,wf_dynmc_ps:!1,vforce2:"vforce2",isMultiVpaidUnit:!0,mprdct:.015}},maxVideoCards:100,verticalWidthThreshold:350,isFireSP:{32:!0},minTopForVideo:10,minLeftForVideo:10,isPlayerOutOfViewport:!1,isToggleIframeContent:!1,cardEligibilityPercent:50,continueToPlayInNexCard:{isActive:!0},stickyCard:{isActive:!0,detachFromTopDistance:0,attachPercent:98,offset:{top:0,left:0},observerThreshold:[.01,.99],maxAspectRatio:.8,restrictions:{isFirstCardOnly:!1,maxWidth:800,rv:!0,adPercent:{percent:30,secondsToClose:3,keepUntilScroll:!0}}},feedCardElig:{isActive:!1,thresholdJump:.01,intersections:{topCard:-1,topCardIntersection:0,bottomCard:-1,bottomCardIntersection:0}}}),initialize:function(){if(n.a.prototype.initialize.call(this),this.loadContent(),window.TRC&&!0===window.TRC.isAMP&&(this.set("isPlayerOutOfViewport",!1),this.set("feedCardElig.isActive",!0),this.set("stickyCard.restrictions.adPercent.percent",.1)),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider"))&&this.set("stickyCard.isActive",!1),this.get("detachToSlider.isStartFromSlider")&&this.set("isRvPriority",!1),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider")||this.get("permanentCard"))&&this.set("getCardMaxPPS",void 0),this.get("isCheckInAppPlayerSize")){var e=Object(o.a)(this.get("parentSelector")).width();this.set("width",e),this.set("height",r.getVideoHeight(e))}this.get("stickyCard.isActive")&&this._setStickyCardParams()},loadContent:function(){"mrss"===this.get("contentLoadType")?o.a.ajax({url:this.get("player.urls.contentLocation"),dataType:"xml",success:this._onMrssLoad.bind(this)}):"direct"===this.get("contentLoadType")?this.set("player.playlist",[{id:0,title:"",link:"",url:this.get("player.urls.contentLocation")||this.get("pVideoUrl"),type:"video/mp4",image:""}]):(window.category=this.get("category"),r.loadJs(this.get("player.urls.contentLocation"),this._onContentLoad.bind(this)))},_onMrssLoad:function(e){var t=[];Object(o.a)(e).find("item").each((function(e,i){i=Object(o.a)(i);var n={};n.id=e,n.title=i.find("title").text(),n.link=i.find("link").text(),n.url=i.find("media\\:content,content").attr("url"),n.type=i.find("media\\:content,content").attr("type"),n.image=i.find("media\\:thumbnail,thumbnail").attr("url"),t.push(n)})),this.set("player.playlist",t)},_onContentLoad:function(){window.playlist.forEach((function(e,t,i){i[t].image=this.get("player.urls.contentImagesLocation")+"/"+e.image,i[t].title=e.title.replace(/([A-Z])/g,"$1").replace(/^./,(function(e){return e.toUpperCase()})),i[t].url=this.get("player.urls.contentVideosLocation")+"/"+i[t].filename,i[t].name=i[t].filename,i[t].type="video/mp4"}),this),this.set("player.playlist",window.playlist)}})},function(e,t,i){"use strict";i.r(t);var n=i(16),o=i(0),r=(i(3),i(5));t.default=n.a.extend({defaults:o.a.extend(!0,{},n.a.prototype.defaults,{animation:{onTransitionOpen:!1,onTransitionClose:!1,transitionAnimationTime:500,detach:500,firstDetach:1e3,slideOut:500,attach:500},customization:{adTitle:{}},organicCardPlacementName:"Organic card below video",openingEffect:1,onTimerClose:"close",bfFactor:0,noaop:2,wfDynamicPause:!1,wfManual:!0,runWfWhenEmpty:!0,viewPercent:20,allowedHeightChange:75,secondsBW:60,isObserveFeedParent:!1,parentSelector:".tbl-feed-container",isMultiActiveAds:!0,isAnimateOnClose:!1,feedCardSelector:"[data-card-index]",isOpenInViewPort:!0,isOpenFloatingViewInViewPort:!0,isOpenMP4OutOfViewPort:!0,kibanaEventsToSend:"all",predictors:{autoKill:{isActive:!0},getAdFail:{isActive:!0},multiAd:{isActive:!0,predictPoints:{}},loading:{isActive:!0,predictPoints:"any"},repeat:{isActive:!0,predictPoints:"any"},playerReady:{isActive:!0,predictPoint:0},distancePercent:{isActive:!1,predictPoints:{}},distancePixels:{isActive:!1,predictPoints:{}}},playPriority:{type:"ppKey",key:1},vForce:{isActive:!0,getAdTimeoutSeconds:60},components:{disclosureText:{text:"ADVERTISEMENT"},CloseButtonView:{delay:3e3},adChoice:{isActive:!0,fallbackUrl:"https://popup.taboola.com/en",icon:"//cdn.taboola.com/static/c5/c5ef96bc-30ab-456a-b3d5-a84f367c6a46.svg",position:"above",title:{isActive:!1,text:"Sponsored Video by Taboola",style:{},logoStyle:{},adViewStyle:{}},videoAd:{isActive:!1,text:"Ad",style:{},logoStyle:{}},slider:{isActive:!0,text:"Ad",style:{},logoStyle:{}}},volume:{isActive:!1,expandedText:"Unmute",timeToMinimize:2e3,style:{border:{},mute:{},unmute:{},text:{}}}},hasCloseButton:!1,detachToSlider:{isStartFromSlider:!1,isDetachToSlider:!1,isDetachAbove:!1,isDetachBelow:!0,width:400,height:400,position:{horizontal:"right",vertical:"bottom",horizontalOffset:0,verticalOffset:0},liquidSize:{isActive:!1,widthPercent:33,minWidth:200,heightPercent:30,maxHeight:350},customCss:null,animation:!0,hasCloseButton:!0,onOutOfView:"pause",isCheckForFirstOnPage:!0,isCheckForTopCard:!0,components:{disclosureText:{text:"ADVERTISEMENT",isActive:!1}},forceDetach:{isActive:!1,restrictions:{rv:!0}}},category:"blankblack5",isMultiAd:!0,pubId:169497,pubTagId:953497,preroll:{pubId:169497,pubTagId:953497},midroll:{pubId:169497,pubTagId:953497},postroll:{pubId:169497,pubTagId:953497},secondsToClose:200,secondsToCloseFeed:20,contentTimerSeconds:20,isMobile:!1,onOutOfView:"pause",unitTitle:"",vertical:"_#VERTICAL#_",player:{hasControls:!1,urls:{blankLocation:"{{player.urls.contentVideosLocation}}/blackScreen5.mp4"},bfFactor:0,settings:{vakll:24e4,time_between_waterfall:1,mintimwf:1e4,bfFactor:0,ad_loaded_method:!0,wf_manual:!1,wf_dynmc_ps:!1,vforce2:"vforce2",isMultiVpaidUnit:!0,mprdct:.025}},maxVideoCards:100,minTopForVideo:10,minLeftForVideo:10,verticalWidthThreshold:350,isFireSP:{32:!0},isPlayerOutOfViewport:!1,isToggleIframeContent:!1,cardEligibilityPercent:50,continueToPlayInNexCard:{isActive:!1},stickyCard:{isActive:!0,detachFromTopDistance:0,attachPercent:98,offset:{top:0,left:0},observerThreshold:[.01,.99],maxAspectRatio:.8,restrictions:{isFirstCardOnly:!1,maxWidth:800,rv:!0,adPercent:{percent:28,secondsToClose:3,keepUntilScroll:!0}}},feedCardElig:{isActive:!1,thresholdJump:.001,intersections:{topCard:-1,topCardIntersection:0,bottomCard:-1,bottomCardIntersection:0}},bottomOfViewPortDebugSelector:!1}),initialize:function(){n.a.prototype.initialize.call(this),this.loadContent(),window.TRC&&!0===window.TRC.isAMP&&(this.set("detachToSlider.isDetachToSlider",!1),this.set("detachToSlider.isStartFromSlider",!1),this.set("feedCardElig.isActive",!0),this.set("stickyCard.restrictions.adPercent.percent",.1)),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider"))&&this.set("stickyCard.isActive",!1),this.get("detachToSlider.isStartFromSlider")&&this.set("isRvPriority",!1),(this.get("detachToSlider.isStartFromSlider")||this.get("detachToSlider.isDetachToSlider")||this.get("permanentCard"))&&this.set("getCardMaxPPS",void 0),this.get("stickyCard.isActive")&&this._setStickyCardParams()},loadContent:function(){"mrss"===this.get("contentLoadType")?o.a.ajax({url:this.get("player.urls.contentLocation"),dataType:"xml",success:this._onMrssLoad.bind(this)}):"direct"===this.get("contentLoadType")?this.set("player.playlist",[{id:0,title:"",link:"",url:this.get("player.urls.contentLocation")||this.get("pVideoUrl"),type:"video/mp4",image:""}]):(window.category=this.get("category"),r.loadJs(this.get("player.urls.contentLocation"),this._onContentLoad.bind(this)))},_onMrssLoad:function(e){var t=[];Object(o.a)(e).find("item").each((function(e,i){i=Object(o.a)(i);var n={};n.id=e,n.title=i.find("title").text(),n.link=i.find("link").text(),n.url=i.find("media\\:content,content").attr("url"),n.type=i.find("media\\:content,content").attr("type"),n.image=i.find("media\\:thumbnail,thumbnail").attr("url"),t.push(n)})),this.set("player.playlist",t)},_onContentLoad:function(){window.playlist.forEach((function(e,t,i){i[t].image=this.get("player.urls.contentImagesLocation")+"/"+e.image,i[t].title=e.title.replace(/([A-Z])/g,"$1").replace(/^./,(function(e){return e.toUpperCase()})),i[t].url=this.get("player.urls.contentVideosLocation")+"/"+i[t].filename,i[t].name=i[t].filename,i[t].type="video/mp4"}),this),this.set("player.playlist",window.playlist)}})},function(e,t){e.exports='<a href="javascript:void(0);" >\n    <img src="{{imageSrc}}">\n</a>'},function(e,t){e.exports='<iframe style="width: 100%; height: 100%;" frameborder="0" border="0"\n        padding="0" scrolling="no" marginwidth="0" marginheight="0"></iframe>'},function(e,t){e.exports='<div class="_cm-opt-out">\n    <div class="_cm-opt-button"></div>\n    <div class="_cm-opt-dialog">\n        <div id="" class="_cm-opt-message">\n            Never show me Video ads\n        </div>\n        <textarea class="_cm-opt-text" placeholder="What was the problem with this ad?"></textarea>\n        <div>\n            <button type="button" class="_cm-cancel">Cancel</button>\n            <button type="button" class="_cm-submit">Send</button>\n        </div>\n    </div>\n</div>'},function(e,t){e.exports='<li class="_cm-playlist-item">\n    <img class="_cm-playlist-img" src="{{image}}">\n    <span class="_cm-playlist-text">{{title}}</span>\n</li>'},function(e,t){e.exports='<div class="_cm-timer-circle">\n    <div class="_cm-timer-mask _cm-timer-full">\n        <div class="_cm-timer-fill"></div>\n    </div>\n    <div class="_cm-timer-mask _cm-timer-half">\n        <div class="_cm-timer-fill"></div>\n        <div class="_cm-timer-fill _cm-timer-fix"></div>\n    </div>\n</div>\n<div class="_cm-timer-inset">\n    <span></span>\n</div>'},function(e,t){e.exports='<span class="_cm-branding-view-title-text">{{titleContainer.titleText}}</span>\n<span class="_cm-branding-view-branding-text">{{titleContainer.BrandingText}}</span>'},function(e,t){e.exports='<a class="_cm-ad-choice-text" target="_blank">{{text}}</a>\n<a class="_cm-ad-choice-logo" target="_blank"></a>'},function(e,t){e.exports={"AR-EG":"","AR-AE":"","AR-SA":"","CS-CZ":"Reklama","DA-DK":"Annonce","DE-DE":"Anzeige","DE-AT":"Anzeige","DE-CH":"Anzeige","EL-GR":"Ad","EN-AE":"Ad","EN-AU":"Ad","EN-CA":"Ad","EN-GB":"Ad","EN-IE":"Ad","EN-IN":"Ad","EN-SG":"Ad","EN-PH":"Ad","EN-MY":"Ad","EN-NZ":"Ad","EN-US":"Ad","EN-ZA":"Ad","EN-XL":"Ad","ES-ES":"Publicidad","ES-AR":"Patrocinado","ES-CO":"Patrocinado","ES-CL":"Patrocinado","ES-PE":"Patrocinado","ES-MX":"Patrocinado","ES-US":"Patrocinado","ES-XL":"Patrocinado","ES-VE":"Patrocinado","EN-ID":"Ad","FI-FI":"Mainos","FR-FR":"Sponsoris","FR-BE":"Sponsoris","FR-CA":"Pub","FR-CH":"Sponsoris","HE-IL":"","HI-IN":"","HU-HU":"Hird.","ID-ID":"Ad","IT-IT":"Ann.","JA-JP":"PR","KO-KR":"AD","NB-NO":"Annonse","NL-NL":"Adv","NL-BE":"Adv","PL-PL":"Reklama","PT-BR":"Publicidade","PT-PT":"Pub","RU-RU":"","SV-SE":"Annons","TH-TH":"Ad","TR-TR":"R","VI-VN":"Ad","ZH-CN":"","ZH-TW":"","ZH-HK":""}},function(e,t){e.exports='<div class="_cm-volume-border">\n    <svg class="_cm-volume-mute" data-name="_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 351.22 266.75">\n        <defs>\n            <style>.cls-1 {\n                fill: #fff;\n            }</style>\n        </defs>\n        <g id="_Group_" data-name="&lt;Group&gt;">\n            <g id="_Group_2" data-name="&lt;Group&gt;">\n                <path class="cls-1"\n                      d="M338,185.84c-.48-3.15-1.39-6.11-5.31-7.4H330c-3.63.93-6.33,3-8.93,5.29L249.59,246H170.26c-7.93,0-14.35,5.59-14.35,12.5V370.1c0,6.9,6.42,12.5,14.35,12.5h85.1l66.91,58.27a19,19,0,0,0,6,3.71c3.92,1.44,7.13.29,8.73-3.12a14.33,14.33,0,0,0,1.22-6.29V189.22A22.39,22.39,0,0,0,338,185.84Z"\n                      transform="translate(-155.91 -178.44)"/>\n            </g>\n        </g>\n        <path class="cls-1"\n              d="M486.13,381.62a20.93,20.93,0,0,1-14.85-6.15l-97.62-97.62a21,21,0,1,1,29.69-29.7L501,345.77a21,21,0,0,1-14.85,35.85Z"\n              transform="translate(-155.91 -178.44)"/>\n        <path class="cls-1"\n              d="M388.5,381.62a21,21,0,0,1-14.84-35.85l97.62-97.62a21,21,0,1,1,29.7,29.7l-97.63,97.62A20.93,20.93,0,0,1,388.5,381.62Z"\n              transform="translate(-155.91 -178.44)"/>\n    </svg>\n\n    <svg class="_cm-volume-unmute" data-name="_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 311.81 266.75">\n        <defs>\n            <style>.cls-1 {\n                fill: #fff;\n            }</style>\n        </defs>\n        <g id="_Group_" data-name="&lt;Group&gt;">\n            <path id="_Path_" data-name="&lt;Path&gt;" class="cls-1"\n                  d="M465.85,290.12A124.1,124.1,0,0,0,453.19,253a127.55,127.55,0,0,0-21.66-29.51c-3.38-3.47-7.4-5.23-12.25-4.6a13.27,13.27,0,0,0-11.5,9.27c-1.87,5.38-.66,10.26,3.23,14.43,1,1.05,2,2,2.95,3.1a96.67,96.67,0,0,1,25.09,55.19,95.28,95.28,0,0,1-1.17,29.52,96.57,96.57,0,0,1-26.52,50.23,13.74,13.74,0,0,0-4.23,12.12,13.25,13.25,0,0,0,9.2,11.27c5.3,1.85,10.15.74,14.31-3.08.82-.74,1.57-1.56,2.33-2.36a125,125,0,0,0,34.74-87.88A131.18,131.18,0,0,0,465.85,290.12Z"\n                  transform="translate(-155.91 -178.44)"/>\n            <path id="_Path_2" data-name="&lt;Path&gt;" class="cls-1"\n                  d="M420.23,307.35a87,87,0,0,0-6.32-28.82A88,88,0,0,0,395,249.69a14,14,0,0,0-24.29,11.22,16.39,16.39,0,0,0,4.73,8.92c13.86,14.79,19.22,32.3,16.05,52.27a58.5,58.5,0,0,1-16.83,32.54A14,14,0,0,0,388.48,378c3.13-.88,5.44-2.88,7.6-5.18,16.05-17.16,23.94-37.57,24.15-61C420.23,310.31,420.29,308.83,420.23,307.35Z"\n                  transform="translate(-155.91 -178.44)"/>\n            <path id="_Path_3" data-name="&lt;Path&gt;" class="cls-1"\n                  d="M338,185.84c-.48-3.15-1.39-6.11-5.31-7.4H330c-3.63.93-6.33,3-8.93,5.29L249.59,246H170.26c-7.93,0-14.35,5.59-14.35,12.5V370.1c0,6.9,6.42,12.5,14.35,12.5h85.1l66.91,58.27a19,19,0,0,0,6,3.71c3.92,1.44,7.13.29,8.73-3.12a14.33,14.33,0,0,0,1.22-6.29V189.22A22.39,22.39,0,0,0,338,185.84Z"\n                  transform="translate(-155.91 -178.44)"/>\n        </g>\n    </svg>\n\n    <div class="_cm-volume-text">{{expandedText}}</div>\n</div>\n'},function(e,t){e.exports='<div class="_cm-click-blocker _cm-click-blocker-top"></div>\n<div class="_cm-click-blocker _cm-click-blocker-bottom"></div>\n<div class="_cm-click-blocker _cm-click-blocker-left"></div>\n<div class="_cm-click-blocker _cm-click-blocker-right"></div>'},function(e,t,i){"use strict";i.r(t);var n=i(0),o=i(6),r=i(3),s=i.n(r),a=i(2),l=i.n(a),c=i(4),d=i(14),u=i(7);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?g(e):t}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=i(5),b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=y(e);if(t){var o=y(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return m(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e.model,t.model.get("msnWebComponentsEnabled")||t.model.set("height",v.getVideoHeight(t.model.get("width"))),t.log=new c.a({unitType:t.model.get("unitType"),className:t.constructor.name||"UnitController",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.containerView=void 0,t.videoView=void 0,t.adService=void 0,t.playerService=void 0,t.isClosedByUser=!1,t.createStateHandlers([{event:"closeState",funcName:"handleCloseState"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"}]),t.model.listenTo(t.model,"ad:stoppedByUser",t.terminate.bind(g(t),!0)),t._createTimers(),setTimeout(function(){this.competitionDetector=new u.c(this.model)}.bind(g(t)),0),t}return t=o,(i=[{key:"_createTimers",value:function(){if(this.model.get("isMultiAd")&&this.model.get("midrollTimeout")>0){var e={startCondition:{stateToListen:l.a.adManagerState.empty,state:"adManagerState"},stopCondition:{stateToListen:l.a.adManagerState.hasAds,state:"adManagerState"}};this.getAdTimer=new d.a(this.model,e,this.terminate.bind(this,!1,"midrollCollapse"),1e3*this.model.get("midrollTimeout"))}else if(this.model.get("isMultiAd")&&this.model.get("secondsToCloseFeed")>0){var t={startCondition:{stateToListen:l.a.adManagerState.empty,state:"adManagerState"},stopCondition:{stateToListen:l.a.adManagerState.hasAds,state:"adManagerState"}};this.getAdTimer=new d.a(this.model,t,this.pause.bind(this,"midrollCollapse"),1e3*this.model.get("secondsToCloseFeed"))}var i=this.model.get("secondsToClose");if(i>0){var n={startCondition:{stateToListen:!0,state:"firstGetAdFired"},stopCondition:{stateToListen:l.a.adQState.impression,state:"adQState"},isStartOnce:!0};this.secondsToCloseTimer=new d.a(this.model,n,this.terminate.bind(this,!1,"secondsToClose"),1e3*i)}var o=this.model.get("secondsToCloseGlobal");if(o>0){var r={startCondition:{stateToListen:"",state:""}};"showReplay"===this.model.get("onTimerClose")?this.secondsToCloseGlobalTimer=new d.a(this.model,r,this.pause.bind(this,"secondsToCloseGlobal"),1e3*this.model.get("secondsToCloseGlobal")):this.secondsToCloseGlobalTimer=new d.a(this.model,r,this.terminate.bind(this,!1,"secondsToCloseGlobal"),1e3*o),this.secondsToCloseGlobalTimer.start(this.model,"")}this._createSecondsToPassbackTimer()}},{key:"terminate",value:function(e,t){this.log.info("Terminate reason: "+t),this.isClosedByUser=e,this._setTimerReason(t),this.model.set("closeState",l.a.closeState.terminate)}},{key:"_setTimerReason",value:function(e){this.model.set("closeTimer",e)}},{key:"handleCloseState",value:function(e,t){switch(this.log.info("handleCloseState",t),s.a.trigger("global:closeState:changed"),t){case l.a.closeState.terminate:this.containerView?this.containerView.close(this.isClosedByUser):this.model.set("closeState",l.a.closeState.containerViewClosed);break;case l.a.closeState.containerViewClosed:this.nativeAdView&&this.nativeAdView.hide(),this.videoView?this.videoView.close(this.isClosedByUser):this.model.set("closeState",l.a.closeState.videoViewClosed);break;case l.a.closeState.videoViewClosed:this.adService?this.adService.close():this.model.set("closeState",l.a.closeState.adManagerStop);break;case l.a.closeState.adManagerStop:this.playerService&&(this.playerService.close(),this._stopListening())}}},{key:"_stopListening",value:function(){this.model.off(),s.a.off()}},{key:"pause",value:function(e){this._setTimerReason(e),this.adService&&this.adService.pauseGetAds()}},{key:"_onParentSelectorLost",value:function(){this.overKill("parentSelectorLost")}},{key:"overKill",value:function(e){this.log.info("overKill reason: "+e),this.adService&&this.adService.pauseGetAds(),this.adsManager&&this.adsManager.pauseGetAds(),this.model.set("closeState",l.a.closeState.terminate),this._setTimerReason(e)}},{key:"_createSecondsToPassbackTimer",value:function(){this.model.get("secondsToPassback")&&(this.passBackTimer=new d.a(this.model,{startCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:!0,state:"isFirstAdLoaded"}},this._triggerPassback.bind(this,"Passback"),1e3*this.model.get("secondsToPassback")),this.passBackTimer.start(this.model,""))}},{key:"_triggerPassback",value:function(){this.model.get("isFirstAdLoaded")||(this.log.info("Passback timer done"),s.a.trigger("global:passback",{isApiPassbackExist:this.model.get("isApiPassbackExist")}),this.model.set("closeState",l.a.closeState.terminate))}}])&&f(t.prototype,i),o}(o.a),_=i(50),S=i.n(_),w=i(51),A=i.n(w),T=(s.a.View.extend({className:"_cm-poster",id:"_cm-css-reset",initialize:function(e){this.log=new c.a({unitType:"Component",className:"PosterView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.render()},render:function(){this.staticBanner=document.createElement("img"),this.staticBanner.addEventListener("error",this._onError.bind(this));var e=this.model.get("components.PosterView.imageLocation");this.staticBanner.src=e,this.staticBanner.height=this.model.get("height"),this.staticBanner.width=this.model.get("width"),this.staticBanner.onclick=this._onClick.bind(this),this.$el.hide(),this.$el.append(this.staticBanner),this.container.prepend(this.$el)},_onError:function(){s.a.trigger("error",this.staticBanner,"imageLoadError"),this.$el.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()},_onClick:function(e){this.trigger("cm:banner:click")}}),i(43),s.a.View.extend({className:"_cm-click-through",initialize:function(e){this.log=new c.a({unitType:"Component",className:"ClickThrough",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.link=e.link,this.render()},render:function(){this.$el.click(this.onClick.bind(this)),this.container.appendChild(this.el)},onClick:function(){this.link&&window.open(this.link,"_blank")},hide:function(){this.$el.hide()},show:function(){this.$el.show()},updateLink:function(e){this.link=e}}),i(13)),P=i(18),C=i.n(P),E=i(1),k=i.n(E),O=i(3),I=i(5),V=i(11),D=i(2),R=(O.View.extend({className:"_cm-close-area",id:"_cm-close-area",events:{"click ":"_onClick"},initialize:function(e){this.log=new V({unitType:e.unitType,className:"closeButtonView"}),this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a,this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){if(!this._rendered){this._rendered=!0,this.$el.append(C.a);var e=this.model.get("wurfl.browser.name").toLowerCase();-1===e.indexOf(k.a.BROWSER.FIREFOX.toLowerCase())&&-1===e.indexOf(k.a.BROWSER.IE.toLowerCase())&&-1===e.indexOf(k.a.BROWSER.EDGE.toLowerCase())||this.$el.addClass("_cm-close-ie-fix"),this.container=I.isArray(this.container)?this.container[0]:this.container,this.container.appendChild(this.el),(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&("detached"===this.model.get("videoViewState")?this.show():this.hide())}},_bindEvents:function(){this.model.get("vForce.isActive")?this.listenTo(this.model,"change:adState",this._onStateChange):this.listenTo(this.model,"change:state",this._onStateChange),(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&this.listenTo(this.model,"change:videoViewState",this._onVideoViewStateChange)},_onPlaying:function(){var e=this.model.get("components.CloseButtonView.delay");this.renderTimeout=setTimeout(this.render.bind(this),e)},_onClick:function(e){e.stopPropagation(),this.model.get("onClose")||"OMNI_TAG"==this.model.get("unitType")||I.firePixel(this.model.getPixel("pixels.close"),"close (user clicked the close button)"),this.model.set("state",this.model.STATE.STOPPED_BY_USER),O.trigger("Ad:stoppedByUser"),this.model.trigger("ad:stoppedByUser",D.closeState.terminate)},_onStateChange:function(e,t){t!==e.STATE.PLAYING&&t!==D.adState.playing||this._onPlaying()},_onVideoViewStateChange:function(e,t){switch(t){case"detached":this.show();break;case"attached":this.hide()}},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),i(3)),x=i(5),N=i(11),M=i(2),F=R.View.extend({className:"_cm-close-area",id:"_cm-close-area",closeButtonRenderd:!1,events:{"click ":"_onClick"},initialize:function(e){this.log=new N({unitType:e.unitType,className:"closeButtonView"}),this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a,this.render(),this.hide()},render:function(){this._rendered||(this._rendered=!0,this.isInDelay=!1,this.$el.append(C.a),this.container.appendChild(this.el))},_bindEvents:function(){this.listenTo(this.model,"change:state",this._onStateChange),this.listenTo(this.model,"change:adState",this._onStateChange),(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&this.model.get("detachToSlider.hasCloseButton")&&this.listenTo(this.model,"change:videoViewState",this._onVideoViewStateChange)},_onPlaying:function(){this.model.get("videoViewState")!==M.videoViewState.attached||this.model.get("hasCloseButton")?this._startRender():this.isInDelay&&(this.closeButtonRenderd=!1,clearTimeout(this.delayTimeout))},_startRender:function(){if(this.closeButtonRenderd)this.show();else{this.closeButtonRenderd=!0;var e=this.model.get("components.CloseButtonView.delay");this.isInDelay=!0,this.delayTimeout=setTimeout(this.render.bind(this),e)}},_onClick:function(){this.model.get("onClose")||"OMNI_TAG"==this.model.get("unitType")||x.firePixel(this.model.getPixel("pixels.close"),"close (user clicked the close button)"),this.model.set("state",this.model.STATE.STOPPED_BY_USER),R.trigger("Ad:stoppedByUser"),this.model.trigger("ad:stoppedByUser")},_onStateChange:function(e,t){switch(t){case"playing":this._onPlaying()}},_onVideoViewStateChange:function(e,t){"detached"===t&&!this.closeButtonRenderd&&this.model.get("detachToSlider.hasCloseButton")&&this._startRender(),"attached"!==t||this.model.get("hasCloseButton")||this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),L=i(24),B=i(3),j=i(5),U=i(11),W=i(91),H=(B.View.extend({className:"_cm-d2d-fallback",initialize:function(e){this.log=new U({unitType:e.unitType,className:"D2dFallbackView"}),this.model=e.model,this.container=e.container,this.isTrusted=!0,this.shouldReport=j.isFactor(this.model.get("gaFactor")),this.shouldReport&&this.model.get("isReportToKibana")&&(this.model.set("gaFactor",1),this.kibana=new L.a({model:this.model})),this.pubId=e.pubId?e.pubId:this.model.get("components.D2DFallbackView.pubId"),this.pubTagId=e.pubTagId?e.pubTagId:this.model.get("components.D2DFallbackView.pubTagId"),this.render(),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){this.$el.append(W),this._customize(),Object(n.a)(this.container).append(this.$el),this.iframe=this.$el.find("iframe")[0],this.iframe.contentWindow?this._writeIframe():this.iframe.onload=this._writeIframe.bind(this),j.firePixel(this.model.getPixel("pixels.D2DFallback"),"D2DFallback")},_writeIframe:function(){this.iframe.onload=this.iFrameOnLoad.bind(this);var e=this.iframe.contentWindow.document;e.open(),e.write('<script type="text/javascript" src="'.concat(this.buildFallbackURL(),'"><\/script>')),e.close(),e.onclick=this._onClick.bind(this)},iFrameOnLoad:function(){var e=Object(n.a)(this.iframe.contentWindow.document.body);Object(n.a)("div",e).length>0&&this.model.set("d2dLoaded",!0)},buildFallbackURL:function(){return"".concat(this.model.get("components.D2DFallbackView.location"),"?")+"oid=15"+"&width=".concat(this.model.get("components.D2DFallbackView.width"))+"&height=".concat(this.model.get("components.D2DFallbackView.height"))+"&pubid=".concat(this.pubId)+"&tagid=".concat(this.pubTagId)+"&pstn=".concat(this.model.get("components.D2DFallbackView.pstn"))+"&cirf=".concat(this.model.get("referrer"))+"&noaop=1&revmod=INSERT_CONTENT_TYPE&encoded=1&cb=INSERT_CACHEBUSTER&keywords=INSERT_COMMA_SEPARATED_KEYWORDS&urlonly=1&callback=document.write"},hide:function(e){this.log.info("D2D hide:",e),e?this.$el.css({display:"none"}):this.$el.css({display:"block"})},show:function(){this.$el.css({display:"block"})},_onClick:function(e){this.isTrusted=!0,e.isTrusted?window.setTimeout(this._onTimeoutEnd.bind(this),1e3*this.model.get("clickTestSeconds")):(j.firePixel(this.model.getPixel("pixels.D2DClickSuspicious"),"Suspicious D2DClick"),this.kibana&&this.kibana.onD2DClick(e.isTrusted))},_onTimeoutEnd:function(){document.hidden?j.firePixel(this.model.getPixel("pixels.D2DClick"),"D2DClick"):(j.firePixel(this.model.getPixel("pixels.D2DClickSuspicious"),"Suspicious D2DClick"),this.kibana&&this.kibana.onD2DClick(!0,!1))},_customize:function(){var e=this.model.get("components.D2DFallbackView.additionalCss");this.$el.css(j.toCssObj(e))},updateD2D:function(e,t){this.iframe&&this.pubId!=e&&this.pubTagId!=t&&(this.pubId=e,this.pubTagId=t,this._writeIframe())},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide(!0)},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide(!0)}}),i(44),i(52)),$=i.n(H),z=i(27),G=i.n(z),q=s.a.View.extend({className:"_cm-loading",id:"_cm-css-reset",initialize:function(e){this.log=new c.a({unitType:"Component",className:"LoadingView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),e.globalModel&&(this.globalModel=e.globalModel),this.container=e.container,this.isShowReplayScreen=e.isStartWithReplay,this.isReplayable=e.isReplayable,this._createStatesAction(),this._bindEvents(),this.render()},_bindEvents:function(){this.listenTo(this.model,"change:adQState",this._onAdStateChange.bind(this,this.adStateActions)),this.listenTo(this.model,"change:adManagerState",this._onAdStateChange.bind(this,this.getAdStateActions)),this.model.on("change:viewTopComponent",this._toggleLoadingVisibility,this),this.model.on("change:repeatState",this._onReplayAdShowing,this),this.globalModel&&this.listenTo(this.globalModel,"change:adManagerState",this._onGlobalModelAdStateChange.bind(this,this.getAdStateActions))},_createStatesAction:function(){this.adStateActions={q0:this._onAdPlaying.bind(this),completed:this._onVideoComplete.bind(this),stopped:this._stop.bind(this)},this.getAdStateActions={stopped:this._stop.bind(this)}},_onGlobalModelAdStateChange:function(e,t,i){if(i==a.adManagerState.stopped){var n=e[i];n&&n()}},_onAdStateChange:function(e,t,i){var n=e[i];n&&n()},render:function(){this.$el.append($.a),this.loadingDiv=this.$el.find("._cm-loading-div"),"css"==this.model.get("components.Loading.type")?this.loadCss():"img"==this.model.get("components.Loading.type")&&this.loadImage(),this._applyAdditionalCss(),this.isShowReplayScreen&&this.$el.css("background","transparent"),this.$el.hide(),this.container.appendChild(this.el),this._renderReapet(),this.currentActiveImage=this.innerDisplay},_renderReapet:function(){this.repeatEl=Object(n.a)(G.a),this._setBackground(),this._setRepeatIcon(),this.learnMoreWrapper=this.repeatEl.find("._cm-learn-more-buttons-wrapper"),this.learnMoreWrapper.hide(),this.model.get("renderLearnMore")&&this._setLearnMoreIcon(),this.repeatEl.hide(),this.loadingDiv.append(this.repeatEl)},_setRepeatIcon:function(){this.repeatViewWrapper=this.repeatEl.find("._cm-repeat-view-wrapper"),this.repeatButtonsWrapper=this.repeatEl.find("._cm-repeat-buttons-wrapper");var e=this.repeatEl.find("._cm-repeat-button"),t=this.repeatEl.find("._cm-repeat-button-hover"),i=this.model.get("components.Repeat.repalyIcon"),n=this.model.get("components.Repeat.replayHoverIcon");this._setButtonSrc(e,t,i,n)},_setLearnMoreIcon:function(){var e=this.repeatEl.find("._cm-learn-more-button"),t=this.repeatEl.find("._cm-learn-more-button-hover"),i=this.model.get("components.Repeat.learnMoreIcon"),n=this.model.get("components.Repeat.learnMoreHoverIcon");this._setButtonSrc(e,t,i,n),this.model.get("adClickThroughUrl")?this.repeatEl.click(this._onLearnMoreClick.bind(this)):this.listenTo(this.model,"change:adClickThroughUrl",this._updateLearnMoreUrl)},_setButtonSrc:function(e,t,i,n){e.attr("src",i),t.attr("src",n)},_setBackground:function(){var e=this.model.get("components.Repeat.backgroundImage");this.repeatEl.css("background-image",'url("'+e+'") !important')},loadCss:function(){var e=document.createElement("div");e.className="_cm-loading-icon",this.loadingDiv.append(e),this.innerDisplay=Object(n.a)(e)},loadImage:function(){var e=document.createElement("img");e.src=this.model.get("components.Loading.imgUrl"),e.className="_cm_loader_img",this.loadingDiv.append(e),this.innerDisplay=Object(n.a)(e)},hide:function(){this.isRepeatShowing=!1,this.$el.hide(),this._setModel("loadingViewState",a.loadingViewState.hiding)},show:function(){this.isShowReplayScreen&&this._showRe(),this.$el.show(),this._setLoadingViewSize(this.currentActiveImage.width(),this.currentActiveImage.height()),this._setModel("loadingViewState",a.loadingViewState.showing)},showRepeat:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stop(e)},_onRepeatClick:function(e){e.stopPropagation(),this.log.info("User click"),this.clickEventRegistered=!1,this._setModel("loadingViewState",a.loadingViewState.clicked),this.repeatEl.hide(),this.innerDisplay.show(),this.currentActiveImage=this.innerDisplay,this._setLoadingViewSize(this.currentActiveImage.width(),this.currentActiveImage.height())},_onLearnMoreClick:function(e){window.open(this.model.get("adClickThroughUrl")),this.model.increaseCounter("learnMoreWasClicked",!0)},_onAdPlaying:function(){this.hide()},_onVideoComplete:function(){this.model.get("displayFiller.betweenAds")!==k.a.DISPLAY_FILLER.BETWEEN_ADS.CONTENT&&this.show()},_stop:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.model.get("isAdClosedByTimer")||this.model.get("closeState")||(this.clickEventRegistered||(this.repeatButtonsWrapper.one("click",this._onRepeatClick.bind(this)),this.clickEventRegistered=!0),this.show(),this.innerDisplay.hide(),this.currentActiveImage=this.repeatEl,this._setLoadingViewSize("auto","auto"),this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.isReplayable||this.repeatButtonsWrapper.hide(),e&&this.repeatViewWrapper.addClass("_cm-repeat-view-wrapper-detached"),this.repeatEl.show())},_showRe:function(){this.isRepeatShowing||(this.innerDisplay.hide(),this.clickEventRegistered||(this.repeatButtonsWrapper.one("click",this._onRepeatClick.bind(this)),this.clickEventRegistered=!0),this.currentActiveImage=this.repeatEl,this._setLoadingViewSize("auto","auto"),this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.isReplayable||this.repeatButtonsWrapper.hide(),this.repeatEl.show(),this.isRepeatShowing=!0)},_setLoadingViewSize:function(e,t){this.loadingDiv.css({width:e,height:t})},_setModel:function(e,t){this.globalModel&&this.globalModel.set(e,t),this.model.set(e,t)},_applyAdditionalCss:function(){var e=this.model.get("additionalCss");e&&(e["z-index"]||e.zIndex)&&this.$el.css({"z-index":e["z-index"]})},_updateLearnMoreUrl:function(){this.model.get("adClickThroughUrl")&&(this.repeatEl.click(this._onLearnMoreClick.bind(this)),this.learnMoreWrapper.show())},_toggleLoadingVisibility:function(){var e=this.model.get("viewTopComponent");this.log.info("_onTopComponentChange",e),e===k.a.FLOATING_VIEW_TOP_COMPONENT.loading?this.show():this.hide()},_onReplayAdShowing:function(){this.model.get("repeatState")===a.repeatState.showing&&this.hide()},resize:function(e){this._isLoadingViewDisplayed()&&this.loadingDiv.css(e)},onAttach:function(){this._isLoadingViewDisplayed()&&this.repeatViewWrapper.removeClass("_cm-repeat-view-wrapper-detached")},_isLoadingViewDisplayed:function(){return this.model.get("loadingViewState")===a.loadingViewState.showing}}),Y=i(3),K=i(5),Q=i(11),X=i(2),J=i(92),Z=(Y.View.extend({events:{"click ._cm-opt-button":"toggleDialog","click ._cm-cancel":"hideDialog","click ._cm-submit":"submitDialog"},id:"_cm-opt-out-view",className:"_cm-opt-out-view",initialize:function(e){this.log=new Q({unitType:e.unitType,className:"optOut"}),this.container=e.container,this.render(),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){this.$el.append(J),Object(n.a)(this.container).prepend(this.$el),this.ui={},this.ui.Dialog=this.$el.find("._cm-opt-dialog"),this.hideDialog()},toggleDialog:function(){"none"===this.ui.Dialog.get(0).style.display?this.showDialog():this.hideDialog()},showDialog:function(){this.$el.trigger("cm:optout:dialog:show"),this.ui.Dialog.show()},hideDialog:function(){this.$el.trigger("cm:optout:dialog:hide"),this.ui.Dialog.hide()},submitDialog:function(){var e=this.el.querySelector("._cm-opt-text").value,t=this.model.getPixel("pixels.optOutNever")+"&userComplaint="+e;K.firePixel(t,"Never OptOut"),this.hideDialog(),this.model.set("state",this.model.STATE.OPT_OUT),this.model.set("closeState",X.closeState.terminate),this.$el.trigger("cm:optout:submit")},hide:function(){this.$el.hide()},show:function(){this.$el.show()},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide()}}),i(3)),ee=i(5),te=i(11),ie=i(93),ne=Z.View.extend({errorCount:0,events:{"click ._cm-playlist-item":"_onItemClick"},initialize:function(e){this.log=new te({unitType:"playlist-item",className:"PlayListView"}),this.model=e.model,this.container=e.container,this._bindEvents(),this.render()},_bindEvents:function(){this.listenTo(this.model,"change:active",this.setActive)},render:function(){var e={image:this.model.get("image"),title:this.model.get("title")},t=ee.template(ie)(e);this.$el.append(t),Object(n.a)(this.container).append(this.$el),this._item=this.$el.find("._cm-playlist-item")},_onItemClick:function(e){this.model.set("clicked",!0)},setActive:function(e,t){t?this._item.addClass("active"):this._item.removeClass("active")}}),oe=i(53),re=i.n(oe),se=(i(45),i(54)),ae=i.n(se),le=(i(5),s.a.View.extend({errorCount:0,className:"_cm-playlist",initialize:function(e){this.log=new c.a({unitType:"playlist",className:"PlayListView"}),this.playListCollection=new re.a,this.container=e.container,this._playlist=e.playlist,this._height=e.height||350,this._itemCount=parseInt(this._height/74),this._itemCount=Math.min(this._playlist.length,this._itemCount),this._playlist=this._playlist.slice(0,this._itemCount),this._height=Math.min(this._height,74*this._itemCount),this._bindEvents(),this.render()},_bindEvents:function(){this.listenTo(s.a,"change:player:content",this._onContentChanged),this.listenTo(this.model,"change:state",this._onStateChange),this.listenToOnce(this.playListCollection,"change:clicked",this._itemSelected)},render:function(){this.$el.append(ae.a),Object(n.a)(this.container).append(this.$el),this._playlist_list=this.$el.find("._cm-playlist-list"),this.$el.css({height:parseInt(this._height)})},_setPlayList:function(){this.playListCollection.length>0||(this.playListCollection.add(this._playlist),this.playListCollection.forEach((function(e){new ne({model:e,container:this._playlist_list})}),this),this.playListCollection.first().set("active",!0))},_onStateChange:function(e,t){switch(t){case e.STATE.PLAYER_READY:this._setPlayList()}},_itemSelected:function(e){e.set("clicked",!1),this._playItem(e),this.listenToOnce(this.playListCollection,"change:clicked",this._itemSelected)},_playItem:function(e){if(!this._playlist_list.hasClass("unclickable")){var t=this.playListCollection.findWhere({active:!0});t&&t.set("active",!1),e.set("active",!0),this.$el.trigger("_cm-unit-play",e.attributes)}},_onContentChanged:function(e){this.log.important("On content changed",e);var t=this.playListCollection.findWhere({active:!0});t&&t.set("active",!1),(t=this.playListCollection.findWhere({id:e.id}))&&t.set("active",!0)},playNext:function(){var e=this.playListCollection.findWhere({active:!0}),t=this.playListCollection.indexOf(e)+1;t>=this._itemCount&&(t=0),this._playItem(this.playListCollection.at(t))},setUnclickable:function(e){e?this._playlist_list.addClass("unclickable"):this._playlist_list.removeClass("unclickable")}}),i(5)),ce=i(27),de=s.a.View.extend({className:"_cm-repeat",id:"_cm-css-reset",initialize:function(e){this.log=new c.a({unitType:"Component",className:"RepeatView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.active=!1,this._createStatesAction(),this._bindEvents(),this._render()},_render:function(){this.repeatEl=Object(n.a)(ce),this._setRepeatIcon(),this.learnMoreWrapper=this.repeatEl.find("._cm-learn-more-buttons-wrapper"),this.learnMoreWrapper.hide(),this.model.get("renderLearnMore")&&this._setLearnMoreIcon(),this._setBackground(),this.$el.hide(),this.$el.append(this.repeatEl),this.container.appendChild(this.el)},_setRepeatIcon:function(){this.repeatWrapper=this.repeatEl.find("._cm-repeat-buttons-wrapper");var e=this.repeatEl.find("._cm-repeat-button"),t=this.repeatEl.find("._cm-repeat-button-hover"),i=this.model.get("components.Repeat.repalyIcon"),n=this.model.get("components.Repeat.replayHoverIcon");this._setButtonSrc(e,t,i,n),this.repeatWrapper.click(this._onClick.bind(this))},_setLearnMoreIcon:function(){var e=this.repeatEl.find("._cm-learn-more-button"),t=this.repeatEl.find("._cm-learn-more-button-hover"),i=this.model.get("components.Repeat.learnMoreIcon"),n=this.model.get("components.Repeat.learnMoreHoverIcon");this._setButtonSrc(e,t,i,n),this.model.get("adClickThroughUrl")?this.learnMoreWrapper.click(this._onLearnMoreClick.bind(this)):this.listenTo(this.model,"change:adClickThroughUrl",this._updateLearnMoreUrl)},_setButtonSrc:function(e,t,i,n){e.attr("src",i),t.attr("src",n)},_setBackground:function(){var e=this.model.get("components.Repeat.backgroundImage");this.repeatEl.css("background-image",'url("'+e+'") !important')},hide:function(){this.$el.hide(),this.active=!1,this.isSpinning=!1,this.model.set("repeatState",a.repeatState.hiding)},show:function(){this.learnMoreWrapper&&this.model.get("adClickThroughUrl")&&this.model.get("renderLearnMore")&&this.learnMoreWrapper.show(),this.repeatWrapper&&this.model.get("dontRenderRepeatButton")&&this.repeatWrapper.hide(),this.$el.show(),this.active=!0,this.model.set("repeatState",a.repeatState.showing)},_bindEvents:function(){this.listenTo(this.model,"change:adQState",this._onAdStateChange)},_onClick:function(e){e.stopPropagation(),this.isSpinning||this.model.getPixel&&le.firePixel(this.model.getPixel("pixels.repeatClick"),"repeat click Pixel"),this.model.set("repeatState",a.repeatState.clicked),this.trigger("cm:repeat:click")},_createStatesAction:function(){this.adStateActions={q0:this._onAdPlaying.bind(this),completed:this._onVideoComplete.bind(this),repeating:this._onAdPlaying.bind(this)}},_onAdStateChange:function(e,t){var i=this.adStateActions[t];i&&i()},_onAdPlaying:function(){var e=this;setTimeout((function(){e.hide()}),100)},_onVideoComplete:function(){this.model.get("isReplayAd")&&this.show()},_onLearnMoreClick:function(e){window.open(this.model.get("adClickThroughUrl")),this.model.increaseCounter("learnMoreWasClicked",!0)},_updateLearnMoreUrl:function(){this.model.get("adClickThroughUrl")&&(this.learnMoreWrapper.click(this._onLearnMoreClick.bind(this)),this.learnMoreWrapper.show())},addAdditionalCss:function(e){Object(n.a)(this.repeatEl).addClass(e)}}),ue=i(3),he=(i(5),i(11)),fe=i(94),pe=(ue.View.extend({className:"_cm-timer",initialize:function(e){this.log=new he({unitType:e.unitType,className:"timerView"}),this.container=e.container,this._time=Number(e.time)||Number(this.model.get("components.TimerView.time")),this._isHide=e.isHide,this._stepTime=1,this.render()},render:function(){this.$el.append(fe),this.hide(),this.container.appendChild(this.el),this.$el.find("._cm-timer-circle ._cm-timer-mask, ._cm-timer-circle ._cm-timer-fill").css("transition","transform "+this._stepTime+"s linear"),this._innerText=this.$el.find("._cm-timer-inset>span")},startTimer:function(){this.log.info("Timer start"),0!==this._time?(this._currentTimer=this._stepTime,this._innerText.text(parseInt(this._time)),this._setDegree(180/this._time*this._currentTimer),window.setTimeout(this._timerUpdate.bind(this),1e3*this._stepTime)):this._finish()},_timerUpdate:function(){if(this._innerText.text(parseInt(this._time-this._currentTimer)),this._currentTimer+=this._stepTime,this._currentTimer>this._time)this._finish();else{var e=180/this._time*this._currentTimer;this._setDegree(e),window.setTimeout(this._timerUpdate.bind(this),1e3*this._stepTime)}},_setDegree:function(e){this.$el.find("._cm-timer-circle ._cm-timer-fill, ._cm-timer-circle ._cm-timer-mask._cm-timer-full").css("transform","rotate("+e+"deg)"),this.$el.find("._cm-timer-circle ._cm-timer-fill._cm-timer-fix").css("transform","rotate("+2*e+"deg)")},_finish:function(){this._isHide&&this.hide(),this.$el.trigger("cm:timer:finish")},hide:function(){this.$el.hide()}}),i(5)),me=i(95),ge=(s.a.View.extend({className:"_cm-branding-title",id:"_cm-css-reset",events:{},initialize:function(e){this.log=new c.a({unitType:"Component",className:"BrandingTitleView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.container=e.container,this.render(),this.bindEvents()},bindEvents:function(){this.model.listenTo(this.model,"change:customization.titleContainer.branding",this._customize.bind(this)),this.model.listenTo(this.model,"change:customization.titleContainer.branding.displayState",this._onDisplayStateChange.bind(this))},render:function(){this.template=pe.template(me),this.$el.append(this.template(this.model.attributes)),this.ui={title:this.$el.find("._cm-branding-view-title-text"),branding:this.$el.find("._cm-branding-view-branding-text")},this._customize(),this.container.appendChild(this.el),this.model.get("isFitToSize")&&this._fitToSize()},_customize:function(){var e=this.model.get("customization.titleContainer.title"),t=this.model.get("customization.titleContainer.branding");e&&((e=pe.toCssObj(e)).height="auto",this.ui.title.css(e)),t&&((t=pe.toCssObj(t)).height="auto",this.ui.branding.css(t))},_fitToSize:function(){var e=Object(n.a)(this.container).height(),t=this.model.get("videoPlaceholderSize");e&&t&&(Number(t.height)+this.$el.height()>=e?Number(t.height)+this.ui.title.height()<e?this._hideDescription():this._hide():this._show())},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},_onDisplayStateChange:function(e){e===a.brandingDisplayState.show?this._showAndFitToSize():this._hide()},_showAndFitToSize:function(){this._show(),this._fitToSize()},_hideDescription:function(){this.ui.branding.hide()}}),i(55)),ye=i.n(ge),ve=i(3),be=(i(5),i(11)),_e=ve.View.extend({className:"_cm-disc-text",id:"_cm-css-reset",initialize:function(e){this.log=new be({unitType:e.unitType,className:"disclosureTextView"}),this.disclosureText=ye.a,this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a},render:function(){this._rendered||(this._rendered=!0,this.container.appendChild(this.el),"detached"===this.model.get("videoViewState")?this.model.get("detachToSlider.components.disclosureText.isActive")?this.show():this.hide():this.model.get("components.disclosureText.isActive")?this.show():this.hide())},_bindEvents:function(){(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("detachToSlider.isDetachToSlider"))&&this.listenTo(this.model,"change:videoViewState",this._onVideoViewStateChange)},_onVideoViewStateChange:function(e,t){switch(t){case"detached":0==this.model.get("detachToSlider.components.disclosureText.isActive")?this.hide():this.show();break;case"attached":this.model.get("components.disclosureText.isActive")?this.show():this.hide()}},hide:function(){this.$el.hide()},show:function(){var e="detached"===this.model.get("videoViewState")?this.model.get("detachToSlider.components.disclosureText.text"):this.model.get("components.disclosureText.text");this.$el[0].innerHTML="",this.$el.append(this.disclosureText.replace("{text}",e)),this.$el.show()}}),Se=i(3),we=i(5),Ae=i(96),Te=i(97),Pe=Se.View.extend({events:{click:"_openAdChoice"},className:"_cm-ad-choice",initialize:function(e){this.log=new c.a({unitType:this.model.get("unitType"),className:"AdChoice",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.log.info("Ad Choice ".concat(e.type," initialized.")),this.container=e.container,this.parentPlaceholder=e.parent,this.placementType=e.type,this.shouldHandelDetachAttach=E.UNIT_TYPES[this.model.get("unitType")]===E.UNIT_TYPES.FEED_MANAGER&&this.placementType!==E.AD_CHOICE_TYPE.TITLE,this.placementModel=this._getAdChoicePlacementModel(e.type),this.titlePosition=this.model.get("components.adChoice.position"),this.icon=this.model.get("components.adChoice.icon"),this._translateText(),this._bindEvents(),this.render(),this._firstVideoViewStateHandle(),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){this.template=we.template(Ae),this.$el.append(this.template(this.placementModel)),this.$el.children("._cm-ad-choice-logo").css({background:"url("+this.icon+") no-repeat"}),this.placementModel.isActive&&(this.placementModel.adViewStyle&&this.$el.css(we.toCssObj(this.placementModel.adViewStyle)),this.$el.find("._cm-ad-choice-text").css(we.toCssObj(this.placementModel.style)),this.$el.find("._cm-ad-choice-logo").css(we.toCssObj(this.placementModel.logoStyle))),this._setAdChoiceUrl(),this._alignTitle(),Object(n.a)(this.container).append(this.el)},_bindEvents:function(){this.shouldHandelDetachAttach&&(this.log.info("Ad Choice ".concat(this.placementType," is listening to videoViewState")),this.listenTo(this.model,"change:videoViewState",this._handleVideoViewState.bind(this))),this.listenTo(this.model,"change:adPlayingWithAdChoice",this._onAdPlayingWithAdChoiceChange.bind(this)),this.listenTo(this.model,"change:content.isContentPlay",this._onAdPlayingWithAdChoiceChange.bind(this)),this.listenTo(this.model,"change:adjustWideFeed",this._onAdjustWideFeed.bind(this));var e=this.model.get("wurfl.browser.name");e!==E.BROWSER.IE&&e!==E.BROWSER.EDGE||this.listenTo(this.model,"change:isExpandEnded",this._onExpandEnded.bind(this))},_onExpandEnded:function(){this.log.info("onExpandEnded - IE or Edge detected");var e=this;this.$el.hide(),window.setTimeout((function(){e.$el.show()}),0)},_getAdChoicePlacementModel:function(e){var t;switch(e){case E.AD_CHOICE_TYPE.TITLE:t=this.model.get("components.adChoice.title");break;case E.AD_CHOICE_TYPE.VIDEO_AD:t=this.model.get("components.adChoice.videoAd");break;case E.AD_CHOICE_TYPE.SLIDER:t=this.model.get("components.adChoice.slider");break;default:t={text:"",style:{},logoStyle:{}}}return t},_getSCardSelector:function(){var e;switch(E.UNIT_TYPES[this.model.get("unitType")]){case E.UNIT_TYPES.WIDGET_ITEM:e='*[data-placement-name="'+this.model.get("placement")+'"]';break;case E.UNIT_TYPES.FEED_MANAGER:e=".tbl-feed-container .trc-content-sponsored";break;case E.UNIT_TYPES.INLINE_INSTREAM:case E.UNIT_TYPES.INLINE:case E.UNIT_TYPES.SLIDER_INSTREAM:e=".trc_rbox_container .trc-content-sponsored";break;default:e=""}return e},_setAdChoiceUrl:function(){this._selector=this._getSCardSelector();var e=this._extractUrl(this._selector);Object(n.a)("._cm-ad-choice-text",this.$el).attr("href",e),Object(n.a)("._cm-ad-choice-logo",this.$el).attr("href",e)},_extractUrl:function(e){var t,i,o=Object(n.a)(e)[0];return o?(Object(n.a)(window).width()<=768||this.model.get("isMobile")?(t=Object(n.a)(o).find("a.trc_mobile_adc_link"),this._isOpenNewTab=!0):t=Object(n.a)(o).find("a.trc_desktop_adc_link"),i=t.length>0?Object(n.a)(t[0]).attr("href").replace(/(Card)(\D*)(\d+)/,"Card "+this.model.get("cardNumber")):this.model.get("components.adChoice.fallbackUrl")):((Object(n.a)(window).width()<=768||this.model.get("isMobile"))&&(this._isOpenNewTab=!0),i=this.model.get("components.adChoice.fallbackUrl")),i},_alignTitle:function(){if(this.placementType===E.AD_CHOICE_TYPE.TITLE&&this._selector){var e=getComputedStyle(Object(n.a)(this._selector)[0]);e&&"rtl"===e.direction&&Object(n.a)(this.container).css("text-align","left !important")}},_firstVideoViewStateHandle:function(){E.UNIT_TYPES[this.model.get("unitType")]===E.UNIT_TYPES.FEED_MANAGER&&this.placementType!==E.AD_CHOICE_TYPE.TITLE&&this._handleVideoViewState()},_handleVideoViewState:function(){switch(this.model.get("videoViewState")){case a.videoViewState.attached:this._onAttach();break;case a.videoViewState.detached:this._onDetach()}},_onAttach:function(){switch(this.placementType){case E.AD_CHOICE_TYPE.VIDEO_AD:this._show();break;case E.AD_CHOICE_TYPE.SLIDER:this._hide()}},_onDetach:function(){switch(this.placementType){case E.AD_CHOICE_TYPE.VIDEO_AD:this._hide();break;case E.AD_CHOICE_TYPE.SLIDER:this._show()}this._updateAdChoicesVisibility()},_openAdChoice:function(e){this._firePixel("pixels.adChoice","adChoice click pixel."),window.TRC&&(this._isOpenNewTab||window.TRC.aboutUs&&window.TRC.aboutUs.open&&window.TRC.aboutUs.open(e))},_firePixel:function(e,t){var i=this.model.getPixel(e);we.firePixel(i,t)},_show:function(){this.placementModel.isActive&&!this.model.get("adPlayingWithAdChoice")&&this.$el.show(),this._validateComponentVisibilityStatus(!0)},_hide:function(){this.placementModel.isActive&&this.$el.hide(),this._validateComponentVisibilityStatus(!1)},_validateComponentVisibilityStatus:function(e){var t=this.componentsVisibilityListener&&this.model.get(this.componentsVisibilityListener);void 0!==t&&e!==t&&this.model.set(this.componentsVisibilityListener,e)},_updateAdChoicesVisibility:function(){this.model.get("adPlayingWithAdChoice")&&this.placementType!==E.AD_CHOICE_TYPE.TITLE?this._hide():this._show()},_onAdPlayingWithAdChoiceChange:function(){this.model.get("content.isContentPlay")&&!this.model.get("components.adChoice.isActiveOnContent")?this._hide():this.shouldHandelDetachAttach?this._handleVideoViewState():this._updateAdChoicesVisibility()},_onAdjustWideFeed:function(){var e=this.model.get("adjustWideFeed");this.titlePosition===E.TITLE_POSITION.BELOW&&(e?Object(n.a)(this.parentPlaceholder).addClass("_cm-wide-feed-title-below"):Object(n.a)(this.parentPlaceholder).removeClass("_cm-wide-feed-title-below"))},_translateText:function(){this.model.get("components.adChoice.isTranslateText")&&this.model.get("language")&&this.model.set("components.adChoice.videoAd.text",Te[this.model.get("language").toUpperCase()])},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this._hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this._show():this._hide()}});function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(3);var Ve=i(11),De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ie(e);if(t){var o=Ie(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Oe(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).log=new Ve({unitType:e.unitType,className:"closeButtonView"}),t._setInitialParameters(e),e.isSkipRender||t.render(),t.bindEvents(),t}return t=o,(i=[{key:"_setInitialParameters",value:function(e){this.container=e.container,this._rendered=!1,this.currModel=e.globalModel?e.globalModel:this.model}},{key:"render",value:function(){if(!this._rendered){this._rendered=!0,this.el.id="_cm-close-area",this.$el.addClass("_cm-close-area"),this.$el.append(C.a);var e=this.model.get("wurfl.browser.name").toLowerCase();-1===e.indexOf(k.a.BROWSER.FIREFOX.toLowerCase())&&-1===e.indexOf(k.a.BROWSER.IE.toLowerCase())&&-1===e.indexOf(k.a.BROWSER.EDGE.toLowerCase())||this.$el.addClass("_cm-close-ie-fix"),this.container.appendChild(this.el)}}},{key:"bindEvents",value:function(){var e=this;this.$el.on("click",(function(){e._onClick()})),this.listenTo(this.currModel,"change:closeButton.isShowing",this.setButtonVisible.bind(this))}},{key:"_onClick",value:function(){this.currModel.trigger("change:closeButtonClick",!0)}},{key:"setButtonVisible",value:function(e,t){t?this.show():this.hide()}},{key:"hide",value:function(){this.$el.hide()}},{key:"show",value:function(){this.$el.show()}}])&&Ee(t.prototype,i),o}(o.b),Re=i(3),xe=i(5),Ne=i(11),Me=i(98),Fe={display:"inline !important"},Le={display:"none !important"},Be={transition:"width 2000ms !important",width:"32px !important"},je={width:"32px !important"},Ue=Re.View.extend({className:"_cm-volume-area",id:"_cm-css-reset",events:{click:"_toggleVolume"},initialize:function(e){this._setInitialParameters(e),this._isHandleDetach(),this._hasCloseButton(),this._initVolumeState(),this._createStatesAction(),this._setMinimizeOnClickCallback(),this._bindEvents(),this.render(),this.log.info("Volume Button initialized.")},_bindEvents:function(){this.listenTo(this.currModel,"change:volumeMuted",this._onVolumeChange.bind(this)),this.listenTo(this.currModel,"startVolumeAnimation",this._minimizeAfterRender.bind(this)),this._handleDetach&&this.listenTo(this.model,"change:videoViewState",this._handleVideoViewState.bind(this)),this.currModel.on("lastVolumeStateCheck",this._onLastVolumeStateCheck,this),this.model.on("change:viewTopComponent",this.setButtonVisible,this),this.listenTo(this.model,"change:adQState",this._onAdStateChange),this.model.on("showVolumeButtonOnBackFromSwap",this.show,this)},_setComponentsVisibilityListener:function(){this.model.on("change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange,this),this.model.get(this.componentsVisibilityListener)||this.hide()},render:function(){this._initTemplate(),this._setPosition(),this._styleCustomization(),this._checkIfMinimized(),this._renderComponent()},_initTemplate:function(){var e=xe.template(Me)(this._settings);this.$el.append(e)},_renderComponent:function(){var e=this,t=this.model.get("wurfl.browser.name");t===E.BROWSER.IE||t===E.BROWSER.EDGE?setTimeout((function(){Object(n.a)(e.container).append(e.el)}),200):Object(n.a)(this.container).append(this.el)},_setInitialParameters:function(e){this.log=new Ne({unitType:this.model.get("unitType"),className:"volumeButtonView"}),this.container=e.container,this.currModel=e.globalModel?e.globalModel:this.model,this._settings=this.model.get("components.volume"),this._isMuted=!0,this._unitType=E.UNIT_TYPES[this.model.get("unitType")],this._isAlwaysBottom=this.model.get("components.volume.isAlwaysBottom"),this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},_initVolumeState:function(){void 0===this.currModel.get("volumeMuted")&&this.currModel.set("volumeMuted",!0)},_setMinimizeOnClickCallback:function(){this._minimizeOnClick=xe.once(this._minimize.bind(this,Be))},_onLastVolumeStateCheck:function(){this._onVolumeChange()},_toggleVolume:function(){this._isMuted?(this._unMute(),this._fireUnmute()):(this._mute(),this._fireMute()),this._minimizeOnClick(),this.currModel.set("volumeUserInteraction",!0)},_mute:function(){this._showMute(),this._hideUnmute(),this._isMuted=!0},_unMute:function(){this._hideMute(),this._showUnmute(),this._isMuted=!1},_fireMute:function(){this.currModel.set("volumeMuted",!0),this.currModel.set("onUnMuteClicked",!1)},_fireUnmute:function(){this.currModel.set("volumeMuted",!1),this.currModel.set("onUnMuteClicked",!0)},_onVolumeChange:function(){this.currModel.get("volumeMuted")?this._mute():this._unMute()},_minimizeAfterRender:function(){this.currModel.get("volumeMustBeMinimized")?this._minimize(je):setTimeout(function(){this._isMinimized||this._minimize(Be)}.bind(this),this._settings.timeToMinimize)},_minimize:function(e){Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border").css(e),this._isMinimized=!0,this.currModel.set("volumeMustBeMinimized",!0)},_hideMute:function(){Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(Le)},_showMute:function(){Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(Fe)},_hideUnmute:function(){Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(Le)},_showUnmute:function(){Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(Fe)},_setPosition:function(){this.hasCloseButton||this._isAlwaysBottom?this.$el.addClass("_cm-volume-area-bottom"):this.$el.addClass("_cm-volume-area-top"),this._handleDetach&&this._handleVideoViewState()},_isHandleDetach:function(){this._handleDetach=!1,this._unitType===E.UNIT_TYPES.FEED_MANAGER&&!1===this.model.get("hasCloseButton")&&!0===this.model.get("detachToSlider.hasCloseButton")&&(this._handleDetach=!0)},_hasCloseButton:function(){this._unitType!==E.UNIT_TYPES.FEED_MANAGER&&this._unitType!==E.UNIT_TYPES.INLINE_INSTREAM&&this._unitType!==E.UNIT_TYPES.MSN_WIDGET||(this.hasCloseButton=this.model.get("closeButton.hasCloseButton")),this._unitType!==E.UNIT_TYPES.WIDGET_ITEM&&this._unitType!==E.UNIT_TYPES.EXPANDABLE&&this._unitType!==E.UNIT_TYPES.EXPANDABLE_MOBILE||(this.hasCloseButton=this.model.get("components.CloseButtonView.hasCloseButton")),this._unitType,E.UNIT_TYPES.SLIDER_INSTREAM,this._unitType,E.UNIT_TYPES.EXPANDABLE},_handleVideoViewState:function(){if(!this._isAlwaysBottom){var e=this.model.get("videoViewState");e===a.videoViewState.attached&&(this.$el.addClass("_cm-volume-area-top"),this.$el.removeClass("_cm-volume-area-bottom")),e===a.videoViewState.detached&&this.hasCloseButton&&(this.$el.addClass("_cm-volume-area-bottom"),this.$el.removeClass("_cm-volume-area-top"))}},_styleCustomization:function(){this._settings.style&&(xe.isEmpty(this._settings.style.border)||Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border").css(this._settings.style.border),xe.isEmpty(this._settings.style.mute)||Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-mute").css(this._settings.style.mute),xe.isEmpty(this._settings.style.unmute)||Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-unmute").css(this._settings.style.unmute),xe.isEmpty(this._settings.style.text)||Object(n.a)("#_cm-css-reset._cm-volume-area > ._cm-volume-border > ._cm-volume-text").css(this._settings.style.text))},_checkIfMinimized:function(){this._unitType===E.UNIT_TYPES.FEED_MANAGER&&this.currModel.get("volumeMinimized")&&this._minimize(je)},setButtonVisible:function(){this.log.info("_onTopComponentChange",this.model.get("viewTopComponent")),this.model.get("viewTopComponent")===E.FLOATING_VIEW_TOP_COMPONENT.video?this.show():this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()},_createStatesAction:function(){this.adStateActions={q0:this.show.bind(this),completed:this.hide.bind(this),repeating:this.show.bind(this)}},_onAdStateChange:function(e,t){var i=this.adStateActions[t];i&&i()},_onComponentsVisibilityChange:function(){this.currModel.get(this.componentsVisibilityListener)?this.show():this.hide()}}),We=i(3),He=i(5),$e=i(11),ze=i(46),Ge=(We.View.extend({className:"_cm-ad-loading-progress",id:"_cm-css-reset",initialize:function(e){this.model.set("progressLoaderInit",!0),this._setInitialParameters(e),this._bindEvents(),this.currModel.get("isFirstAdLoaded")&&(this._startWatchingViewPort(),this._show()),this.render(),this.log.info("ad-loading-progress initialize")},_bindEvents:function(){this.log.info("ad-loading-progress _bindEvents"),this.listenTo(this.currModel,"change:isFirstAdLoaded",this._onFirstAdLoaded.bind(this)),this.listenToOnce(this.currModel,"change:hasReadyAd",this._onAdImpression.bind(this)),this.listenTo(this.currModel,"ProgressLoaderRepositioned",this._restart.bind(this))},_setInitialParameters:function(e){this.log=new $e({unitType:this.model.get("unitType"),className:"adLoadingProgressView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.currModel=e.globalModel?e.globalModel:this.model,this.$el=Object(n.a)(this.el),this.viewPercent=this.currModel.get("components.adLoadingProgress.inViewPortEligibility")||100,this.loadingTimerTime=Number(this.currModel.get("components.adLoadingProgress.maxProgressTime"))||5e3,this.count=1,this.currModel.set("loaderCurrCount",this.count),this.progressTik=this.loadingTimerTime/50,this.showProgress=this.currModel.get("components.adLoadingProgress.showProgressBar")},render:function(){this._initTemplate(),this._customize(),this.model.get("eligiblePlaceholder")?this._renderComponent():this.model.once("change:eligiblePlaceholder",this._renderComponent.bind(this))},_renderComponent:function(){this.container=this.model.get("eligiblePlaceholder");var e={width:this.model.get("width")+3+"px",height:this.model.get("height")+2+"px"};this.$el.css(e),this.$el.css(this._getPosition(this.model.get("eligiblePlaceholder"))),Object(n.a)("body").append(this.el),this.$el.css(),Object(n.a)("._cm-ad-loading-progress_title_span").text(this.currModel.get("components.adLoadingProgress.title")),this.showProgress&&Object(n.a)("._cm-ad-loading-progress-container").css({display:"block"})},_initTemplate:function(){var e=He.template(ze)(this._settings);this.$el.append(e),this.$loadingPercentElement=Object(n.a)("._cm-ad-loading-progress_percent_span")},_onFirstAdLoaded:function(){this.log.info("FirstAd _onFirstAdLoaded loaded"),this.currModel.get("isFirstAdLoaded")&&(this._startWatchingViewPort(),this._show())},_startWatchingViewPort:function(){this.listenTo(We,"window:scroll:change",this._calculateViewPortIntersection.bind(this,!1));var e=this.$el.parent().height();this.$el.parent().height(e+1)},_calculateViewPortIntersection:function(){if(!this.stopWatchingViewPort){var e=He.getViewPercent(this.el,this.$el.width(),this.$el.height(),this.currModel.get("scrollSelector"));this.log.info("currViewPercent: ",e||0),this.viewPercent<=e&&(this._startLoadingTimer(),this.stopWatchingViewPort=!0)}},_onAdImpression:function(){this.model.get("progressLoaderTimerReached")&&this.model.set("eligiblePlaceholder",!1),this.close()},_startLoadingTimer:function(){this.loadingTimer=window.setTimeout(function(){this.log.info("Loading timer progress reached"),this.currModel.set("progressLoaderTimerReached",!0),window.clearInterval(this.calculationInterval),this.calculationInterval=null}.bind(this),this.loadingTimerTime),this._startCalculation()},_startCalculation:function(){this.calculationInterval=window.setInterval(function(){this._calculateLoadingProgress(),Object(n.a)("._cm-ad-loading-progress-bar-loaded").css({width:"100%",transition:"width "+this.loadingTimerTime+"ms","transition-timing-function":"linear"})}.bind(this),this.progressTik)},_calculateLoadingProgress:function(){Object(n.a)("._cm-ad-loading-progress_percent_span").text(this.count+"%"),this.count<100&&(this.count+=2,this.currModel.set("loaderCurrCount",this.count))},_restart:function(){this.container=this.model.get("eligiblePlaceholder"),this._renderComponent(),this._hide(),this.currModel.set("progressLoaderTimerReached",!1),Object(n.a)("._cm-ad-loading-progress_percent_span").text("1%"),this.count=1,Object(n.a)("._cm-ad-loading-progress-bar-loaded").css({transition:"none",width:"0%"}),this.stopWatchingViewPort=!1,this._show()},_show:function(){this.$el.css({display:"flex"})},_hide:function(){this.$el.css({display:"none"})},close:function(){this.model.set("progressLoaderViewClosed",!0),this._hide(),window.clearInterval(this.calculationInterval),this.calculationInterval=null,this.loadingTimer&&(window.clearTimeout(this.loadingTimer),this.loadingTimer=null),this.stopListening(We,"window:scroll:change"),this.model.set("components.adLoadingProgress.isActive".false)},_customize:function(){var e=this.model.get("components.adLoadingProgress.additionalCss");this.$el.css(He.toCssObj(e))},_getPosition:function(e){var t=e.getBoundingClientRect(),i=document.body.getBoundingClientRect();return{top:t.top-i.top-1+"px",left:t.left+"px"}}}),i(56));i.n(Ge);i(5);var qe=(o.b,i(57)),Ye=i.n(qe);function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var et=i(5),tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ze(e);if(t){var o=Ze(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Je(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).log=new c.a({unitType:t.model.get("unitType"),className:"ContentVideoView",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.model=e.model,t.container=e.container,t.$el.css({display:"none"}),t.isHidden=!0,Object(n.a)(t.container).append(t.$el),t._addContentStyleObserver(),t.contentTimer=null,t.model.get("repeat")&&t.model.set("components.contentVideo.isRepeat",!0),t.handleMouseActivity(),t.bindRenderShowEvents(),t}return t=r,(i=[{key:"bindRenderShowEvents",value:function(){var e=[];this.model.get("displayFiller.beforeAd")===k.a.DISPLAY_FILLER.BEFORE_AD.CONTENT&&e.push({event:"player.playlist",funcName:"render"}),this.model.get("displayFiller.betweenAds")===k.a.DISPLAY_FILLER.BETWEEN_ADS.CONTENT&&e.push({event:"adQState:completed",funcName:"render"}),this.model.get("displayFiller.onTimeout")===k.a.DISPLAY_FILLER.ON_TIMEOUT.CONTENT&&e.push({event:"closeTimer:midrollCollapse",funcName:"render"}),e.length>0&&e.push({event:"closeState",funcName:"onCloseState"}),this.createStateHandlers(e)}},{key:"render",value:function(){this.model.get("hasReadyAd")&&!this.model.get("timeBetweenAds")||(this.log.info("Content is being loaded!"),this.video||(this.$el.append(Ye.a),this.el.id="_cm-css-reset",this._customize(),this.playList=this.model.get("player.playlist"),this.currentTrackIndex=0,this.initVideo(),this._addVideoControls(),this.initLoadingBackground(),this.bindEvents()),this.show())}},{key:"_addVideoControls",value:function(){this.videoControls=new ut({container:this.el,model:this.model,video:this.video})}},{key:"bindEvents",value:function(){this.createStateHandlers([{event:"isEligibleToPlay",funcName:"checkEligible"},{event:"isInTab",funcName:"checkEligible"},{event:"mute:true",funcName:"mute"},{event:"mute:false",funcName:"unMute"},{event:"content.playClicked:true",funcName:"play"},{event:"content.pauseClicked:true",funcName:"pause"},{event:"adQState:q0",funcName:"hide"},{event:"adState:playing",funcName:"hide"},{event:"blockedByExternalUnit:true",funcName:"pause"},{event:"blockedByExternalUnit:false",funcName:"play"}])}},{key:"initVideo",value:function(){this.video=this.$el.find("video")[0],this.model.get("contentClickUrl")&&(this.video.onclick=this.contentClickThru.bind(this),this.video.style.cursor="pointer"),this.video.src=this.playList[this.currentTrackIndex].url,this.video.addEventListener("ended",this.onEnd.bind(this)),this.video.addEventListener("loadeddata",this.onLoaded.bind(this)),this.video.addEventListener("playing",this.onPlaying.bind(this)),this.video.muted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("playsinline","")}},{key:"initLoadingBackground",value:function(){this.$loadingImg=this.$el.find("._cm-background-loading"),-1!==!this.$loadingImg.index()?this.$loadingImg.css({backgroundImage:'url("'.concat(this.model.get("components.contentVideo.X"),'")')}):this.log.warning("No loading background found!")}},{key:"show",value:function(){this.isTerminated||(this.model.set("content.isContentPlay",!0),this.log.info("Content video show"),this.isHidden=!1,this.$el.css({display:"block"}),this.play())}},{key:"hide",value:function(){this.isTerminated||(this.model.set("content.isContentPlay",!1),this.log.info("Content video hide"),this.isHidden=!0,this.$el.css({display:"none"}),this.pause())}},{key:"play",value:function(){var e=this;if(this.video){if(this.model.get("content.playClicked")||!this.model.get("content.pauseClicked")){this.model.set("content.playClicked",!1),this.model.set("content.startProgressBar",!0);var t=this.video.play();this.model.set("isExternalComponentBlockingAdFromPlay",!0,{silent:!0}),void 0!==t?t.catch((function(t){e.model.set("isExternalComponentBlockingAdFromPlay",!1),e.log.info("Auto-play was prevented",t)})).then((function(){e.log.info("Auto-play content video started"),e.isHidden||e.model.set("content.isContentPlay",!0),e.contentTimer=setTimeout((function(){e.model.set("isExternalComponentBlockingAdFromPlay",!1)}),1e3*e.getTimeoutBeforeOrBetweenAds())})):this.model.set("isExternalComponentBlockingAdFromPlay",!1)}}else this.log.warning("Play was called without video render!")}},{key:"getTimeoutBeforeOrBetweenAds",value:function(){var e=this.model.get("isFirstAd");return"content"===this.model.get("displayFiller.beforeAd")&&e&&this.model.get("timeBeforeFirstAd")>0?this.model.get("timeBeforeFirstAd"):"content"===this.model.get("displayFiller.betweenAds")&&!e&&this.model.get("timeBetweenAds")>0?this.model.get("timeBetweenAds"):0}},{key:"pause",value:function(){this.video?(this.model.set("content.startProgressBar",!1),this.video.pause()):this.log.warning("Pause was called without video render!")}},{key:"mute",value:function(){this.video.muted=!0,this.video.setAttribute("muted",""),this.model.set("mute",!0)}},{key:"unMute",value:function(){this.video.muted=!1,this.video.removeAttribute("muted"),this.model.set("mute",!1)}},{key:"onLoaded",value:function(){this.$loadingImg&&this.$loadingImg.hide()}},{key:"onPlaying",value:function(){this.model.get("components.contentVideo.isActive")&&this.model.get("displayFiller.beforeAd")===k.a.DISPLAY_FILLER.BEFORE_AD.CONTENT&&this.model.trigger("contentReadySliderShow")}},{key:"onEnd",value:function(){this.isTerminated||(this.$loadingImg&&this.$loadingImg.show(),this.model.get("components.contentVideo.isRepeat")&&(this.playList.length-1===this.currentTrackIndex&&(this.currentTrackIndex=-1),this.video.src=this.playList[++this.currentTrackIndex].url,this.model.set("content.isContentPlay",!1),clearTimeout(this.contentTimer),this.model.set("isExternalComponentBlockingAdFromPlay",!1,{silent:!0}),this.play()))}},{key:"handleMouseActivity",value:function(){"onHover"===this.model.get("volume")&&(this.el.onmouseenter=this.onMouseEnter.bind(this),this.el.onmouseleave=this.onMouseLeave.bind(this))}},{key:"onMouseEnter",value:function(){this.unMute()}},{key:"onMouseLeave",value:function(){this.mute()}},{key:"contentClickThru",value:function(){window.open(this.model.get("contentClickUrl"))}},{key:"_customize",value:function(){var e=this.model.get("components.contentVideo.additionalCss");this.$el.css(et.toCssObj(e))}},{key:"checkEligible",value:function(){this.isEligibleToPlay()?this.play():this.pause()}},{key:"isEligibleToPlay",value:function(){return!this.isHidden&&!this.model.get("blockedByExternalUnit")&&(this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===a.videoViewState.detached:this.model.get("videoViewState")===a.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView)}},{key:"onCloseState",value:function(){this.isTerminated||(this.model.get("closeState")!==a.closeState.terminate&&this.model.get("closeState")!==a.closeState.adManagerStop?this.model.isLoadcomponent("content","onTimeout")?this.video?this.show():this.render():this.hide():this.terminate())}},{key:"terminate",value:function(){this.log.info("Terminate"),this.isTerminated||(clearTimeout(this.contentTimer),this.model.set("isExternalComponentBlockingAdFromPlay",!1,{silent:!0}),this.isTerminated=!0,this.video&&(this.hide(),this.mute(),this.video.removeAttribute("src"),this.video.load(),this._destroy()),this.log.info("Content is terminated."))}},{key:"_destroy",value:function(){this.video.removeEventListener("ended",this.onEnd),this.video.removeEventListener("loadeddata",this.onLoaded),this.video.removeEventListener("playing",this.onPlaying),this.mo&&this.mo.disconnect(),this.container&&this.container.parentElement&&this.container.parentElement.removeChild(this.container),this.container=this.mo=void 0}},{key:"_addContentStyleObserver",value:function(){var e=this,t=this.$el[0];t&&window.MutationObserver&&(this.mo=new window.MutationObserver((function(){"none"!==t.style.display&&e.isHidden&&(t.style.display="none")})),this.mo.observe(t,{attributes:!0,attributeFilter:["style"]}))}},{key:"className",get:function(){return"_cm-content-video"}}])&&Qe(t.prototype,i),r}(o.b),it=i(58),nt=i.n(it),ot=i(3),rt=i(5),st=i(11),at=(i(2),ot.View.extend({className:"_cm-skip-ad-area",id:"_cm-skip-ad-area",events:{"click ":"_onClick"},initialize:function(e){this.log=new st({unitType:e.unitType,className:"SkipAdButtonView"}),this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a,this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener()},render:function(){if(!this._rendered){this._rendered=!0,this._settings=this.model.get("components.skipAdButton");var e=rt.template(nt.a)(this._settings);this.$el.append(e),this.container.appendChild(this.el)}},_bindEvents:function(){},_onClick:function(e){e.stopPropagation(),this.model.increaseCounter("skipButtonClicked")},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),i(59)),lt=i.n(at),ct=i(3),dt=(i(5),i(11)),ut=ct.View.extend({className:"video_controls show",id:"video_controls",initialize:function(e){this.log=new dt({unitType:e.unitType,className:"progressBarView"}),this.model=e.model,this.container=e.container,this.video=e.video,this._bindEvents(),this.render()},_bindEvents:function(){this.video.addEventListener("ended",this.resetProgress.bind(this)),this.model.listenTo(this.model,"change:mute",this.muteChanged.bind(this)),this.model.listenTo(this.model,"change:content.startProgressBar",this.ManageProgressBarInterval.bind(this))},render:function(){this.container.appendChild(this.el),this.$el.append(lt.a),this.setControls(),this.show()},setControls:function(){this.setProgressBarComponent(),this.setPlayPauseButton(),this.setMuteButton()},hide:function(){this.$el.hide()},show:function(){this.$el.show()},setProgressPercent:function(e){this.progressDiv.style.width=e+"%"},resetProgress:function(){this.progressDiv.classList.add("init_bg"),this.setProgressPercent(0)},playClicked:function(){this.model.set("content.playClicked",!0),this.model.set("content.pauseClicked",!1),this.pauseButton.classList.add("show"),this.pauseButton.classList.remove("hide"),this.playButton.classList.remove("show"),this.playButton.classList.add("hide")},pauseClicked:function(){this.model.set("content.pauseClicked",!0),this.playButton.classList.add("show"),this.playButton.classList.remove("hide"),this.pauseButton.classList.remove("show"),this.pauseButton.classList.add("hide")},muteClicked:function(){this.model.get("mute")?this.unMute():this.mute()},muteChanged:function(){this.model.get("mute")?this.setMuteClasses():this.setUnMuteClasses()},mute:function(){this.model.set("mute",!0),this.setMuteClasses()},unMute:function(){this.model.set("mute",!1),this.setUnMuteClasses()},setMuteClasses:function(){this.muteImg.style.display="block",this.unmuteImg.style.display="none"},setUnMuteClasses:function(){this.muteImg.style.display="none",this.unmuteImg.style.display="block"},setProgressBarComponent:function(){this.progressDiv=this.$el.find(".blue_bg")[0],this.progressComponentDiv=this.$el.find(".cm_video_controls_progressbar_area")[0],this.model.get("components.contentVideo.hideProgressBar")&&(this.progressComponentDiv.style.display="none"),this.resetProgress()},setMuteButton:function(){this.muteButton=this.$el.find(".cm_video_controls_mute").get(0),this.model.get("components.contentVideo.hideMuteButton")&&(this.muteButton.style.display="none"),this.muteImg=this.$el.find(".cm_video_controls_mute .display_mute").get(0),this.unmuteImg=this.$el.find(".cm_video_controls_mute .display_unmute").get(0),this.muteImg.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.muteImgUrl"),'")'),this.unmuteImg.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.unmuteImgUrl"),'")'),this.muteButton.onclick=this.muteClicked.bind(this),this.muteChanged()},setPlayPauseButton:function(){this.playButton=this.$el.find(".play")[0],this.pauseButton=this.$el.find(".pause")[0],this.pauseButton.style.backgroundImage='url("'.concat(this.model.get("components.contentVideo.pauseImgUrl"),'")'),this.model.get("components.contentVideo.hidePlayButton")&&(this.pauseButton.classList.remove("show"),this.pauseButton.classList.add("hide")),this.playButton.onclick=this.playClicked.bind(this),this.pauseButton.onclick=this.pauseClicked.bind(this)},ManageProgressBarInterval:function(){this.model.get("content.startProgressBar")?this.progressInterval=setInterval(this.setProgress.bind(this),100):this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)},setProgress:function(){this.setProgressPercent(this.video.currentTime/this.video.duration*100)}}),ht=i(3),ft=i(5),pt=i(11),mt=i(46),gt=(ht.View.extend({className:"_cm-ad-loading-progress",id:"_cm-css-reset",initialize:function(e){e.isActive&&(this.model=e.model,this.container=e.container,this._setInitialParameters(e),this._bindEvents(),this.render(),this._startWatchingViewPort(),this.log.info("ad-loading-progress initialize"))},_bindEvents:function(){this.log.info("ad-loading-progress _bindEvents"),this.listenToOnce(this.model,"change:hasReadyAd",this.close.bind(this)),this.listenTo(this.model,"change:ProgressLoaderRepositioned",this._restart.bind(this))},_setInitialParameters:function(e){this.log=new pt({unitType:this.model.get("unitType"),className:"adLoadingProgressView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.globalModel=e.globalModel||this.model,this.globalModel.set("progressLoaderInit",!0),this.$el=Object(n.a)(this.el),this.viewPercent=this.model.get("components.adLoadingProgress.inViewPortEligibility")||100,this.loadingTimerTime=Number(this.model.get("components.adLoadingProgress.maxProgressTime"))||5e3,this.count=1,this.globalModel.set("loaderCurrCount",this.count),this.progressTik=this.loadingTimerTime/100,this.showProgress=this.model.get("components.adLoadingProgress.showProgressBar")},render:function(){this._initTemplate(),this._customize(),this._renderComponent(),this._show()},_initTemplate:function(){var e=ft.template(mt)(this._settings);this.$el.append(e),this.$loadingPercentElement=Object(n.a)("._cm-ad-loading-progress_percent_span")},_customize:function(){var e=this.model.get("components.adLoadingProgress.additionalCss");this.$el.css(ft.toCssObj(e))},_renderComponent:function(){var e={width:this.model.get("width")+"px",height:this.model.get("height")+"px"};this.$el.css(e),Object(n.a)(this.container).append(this.el),Object(n.a)("._cm-ad-loading-progress_title_span").text(this.model.get("components.adLoadingProgress.title")),this.showProgress&&Object(n.a)("._cm-ad-loading-progress-container").css({display:"block"})},_startWatchingViewPort:function(){this.listenTo(ht,"window:scroll:change",this._calculateViewPortIntersection.bind(this,!1)),this._calculateViewPortIntersection()},_calculateViewPortIntersection:function(){var e=ft.getViewPercent(this.el,this.$el.width(),this.$el.height(),this.model.get("scrollSelector"));!this.calculationRunning&&this.viewPercent<=e&&this._startLoadingTimer(),this.calculationRunning&&!e&&this.el.getBoundingClientRect().top<0&&this._stopCalculation()},_startLoadingTimer:function(){this.loadingTimer=window.setTimeout(function(){this._stopCalculation()}.bind(this),this.loadingTimerTime),this._startCalculation()},_startCalculation:function(){this.calculationRunning=!0,this.calculationInterval=window.setInterval(function(){this._calculateLoadingProgress()}.bind(this),this.progressTik),Object(n.a)("._cm-ad-loading-progress-bar-loaded").css({width:"100%",transition:"width "+this.loadingTimerTime+"ms","transition-timing-function":"linear"})},_stopLoadingTimer:function(){this.loadingTimer&&clearTimeout(this.loadingTimer)},_stopCalculation:function(){this.calculationRunning=!1,this.globalModel.set("progressLoaderTimerReached",!0),window.clearInterval(this.calculationInterval),this.calculationInterval=null},_calculateLoadingProgress:function(){Object(n.a)("._cm-ad-loading-progress_percent_span").text(this.count+"%"),this.count<100&&(this.count+=1,this.globalModel.set("loaderCurrCount",this.count))},_restart:function(){this._stopLoadingTimer(),this.globalModel.set("progressLoaderTimerReached",!1),this.model.get("ProgressLoaderRepositioned")&&(Object(n.a)("._cm-ad-loading-progress_percent_span").text("1%"),this.count=1,Object(n.a)("._cm-ad-loading-progress-bar-loaded").css({transition:"none",width:"0%"}),this.calculationRunning=!1,this.model.set("ProgressLoaderRepositioned",!1))},_show:function(){this.$el.css({display:"flex"}),this.model.set("isProgressLoaderViewRunning",!0)},_hide:function(){this.$el.css({display:"none"})},close:function(){this.log.info("close loader"),this.model.set("isProgressLoaderViewRunning",!1),this.globalModel.set("progressLoaderViewClosed",!0),this._hide(),window.clearInterval(this.calculationInterval),this.calculationInterval=null,this.loadingTimer&&(window.clearTimeout(this.loadingTimer),this.loadingTimer=null),this.stopListening(ht,"window:scroll:change"),this.model.set("components.adLoadingProgress.isActive",!1)}}),i(47),i(60)),yt=i.n(gt),vt=i(61),bt=i.n(vt);function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pt=i(5),Ct="_cm-native-ad",Et={title:"._cm-native-ad-title",ctaButtone:"._cm-native-ad-cta-button",description:"._cm-native-ad-description",icon:"._cm-native-ad-icon",branding:"._cm-native-ad-branding",adChoice:"._cm-ad-choice",placeholder:"._cm-feed-manager-video-placeHolder",wrapper:"._cm-native-ad-bottom"},kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Tt(e);if(t){var o=Tt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return At(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).model=e.model,t.globalModel=e.globalModel,t.shouldHideBrandingText=e.shouldHideBrandingText||!1,t.shouldFitToSize=e.shouldFitToSize||!1,t.isMultiFloatingNASElements=e.isMultiFloatingNASElements||!1,e.additionalCss&&t._addAdditionalCss(e.additionalCss),t.log=new c.a({unitType:t.model.get("unitType"),className:constructor.name,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.template=t._isTitleOnTop()?bt.a:yt.a,t.container=Object(n.a)(e.container),t.nativeAdMapping=t.globalModel.get("nativeAdMapping"),(t.model.get("stickyCard.isActive")||!t.model.get("detachToSlider.isStartFromSlider")&&!t.model.get("detachToSlider.isDetachToSlider"))&&(t.isSticky=!0,t._setToModel("floatingNAS.isActive",!1)),t.bindEvents(),t}return t=r,(i=[{key:"_setToModel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.model.set(e,t,i),this.globalModel&&this.globalModel.set(e,t,i)}},{key:"_render",value:function(){this.renderTemplate(),this._adjustRTL(),this.$el.addClass(Ct),this.container.append(this.$el),this._addAdChoiceTitle(),this.rendered=!0}},{key:"_adjustRTL",value:function(){var e=this._getCssFromSelector(this.model.get("rboxCssSelectors.title"));e&&"rtl"===e.direction&&(this.ui.wrapper.css({"flex-direction":"row-reverse",direction:"ltr"}),this.ui.icon.addClass("_cm-native-ad-icon-rtl").removeClass("_cm-native-ad-icon"))}},{key:"bindEvents",value:function(){this.createStateHandlers([{event:"adNativeSettings",funcName:"_updateAdData"},{event:"repeatState:".concat(a.repeatState.hiding),funcName:"show"},{event:"loadingViewState:".concat(a.loadingViewState.hiding),funcName:"show"},{event:"floatingView:".concat(a.floatingView.detach),funcName:"detach"},{event:"floatingView:".concat(a.floatingView.attach),funcName:"attach"},{event:"floatingView:".concat(a.floatingView.postAttach),funcName:"postAttach"},{event:"floatingView:".concat(a.floatingView.permanentClosed),funcName:"permanentClosed"}])}},{key:"_updateAdData",value:function(){this.rendered||this._render(),this.adNativeSettings=this.model.get("adNativeSettings"),this._displayTitleOnTop(),this._setRandomTitle(),this._handleBranding(),this.isClickable=this.adNativeSettings.isClickable;var e=this.model.get("rboxCssSelectors.title");this._updateContainerViewTitleVisibility(),this._adjustDescFontToTitleFont(e),this._updateTitleContainerEl(this.ui.ctaButtone,this.adNativeSettings[this.nativeAdMapping.ctaButtone],"",this.model.get("customization.cta")),this._updateTitleContainerEl(this.ui.title,this.adNativeSettings[this.nativeAdMapping.title],e,this.model.get("customization.title")),this._updateTitleContainerEl(this.ui.description,this.adNativeSettings[this.nativeAdMapping.description],this.model.get("rboxCssSelectors.description"),this.model.get("customization.description")),this._updateTitleContainerEl(this.ui.branding,this.adNativeSettings[this.nativeAdMapping.branding],this.model.get("rboxCssSelectors.branding"),this.model.get("customization.branding")),this._updateIcon(this.adNativeSettings[this.nativeAdMapping.icon]),this._createFloatingNAS(),this._isSuperSlider()?this.hide():this.show(),this._fitToSize(),this.adDataUpdated=!0,this.model.trigger("nativeAdSettingsUpdated")}},{key:"_setRandomTitle",value:function(){this.model.get("getRandomNativeAdTitle")&&!this.adNativeSettings[this.nativeAdMapping.title]&&(this.adNativeSettings[this.nativeAdMapping.title]=Pt.getRandomFromList(this.model.get("randomTitlesList")))}},{key:"_displayTitleOnTop",value:function(){var e=this;this._isTitleOnTop()&&(this.model.set("isTitleOnTop",!0),this.model.set("getRandomNativeAdTitle",!1),this._displayTitleOnly(),Object(n.a)(this.ui.title).css({"max-width":"340px"}),setTimeout((function(){return Object(n.a)(e.ui.title).css({"max-width":"225px"})}),2e3))}},{key:"_isTitleOnTop",value:function(){return this.model.get("unitType").indexOf("RECO_REEL_WIDGET")>-1&&this.model.get("frameType")===k.a.FRAME_TYPE.amp&&this.model.get("showTitleOnTop")}},{key:"_handleBranding",value:function(){this.shouldHideBrandingText&&(this.containerHeight=this.containerHeight||Object(n.a)("._cm-widget-item").height(),this.model.trigger("change:customization.titleContainer.branding.displayState",this._hasNASTitle()?a.brandingDisplayState.hide:a.brandingDisplayState.show))}},{key:"_fitToSize",value:function(){if(this.shouldFitToSize)if(this.hasNAS=this._hasNASTitle(),this.hasNAS){if(!this.detached){this.fitToSizeDisplaying=k.a.NATIVE_AD.FIT_TO_SIZE.NONE;var e=this.model.get("videoPlaceholderSize");this.containerHeight&&e&&(this._canFitTitleAndDescription(e)?this._canFitTitleOnly(e)?(this.fitToSizeDisplaying=k.a.NATIVE_AD.FIT_TO_SIZE.TITLE,this._displayTitleOnly(),this.model.trigger("displayingNASTitleOnly")):this.hide():(this.fitToSizeDisplaying=k.a.NATIVE_AD.FIT_TO_SIZE.FULL,this.show(),this.model.trigger("displayingFullNAS")))}}else this.hide()}},{key:"_canFitTitleAndDescription",value:function(e){return Number(e.height)+this.$el.height()>=this.containerHeight}},{key:"_canFitTitleOnly",value:function(e){return Number(e.height)+this.ui.title.height()<this.containerHeight}},{key:"_displayTitleOnly",value:function(){this.ui.title.show(),this.ui.description.hide(),this.ui.ctaButtone.hide(),this.ui.branding.hide(),this.ui.icon.hide(),this.container.height(this.containerHeight)}},{key:"_isSuperSlider",value:function(){return this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider")}},{key:"_updateContainerViewTitleVisibility",value:function(){var e=this.adNativeSettings.title||this.adNativeSettings.ctatext||this.adNativeSettings.desc||this.adNativeSettings.sponsored,t=this.container.find("._cm-ad-title");e?(t.hide(),this.ui.adChoice.show()):(t.show(),this.ui.adChoice.hide())}},{key:"_adjustDescFontToTitleFont",value:function(e){var t=this.model.get("customization.description");if(!t)try{var i=parseInt(this._getCssFromSelector(e).fontSize);isNaN(i)||(t={},Pt.extend(t,{"font-size":i*k.a.NATIVE_AD.DESC_TITLE_FONT_RATIO+"px"}),this.model.set("customization.description",t))}catch(e){this.log.info("No title selector found - apply default values")}}},{key:"_updateTitleContainerEl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(e.text(t),t)this._applyCssFromSelector(e,i,n),e.show();else{var o=e===this.ui.ctaButtone;o&&e.hide()}this._updateTitleContainerClickability(e)}},{key:"_applyCssFromSelector",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Pt.pick(this._getCssFromSelector(t),k.a.CSS_PROPERTIES_FROM_RBOX);Pt.extend(n,i),e.css(Pt.toCssObj(n))}},{key:"_getCssFromSelector",value:function(e){if(!e)return{};var t="string"==typeof e?document.querySelector(e):e;return t&&getComputedStyle(t)}},{key:"_updateTitleContainerClickability",value:function(e){this.isClickable?(e[0].onclick=this._onClick.bind(this),e.css({cursor:"pointer"}),e.attr("role","link")):(e[0].onclick=null,e.css({cursor:"default"}),e.removeAttr("role"))}},{key:"_onClick",value:function(e){var t=e.target.getAttribute("data-click-name");this.model.set("nativeAdClick",t,{silent:!0}),this.model.trigger("change:nativeAdClick",t)}},{key:"_updateIcon",value:function(e){e?(this.iconImg||this._createIconImg(),this.iconImg.src=e,this._updateTitleContainerClickability(this.ui.icon),this.ui.icon.show()):this.ui.icon.hide()}},{key:"_createIconImg",value:function(){this.iconImg=document.createElement("img"),this.iconImg.className="_cm-native-ad-icon-img",this.iconImg.setAttribute("data-click-name","adIconClick"),this.iconImg.addEventListener("error",this._onError.bind(this)),this.ui.icon.css(Pt.toCssObj(Pt.extend({},this.model.get("customization.icon")))),this.ui.icon.append(this.iconImg)}},{key:"_onError",value:function(){this.log.error("can't load native ad icon"),this.ui.icon.hide()}},{key:"_addAdChoiceTitle",value:function(){this.model.get("components.adChoice.isActive")&&this.model.get("components.adChoice.title.isActive")&&(this.adChoice=new Pe({model:this.model,container:this.ui.adChoice,parent:this.el,type:k.a.AD_CHOICE_TYPE.TITLE}))}},{key:"_addAdditionalCss",value:function(e){Object(n.a)(this.el).addClass(e)}},{key:"hide",value:function(){this.$el.hide()}},{key:"show",value:function(){this._isSuperSlider()||this.$el.show()}},{key:"_createFloatingNAS",value:function(){this.globalModel.get("floatingNAS.isActive")&&(this.hasNAS=this._hasNASTitle(),this.hasNAS&&(this.isMultiFloatingNASElements&&this._removePreviousFloatingNASElement(),this.ui.floatingNAS={},this._createFloatingNASWrapper(),this._createFloatingNASTitle(),this._appendFloatingNAS()))}},{key:"_removePreviousFloatingNASElement",value:function(){this.ui.floatingNAS&&this.ui.floatingNAS.wrapper&&this.ui.floatingNAS.wrapper.parentElement.removeChild(this.ui.floatingNAS.wrapper)}},{key:"_createFloatingNASWrapper",value:function(){this.ui.floatingNAS.wrapper=document.createElement("div"),this.ui.floatingNAS.wrapper.className="".concat(Et.wrapper.replace(/^\./,"")," _cm-native-ad-bottom-floating"),this.shouldFitToSize&&!this.detached&&Object(n.a)(this.ui.floatingNAS.wrapper).addClass("hide"),this.ui.floatingNAS.wrapper.style.width=this.model.get("detachToSlider.width")+"px"}},{key:"_createFloatingNASTitle",value:function(){this.ui.floatingNAS.title=this.ui.title[0].cloneNode(!0),this.ui.floatingNAS.title.className+=" _cm-native-ad-title-floating"}},{key:"_appendFloatingNAS",value:function(){this.ui.floatingNAS.wrapper.appendChild(this.ui.floatingNAS.title),this._getActiveAd().appendChild(this.ui.floatingNAS.wrapper)}},{key:"_getActiveAd",value:function(){return document.getElementsByClassName("_cm-ad-active")[0]||this.container.get(0)}},{key:"_getFloatingView",value:function(){return document.getElementsByClassName("_cm-floating-view")[0]}},{key:"_hasNASTitle",value:function(){return"string"==typeof this.adNativeSettings[this.nativeAdMapping.title]}},{key:"detach",value:function(){this.isSticky?this.hide():this.shouldFitToSize&&this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.NONE||(this.detached=!0,this.hasNAS&&(this.ui.floatingNAS.wrapper.style.width=this.model.get("detachToSlider.width")+"px",this.ui.floatingNAS.wrapper.className=this.ui.floatingNAS.wrapper.className.replace(" hide","")))}},{key:"attach",value:function(){this.isSticky||this.shouldFitToSize&&this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.NONE||this.hasNAS&&this.detached&&(this.ui.floatingNAS.wrapper.style.width=this.model.get("width")+"px")}},{key:"postAttach",value:function(){this.isSticky?this._displayFitToSizeNAS():this.shouldFitToSize&&this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.NONE||(this.hasNAS&&this.detached&&(this._handleActiveAdWithoutNAS(),this.ui.floatingNAS.wrapper.className+=" hide",this._displayFitToSizeNAS()),this.detached=!1)}},{key:"_displayFitToSizeNAS",value:function(){this.shouldFitToSize&&this.fitToSizeDisplaying!==k.a.NATIVE_AD.FIT_TO_SIZE.NONE&&(this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.TITLE?this._displayTitleOnly():this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.FULL&&this.show())}},{key:"triggerDetachIfRendered",value:function(){this.adDataUpdated&&this.model.trigger("nativeAdSettingsUpdated")}},{key:"getFloatingNASHeight",value:function(){return this.ui.floatingNAS&&this.ui.floatingNAS.wrapper?this.ui.floatingNAS.wrapper.getBoundingClientRect().height:0}},{key:"getNASHeight",value:function(){return this.shouldFitToSize&&this.fitToSizeDisplaying!==k.a.NATIVE_AD.FIT_TO_SIZE.NONE?this.fitToSizeDisplaying===k.a.NATIVE_AD.FIT_TO_SIZE.TITLE?this.ui.title.height():this.$el.height():0}},{key:"onAdComplete",value:function(){this.prevAdNAS=this.hasNAS,this.adDataUpdated=!1,this.hasNAS&&this.detached&&(this._handleFloatingViewWithoutNAS(),this._isSuperSlider()&&this._handleActiveAdWithoutNAS())}},{key:"onAdDisplayChange",value:function(){if(this.hasNAS&&this.detached){if(this.prevAdNAS&&this._isSuperSlider())return;this._handleFloatingViewWithNAS(),this._isSuperSlider()&&this._handleActiveAdWithNAS()}}},{key:"onAdSwapped",value:function(){this.hasNAS=this._hasNASTitle()||this._isActiveAdContainNAS(),this.detached&&this.hasNAS!==this.prevAdNAS&&(this.hasNAS?this._handleFloatingViewWithNAS():(this._handleFloatingViewWithoutNAS(),this._handleActiveAdWithNAS())),this.prevAdNAS=this.hasNAS}},{key:"_handleFloatingViewWithNAS",value:function(){var e=this._getFloatingView();e&&(e.style.bottom=parseInt(e.style.bottom)+this.getFloatingNASHeight()+"px")}},{key:"_handleFloatingViewWithoutNAS",value:function(){var e=this._getFloatingView();e&&(e.style.bottom=Math.max(parseInt(e.style.bottom)-this.getFloatingNASHeight(),0)+"px")}},{key:"_handleActiveAdWithNAS",value:function(){var e=this._getActiveAd();e&&(e.style.height=parseInt(e.style.height)+this.getFloatingNASHeight()+"px")}},{key:"_handleActiveAdWithoutNAS",value:function(){var e=this._getActiveAd();if(e){var t=parseInt(e.style.height);t>this.model.get("videoPlaceholderSize").height&&(e.style.height=t-this.getFloatingNASHeight()+"px")}}},{key:"_isActiveAdContainNAS",value:function(){var e=this._getActiveAd();return!!e&&e.getElementsByClassName("_cm-native-ad-bottom-floating").length>0}},{key:"permanentClosed",value:function(){this._isSuperSlider()&&this.hide()}},{key:"hideFloatingNAS",value:function(){this.detached&&this.ui.floatingNAS&&Object(n.a)(this.ui.floatingNAS.wrapper).addClass("hide")}},{key:"showFloatingNAS",value:function(){this.detached&&this.ui.floatingNAS&&Object(n.a)(this.ui.floatingNAS.wrapper).removeClass("hide")}},{key:"className",get:function(){return Ct}},{key:"ui",get:function(){return this.UI?this.UI:this.UI=Et},set:function(e){return this.UI=e}}])&&St(t.prototype,i),r}(o.b);i(62),i(5);var Ot=i(63),It=i.n(Ot),Vt=i(64),Dt=i.n(Vt),Rt=i(3),xt=i(5),Nt=i(11),Mt=Rt.View.extend({className:"_cm-content-carousel-item",events:{"click ":"_onClick"},initialize:function(e){this.log=new Nt({unitType:e.unitType,className:"ContentCarouselItemView"}),this.model=e.model,this.itemId=e.itemId,this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a,Object(n.a)(this.container).append(this.$el),this._setInfo(),this.render()},render:function(){if(!this._rendered){var e=xt.template(Dt.a)(this.itemInfo);this.$el.append(e),this.imageNode=this.$el.find("._cm-content-carousel-item-image"),this.imageNode.css({"background-image":' url("'.concat(this.model.get("components.contentCarousel.backgroundImage"),'")')})}},_bindEvents:function(){},_onClick:function(){this.itemInfo.selected||this.model.set("playlistItemClicked",this.itemId)},_setInfo:function(){this.itemInfo=this.model.get("player.playlist")[this._getItemIndex()],this.itemInfo.description=this.itemInfo.title.replace(/-/g," "),this.itemInfo.playingNowString=this.model.get("playingNowString"),this.updateSelected()},updateSelected:function(){this.itemInfo.selected=this.model.get("player.playlist")[this._getItemIndex()].selected,Object(n.a)(this.$el).removeClass("true"),Object(n.a)(this.$el).removeClass("false"),Object(n.a)(this.$el).addClass(this.itemInfo.selected.toString())},_getItemIndex:function(){for(var e=this.model.get("player.playlist"),t=0,i=0;i<e.length;i++)if(e[i].id===this.itemId){t=i;break}return t}}),Ft=i(3),Lt=(i(5),i(11));function Bt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Ft.View.extend({className:"_cm-content-carousel-area",id:"_cm-content-carousel-area",initialize:function(e){this.log=new Lt({unitType:e.unitType,className:"ContentCarouselView"}),this.container=e.container,this._rendered=!1,this._bindEvents(),this.createStateHandlers=T.a,this.componentsVisibilityListener=e.componentsVisibilityListener,this.componentsVisibilityListener&&this._setComponentsVisibilityListener(),Object(n.a)(this.container).append(this.$el)},render:function(){this._rendered?this.updatePlaylistItem():(this._rendered=!0,this.$el.append(It.a),this.listContainer=this.$el.find("._cm-content-carousel-items-container"),this.blockDiv=this.$el.find("._cm-content-carousel-blocker"),this.scrollElement=document.querySelector("div._cm-content-carousel-items-container-wrapper"),this.listItemsArray=[],this.unBlockView(),this._createListItems(),this._setScrollButtons())},_createListItems:function(){for(var e=this.model.get("player.playlist"),t=0;t<e.length;t++)e[t].id=t,e[t].selected=!1;this.model.set("player.playlist",e);for(var i=0;i<e.length;i++){var n=new Mt({model:this.model,container:this.listContainer,itemId:i});this.listItemsArray.push(n)}},_bindEvents:function(){},_setComponentsVisibilityListener:function(){this.listenTo(this.model,"change:".concat(this.componentsVisibilityListener),this._onComponentsVisibilityChange.bind(this)),this.model.get(this.componentsVisibilityListener)||this.hide()},_onComponentsVisibilityChange:function(){this.model.get(this.componentsVisibilityListener)?this.show():this.hide()},_setScrollButtons:function(){var e=this.$el.find("._cm-content-carousel-arrow-left"),t=this.$el.find("._cm-content-carousel-arrow-right");e.on("click",this._scrollLeft.bind(this)),t.on("click",this._scrollRight.bind(this))},_scrollLeft:function(){this.scrollElement.scrollBy(-100,0)},_scrollRight:function(){this.scrollElement.scrollBy(100,0)},hide:function(){this.$el.hide()},show:function(){this.$el.show()},blockView:function(){this.blockDiv.css({display:"block"})},unBlockView:function(){this.blockDiv.css({display:"none"})},updatePlaylistItem:function(){for(var e=0;e<this.listItemsArray.length;e++)this.listItemsArray[e].updateSelected()}});var jt,Ut=i(5),Wt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new c.a({unitType:"Util",className:"AnimationUtil",version:this.model.get("version"),isDebug:this.model.get("isDebug")})}var t,i;return t=e,(i=[{key:"expand",value:function(e){e.$el.height()>=e.height?this.log.info("No expand needed"):this.aniamteHeight(e)}},{key:"collapse",value:function(e){e.$el.height()<=e.height?this.log.info("No collapse needed"):this.aniamteHeight(e)}},{key:"aniamteHeight",value:function(e){this.model.set("isAnimationRunning",!0);var t={transition:"height "+e.timeMS+"ms",height:e.height};requestAnimationFrame((function(){e.$el.css(t)})),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}},{key:"aniamteOpacity",value:function(e){this.model.set("isAnimationRunning",!0);var t={transition:"opacity "+e.timeMS+"ms",opacity:e.opacity};requestAnimationFrame((function(){e.$el.css(t)})),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}},{key:"attach",value:function(e){if(e.$el){var t={top:e.target.top,left:e.target.left};if(e.isAnimated){t.width=this.model.get("videoPlaceholderSize.width")+"px",t.height=this.model.get("videoPlaceholderSize.height")+"px";var i=e.$el.offset(),o={position:"absolute",top:i.top+"px",left:i.left+"px",width:i.width+"px",height:i.height+"px"};requestAnimationFrame((function(){e.$el.css(o),Ut.flushCss(e.$el[0])})),t.transition="all "+e.timeMS+"ms ease",t=n.a.extend(t,e.additionalCss),requestAnimationFrame(function(){e.$el.css(t)}.bind(this))}else{var r={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto"};t=n.a.extend(r,t),t=n.a.extend(r,e.additionalCss),e.$el.css(r),requestAnimationFrame((function(){Ut.flushCss(e.$el[0])}))}this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}else this.log.warning("Called attach without an element!")}},{key:"detach",value:function(e){if(e.isAmp)this.detachSliderAmp(e);else{var t={position:"fixed",top:"auto",bottom:"auto",left:"auto",right:"auto"};if(e.isSlideIn)t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px",t.height=this.model.get("detachToSlider.height")+"px",e.isSlideVertically?t.height=0:t.width=0;else{var i=n.a.extend({},e.$el[0].getBoundingClientRect());i.right=window.innerWidth-i.left-i.width,i.bottom=window.innerHeight-i.bottom,t[e.sliderOptions.position.horizontal]=i[e.sliderOptions.position.horizontal]+"px",t[e.sliderOptions.position.vertical]=i[e.sliderOptions.position.vertical]+"px"}var o={transition:"all "+e.timeMS+"ms ease"};o[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",o[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px",o.width=this.model.get("detachToSlider.width")+"px",o.height=this.model.get("detachToSlider.height")+"px",0!==e.timeMS?(e.$el.css(t),requestAnimationFrame((function(){e.$el.css(t),Ut.flushCss(e.$el[0])})),requestAnimationFrame(function(){e.$el.css(o)}.bind(this))):(e.$el.css(t),e.$el.css(o)),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}}},{key:"detachSliderAmp",value:function(e){var t={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto"};e.isSlideIn?(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t.top=this._getSliderPositionVerticalAmp(e.sliderOptions),t.height=this.model.get("detachToSlider.height")+"px",e.isSlideVertically?t.height=0:t.width=0):(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t.top=this._getSliderPositionVerticalAmp(e.sliderOptions));var i={position:"absolute",top:"auto",bottom:"auto",left:"auto",right:"auto",transition:"all  ".concat(e.sliderOptions.detachAnimationTime," ").concat(e.sliderOptions.animationStyle)};i[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",i.top=this._getSliderPositionVerticalAmp(e.sliderOptions),i.width=this.model.get("detachToSlider.width")+"px",i.height=this.model.get("detachToSlider.height")+"px",e.isSlideIn&&e.$el.css(t),requestAnimationFrame(function(){e.$el.css(i)}.bind(this)),setTimeout(function(){this.correctSliderDetachPosition({$el:e.$el,sliderOptions:e.sliderOptions,isSlideVertically:e.isStickyCardActive})}.bind(this),e.sliderOptions.animationTime+10),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}},{key:"detachAmpSticky",value:function(e){TRC&&TRC.dispatch&&TRC.dispatch("videoSliderOn"),e.timeMS=150;var t={transition:"top "+e.timeMS+"ms ease-in-out",position:"absolute"};t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px",t.width=this.model.get("detachToSlider.width")+"px",t.height=this.model.get("detachToSlider.height")+"px",e.$el.css(t),this.oneAnimationEnd(e.$el,e.cb,e.timeMS+1)}},{key:"correctSliderDetachPosition",value:function(e){TRC&&TRC.dispatch&&TRC.dispatch("videoSliderOn");var t=e.sliderOptions.amp.correctionAnimationTime,i={transition:"top "+t+"ms ease-in-out",position:"absolute"};i.top=this._getSliderPositionVerticalAmp(e.sliderOptions),e.$el.css(i),this.oneAnimationEnd(e.$el,e.cb,t+1)}},{key:"slideOut",value:function(e){var t={transition:"all "+e.timeMS+"ms linear"};e.isVerticalSlideOut?(t[e.sliderOptions.position.horizontal]=e.sliderOptions.position.horizontalOffset+"px",t[e.sliderOptions.position.vertical]="-"+(e.sliderOptions.height+parseFloat(e.sliderOptions.position.verticalOffset))+"px"):(t[e.sliderOptions.position.horizontal]="-"+(e.sliderOptions.width+parseFloat(e.sliderOptions.position.horizontalOffset))+"px",t[e.sliderOptions.position.vertical]=e.sliderOptions.position.verticalOffset+"px"),requestAnimationFrame(function(){e.$el.css(t)}.bind(this)),this.oneAnimationEnd(e.$el,e.cb,e.timeMS)}},{key:"oneAnimationEnd",value:function(e,t,i){setTimeout(function(){this.model.set("isAnimationRunning",!1),e.css("transition","none"),t&&t()}.bind(this),i)}},{key:"PrefixedEvent",value:function(e,t,i,n){i=i.toLowerCase(),Ut.each(["webkit","moz","MS","o",""],(function(o){e[t](o+i,n)}))}},{key:"_getSliderPositionVerticalAmp",value:function(e){var t=0,i=this.model.get("ampPageTopLimit")||0,n=this.model.get("ampPageBottomLimit")||0;return"bottom"===e.position.vertical?(t=n-e.height-e.position.verticalOffset)<e.height+e.position.verticalOffset&&(t=e.height+e.position.verticalOffset):t=i+e.position.verticalOffset,"".concat(t,"px")}},{key:"updateModel",value:function(e){this.model=e}}])&&Bt(t.prototype,i),e}(),Ht=function(e){return jt||(jt=new Wt(e)),jt.updateModel(e),jt};function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qt(e,t){return(qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yt(e,t){return!t||"object"!==$t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Qt=i(5),Xt={title:"._cm-ad-title",placeholder:"._cm-feed-manager-video-placeHolder"},Jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Kt(e);if(t){var o=Kt(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Yt(this,i)}}(r);function r(){return zt(this,r),o.apply(this,arguments)}return t=r,(i=[{key:"initialize",value:function(e){this.log=new c.a({unitType:this.model.get("unitType"),className:"SubFeedContainerView",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.globalModel=e.globalModel,this.titlePosition=this.model.get("components.adChoice.position"),this.template=this.titlePosition===k.a.TITLE_POSITION.ABOVE?S.a:A.a,this.subUnitId=this.model.get("subUnitId"),this.model.set("containerViewState",a.readyState),this.listenTo(this.model,"change:closeState",this._onCloseStateChange.bind(this)),this.isAnimateOnOpen=this.model.get("animation.onTransitionOpen"),this.isAnimateOnClose=this.model.get("isAnimateOnClose")||this.model.get("animation.onTransitionClose")&&"close"===this.model.get("onTimerClose"),this.openCloseAmnimation={transition:"height "+this.model.get("animation.transitionAnimationTime")+"ms"},this.noAmnimationCss={transition:"none"};var t=this.model.get("detachToSlider");this.isSuperSliderMode=t.isStartFromSlider&&t.isDetachToSlider,this.isStartFromSlider=t.isStartFromSlider,this.animationStartEndPoint={height:"0"},this.animationUtil=Ht(this.model)}},{key:"_bindWindowEvents",value:function(){this.listenTo(s.a,"window:orientation:change",this._orientationChange.bind(this)),this.listenTo(s.a,"window:resize:change",this._onwindoResize.bind(this)),this.listenTo(this.model,"change:isAdClosed",this._onAdClosed.bind(this)),this.listenTo(s.a,"window:scroll:change",this._onPlaceHolderDomChange.bind(this,!1)),this.listenTo(s.a,"feed:resize:change",this._onPlaceHolderDomChange.bind(this,!1)),this.listenTo(s.a,"taboola:readmore:click",this._onPlaceHolderDomChange.bind(this,!0)),this.listenTo(this.model,"change:aspectRatioNum",this._onPlaceHolderDomChange.bind(this,!0)),this.listenTo(s.a,"publisher:dom:change",this._onPublisherDOMChange.bind(this,!0)),this.listenTo(this.model,"change:isAdClosedByTimer",this._onAdClosed.bind(this))}},{key:"render",value:function(e,t){this.log.info("rendering subunit:",this.subUnitId),this.container=e,this.$container=Object(n.a)(this.container),this.renderTemplate(),this._customize(),this.el.id="_cm-video-unit",this.$el.addClass("ContainerView_"+t),this._addAdChoiceTitle(),Object(n.a)(e).append(this.el),this._adjustWideFeed(),this.isAnimateOnOpen&&(this.isSuperSliderMode||this.isStartFromSlider)&&this._runAnimation(!0,null),this._onPlaceHolderDomChange(),this.model.set("containerViewPlaceHolder",this.ui.placeholder[0]),this._bindWindowEvents(),this.model.set("containerViewState",a.containerViewState.rendered),this._triggerRenderEvent()}},{key:"_onAdClosed",value:function(e,t){t&&this.isAnimateOnClose&&this._runAnimation(!1,this.closeAndRemove.bind(this))}},{key:"terminate",value:function(e,t){this.terminated||(this.stopListening(s.a,"window:scroll:change"),this.stopListening(s.a,"feed:resize:change"),this.model.set("closeState",a.closeState.closeUnit),this.terminated=!0)}},{key:"hide",value:function(){this.$el.hide(),this.$container.hide()}},{key:"remove",value:function(){this.$el.remove(),this.$container.remove()}},{key:"close",value:function(){this.log.info("close"),this.isClosed||(this.isClosed=!0,"WIDGET_ITEM"===this.model.get("unitType")?(this._runAnimation(!1,this.hide.bind(this)),this.model.set("closeState",a.closeState.containerViewClosed)):setTimeout(function(){this.model.set("closeState",a.closeState.containerViewClosed)}.bind(this),1500))}},{key:"closeAndRemove",value:function(){this.terminate(),this.remove()}},{key:"_onCloseStateChange",value:function(){switch(this.model.get("closeState")){case a.closeState.closeUnit:this.close()}}},{key:"_customize",value:function(){var e=this.model.get("customization.unitContainer"),t=this.model.get("customization.placeHolder"),i=this.model.get("customization.adTitle");this._customizeFeed(),this.$el.css(Qt.toCssObj(e)),this.ui.title.css(Qt.toCssObj(i)),this.ui.placeholder.css(Qt.toCssObj(t))}},{key:"_addAdChoiceTitle",value:function(){this.model.get("components.adChoice.isActive")&&this.model.get("components.adChoice.title.isActive")&&(this.adChoice=new Pe({model:this.model,container:this.ui.title,parent:this.el,type:k.a.AD_CHOICE_TYPE.TITLE}))}},{key:"_customizeFeed",value:function(){this.ui.title.text(this.model.get("unitTitle"))}},{key:"_onwindoResize",value:function(){this._onPlaceHolderDomChange()}},{key:"_onPlaceHolderDomChange",value:function(){!this._isAdRequiresEligibilityValidation()||this.model.get("isEligibleToPlay")?this._onPublisherDOMChange():this.isListeningToEligibilityChange||(this.isListeningToEligibilityChange=!0,this.model.set("isUseObserver",!1))}},{key:"_onPublisherDOMChange",value:function(){this.terminated||(this._calcPlaceholderSize(),this._calcPlaceholderPosition())}},{key:"_isAdRequiresEligibilityValidation",value:function(){return!!this.model.get("eligibilityValidator.isActive")&&(!this.model.get("eligibilityValidator.isRvOnly")||(void 0===this.model.get("isNextAdRv")?this.globalModel.get("isNextAdRV"):this.model.get("isNextAdRv")))}},{key:"_calcPlaceholderSize",value:function(){this.isAnimatioRunning||(this.isSuperSliderMode?this._calcPlaceholderSizeFeed(!1,this.$container.width()):this._calcPlaceholderSizeFeed())}},{key:"_runAnimation",value:function(e,t){if(e&&this.isSuperSliderMode)this.$el.css({display:"none"});else if(this.isAnimatioRunning=!0,e){this.$el.css(this.animationStartEndPoint);var i=this.ui.placeholder.width(),n=this._getVideoHeightByRatio(i);this.model.set("videoPlaceholderSize",{width:i,height:n}),this.animationUtil.expand({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("height"),cb:this.postAnimation.bind(this,this._calcPlaceholderSizeFeed.bind(this,!0))})}else this.animationUtil.collapse({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:this.postAnimation.bind(this,t)})}},{key:"postAnimation",value:function(e){this._removeAnimation(),e&&e()}},{key:"_removeAnimation",value:function(){this.isAnimatioRunning=!1,this.$el.css(this.noAmnimationCss)}},{key:"_calcPlaceholderSizeFeed",value:function(e,t){var i=this.ui.placeholder.width()||t,n=this._getVideoHeightByRatio(i);i&&n?((e||this.model.get("videoPlaceholderSize.width")!==i||this.model.get("videoPlaceholderSize.height")!==n)&&(this.model.set("width",i),this.model.set("height",n),this.$el.css({height:n+this.ui.title.height(),width:i}),this.titlePosition===k.a.TITLE_POSITION.BELOW&&this.ui.placeholder.css({height:n}),this.model.set("videoPlaceholderSize",{width:i,height:n}),this.model.get("videoViewState")!==a.videoViewState.detached&&this.model.trigger("change:videoPlaceholderSize",this.model,this.model.get("videoPlaceholderSize"))),this._adjustWideFeed()):this.log.error("_calcPlaceholderSizeFeed calculated width=0 or height=0",{width:i,height:n,subUnitId:this.subUnitId})}},{key:"_getVideoHeightByRatio",value:function(e){return this.model.isVerticalVideoEnabled(e)?Qt.getVideoHeightByRatio(e,this.model.get("aspectRatioNum")):Qt.getVideoHeight(e)}},{key:"_calcPlaceholderPosition",value:function(){var e=Qt.getOffsetWithContainer(this.ui.placeholder,this.model.get("offsetGetterType"),this.model.get("videoContainerSelector")),t=this.model.get("videoPlaceholderPosition");t&&t.top===e.top&&t.left===e.left||this.model.set("videoPlaceholderPosition",{top:e.top,left:e.left})}},{key:"_adjustWideFeed",value:function(){var e=this.model.get("maxVideoWidth"),t=this.$el.parent();if(e&&t){var i=t.width();i>=e?(this._setMaxVideoSize(e),this.$el.addClass("_cm-wide-feed"),this.model.set("adjustWideFeed",!0)):(this.$el.removeClass("_cm-wide-feed"),this._setMaxVideoSize(i),this.model.set("adjustWideFeed",!1))}}},{key:"_setMaxVideoSize",value:function(e){var t=Qt.getVideoHeight(e)+this.ui.title.height();this.$el.css({maxHeight:t,maxWidth:e})}},{key:"_orientationChange",value:function(){this._onPlaceHolderDomChange()}},{key:"_updateBrandingStyle",value:function(){var e=document.querySelector(".videoCube"),t=e.querySelector(".video-label-box .video-title");this.model.set("customization.titleContainer.title",Qt.cssObjToString(getComputedStyle(t)));var i=e.querySelector(".video-label-box .branding");this.model.set("customization.titleContainer.branding",Qt.cssObjToString(getComputedStyle(i)))}},{key:"_triggerRenderEvent",value:function(){var e=this.model.get("cardNumber");e&&s.a.trigger("newCardRendered",{cardNumber:Math.abs(e),isSlider:e<0,subUnitType:this.model.get("subUnitType")})}},{key:"_SuperSliderClose",value:function(){this.isSuperSliderMode=!1,this.terminate()}},{key:"getVideoPlaceholder",value:function(){return this.ui.placeholder}},{key:"className",get:function(){return"_cm-feed-manager"}},{key:"ui",get:function(){return this.UI?this.UI:this.UI=Xt},set:function(e){return this.UI=e}}])&&Gt(t.prototype,i),r}(o.b),Zt=i(23);function ei(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ti=i(5),ii=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new c.a({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")})}var t,i;return t=e,(i=[{key:"setReportingObserver",value:function(e){if(!this.reportingObserver&&ti.isObserverSupported("ReportingObserver")){var t={types:this.model.get("reportingObserver.types"),buffered:!0};this.reportingObserver=new ReportingObserver(e.bind(this),t),this.reportingObserver.observe(),this._bindUnloadEvents(e)}}},{key:"_bindUnloadEvents",value:function(e){var t=this;window.addEventListener("unload",(function(i){var n=t.reportingObserver.takeRecords();e(n)}))}}])&&ei(t.prototype,i),e}(),ni=function(){var e;return function(t){return e||(e=new ii(t)),e}}();function oi(e){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ri(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function si(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ai(e,t){return(ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function li(e,t){return!t||"object"!==oi(t)&&"function"!=typeof t?ci(e):t}function ci(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function di(e){return(di=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ui=i(5),hi=ui.now().toString(),fi={video:"._cm-video-ad"},pi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ai(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=di(e);if(t){var o=di(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return li(this,i)}}(o);function o(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"VideoView",r=arguments.length>2?arguments[2]:void 0;return ri(this,o),(t=n.call(this,e)).eligibilityService=e.eligibilityService||{},t.log=new c.a({unitType:t.model.get("unitType"),className:i,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.model.set("videoAdId",t.videoAdId),t.currModel=r||t.model,t._setVolumeAnimationTrigger(),t._bindEvents(),t._bindBlockedByExternalUnitChange(),t.viewabiltyService=new Zt.a({model:t.model,onViewability:t._onViewability.bind(ci(t))}),t._setVideoValidator(),t._initPerformanceMonitor(),t}return t=o,(i=[{key:"_bindEvents",value:function(){}},{key:"_initPerformanceMonitor",value:function(){this.currModel.get("reportingObserver.isActive")&&(this.performanceMonitor=new ni(this.currModel),this.performanceMonitor.setReportingObserver(this.reportingObserverCB.bind(this)))}},{key:"reportingObserverCB",value:function(e){var t=this,i=this.currModel.get("reportingObserver.ids");i&&i.length>0&&(e=ui.filter(e,(function(e){return e.body&&e.body.id&&ui.contains(i,e.body.id)}))),this.activeAd?ui.forEach(e,(function(e){t._setReportingObserverAdData(e),t.activeAd.oppsService.fireBeaconOpp("reportingObserver")})):this.model.get("pixels.reportingObserver.isFire")&&this._fireReportObserverPixel(e)}},{key:"_setReportingObserverAdData",value:function(e){this.activeAd.adData.rot=e.type,this.activeAd.adData.roid=e.body&&e.body.id,this.activeAd.adData.rom=e.body&&e.body.message}},{key:"_fireReportObserverPixel",value:function(e){var t=this;ui.forEach(e,(function(e){var i={debug:"rot:".concat(e.type,"!roid:").concat(e.body.id,"!rom:").concat(e.body.message,"!")},n=t.model.getPixel("pixels.reportingObserver"),o=ui.addParametersToUrl(n,i,-1===n.indexOf("?"));ui.isSendBeaconSupported()&&navigator.sendBeacon(o)}))}},{key:"_setVolumeEvents",value:function(){this.currModel.on("change:volumeMuted",this._handleVolume.bind(this)),this.model.get("components.volume.isActive")&&this.currModel.on("change:onUnMuteClicked",this._fireUserAdUnmuted.bind(this)),this.currModel.get("autoplaySoundOn")?(this._bindOnHoverListeners(),this.checkVolumeStatus()):this.createStateHandlers([{event:"autoplaySoundOn:true",funcName:"_bindOnHoverListeners",isListenOnce:!0},{event:"autoplaySoundOn:true",funcName:"checkVolumeStatus",isListenOnce:!0}])}},{key:"checkVolumeStatus",value:function(){this.currModel.get("autoplaySoundOn")&&"on"===this.currModel.get("volume")?(this.log.info("Unmute first video because volume=on"),this.currModel.set("volumeMuted",!1)):this.currModel.set("volumeMuted",!0)}},{key:"hide",value:function(){this.$el.hide()}},{key:"show",value:function(){this.$el.show()}},{key:"close",value:function(){this.model.set("closeState",l.a.closeState.videoViewClosed)}},{key:"_customize",value:function(){var e=this.model.get("additionalCss");this.$el.css(ui.toCssObj(e))}},{key:"_rePosition",value:function(e,t){this.$el.css(t)}},{key:"_onLoadingClick",value:function(){this.ui.video[0].id=this.videoAdId,this.replayAd()}},{key:"replayAd",value:function(){this.model.get("isReplayAd")&&this.repeatingAd&&(this.activeAd=this.repeatingAd,this.activeAd.vpaidWrapper.restartAd(),this._resizeRepeatingAd(),this.activeAd.setToModel("adQState",l.a.adQState.repeating,this.repeatingAd.adId),this.activeAd.setToModel("adState",l.a.adState.repeating,this.repeatingAd.adId)),this.model.set("isAdClosedByTimer",!1)}},{key:"_onLearnMoreClick",value:function(){this.repeatingAd&&this.repeatingAd.onLearnMoreClick()}},{key:"_onMouseEnter",value:function(){this.activeAd&&(this.activeAd.unmute(),this.currModel.set("volumeMuted",!1))}},{key:"_onMouseLeave",value:function(){this.activeAd&&(this.activeAd.mute(),this.currModel.set("volumeMuted",!0))}},{key:"_handleVolume",value:function(){this.activeAd&&(this.currModel.get("volumeMuted")?this.activeAd.mute():this.activeAd.unmute())}},{key:"_fireUserAdUnmuted",value:function(){this.currModel.get("onUnMuteClicked")&&this.activeAd&&this.activeAd.oppsService.fireUserAdUnmuted()}},{key:"onAdComplete",value:function(){this.setRepeatingAd(),this.activeAd=void 0,this.model.get("isMultiAd")?this.checkEligible():this.model.set("closeState",l.a.closeState.terminate)}},{key:"checkEligible",value:function(){this.model.get("isInTab")&&this.isEligibleToPlay()?(this.activeAd||this.getReadyAd(),this.activeAd&&this.playAd()):this.activeAd&&this.activeAd.pause()}},{key:"isEligibleToPlay",value:function(){return this.model.get("isEligibleToPlay")}},{key:"getReadyAd",value:function(){this.model.get("hasReadyAd")&&(this.model.get("volumeMuted")||this.model.get("wurfl.os.name")!==k.a.OS.IOS||this.model.set("volumeMuted",!0),this.activeAd=this.model.getNextAd(),-1===this.model.get("unitType").indexOf("RECO_REEL_WIDGET")&&this.model.set("aspectRatioNum",this.activeAd.getAspectRatioNum()),this.postGetAd())}},{key:"postGetAd",value:function(){}},{key:"playAd",value:function(){this.log.info("@@play ad",this.model.get("unitType")),this.activeAd&&(this.log.info("Play Ad !!!!",this.activeAd),this.activeAd.play(),this.activeAd.isUsed||(this.activeAd.isUsed=!0),this.model.get("components.volume.isActive")&&setTimeout(this._fireVolumeStateCheck.bind(this),0),this.viewabiltyService.updateActiveAd(this.activeAd))}},{key:"pauseAd",value:function(){this.activeAd&&this.activeAd.pause()}},{key:"_onViewability",value:function(){this.log.info("Viewability reached")}},{key:"_addDisclosureText",value:function(){(this.model.get("components.disclosureText.isActive")||this.model.get("detachToSlider.components.disclosureText.isActive"))&&(this.disclosureTextView=new _e({model:this.model,container:this.el}),this.disclosureTextView.render())}},{key:"_fireVolumeStateCheck",value:function(){this._startAnimationOnce(),this._handleVolume(),this.currModel.trigger("lastVolumeStateCheck")}},{key:"_setVolumeAnimationTrigger",value:function(){var e=this;this._startAnimationOnce=ui.once((function(){e.currModel.trigger("startVolumeAnimation")}))}},{key:"_unBindOnHoverListeners",value:function(){this.el.onmouseenter=null,this.el.onmouseleave=null}},{key:"_bindOnHoverListeners",value:function(){this.currModel.get("autoplaySoundOn")&&"onHover"===this.currModel.get("volume")&&!this.currModel.get("volumeUserInteraction")&&(this.el.onmouseenter=this._onMouseEnter.bind(this),this.el.onmouseleave=this._onMouseLeave.bind(this),this.currModel.on("change:volumeUserInteraction",this._unBindOnHoverListeners.bind(this)))}},{key:"setRepeatingAd",value:function(){this.model.get("isReplayAd")&&this.activeAd&&this.activeAd.vpaidWrapper.isReplayable?this.repeatingAd=this.activeAd:this.repeatingAd=null}},{key:"_bindBlockedByExternalUnitChange",value:function(){this.currModel.on("change:blockedByExternalUnit",this._onBlockedByExternalUnitChange.bind(this))}},{key:"_onBlockedByExternalUnitChange",value:function(){this.currModel.get("blockedByExternalUnit")?(this.pauseAd(),this.activeAd&&this.activeAd.fireAdOppOnce("adPausedOtherUnitIsPlaying")):this.checkEligible()}},{key:"_resizeRepeatingAd",value:function(){var e=this;setTimeout((function(){var t=e.isDetached?e.model.get("detachToSlider.width"):e.model.get("width"),i=e.isDetached?e.model.get("detachToSlider.height"):e.model.get("height");e.activeAd.vpaidWrapper.resizeAd(t,i)}),0)}},{key:"_setVideoValidator",value:function(){this.model.get("videoValidator.isActive")&&(this.eligibilityValidator=new u.e({model:this.model}))}},{key:"id",get:function(){return"_cm-css-reset"}},{key:"videoAdId",get:function(){return hi}},{key:"ui",get:function(){return this.UI?this.UI:this.UI=fi},set:function(e){return this.UI=e}}])&&si(t.prototype,i),o}(o.b),mi=i(12);function gi(e){return(gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vi(e,t){return(vi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bi(e,t){return!t||"object"!==gi(t)&&"function"!=typeof t?_i(e):t}function _i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Si(e){return(Si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wi=i(5),Ai=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vi(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Si(e);if(t){var o=Si(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return bi(this,i)}}(r);function r(e,t,i){var s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=o.call(this,e,"SubVideoViewDetachable",i)).subUnitId=s.model.get("subUnitId"),s.isFirstAd=!0,s.cardNumber=s.model.get("cardNumber"),s.globalModel=i,s.container=Object(n.a)(s.model.get("videoContainerSelector")||"body")[0],s.animationTimeOut=null,s.sliderOptions=s.model.get("detachToSlider"),s.detachOptions=s.model.get("detachToSlider"),s.isDetachActive=s.model.get("detachToSlider.isStartFromSlider")||s.model.get("detachToSlider.isDetachToSlider"),s.isDetachedHasCloseButton=s.isDetachActive&&s.model.get("detachToSlider.hasCloseButton"),s.isAttachedHasCloseButton=s.model.get("hasCloseButton"),s.isFirstDetach=!0,s.isDetached=!1,s.isFistImpression=!0,s.isGotImpression=!0,s.attachedOnceToNewCard=!1,s.closeButtonDelayd=!1,s.scrollManager=new mi.a,s._setAd(t),s.model.get("detachToSlider.isStartFromSlider")){var a=s.model.get("width"),l=s.model.get("detachToSlider.liquidSize.isActive")?s._calcLiquidWidth():s.model.get("detachToSlider.width");a>l&&(s.model.set("width",l),s.model.set("height",wi.getVideoHeight(l)))}else s.isFirstDetach=!1;s.render(),s.feedPlayerSize={width:s.model.get("width"),height:s.model.get("height")},s.isClosedByButton=!1,s.isAnimateOnOpen=s.model.get("animation.onTransitionOpen"),s.isAnimateOnClose=s.model.get("isAnimateOnClose")||s.model.get("animation.onTransitionClose")&&"close"===s.model.get("onTimerClose"),s.animationCss={transition:"all 500ms ease-in-out"},s.animationCssFirstSlide={transition:"all 1s ease"},s.openCloseAmnimation={transition:"height "+s.model.get("animation.transitionAnimationTime")+"ms"},s.noAmnimationCss={transition:"none"},s.animationStartEndPoint={height:"0"};var c={startCondition:{stateToListen:"",state:""}},d=s.model.get("isPlacementSingleAd")?0:1e3*s.model.get("secondsToCloseFeed");return s.getAdTimer=new u.r(s.model,c,s.onLocalTimerEnd.bind(_i(s),"midrollCollapse subUnit"),d),s.contentTimer=new u.r(s.model,c,s.onLocalTimerEnd.bind(_i(s),"Content tiemr subUnit"),1e3*s.model.get("contentTimerSeconds")),s.sliderOptions.isStartFormSlider||"rendered"!==s.model.get("containerViewState")||(s.checkEligible(),s.containerViewStateRendered()),s._bindSubViewEvents(),s.sliderOptions.isStartFromSlider&&s.onUnitStart(),s.adCompleted=!1,s._addUIComponents(),s._addContentView(),s}return t=r,(i=[{key:"_setAd",value:function(e){this.isFirstAd?this._switchFromActiveAd("set ad first ad switch"):this.isFirstAd=!1,this.el=e.vpaidWrapper.adTarget,this.model.get("isReplayAd")&&e.vpaidWrapper.isReplayable&&e.vpaidWrapper.dontDie&&e.vpaidWrapper.dontDie(),this.$el=Object(n.a)(this.el),this.globalModel.get("volumeMuted")||this.model.get("wurfl.os.name")!==E.OS.IOS||this.globalModel.set("volumeMuted",!0),this._setAdBase(e)}},{key:"_switchToActiveAd",value:function(e){this.$el.removeClass("_cm-ad"),this.$el.addClass("_cm-ad-active"),this.log.warning("switchToActiveAd",this.cardNumber)}},{key:"_switchFromActiveAd",value:function(e){this.isDetached&&(this.log.warning("switchFromActiveAd",this.cardNumber),this.$el.addClass("_cm-ad"),this.$el.removeClass("_cm-ad-active")),this.repeatingAd&&this.repeatingAd.vpaidWrapper&&Object(n.a)(this.repeatingAd.vpaidWrapper.adTarget).css({display:"none !important"})}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"videoPlaceholderSize",funcName:"onVideoPlaceholderSizeChange",withBind:!1},{event:"videoPlaceholderPosition",funcName:"setVideoPlaceholderPosition",withBind:!1},{event:"containerViewState:rendered",funcName:"containerViewStateRendered"},{event:"isEligibleToPlay",funcName:"isEligibleToPlayChange"},{event:"isInTab",funcName:"isInTabChange"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"adQState:completed",funcName:"onAdComplete"},{event:"isEligibleToPlay",funcName:"checkEligible"},{event:"isInTab",funcName:"checkEligible"},{event:"learnMoreWasClicked",funcName:"_onLearnMoreClick"}])}},{key:"_bindSubViewEvents",value:function(){this.isDetachActive&&this.model.get("detachToSlider").liquidSize.isActive&&Object(n.a)(window).on("resize",this._onResize.bind(this))}},{key:"_onResize",value:function(){if(this.isDetached){var e=this.getDetachPositionAndSize().size;this._resize(this.model,e),this.model.trigger("change:videoViewSize",e)}}},{key:"onVideoPlaceholderSizeChange",value:function(){this.currentSize=null,this.setVideoPlaceholderSize()}},{key:"setVideoPlaceholderSize",value:function(){var e=this.model.get("videoPlaceholderSize");this.isDetached||this._resize(arguments[0],e)}},{key:"setVideoPlaceholderPosition",value:function(){if(!this.isDetached){var e=this.model.get("videoPlaceholderPosition");this._rePosition(this.model,{top:e.top,left:e.left}),this.repeatingAd&&this.$el!==Object(n.a)(this.repeatingAd.vpaidWrapper.adTarget)&&Object(n.a)(this.repeatingAd.vpaidWrapper.adTarget).css(arguments[1])}}},{key:"render",value:function(){this._customize(),this.$el.css({width:this.model.get("width")}),this.$el.addClass("_cm-video-with-slider"),this.model.set("targetId",this.videoAdId),this.model.set("videoViewState",a.videoViewState.rendered),this._addDisclosureText(),this.log.info("new video view is renderd. subUnitId="+this.subUnitId),wi.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoInitToRender".concat(this.model.get("perfUnitType")),E.TRC_PERFORMANCE_ACTIONS.STOP)}},{key:"containerViewStateRendered",value:function(){this.model.get("detachToSlider.isStartFromSlider")||this.attach()}},{key:"cleanAnimation",value:function(e){setTimeout(function(){this.$el.css({transition:""})}.bind(this),e)}},{key:"isInTabChange",value:function(){this.model.get("isInTab")&&this.model.get("videoViewState")===a.videoViewState.attached&&(this.$el.css({position:"absolute"}),this.isFirstDetach=!1),this.model.get("isInTab")&&!this.model.get("isEligibleToPlay")&&this.model.get("videoViewState")===a.videoViewState.rendered&&this.isEligibleToPlayChange(),this.activeAd&&this.activeAd.vpaidWrapper&&this.model.get("isInTab")&&wi.forceElementRedrawWithBorderChange(this.model.get("wurfl.browser"),this.activeAd.vpaidWrapper.adTarget)}},{key:"attach",value:function(){this.sliderOptions.isStartFromSlider||this.attachedOnceToNewCard?this._attachFromSlider():(this.attachedOnceToNewCard=!0,this._attachNewCard()),this._closeButtonHide(),this.globalModel.get("isSliderOn")&&!this.model.get("detachToSlider.isDetachToSlider")&&this.globalModel.set("isSliderOn",!1)}},{key:"_attachNewCard",value:function(){this.log.info("attaching new card to placeholder:",this.subUnitId),this._attachToCard(),this.model.set("videoViewState",a.videoViewState.attached),this.isAnimateOnOpen&&this._runAnimation(!0,null),setTimeout(function(){!this.model.get("isEligibleToPlay")&&this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("videoViewState")!==a.videoViewState.detached&&(this.log.info("gotad _attachNewCard fix detach"),this.isEligibleToPlayChange(),this.checkEligible())}.bind(this),300)}},{key:"_runAnimation",value:function(e,t){this.isAnimatioRunning=!0,e?(this.$el.css(this.animationStartEndPoint),this.$el.css(this.openCloseAmnimation),setTimeout(function(){this.currentSize=null,this._resize(this.model,this.model.get("videoPlaceholderSize"))}.bind(this),100),setTimeout(function(){this._removeAnimation()}.bind(this),this.model.get("animation.transitionAnimationTime")+100)):(this.$el.css(this.openCloseAmnimation),setTimeout(function(){this.$el.css(this.animationStartEndPoint)}.bind(this),100),setTimeout(function(){this._removeAnimation(),this.$el.hide()}.bind(this),this.model.get("animation.transitionAnimationTime")+100)),t&&t()}},{key:"_removeAnimation",value:function(){this.$el.css(this.noAmnimationCss)}},{key:"_attachToCard",value:function(){this.currentSize=null,this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this._resize(this.model,this.model.get("videoPlaceholderSize")),this.$el.css(this.model.get("videoPlaceholderSize")),this.$el.css(this.model.get("additionalCss")),this.log.info("done attaching",this.$el),this._closeButtonHide()}},{key:"_attachFromSlider",value:function(){clearTimeout(this.animationTimeOut),this.log.info("attaching slider to placeholder",this.subUnitId);var e=this.$el.offset();this.cleanStyle();var t={position:"absolute",width:e.width+"px",height:e.height+"px"};n.a.extend(t,this.model.get("additionalCss")),this.$el.css(t),this._rePosition(this.model,{top:e.top+"px",left:e.left+"px"}),this.isFirstDetach=!1,this.animationTimeOut=setTimeout(this.postAttach.bind(this),100)}},{key:"postAttach",value:function(){this.model.get("detachToSlider").animation&&this.$el.css(this.animationCss);var e=this.model.get("videoPlaceholderSize");this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this._resize(this.model,e),this.model.set("videoViewState",a.videoViewState.attached),this.model.trigger("change:videoViewSize",this.model.get("videoPlaceholderSize")),this.isDetached=!1,this.cleanAnimation(500),this.isAttachedHasCloseButton&&setTimeout(this._closeButtonShow.bind(this),500)}},{key:"detach",value:function(){if(!this.isDetached){clearTimeout(this.animationTimeOut),this.log.info("detaching to placeholder"),this.isDetached=!0,this.model.set("videoViewState",a.videoViewState.detached);var e={},t={};this._closeButtonHide(),this.isFirstDetach?(e={position:"fixed"},t[this.model.get("detachToSlider").position.horizontal]="-"+(this.model.get("detachToSlider").width+this.model.get("detachToSlider").position.horizontalOffset)+"px",t[this.model.get("detachToSlider").position.vertical]=this.model.get("detachToSlider").position.verticalOffset+"px",e.width=0,e.height=wi.getVideoHeight(this.model.get("detachToSlider").width)+"px"):(this.cleanStyle(),t=this._getFixedPositionCss(),e.width=this.model.get("videoPlaceholderSize").width+"px",e.height=this.model.get("videoPlaceholderSize").height+"px"),n.a.extend(e,this.model.get("additionalCss")),this.$el.css(e),this._rePosition(this.model,t),this.animationTimeOut=setTimeout(this.postDetach.bind(this),100)}}},{key:"_getFixedPositionCss",value:function(){var e=n.a.extend({},this.$el[0].getBoundingClientRect());e.right=window.innerWidth-e.left-e.width,e.bottom=window.innerHeight-e.bottom;var t={position:"fixed",top:"auto",bottom:"auto",left:"auto",right:"auto"};return t[this.model.get("detachToSlider").position.horizontal]=e[this.model.get("detachToSlider").position.horizontal]+"px",t[this.model.get("detachToSlider").position.vertical]=e[this.model.get("detachToSlider").position.vertical]+"px",t}},{key:"postDetach",value:function(){var e=500;this.$el.css({position:"fixed"}),this.model.get("detachToSlider").animation&&!1===this.isFirstDetach&&this.$el.css(this.animationCss),!0===this.isFirstDetach&&(this.isFirstDetach=!1,this.$el.css(this.animationCssFirstSlide),e=1200);var t=this.getDetachPositionAndSize();this._resize(this.model,t.size),this._rePosition(this.model,t.position),this.model.trigger("change:videoViewSize",t.size),wi.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss)),this.cleanAnimation(e),this._updateCloseButtonContainer(),setTimeout(this._closeButtonShow.bind(this),e)}},{key:"cleanStyle",value:function(){this.$el.removeAttr("style")}},{key:"onUnitStart",value:function(){this.log.warning("onAdImpression isEligibleToPlay",this.model.get("isEligibleToPlay")),this.isGotImpression=!0;var e=this.detachOptions.isStartFromSlider&&this.detachOptions.isDetachToSlider;this.model.get("isEligibleToPlay")&&!e&&(this.isFirstDetach=!1,this.detachOptions.isStartFromSlider=!1,this.attach()),(!this.model.get("isEligibleToPlay")||e)&&this.model.get("detachToSlider").isStartFromSlider&&this.isFistImpression&&(this.isFistImpression=!1,this.model.get("isInTab")&&(this._playAd(),this.detach()))}},{key:"isEligibleToPlayChange",value:function(){if(this.isGotImpression)return this.model.get("isEligibleToPlay")&&this.isAdClosedByTimer&&this.isAnimateOnClose?(this.model.set("isAdClosedByTimer",!0),void this._runCloseAnimation()):void(!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")!==a.videoViewState.detached||!this.model.get("renderWasCalled")||this.sliderOptions.isStartFromSlider&&this.sliderOptions.isDetachToSlider?!this.model.get("isEligibleToPlay")&&(this.model.get("videoViewState")===a.videoViewState.attached||this.model.get("videoViewState")===a.videoViewState.rendered)&&this.isDetachActive&&this.model.get("detachToSlider.isDetachToSlider")&&this.model.get("isInTab")&&"string"==typeof this.model.get("adState")&&this._isDetachAvailable()&&this.detach():this.attach())}},{key:"_isDetachAvailable",value:function(){return this.el.getBoundingClientRect().top>0?this.model.get("detachToSlider.isDetachAbove"):this.model.get("detachToSlider.isDetachBelow")}},{key:"close",value:function(){this.log.info("close"),this.permanentAttach(),this.$el.height(0),setTimeout(function(){this.permanentClose()}.bind(this),1500)}},{key:"permanentClose",value:function(){this.log.info("permanentClose"),this.activeAd?(this.activeAd.pause(),this.activeAd=void 0):this.$el.remove(),this.terminateContent()}},{key:"checkAndClose",value:function(e){return!(this.isDetached||!this.isEligibleToPlay()||!this.isAnimateOnClose||this.model.get("isPlacementSingleAd")||(this._runCloseAnimation(),this.log.info("Close because of: ",e),0))}},{key:"closeAndRemove",value:function(){this.$el&&(this.activeAd&&this.activeAd.pause(),this.$el.remove(),this._closeLoadingView(),this._closeButtonHide(),this.isDetached=!1,this.close(),this.globalModel.set("isSliderClosed",!1))}},{key:"permanentAttach",value:function(){var e=this.isDetached;this.$el.css(this.animationCss),this._closeButtonHide(),this.model.set("detachToSlider.isDetachToSlider",!1),this.globalModel.set("isSliderOn",!1),e&&this._permanentAttachAnimation(),this.globalModel.set("isSliderClosed",!0),this.terminateContent()}},{key:"_permanentAttachAnimation",value:function(){this.isAnimatioRunning=!0,setTimeout(function(){this.$el.css({width:"1px"})}.bind(this),100),setTimeout(function(){this.isAnimatioRunning=!1,this.$el.css({transition:""}),this._rePosition(this.model,this._getPositionResetCSS()),this.$el.css({position:"absolute"}),this.$el.css(this.model.get("additionalCss")),this._rePosition(this.model,this.model.get("videoPlaceholderPosition"));var e=this.model.get("videoPlaceholderSize");e||(e={width:1,height:1}),this.isDetached=!1,this.isDetachActive=!1,this._resize(this.model,e),this.model.set("videoViewState",a.videoViewState.attached),this.checkEligible(),this.model.get("isSuperSlider")&&(this.model.set("isSuperSliderClosed",!0),this.globalModel.set("isSuperSliderClosed",!0),this._updateSubAdsEligibilityStatus(!1)),this.model.set("isPermanentAttachAnimationDone",!0)}.bind(this),600)}},{key:"_onStateChange",value:function(e,t){t===e.STATE.STOPPED_BY_USER&&this.close()}},{key:"_calcLiquidWidth",value:function(){var e=this.model.get("detachToSlider").liquidSize.minWidth,t=this.model.get("detachToSlider").liquidSize.maxWidth,i=window.innerWidth*(this.model.get("detachToSlider").liquidSize.widthPercent/100);return t&&i>t&&(i=t),i<e&&(i=e),i}},{key:"getDetachPositionAndSize",value:function(e){var t=Math.floor(this.model.get("detachToSlider").liquidSize.isActive?this._calcLiquidWidth():this.model.get("detachToSlider").width),i=wi.getVideoHeight(t),n={position:this._getPositionResetCSS(),size:{width:t,height:i}};return n.position[this.model.get("detachToSlider").position.horizontal]=this.model.get("detachToSlider").position.horizontalOffset+"px",n.position[this.model.get("detachToSlider").position.vertical]=this.model.get("detachToSlider").position.verticalOffset+"px",n}},{key:"_resize",value:function(e,t){this.currentSize&&this.currentSize.width===t.width&&this.currentSize.height===t.height||(this.log.info("_resize sizeObj: ",t),this.$el.css(t),this.activeAd&&this.activeAd.vpaidWrapper?this.activeAd.resize(t):this.repeatingAd&&this.repeatingAd.vpaidWrapper&&this.repeatingAd.resize(t),this.currentSize=t)}},{key:"onTimerEnd",value:function(e){this.log.info("SubVideo midroll:",e),this.isContentViewActive()||(this.ad$el&&this.ad$el.height(0),this.activeAd=void 0,this.ad$el=void 0,this._startLoadingView(),this.checkAndClose(e)&&(this.isAdClosedByTimer=!0),this.permanentAttach(),this.isViewed=!1)}},{key:"onLocalTimerEnd",value:function(e){this.log.info("SubUnit onLocalTimerEnd card number: ",this.model.get("cardNumber")),this.isRepeateMode=!this.isReplayMode,this.isDetached?(this.createStateHandlers([{event:"isPermanentAttachAnimationDone",funcName:"_showRepeat",isListenOnce:!0}]),this.permanentAttach()):this._showRepeat(),this.isSkipCollapse?this.isSkipCollapse=!1:this.checkAndClose("LocalTimerEnd: "+e)}},{key:"_runCloseAnimation",value:function(){this.model.set("isAdClosedByTimer",!0),this._runAnimation(!1,null)}},{key:"onAdComplete",value:function(){if(this.model.get("isReplayAd")&&(this.repeatingAd=this.activeAd,this.isReplayMode=!1),this.model.get("isCardBelongToTempAd")&&this.onConditionComplete(),this.activeAd=void 0,this.ad$el=void 0,this._handleMidroll(),!this.model.get("isMultiAd"))return this.permanentAttach(),void this.checkAndClose("Single Ad Complete");this.isViewed=!1,this.checkEligible()}},{key:"isEligibleToPlay",value:function(){return this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===a.videoViewState.detached:this.model.get("videoViewState")===a.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView}},{key:"checkEligible",value:function(){if(!this.isRepeateMode){var e=this.isEligibleToPlay();this._setCardId(),e?(this.activeAd||(this.getReadyAd(),this.loadingView&&this.loadingView.show()),this.activeAd&&(this.loadingView&&this.loadingView.hide(),this.log.info("Play Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this._playAd(),this._stopLocalTimers())):this.activeAd&&(this.log.info("Pause Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this.activeAd.pause(),this._clearViewabilityTime()),!e&&this.isFirstDetach&&(e=!0),this._updateSubAdsEligibilityStatus(e)}}},{key:"hasRedyAdChangeSubUnit",value:function(){this.log.info("hasRedyAdChangeSubUnit",this.globalModel.get("hasReadyAd")),!this.isRepeateMode&&this.globalModel.get("hasReadyAd")&&this.isEligibleToPlay()&&this.getReadyAd()}},{key:"_setCardId",value:function(){this.isDetached?this.model.set("cardNumber",-1*this.cardNumber):this.model.set("cardNumber",this.cardNumber)}},{key:"getReadyAd",value:function(e){if(this.globalModel.get("hasReadyAd")&&!this.model.get("isPlacementSingleAd")){var t=this.globalModel.getNextAd();if(!t)return;this.globalModel.get("lastAdID")||this.globalModel.set("lastAdID",t.adId),this.log.info("Video View Got new ad of type : "+parseInt(t.adData.requiredViewability?"1":"0"),t),this._switchFromActiveAd("getReadyAd"),this.oldAdUi=this.$el,this.activeAd,this._setAd(t),this.activeAd.setSubModel(this.model),this.isDetached?this._resetElDetached():this._attachToCard(),this.checkEligible()}else this.log.warning("Could not find ad"),this.watingForAd=!0,this.globalModel.once("change:hasReadyAd",this.hasRedyAdChangeSubUnit.bind(this))}},{key:"_onViewability",value:function(){this.isViewed=!0,this.viewabilityTimer=void 0,this.activeAd&&this.activeAd.onViewability(),this.log.info("!!@ _onViewability",this.model.get("tempAdCondition")),"viewability"===this.model.get("tempAdCondition")&&this.onConditionComplete()}},{key:"_startLoadingView",value:function(e){this.$el.hasClass("_cm-loading")||(this.loadingView=new q({model:this.model,container:this.container,globalModel:this.globalModel,isStartWithReplay:this.model.get("isPlacementSingleAd")&&!this.isDetached,isReplayable:this.model.get("isReplayable")}),this._switchFromActiveAd("_startLoadingView"),this.el=this.loadingView.el,this.$el=this.loadingView.$el,this.currentSize=null,this.isDetached?this._resetElDetached():this._attachToCard()),this.loadingView.show(),this.isEligibleToPlay()||(this.isSkipCollapse=!0),e||this.getAdTimer.start(this.model,"")}},{key:"_startRepeatView",value:function(){this.repeatView=new de({model:this.model,container:this.container,globalModel:this.globalModel}),this._switchFromActiveAd("_startRepeatView"),this.el=this.repeatView.el,this.$el=this.repeatView.$el,this._updateCloseButtonContainer(),this.isDetached?this._resetElDetached():this._attachToCard(),this.repeatView.show()}},{key:"_resetElDetached",value:function(){this.currentSize=null;var e=this.getDetachPositionAndSize();this.$el.css("position","fixed"),this._resize(this.model,e.size),this._rePosition(this.model,e.position),this.model.trigger("change:videoViewSize",e.size),wi.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss))}},{key:"_closeLoadingView",value:function(){this.loadingView&&(this.log.info("loading view closed"),this.loadingView.hide(),this.loadingView.remove(),this.loadingView=void 0)}},{key:"_addCloseButton",value:function(){this.closeButtonView||!this.isDetachedHasCloseButton&&!this.isAttachedHasCloseButton||(this.log.info("Creating Close Button"),!0===wi.parseBool(this.model.get("closeButton.hasCloseButton"))&&(this.closeButtonView=new F({model:this.model,container:this.el})))}},{key:"_renderCloseButton",value:function(){if(this.closeButtonDelayd)this.closeButtonView.render(),this.closeButtonView.show();else{this.closeButtonDelayd=!0;var e=this.model.get("components.CloseButtonView.delay");setTimeout(this._renderCloseButton.bind(this),e)}}},{key:"_updateCloseButtonContainer",value:function(){this.closeButtonView&&Object(n.a)(this.closeButtonView.el).appendTo(this.$el)}},{key:"_closeButtonShow",value:function(){this.closeButtonView&&(this.isAttachedHasCloseButton||this.model.get("videoViewState")===a.videoViewState.detached)&&this.closeButtonView.show()}},{key:"_closeButtonHide",value:function(){this.closeButtonView&&this.closeButtonView.hide()}},{key:"_onLoadingClick",value:function(){this.isReplayMode||(this.model.get("isReplayAd")&&this.repeatingAd&&this.repeatingAd.vpaidWrapper.isReplayable?this._setRepeatingAd():this.getAdTimer.start(this.model,"")),this.model.set("isAdClosedByTimer",!1),this.model.set("closeTimer",void 0),this.isRepeateMode=!1,this.globalModel.once("change:hasReadyAd",this.hasRedyAdChangeSubUnit.bind(this))}},{key:"_setRepeatingAd",value:function(){var e=this.repeatingAd;this.isReplayMode=!0,this.el=e.vpaidWrapper.adTarget,this.$el=Object(n.a)(this.el),this.$el.css({position:"absolute"}),this.$el.css({display:"block !important"}),this._setAdBase(e),this.isDetached?this._resetElDetached():this._attachToCard(),e.vpaidWrapper.restartAd(),this.log.info("replaying ad "+e.adId),e.setToModel("adQState",a.adQState.repeating,e.adId),e.setToModel("adState",a.adState.repeating,e.adId),e.adState=a.adState.repeating}},{key:"_setAdBase",value:function(e){this.$el.attr("data-adId",e.adId),this.activeAd=e,this.ad$el=this.$el,this._updateCloseButtonContainer(),this._updateDisclosureTextContainer(),this._updateAdChoiceContainer(),this._updateVolumeButton(),this.$el.addClass("_cm-video"),this._switchToActiveAd("set ad"),this.$el.addClass("_cm-sub-unit-id-"+this.subUnitId),this._setVolumeEvents(),this.model.set("videoViewContainer",this.$el),this.model.get("isCardBelongToTempAd")&&this.activeAd.onCardSwap(),this._closeLoadingView(),this.isDetached&&e.vpaidWrapper.nonVideoVpaid&&this.permanentAttach()}},{key:"_updateDisclosureTextContainer",value:function(){this.disclosureTextView&&this.disclosureTextView.$el.appendTo(this.$el)}},{key:"_updateAdChoiceContainer",value:function(){this.adChoiceArr&&this.adChoiceArr.length>0&&this.adChoiceArr.forEach(function(e){e.$el.appendTo(this.$el)}.bind(this))}},{key:"_getPositionResetCSS",value:function(){return{top:"auto",bottom:"auto",left:"auto",right:"auto"}}},{key:"createBasicAdDataObj",value:function(e){var t=e.adData;return{adId:e.adId,requiredViewability:t.requiredViewability,playerSequenceId:t.sequenceId,dp:t.dp.toString()}}},{key:"createNewAdData",value:function(e,t){var i={newAd:this.createBasicAdDataObj(e)},o=Object(n.a)(this.model.get("scrollSelector"))[0],r=null!=o,s=r?o.clientHeight:window.innerHeight,a=r?s+o.scrollTop:s+window.pageYOffset,l=this.model.get("parentSelector");l=wi.isArray(l)?l[0]:l,l=Object(n.a)(l)[0];var c=wi.getTopOfEl(l);return i.newAd.isEligible=this.model.get("isEligibleToPlay"),i.newAd.hadEligibility=this.model.get("hadEligibility"),i.newAd.hadLostEligibility=!!this.model.get("lostEligibilityTime"),i.newAd.topParentSelector=c,i.newAd.bottomViewPort=a,i.adId=t,i}},{key:"createOldAdData",value:function(e,t){return{oldAd:this.createBasicAdDataObj(e),adId:t}}},{key:"_addAdChoice",value:function(){var e=this.model.get("components.adChoice");e.isActive&&(e.videoAd.isActive&&!this.isDetachActive?this._initVideoViewAdChoice():this._initAdChoiceDetachable())}},{key:"_initVideoViewAdChoice",value:function(){this.adChoiceArr=[],this.adChoice=new Pe({model:this.model,container:this.el,type:E.AD_CHOICE_TYPE.VIDEO_AD}),this.adChoiceArr.push(this.adChoice)}},{key:"_initAdChoiceDetachable",value:function(){this.adChoiceArr=[],this.model.get("components.adChoice.videoAd.isActive")&&(this.adChoiceVideoAd=new Pe({model:this.model,container:this.el,type:E.AD_CHOICE_TYPE.VIDEO_AD}),this.adChoiceArr.push(this.adChoiceVideoAd)),this.model.get("components.adChoice.slider.isActive")&&(this.adChoiceSlider=new Pe({model:this.model,container:this.el,type:E.AD_CHOICE_TYPE.SLIDER}),this.adChoiceArr.push(this.adChoiceSlider))}},{key:"_rePosition",value:function(e,t){if(t.top){if(!this.isDetached&&t.top<=this.model.get("minTopForVideo")&&t.left<=this.model.get("minLeftForVideo"))return this.globalModel.set("top0Left0",!0),void this.globalModel.set("topParentSelectorLost",!0);this.model.get("isPlayerOutOfViewport")&&t.top&&this.activeAd&&(t.top,this.globalModel.get("topOffsetPosition"),this.activeAd.vpaidWrapper.adTarget.parentElement.style.top="-"+this.globalModel.get("topOffsetPosition")+"px"),this.$el.css(t)}}},{key:"_playAd",value:function(){this.model.get("isToggleIframeContent")&&this.activeAd.vpaidWrapper.toggleIframeContentDisplay&&this.activeAd.vpaidWrapper.toggleIframeContentDisplay("show"),this.playAd()}},{key:"_updateSubAdsEligibilityStatus",value:function(e){e?this.globalModel.set("lastCardOutOfViewport",void 0):this.globalModel.set("lastCardOutOfViewport",this.model.get("subUnitId")),this.globalModel.set("subAdsEligibility."+this.model.get("subAdId"),e)}},{key:"injectAd",value:function(e,t){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempActiveAdCondition",t),e.setSubModel(this.model),this._setAd(e),this.$el.height(this.model.get("videoPlaceholderSize.height")),this._rePosition(this.model,this.model.get("videoPlaceholderPosition")),this.isEligibleToPlay(),this.log.info("is Viewability fired",e.isViewabilityFired)}},{key:"extractAd",value:function(e){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempAdCondition",e),this.ad$el&&this.ad$el.css("height","0"),this._removeAnimation(),this.activeAd=void 0,this.ad$el=void 0,this._startLoadingView(!0),this._clearViewabilityTime()}},{key:"onConditionComplete",value:function(){this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.listeningToCondition=!1,this.globalModel.set("temAdCondition",!0)}},{key:"onTempAdEnd",value:function(){this.log.info("@!! onTempAdEnd subUnitId: ",this.subUnitId),this.log.info("@!! onTempAdEnd isCardBelongToTempAd: ",this.model.get("isCardBelongToTempAd")),this.model.get("isCardBelongToTempAd")&&(this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.listeningToCondition=!1,this.onLocalTimerEnd("Temp Card Close"))}},{key:"_addUIComponents",value:function(){this._addCloseButton(),this._addAdChoice(),this._adVolumeButton()}},{key:"_adVolumeButton",value:function(){this.model.get("components.volume.isActive")&&(this.volume=new Ue({model:this.model,container:this.el,globalModel:this.globalModel}))}},{key:"_updateVolumeButton",value:function(){this.volume&&this.volume.$el.appendTo(this.$el)}},{key:"_showRepeat",value:function(){this.loadingView&&this.loadingView.showRepeat()}},{key:"getActiveAd",value:function(){return this.activeAd}},{key:"getEl",value:function(){return this.el}},{key:"getModel",value:function(){return this.model}},{key:"isContentViewActive",value:function(){return!!(this.model.get("components.contentVideo.isActive")&&this.model.get("detachToSlider.isStartFromSlider")&&this.model.get("detachToSlider.isDetachToSlider")&&this.isDetached)}},{key:"_addContentView",value:function(){this.isContentViewActive()&&(this.contentView=new tt({model:this.globalModel,container:this.container}),this.log.info("Content was created."))}},{key:"_showContentView",value:function(){this.contentView?(this._switchFromActiveAd("_startLoadingView"),this.el=this.contentView.el,this.$el=this.contentView.$el,this.$el.removeClass("_cm-ad"),this.$el.removeClass("_cm-ad-active"),this.currentSize=null,this.isDetached?this._resetElDetached():this.log.warning("Should not start content when attached!!!"),this.contentTimer.start(this.model,"")):this.log.warning("There is no content view available!")}},{key:"terminateContent",value:function(){this.isContentViewActive()||this.contentView&&this.contentView.terminate()}},{key:"_handleMidroll",value:function(){this.isContentViewActive()?this._showContentView():this._startLoadingView()}},{key:"_stopLocalTimers",value:function(){this.getAdTimer.stop(this.model,"",null,!0),this.contentTimer.stop(this.model,"",null,!0)}}])&&yi(t.prototype,i),r}(pi);function Ti(e){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ci(e,t){return(Ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ei(e,t){return!t||"object"!==Ti(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ki(e){return(ki=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Oi=i(5),Ii=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ci(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ki(e);if(t){var o=ki(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ei(this,i)}}(r);function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e,"SubFeedVideoView "+e.model.get("cardNumber"),e.globalModel)).globalModel=e.globalModel,t.nativeAdSettings=e.nas,t.animationUtil=Ht(t.model),t.detachToSlider=t.model.get("detachToSlider"),t.currentAnimation=E.ANIMATION_TYPE.none,t.isStickyCardActive=t.model.get("stickyCard.isActive"),t.render(),t._setAd(e.adjs),t.isStickyCardActive&&t._setStickyCardParams(),t}return t=r,(i=[{key:"render",value:function(){this.$el.addClass("_cm-video-with-slider"),this.model.set("videoViewState",a.videoViewState.rendered),Oi.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoInitToRender".concat(this.model.get("perfUnitType")),E.TRC_PERFORMANCE_ACTIONS.STOP)}},{key:"_setStickyCardParams",value:function(){var e=this.getStickyPosition();this.detachToSlider.position.horizontalOffset=e.left,this.detachToSlider.position.verticalOffset=e.top,this.detachToSlider.position.horizontal="left",this.detachToSlider.position.vertical="top"}},{key:"getStickyPosition",value:function(){var e=this.$el.offset(),t={top:this.model.get("stickyCard.offset.top")||0,left:this.model.get("stickyCard.offset.left")||0};return{top:"".concat(t.top),left:"".concat(e.left+t.left)}}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"blockedByExternalUnit",funcName:"_onBlockedByExternalUnitChange"},{event:"isInTab",funcName:"onIsInTabChange"}]);var e=this.model.get("isMultiAd")&&!this.model.get("isPlacementSingleAd");this.model.get("isForceSwapToRV")&&e&&(this.currModel.on("change:hasReadyAd",this.onGotRVAd.bind(this)),this.currModel.on("change:isNextAdRV",this.onGotRVAd.bind(this)))}},{key:"_setAd",value:function(e){this.isFirstAd?this._switchFromActiveAd("set ad first ad switch"):this.isFirstAd=!1,this.el=e.vpaidWrapper.adTarget,this.isCurrentAdRV=e.adData.requiredViewability,this.model.get("isReplayAd")&&e.vpaidWrapper.isReplayable&&e.vpaidWrapper.dontDie&&e.vpaidWrapper.dontDie(),this.globalModel.get("volumeMuted")||"iOS"!==this.ua.os.name||this.globalModel.set("volumeMuted",!0),this.$el=Object(n.a)(this.el),this.activeAd=e,this.$el.addClass("_cm-video"),this._switchToActiveAd("set ad"),this._setVolumeEvents(),this.model.get("isCardBelongToTempAd")&&this.activeAd.onCardSwap(),this.model.set("videoViewContainer",this.$el),this.eligibilityService.onAdRvChange(this.isCurrentAdRV)}},{key:"_switchFromActiveAd",value:function(e){this.log.info("@@@ _switchFromActiveAd"),this.log.warning("switchFromActiveAd",this.cardNumber),this.$el.addClass("_cm-ad"),this.$el.removeClass("_cm-ad-active"),this.model.get("isReplayAd")||this.model.set("isActiveAd",!1),this.repeatingAd&&this.repeatingAd.vpaidWrapper&&Object(n.a)(this.repeatingAd.vpaidWrapper.adTarget).css({display:"none !important"})}},{key:"_switchToActiveAd",value:function(e){this.$el.removeClass("_cm-ad"),this.$el.addClass("_cm-ad-active"),this.model.set("isActiveAd",!0),this.changeBackgroundColor(),this.log.info("switchToActiveAd",this.cardNumber)}},{key:"detach",value:function(e,t,i){if(e||!this.isDetached){this.log.info("detaching"),this.currentAnimation=E.ANIMATION_TYPE.detaching;var n=!this.model.get("stickyCard.isActive");this.changeBackgroundColor(n),this.$el.css(this.model.get("additionalCss")),this.nativeAdSettings?(this.model.once("nativeAdSettingsUpdated",this._detach.bind(this,e,t,i)),this.nativeAdSettings.triggerDetachIfRendered()):this._detach(e,t,i),this.isDetached=!0,this.model.set("videoViewState",a.videoViewState.detached),this.checkEligible()}}},{key:"_detach",value:function(e,t,i){var o=n.a.extend(!0,{},this.detachToSlider);this.nativeAdSettings.hasNAS&&o.height&&(o.height+=this.nativeAdSettings.getFloatingNASHeight(),this.model.set("detachToSlider.height",o.height));var r=t||this.model.get("videoViewState")!==a.videoViewState.detached?i:0;this.animationUtil.detach({$el:this.$el,timeMS:r,sliderOptions:o,isSlideIn:t,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this),isAmp:this.model.get("frameType")===E.FRAME_TYPE.amp}),this.nativeAdSettings.hasNAS&&this.model.set("detachToSlider.height",o.height-this.nativeAdSettings.getFloatingNASHeight())}},{key:"detachAmpSticky",value:function(e,t,i,n){if(e||!this.isDetached){this.log.info("detaching"),this.currentAnimation=E.ANIMATION_TYPE.detaching;var o=!this.model.get("stickyCard.isActive");this.changeBackgroundColor(o),this.$el.css(this.model.get("additionalCss")),this.animationUtil.detachAmpSticky({$el:this.$el,timeMS:i,sliderOptions:n,isSlideIn:t,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.isDetached=!0,this.model.set("videoViewState",a.videoViewState.detached),this.checkEligible()}}},{key:"correctSliderAMPOffset",value:function(e){this.currentAnimation=E.ANIMATION_TYPE.detaching,this.animationUtil.correctSliderDetachPosition({$el:this.$el,sliderOptions:e,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)})}},{key:"postDetach",value:function(){this.currentAnimation===E.ANIMATION_TYPE.detaching&&(this.currentAnimation=E.ANIMATION_TYPE.none,Oi.isEmpty(this.model.get("detachToSlider").customCss)||this.$el.css(JSON.parse(this.model.get("detachToSlider").customCss)),this.activeAd&&(this._playAd(),this.activeAd.onDetached()))}},{key:"resize",value:function(e,t,i){if(!this.currentSize||this.currentSize.width!==e.width||this.currentSize.height!==e.height||t){if(!i||t){var o=n.a.extend(!0,{},e);this.nativeAdSettings&&this.nativeAdSettings.hasNAS&&(o.height+=this.nativeAdSettings.getFloatingNASHeight()),this.$el.css(o)}0!==e.height&&0!==e.width&&(this.activeAd&&this.activeAd.vpaidWrapper?this.activeAd.resize(e):this.repeatingAd&&this.repeatingAd.vpaidWrapper&&this.repeatingAd.resize(e),this.currentSize=n.a.extend(!0,{},e),this.model.trigger("change:videoViewSize",e))}}},{key:"_playAd",value:function(){this.model.get("isToggleIframeContent")&&this.activeAd.vpaidWrapper.toggleIframeContentDisplay&&this.activeAd.vpaidWrapper.toggleIframeContentDisplay("show"),this.log.info("@@@ Play AD"),this.activeAd.recheckSize(),this.playAd()}},{key:"onAdComplete",value:function(){if(this.nativeAdSettings&&this.nativeAdSettings.onAdComplete(),this.model.get("isReplayAd")&&this.activeAd&&(this.repeatingAd=this.activeAd),this.handlePlayerOutOfViewport(),this._switchFromActiveAd("end off ad"),this.activeAd=void 0,this.isSwappedAd&&(!this.currModel.get("hasReadyAd")||!this.currModel.get("isNextAdRV")))return this.isSwappedAd=!1,this._setAd(this.swappedAd),this.model.trigger("showVolumeButtonOnBackFromSwap"),this._swapNativeAdSettings(),this.swappedAd=void 0,void this.postGetAd();this.model.set("videoView.showingAd",!1),this.model.get("isCardBelongToTempAd")&&this.onConditionComplete(),this.model.get("isMultiAd")&&!this.model.get("isPlacementSingleAd")?!this.isSwappedAd||this.currModel.get("hasReadyAd")&&this.currModel.get("isNextAdRV")?this.checkEligible():this.swapBackToSavedAd():this.isSingleAdCompleted=!0}},{key:"_onViewability",value:function(){this.activeAd?(pi.prototype._onViewability.call(this),this.log.info("!!@ _onViewability",this.model.get("tempAdCondition")),"viewability"===this.model.get("tempAdCondition")&&this.onConditionComplete()):this.log.warning("Viewability without active ad was called!")}},{key:"onIsInTabChange",value:function(){this.activeAd&&this.activeAd.vpaidWrapper&&this.model.get("isInTab")&&Oi.forceElementRedrawWithBorderChange(this.model.get("wurfl.browser"),this.activeAd.vpaidWrapper.adTarget),this.checkEligible()}},{key:"checkEligible",value:function(){if(!this.isRepeatMode){var e=this.isEligibleToPlay();this._setCardId(),e?(this.activeAd||this.getReadyAd(),this.activeAd&&(this.hadPossibleRV&&(this.onGotRVAd(),this.hadPossibleRV=!1),this.log.info("Play Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this._playAd())):this.pauseAd(),!e&&this.isFirstDetach&&(e=!0),this._updateSubAdEligibilityStatus(e)}}},{key:"_updateSubAdEligibilityStatus",value:function(e){e?(this.log.info("!!!@@@ _updateSubAdEligibilityStatus","set underfind"),this.globalModel.set("lastCardOutOfViewport",void 0)):(this.log.info("!!!@@@ _updateSubAdEligibilityStatus",this.model.get("subUnitId")),this.globalModel.set("lastCardOutOfViewport",this.model.get("subUnitId"))),this.globalModel.set("subAdsEligibility."+this.model.get("subAdId"),e)}},{key:"isEligibleToPlay",value:function(){return!this.model.get("blockedByExternalUnit")&&(this.model.get("isInTab")?!!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")===a.videoViewState.detached:this.model.get("videoViewState")===a.videoViewState.detached&&"play"===this.model.get("detachToSlider").onOutOfView)}},{key:"_setCardId",value:function(){this.isDetached?this.model.set("cardNumber",-1*this.cardNumber):this.model.set("cardNumber",this.cardNumber)}},{key:"getReadyAd",value:function(){if(!this.isSingleAdCompleted)if(this.globalModel.get("hasReadyAd")){var e=this.globalModel.getNextAd();if(!e)return;this.globalModel.get("lastAdID")||this.globalModel.set("lastAdID",e.adId),this.log.info("Video View Got new ad of type : "+parseInt(e.adData.requiredViewability?"1":"0"),e),this._switchFromActiveAd("getReadyAd"),this._setAd(e),this.activeAd.setSubModel(this.model),this.postGetAd()}else this.log.warning("Could not find ad"),this.watingForAd=!0,this.globalModel.once("change:hasReadyAd",this.hasReadyAdChangeSubUnit.bind(this))}},{key:"postGetAd",value:function(){this.repositionVideo(),this.resize(this.currentSize,!0),this.model.set("videoView.showingAd",!0),this.checkEligible()}},{key:"hasReadyAdChangeSubUnit",value:function(){this.log.info("hasReadyAdChangeSubUnit",this.globalModel.get("hasReadyAd")),!this.isRepeatMode&&this.globalModel.get("hasReadyAd")&&this.isEligibleToPlay()&&this.getReadyAd()}},{key:"expand",value:function(){this.log.info("Expand"),this.currentAnimation=E.ANIMATION_TYPE.expanding;var e=this.model.get("videoPlaceholderSize");this.resize(e);var t={height:0,width:e.width};this.resize(t),this.animationUtil.expand({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("videoPlaceholderSize.height"),cb:this.postExpand.bind(this)})}},{key:"postExpand",value:function(){this.currentAnimation===E.ANIMATION_TYPE.expanding&&(this.currentAnimation=E.ANIMATION_TYPE.none)}},{key:"collapse",value:function(){this.$el&&this.animationUtil.collapse({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:null})}},{key:"attach",value:function(e,t,i){this.log.info("Attaching to card",this.$el),this.currentAnimation=E.ANIMATION_TYPE.attaching,this.isDetached=!1,this.changeBackgroundColor(!1),this.animationUtil.attach({$el:this.$el,target:this.model.get("videoPlaceholderPosition"),isAnimated:e,timeMS:t,additionalCss:this.model.get("additionalCss"),size:this.model.get("videoPlaceholderSize"),cb:this.postAttach.bind(this,i)}),this.handlePlayerOutOfViewport(),this.model.set("videoViewState",a.videoViewState.attached)}},{key:"postAttach",value:function(e){this.currentAnimation===E.ANIMATION_TYPE.attaching&&(this.currentAnimation=E.ANIMATION_TYPE.none,this.log.info("Attached",this.$el),e&&(this.isFirstDetach=!1,this.model.trigger("change:videoViewSize",this.model.get("videoPlaceholderSize"))),this.activeAd&&this.activeAd.onAttached(),this.checkEligible())}},{key:"slideOut",value:function(e,t){this.runSlideOutAnimation(e,t),this.isDetached=!1,this.model.set("videoViewState",a.videoViewState.attached),this.pauseAd(),this.model.get("isSuperSlider")&&(this.model.set("isSuperSliderClosed",!0),this.globalModel.set("isSuperSliderClosed",!0),this._updateSubAdEligibilityStatus(!1))}},{key:"runSlideOutAnimation",value:function(e,t){this.animationUtil.slideOut({$el:this.$el,timeMS:e,sliderOptions:this.detachToSlider,isVerticalSlideOut:t,cb:null})}},{key:"onTimerEnd",value:function(){this.activeAd=void 0}},{key:"pauseAd",value:function(){this.activeAd&&(this.log.info("Pause Ad sub unit: "+this.subUnitId+" ad:"+this.activeAd.adId),this.activeAd.pause())}},{key:"handlePlayerOutOfViewport",value:function(){var e=this.activeAd&&this.activeAd.vpaidWrapper.adTarget.parentElement;this.model.get("isPlayerOutOfViewport")&&e&&(e.style.top="-"+this.globalModel.get("topOffsetPosition")+"px")}},{key:"terminate",value:function(){this.log.info("terminate"),this.$el&&(this.activeAd&&this.activeAd.pause(),this.$el.remove(),this.isDetached=!1,this.close(),this.globalModel.set("isSliderClosed",!1))}},{key:"close",value:function(){this.log.info("close"),this.$el.height(0),setTimeout(function(){this.permanentClose()}.bind(this),1500)}},{key:"permanentClose",value:function(){this.log.info("permanentClose"),this.activeAd?(this.activeAd.pause(),this.activeAd=void 0):this.$el.remove()}},{key:"getActiveAd",value:function(){return this.activeAd}},{key:"getEl",value:function(){return this.el}},{key:"getModel",value:function(){return this.model}},{key:"setRepeatMode",value:function(e){this.isRepeatMode=e}},{key:"extractAd",value:function(){this.$el&&this.$el.css("height","0"),this.activeAd=void 0,this.$el=void 0}},{key:"injectAd",value:function(e){e.setSubModel(this.model),this._setAd(e),this.$el.height(this.model.get("videoPlaceholderSize.height")),this.isEligibleToPlay(),this.log.info("is Viewability fired",e.isViewabilityFired)}},{key:"onConditionComplete",value:function(){this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.globalModel.set("temAdCondition",!0)}},{key:"isRepeatingAd",value:function(){return this.repeatingAd&&this.repeatingAd.vpaidWrapper.isReplayable}},{key:"startRepeatingAd",value:function(){var e=this.repeatingAd;e.setNativeAdClickListener(),this._setAd(e),this.$el.css({display:"block !important"}),this.postGetAd(),e.vpaidWrapper.restartAd(),this.log.info("replaying ad "+e.adId),e.setToModel("adQState",a.adQState.repeating,e.adId),e.setToModel("adState",a.adState.repeating,e.adId),e.adState=a.adState.repeating,setTimeout(this.activeAd.recheckSize.bind(this.activeAd),0)}},{key:"repositionVideo",value:function(){this.isDetached?(this.isDetached=!1,this.detach(!1,0)):this.attach(!1,0,!1,!1)}},{key:"onSliderClose",value:function(){this.activeAd&&this.activeAd.onSliderClose()}},{key:"changeBackgroundColor",value:function(e){!e&&this.model.get("style.videoBackgroundColor")&&this.$el.css("background-color",this.model.get("style.videoBackgroundColor")),e&&this.$el.css("background-color","transparent")}},{key:"onGotRVAd",value:function(){this.currModel.get("hasReadyAd")&&this.currModel.get("isNextAdRV")&&!this.isCurrentAdRV&&(this.activeAd&&this.isEligibleToPlay()?this.swapToNewReadyAd():this.hadPossibleRV=!0)}},{key:"swapToNewReadyAd",value:function(){var e=this;this.isSwappedAd=!0,this.swappedAd=this.activeAd,this.swappedAd.onAdSwappedOut(),this.pauseAd(),this.getReadyAd(),this._swapNativeAdSettings(),setTimeout((function(){e.activeAd.onAdSwappedIn()}),0)}},{key:"_swapNativeAdSettings",value:function(){this.nativeAdSettings&&this.nativeAdSettings.onAdSwapped()}},{key:"swapBackToSavedAd",value:function(){this.isSwappedAd=!1,this._setAd(this.swappedAd),this.swappedAd=void 0,this.model.set("aspectRatioNum",this.activeAd.aspectRatioNum),this.postGetAd()}},{key:"_bindBlockedByExternalUnitChange",value:function(){}},{key:"_onBlockedByExternalUnitChange",value:function(){this.model.get("blockedByExternalUnit")?(this._pauseAd(),this.activeAd&&this.activeAd.fireAdOppOnce("adPausedOtherUnitIsPlaying")):this.checkEligible()}},{key:"_pauseAd",value:function(){this.activeAd&&this.activeAd.pause()}}])&&Pi(t.prototype,i),r}(pi);function Vi(e){return(Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Di(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ri(e,t){return(Ri=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xi(e,t){return!t||"object"!==Vi(t)&&"function"!=typeof t?Ni(e):t}function Ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mi(e){return(Mi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fi=i(5),Li=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ri(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Mi(e);if(t){var o=Mi(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return xi(this,i)}}(r);function r(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).log=new c.a({unitType:t.model.get("unitType"),className:"SubFeedFloatingView "+t.model.get("cardNumber"),version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t.nativeAdSettings=e.nas,t.globalModel=e.globalModel,t.eligibilityService=e.eligibilityService||{},t.container=Object(n.a)(t.model.get("videoContainerSelector")||"body")[0],t.animationUtil=Ht(t.model),t.detachToSlider=t.model.get("detachToSlider"),t.attachedOnceToNewCard=!1,t.isDetachActive=t.detachToSlider.isStartFromSlider||t.detachToSlider.isDetachToSlider,t.isStickyCardActive=t.model.get("stickyCard.isActive"),t.isStickyCardActive&&t.globalModel.set("floatingNAS.isActive",!1),t.isDetachedHasCloseButton=t.isDetachActive&&t.detachToSlider.hasCloseButton,t.isAttachedHasCloseButton=t.model.get("hasCloseButton"),t.isAnimateOnClose=t.model.get("isAnimateOnClose")||t.model.get("animation.onTransitionClose")&&"close"===t.model.get("onTimerClose"),t.isForceDetachOnGotAd=(t.isDetachActive||t.isStickyCardActive)&&t.model.get("detachToSlider.forceDetach.isActive");var i={startCondition:{stateToListen:"",state:""}},s=t._getSecondsForLoadingTimer();return t.loadingTimer=new u.r(t.model,i,t.onLocalTimerEnd.bind(Ni(t),"midrollCollapse subUnit"),s),t.contentTimer=new u.r(t.model,i,t.onLocalTimerEnd.bind(Ni(t),"Content timer subUnit"),1e3*t.model.get("contentTimerSeconds")),t.currentAnimation=E.ANIMATION_TYPE.none,t._setStickParams(),t._setSliderSize(),t.render(),t.renderComponenets(),t.subFeedVideoView=new Ii(e),t._bindEvents(),t.startUnit(),t}return t=r,(i=[{key:"_getSecondsForLoadingTimer",value:function(){return 1e3*(this.model.get("isPlacementSingleAd")?this.model.get("secondsToCloseSingleAdFeed")||0:this.model.get("secondsToCloseFeed"))}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"isEligibleToPlay",funcName:"isEligibleToPlayChange"},{event:"closeButtonClick",funcName:"_onCloseButtonClick"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"adQState:completed",funcName:"onAdComplete"},{event:"isEligibleToStick",funcName:"isEligibleToPlayChange"},{event:"videoView.showingAd",funcName:"onAdDisplayChange"},{event:"videoPlaceholderSize",funcName:"onVideoPlaceholderSizeChange",withBind:!1},{event:"videoPlaceholderPosition",funcName:"onVideoPlaceholderPosition",withBind:!1},{event:"aspectRatioNum",funcName:"onAspectRatioChange"},{event:"isInTab",funcName:"onIsInTabChange"},{event:"blockedByExternalUnit",funcName:"_onBlockedByExternalUnit"},{event:"isActiveAd:true",funcName:"_show"},{event:"isActiveAd:false",funcName:"_hide"}]),this.model.get("stickyCard.isActive")&&(s.a.on("window:scroll:change",this._onWindowScroll.bind(this)),s.a.on("window:resize:change",this.onWindowResize,this),this.model.get("feedCardElig.isActive")&&this.globalModel.on("change:ampPageTopLimit",this._correctAMPOffset.bind(this))),this.isDetachActive&&this.model.get("frameType")===E.FRAME_TYPE.amp&&(this.model.set("ampPageBottomLimit",this.globalModel.get("ampPageBottomLimit")),this.model.set("ampPageTopLimit",this.globalModel.get("ampPageTopLimit")),this.globalModel.on("change:ampPageBottomLimit",this._correctSliderAMPOffset.bind(this)))}},{key:"startUnit",value:function(){this.model.get("isEligibleToPlay")&&!this.model.get("isSuperSlider")?this.startUnitAttached():this.model.get("isOpenFloatingViewInViewPort")?this.model.get("detachToSlider.isStartFromSlider")?this.startUnitDetached():this._isForceAdDetach()?(this.hadForcedDetach=!0,this.globalModel.set("hadForcedDetach",!0),this.isDetachedHasCloseButton=this.detachToSlider.hasCloseButton,this.startUnitDetached()):this.createStateHandlers([{event:"isEligibleToPlay",funcName:"startUnitAttached",isListenOnce:!0,withBind:!0}]):this.startUnitAttached(!0)}},{key:"_isForceAdDetach",value:function(){if(!this.isForceDetachOnGotAd||this.globalModel.get("hadStickyDetach"))return!1;var e=this._isActiveAdCanStick()&&!this.globalModel.get("isEligibleToPlay");return this.log.info("force ad detach:",e),e}},{key:"startUnitAttached",value:function(e){this.isAttachingOnStart=!0,this.attach(!1,!0),e||this.playAd()}},{key:"startUnitDetached",value:function(){this.isFirstDetach=!0,this.isStickyCardActive&&this._setStickySizeRestriction(),this._startFromSlider()}},{key:"_startFromSlider",value:function(){!this.eligibilityService.checkSliderEligibility||this.eligibilityService.checkSliderEligibility()?(this.isWaitingForSliderEligibility=!1,this.detach(),this.playAd()):(this.isWaitingForSliderEligibility=!0,this.createStateHandlers([{event:"isSliderEligibleToPlay:true",funcName:"_startFromSlider",isListenOnce:!0}]))}},{key:"render",value:function(){this.el.id="_cm-css-reset",this.$el.addClass("_cm-floating-view"),this.$el.css({width:this.model.get("width"),height:0}),this.container.appendChild(this.el)}},{key:"renderComponenets",value:function(){this.createCloseButton(),this.createLoadingView(),this._addAdChoice(),this._adVolumeButton(),this._addDisclosureText(),this._addContentView()}},{key:"_onLoadingClick",value:function(){this.isReplayMode||(this.model.get("isReplayAd")&&this.subFeedVideoView.isRepeatingAd()?(this.log.warning("Repeating ad should play"),this.subFeedVideoView.startRepeatingAd(),this.isReplayMode=!0,this.hideLoadingView()):(this.log.info("@@@ loadingTimer start"),this.loadingTimer.start(this.model,""))),this.model.set("isAdClosedByTimer",!1),this.model.set("closeTimer",void 0),this.subFeedVideoView.setRepeatMode(!1),this.globalModel.once("change:hasReadyAd",this.subFeedVideoView.hasReadyAdChangeSubUnit.bind(this.subFeedVideoView))}},{key:"_setSliderSize",value:function(){if(this.detachToSlider=this.model.get("detachToSlider"),this.model.get("stickyCard.isActive")){var e=this.model.get("width"),t=this.model.get("height"),i=this.getStickyPosition();return this.detachToSlider.position.horizontalOffset=i.left,this.detachToSlider.position.verticalOffset=i.top,this.detachToSlider.position.horizontal="left",this.detachToSlider.position.vertical="top",this.model.set("detachToSlider.width",e),void this.model.set("detachToSlider.height",t)}this.originalSliderWidth&&(this.detachToSlider.width=this.originalSliderWidth,this.originalSliderWidth=void 0),this.originalSliderHeight&&(this.detachToSlider.height=this.originalSliderHeight,this.originalSliderHeight=void 0),this.originalSliderHeight=this.detachToSlider.height;var n=this.model.get("width"),o=this.detachToSlider.liquidSize.isActive?this._calcLiquidWidth():this.detachToSlider.width;n>o&&(n=o);var r=Fi.getVideoHeightByRatio(n,this.model.get("aspectRatioNum")<=1?1.77:this.model.get("aspectRatioNum"));this.model.set("detachToSlider.width",n),this.model.set("detachToSlider.height",r)}},{key:"_setStickParams",value:function(){var e=this.model.get("stickyCard.navBarSelector"),t=document.querySelector(e),i=this.model.get("stickyCard.offset.top");if(t){var n=t.offsetHeight||0;this.model.set("stickyCard.offset.top",i+n)}}},{key:"_setStickyOffsetAMP",value:function(){this.ampOffsetTop=this.globalModel.get("ampPageTopLimit")}},{key:"_getCardTopOffset",value:function(e,t){var i='[data-card-index="'.concat(e,'"]'),o=Object(n.a)(i);if(!o)return 0;var r=o.offset();return r.top+r.height*(1-t)}},{key:"getStickyPosition",value:function(){var e=Object(n.a)(this.model.get("containerViewPlaceHolder")),t=e.length?e.offset().left:0,i=this.model.get("stickyCard.offset.top")||0;this.model.get("feedCardElig.isActive")&&(this._setStickyOffsetAMP(),this.ampOffsetTop&&(i+=this.ampOffsetTop));var o=t+(this.model.get("stickyCard.offset.left")||0);return{top:"".concat(i),left:"".concat(o)}}},{key:"_calcLiquidWidth",value:function(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.minWidth,t=this.detachToSlider.liquidSize.maxWidth,i=window.innerWidth*(this.detachToSlider.liquidSize.widthPercent/100);return t&&i>t&&(i=t),i<e&&(i=e),i}},{key:"_calcLiquidHeight",value:function(){this.detachToSlider=this.model.get("detachToSlider");var e=this.detachToSlider.liquidSize.maxHeight,t=window.innerHeight*(this.detachToSlider.liquidSize.heightPercent/100);return e&&t>e&&(t=e),t}},{key:"detach",value:function(e,t){if(this.model.set("floatingView",a.floatingView.detach),e||!this.isDetached){this.log.info("detaching"),this.isStickyCardActive||Fi.dispatchTRC("videoSliderOn"),this.currentAnimation=E.ANIMATION_TYPE.detaching;var i=t?0:this.model.get("animation.detach");this.isFirstDetach&&(i=this.model.get("animation.firstDetach")),this._setSliderSize();var n={width:this.model.get("detachToSlider.width"),height:this.model.get("detachToSlider.height")};this._resize(n,!this.isFirstDetach),this.$el.css(this.model.get("additionalCss")),this.model.get("stickyCard.isActive")&&this.model.get("frameType")===E.FRAME_TYPE.amp?(this._setStickyOffsetAMP(),this._setSliderSize(),this.animationUtil.detachAmpSticky({$el:this.$el,timeMS:i,sliderOptions:this.detachToSlider,isSlideIn:this.isFirstDetach,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.subFeedVideoView.detachAmpSticky(e,this.isFirstDetach,i,this.detachToSlider)):(this.nativeAdSettings?(this.model.once("nativeAdSettingsUpdated",this._detach.bind(this,e,t,i)),this.nativeAdSettings.triggerDetachIfRendered()):this._detach(e,t,i),this.subFeedVideoView.detach(e,this.isFirstDetach,i)),this.isStickyCardActive&&this.globalModel.set("hadStickyDetach",!0),this.isDetached=!0}}},{key:"_detach",value:function(e,t,i){var o=n.a.extend(!0,{},this.detachToSlider);this.nativeAdSettings.hasNAS&&(o.position.verticalOffset+=this.nativeAdSettings.getFloatingNASHeight()),this.animationUtil.detach({$el:this.$el,timeMS:i,sliderOptions:o,isSlideIn:this.isFirstDetach,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this),isAmp:this.model.get("frameType")===E.FRAME_TYPE.amp})}},{key:"postDetach",value:function(){this.currentAnimation===E.ANIMATION_TYPE.detaching&&(this.eligibilityService&&this.eligibilityService.checkSliderEligibility(),this.currentAnimation=E.ANIMATION_TYPE.none,!0===this.isFirstDetach&&(this.isFirstDetach=!1),this.isDetachedHasCloseButton?this._showCloseButton(this.model.get("stickyCard.isActive")):this._hideCloseButton())}},{key:"_resize",value:function(e,t,i){this.currentSize&&this.currentSize.width===e.width&&this.currentSize.height===e.height||(t&&!i||(this.$el.css(e),this.loadingView&&this.loadingView.resize(e)),this.currentSize=n.a.extend(!0,{},e),this.subFeedVideoView.resize(e,i,t))}},{key:"onIsInTabChange",value:function(){!this.model.get("isInTab")||this.model.get("isEligibleToPlay")||this.model.get("videoViewState")!==a.videoViewState.rendered||this.model.get("blockedByExternalUnit")||this.isEligibleToPlayChange()}},{key:"isEligibleToPlayChange",value:function(){this.currentAnimation===E.ANIMATION_TYPE.none&&(this.canAttach()?this.attach():this.canDetach()&&(this.detach(),this.model.get("stickyCard.isActive")&&this._setStickySizeRestriction()),this.subFeedVideoView.checkEligible())}},{key:"_setStickySizeRestriction",value:function(){if(!this.rvTimerWasSet&&this.model.get("stickyCard.restrictions.adPercent.percent")){var e=Fi.getViewportHeight(this.model.get("scrollSelector"));this.model.get("height")/e*100>=this.model.get("stickyCard.restrictions.adPercent.percent")&&(this.rvTimerWasSet=!0,this.stickyTimer=new u.r(this.model,{startCondition:{stateToListen:"",state:""}},this._onStickyTimerEnd.bind(this,"Sticky timer subUnit end"),1e3*this.model.get("stickyCard.restrictions.adPercent.secondsToClose")),this.stickyTimer.start(this.model,"",null,!0))}}},{key:"canAttach",value:function(){return!(this.model.get("stickyCard.isActive")&&this.model.get("isEligibleToStick")||!this.model.get("isEligibleToPlay")||this.model.get("videoViewState")!==a.videoViewState.detached&&!this.isWaitingForSliderEligibility||!this.model.get("renderWasCalled")||this.isSuperSlider())}},{key:"isSuperSlider",value:function(){return this.detachToSlider.isStartFromSlider&&this.detachToSlider.isDetachToSlider}},{key:"canDetach",value:function(){this.detachToSlider=this.model.get("detachToSlider");var e=this.subFeedVideoView.getActiveAd();if(this.model.get("stickyCard.isActive")){var t=this.model.get("stickyCard.restrictions.maxWidth")&&this.model.get("width")>this.model.get("stickyCard.restrictions.maxWidth"),i=this._isActiveAdCanStick(),n=this.model.get("aspectRatioNum")<this.model.get("stickyCard.maxAspectRatio");if(t||n||!i||!this.model.get("isEligibleToStick"))return(t||n||!i)&&this.globalModel.set("isSliderOn",!1),e&&this.model.get("videoViewState")!==a.videoViewState.attached&&!i&&this.permanentAttach(),!1}else if(this.model.get("isEligibleToPlay"))return!1;return this.model.get("isEligibleToPlay")||this.model.get("isOpenFloatingViewInViewPort")?!(this.model.get("videoViewState")!==a.videoViewState.attached&&this.model.get("videoViewState")!==a.videoViewState.rendered||!this.getActiveAd()||!this.detachToSlider.isDetachToSlider||!this.model.get("isInTab")||!this._isDetachAvailable()||this.globalModel.get("blockedByExternalUnit")||this.eligibilityService.isSliderEligibleToPlay&&!this.eligibilityService.isSliderEligibleToPlay()):(this.model.set("isOpenFloatingViewInViewPort",!0),!1)}},{key:"_isDetachAvailable",value:function(){return this.globalModel.get("disableDetachForSession")||this.globalModel.get("disableDetach")?(this.globalModel.set("disableDetach",!0),!1):this.model.get("frameType")===E.FRAME_TYPE.amp?this.model.get("AMPElemBelowVisible")?this.model.get("detachToSlider.isDetachBelow"):this.model.get("detachToSlider.isDetachAbove"):this.el.getBoundingClientRect().top>0?this.model.get("detachToSlider.isDetachAbove"):this.model.get("detachToSlider.isDetachBelow")}},{key:"_runAnimation",value:function(e){e?this.expand():this.collapse()}},{key:"expand",value:function(){var e=this;if(!this.expanded){this.expanded=!0;var t={height:0,width:this.model.get("videoPlaceholderSize").width};this._resize(t),this.currentAnimation=E.ANIMATION_TYPE.expanding,this.animationUtil.expand({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:this.model.get("videoPlaceholderSize.height"),cb:function(){e.postExpand()}}),this.subFeedVideoView.expand()}}},{key:"postExpand",value:function(){this.currentAnimation===E.ANIMATION_TYPE.expanding&&(this.currentAnimation=E.ANIMATION_TYPE.none,this.isEligibleToPlayChange())}},{key:"collapse",value:function(){this.animationUtil.collapse({$el:this.$el,timeMS:this.model.get("animation.transitionAnimationTime"),height:0,cb:null}),this.subFeedVideoView.collapse()}},{key:"attach",value:function(e,t){var i=this.model.get("videoPlaceholderPosition");if(i)if(isNaN(i.top))this.isStickyCardActive||Fi.dispatchTRC("videoSliderOff");else{this.eligibilityService&&this.eligibilityService.onAttach(),this.isWaitingForSliderEligibility=!1;var n=this.model.get("animation.attach"),o=(this.detachToSlider.isStartFromSlider||this.isForceDetachOnGotAd)&&this.isDetached||this.attachedOnceToNewCard,r=!e&&o&&this.model.get("detachToSlider").animation;this.isFirstDetach=!1,this.attachedOnceToNewCard=!0,this.log.info("Attaching",this.$el),this.currentAnimation=E.ANIMATION_TYPE.attaching,this.model.get("stickyCard.isActive")&&(r=!1),this.isDetached=!1,this.model.set("floatingView",a.floatingView.attach),this.animationUtil.attach({$el:this.$el,target:this.model.get("videoPlaceholderPosition"),isAnimated:r,timeMS:n,additionalCss:this.model.get("additionalCss"),cb:this.postAttach.bind(this,o)}),this.isAttachingOnStart&&(this.isAttachingOnStart=!1,this.expand()),this.subFeedVideoView.attach(r,n,o),!o&&this.model.get("animation.onTransitionOpen")||setTimeout(function(){this._resize(this.model.get("videoPlaceholderSize"),r,!0)}.bind(this),0),this.globalModel.get("isSliderOn")&&!this.model.get("detachToSlider.isDetachToSlider")&&this.globalModel.set("isSliderOn",!1),this.isAttachedHasCloseButton?this._showCloseButton():this._hideCloseButton(),this.loadingView&&this.loadingView.onAttach()}}},{key:"postAttach",value:function(e){this.model.set("floatingView",a.floatingView.postAttach),this.currentAnimation===E.ANIMATION_TYPE.attaching&&(this.isStickyCardActive||Fi.dispatchTRC("videoSliderOff"),this.currentAnimation=E.ANIMATION_TYPE.none,this.log.info("Attached",this.$el),e&&(this.isFirstDetach=!1),!this.model.get("animation.onTransitionOpen")||e?this.isEligibleToPlayChange():this.expand())}},{key:"permanentAttach",value:function(){var e=this;this.isPermanentAttachCalled||(this.model.set("detachToSlider.isStartFromSlider",!1),this.model.set("detachToSlider.isDetachToSlider",!1),this.globalModel.set("isSliderOn",!1),this.globalModel.set("isSliderClosed",!0),this.globalModel.set("floatingNAS.isActive",!1),this.model.set("floatingView",a.floatingView.permanentClosed),this.isDetached?this._slideOut((function(){e._hideCloseButton(!0),e.attach(!0),e.getActiveAd()||e.showLoadingView()})):this.attach(!0),this.terminateContent(),this.isPermanentAttachCalled=!0)}},{key:"_slideOut",value:function(e){if(this.isDetached){var t=this.model.get("animation.slideOut"),i=this.model.get("stickyCard.isActive");this._runSlideOutAnimation(e),this.subFeedVideoView.slideOut(t,i),this.isDetached=!1}}},{key:"_runSlideOutAnimation",value:function(e){var t=this.model.get("animation.slideOut"),i=this.model.get("stickyCard.isActive");this.animationUtil.slideOut({$el:this.$el,timeMS:t,sliderOptions:this.detachToSlider,isVerticalSlideOut:i,cb:e}),this.subFeedVideoView.runSlideOutAnimation(t,i)}},{key:"_runSlideInAnimation",value:function(){}},{key:"onAdComplete",value:function(){this.model.set("isReplayAd",this._isSingleAd()),this.model.get("isReplayAd")&&(this.isReplayMode=!1),this.model.get("isMultiAd")||this.model.get("isReplayAd")&&(this.log.info("Single ad completed, stays detach"),this.checkAndClose("Single ad"),this.showLoadingView()),this.isContentViewActive()&&this.model.set("aspectRatioNum",this.model.get("defaultAspectRatioNum")),this.subFeedVideoView.onAdComplete()}},{key:"checkAndClose",value:function(e){return!(this.isDetached||!this.model.get("isEligibleToPlay")||!this.isAnimateOnClose||this.model.get("isPlacementSingleAd")||(this.log.info("Close because of: ",e),this.collapse(),this.model.set("isAdClosed",!0),0))}},{key:"onTimerEnd",value:function(e){this.model.set("viewTopComponent",E.FLOATING_VIEW_TOP_COMPONENT.repeat),this.log.info("midroll:",e),this.subFeedVideoView.setRepeatMode(!0),this.showLoadingView(),this.checkAndClose(e),this.permanentAttach(),this.subFeedVideoView.onTimerEnd()}},{key:"playAd",value:function(){this.isWaitingForSliderEligibility=!1,this.subFeedVideoView._playAd(),this.log.info("@@@ loadingTimer stop"),this._stopLocalTimers(),this.createStateHandlers([{event:"isSliderEligibleToPlay",funcName:"_onSliderEligibilityChange"}])}},{key:"_onSliderEligibilityChange",value:function(){if(this.isDetached&&!this.isPermanentAttachCalled){var e=this.getActiveAd();e&&(this.model.get("isSliderEligibleToPlay")?e.play():e.pause())}}},{key:"_addAdChoice",value:function(){var e=this.model.get("components.adChoice");e.isActive&&(e.videoAd.isActive&&(this.adChoice=new Pe({model:this.model,container:this.el,type:E.AD_CHOICE_TYPE.VIDEO_AD})),e.slider.isActive&&(this.isDetachActive||this.isForceDetachOnGotAd)&&(this.adChoiceSlider=new Pe({model:this.model,container:this.el,type:E.AD_CHOICE_TYPE.SLIDER})))}},{key:"createCloseButton",value:function(){!this.closeButtonView&&(this.isDetachedHasCloseButton||this.isAttachedHasCloseButton||this.isForceDetachOnGotAd)&&(this.log.info("Creating Close Button"),!0===this.model.get("closeButton.hasCloseButton")&&(this.closeButtonView=new De({model:this.model,container:this.el,isSkipRender:!1}),this.closeButtonView.hide()))}},{key:"_onCloseButtonClick",value:function(){this.isDetached?(this.permanentAttach(),this.subFeedVideoView.onSliderClose()):(this.log.info("Close button click: close card"),this.checkAndClose())}},{key:"_showCloseButton",value:function(e){e&&void 0===this.closeButtonTimer?this.closeButtonTimer=setTimeout(this.model.set.bind(this.model,"closeButton.isShowing",!0),this.model.get("components.CloseButtonView.delay")):e||this.model.set("closeButton.isShowing",!0)}},{key:"_hideCloseButton",value:function(){clearTimeout(this.closeButtonTimer),this.closeButtonTimer=void 0,this.model.set("closeButton.isShowing",!1)}},{key:"_adVolumeButton",value:function(){this.model.get("components.volume.isActive")&&(this.volume=new Ue({model:this.model,container:this.el,globalModel:this.globalModel}))}},{key:"onAdDisplayChange",value:function(e,t){this.log.info("@@@ onAdDisplayChange");var i=t?E.FLOATING_VIEW_TOP_COMPONENT.video:E.FLOATING_VIEW_TOP_COMPONENT.loading;this.model.set("viewTopComponent",i),t?(this.model.set("viewTopComponent",E.FLOATING_VIEW_TOP_COMPONENT.video),this.log.info("@@@ ad started displaying"),this._stopLocalTimers(),this.nativeAdSettings&&this.nativeAdSettings.onAdDisplayChange()):(this.log.info("@@@ ad stopped displaying"),this.isContentViewActive()?(this.hideLoadingView(),this.model.set("viewTopComponent",E.FLOATING_VIEW_TOP_COMPONENT.content),this.contentTimer.start(this.model,"",null,!0)):(this.loadingTimer.start(this.model,"",null,!0),this.model.set("viewTopComponent",E.FLOATING_VIEW_TOP_COMPONENT.loading)))}},{key:"onVideoPlaceholderPosition",value:function(){this.model.get("isAdClosed")||this.isDetached||this.attach(!0)}},{key:"onVideoPlaceholderSizeChange",value:function(e,t){this.isDetached||this.currentAnimation!==E.ANIMATION_TYPE.none||this.model.get("videoViewState")!==a.videoViewState.attached||(this._setSliderSize(),this._resize(this.model.get("videoPlaceholderSize")))}},{key:"onAspectRatioChange",value:function(e,t){this.isDetached&&(this._setSliderSize(),this.detach(!0,!0))}},{key:"_addDisclosureText",value:function(){(this.model.get("components.disclosureText.isActive")||this.model.get("detachToSlider.components.disclosureText.isActive"))&&(this.disclosureTextView=new _e({model:this.model,container:this.el}),this.disclosureTextView.render())}},{key:"createLoadingView",value:function(){this.log.info("@@@ createLoadingView"),this.loadingView=new q({model:this.model,container:this.el,globalModel:this.globalModel,isReplayable:this.model.get("isReplayable")})}},{key:"showLoadingView",value:function(){this.loadingView&&!this.loadingTimer.isTimerActive()&&(this.log.info("@@@ showLoadingView"),this.loadingView.showRepeat(this.isDetached&&!this.globalModel.get("hadStickyDetach")),this.model.set("viewTopComponent",E.FLOATING_VIEW_TOP_COMPONENT.loading))}},{key:"hideLoadingView",value:function(){this.loadingView&&this.loadingView.hide()}},{key:"onLocalTimerEnd",value:function(e){this.log.info("SubUnit onLocalTimerEnd card number: ",this.model.get("cardNumber")),this.subFeedVideoView.setRepeatMode(!0);var t=!1;(this.globalModel.get("isSliderOn")||this.hadForcedDetach)&&(this.permanentAttach(),t=!0),this.checkAndClose("LocalTimerEnd: "+e)||t||this.showLoadingView()}},{key:"closeAndRemove",value:function(){this.terminate()}},{key:"terminate",value:function(){this.log.info("terminate"),this.hideLoadingView(),this._hideCloseButton(),this.permanentAttach(),this.subFeedVideoView.terminate(),this.$el.hide(),this.$el.remove()}},{key:"permanentClose",value:function(){this.subFeedVideoView.permanentClose()}},{key:"getActiveAd",value:function(){return this.subFeedVideoView.getActiveAd()}},{key:"getEl",value:function(){return this.subFeedVideoView.getEl()}},{key:"getModel",value:function(){return this.subFeedVideoView.getModel()}},{key:"extractAd",value:function(e){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempAdCondition",e),this.showLoadingView(),this.subFeedVideoView.extractAd()}},{key:"injectAd",value:function(e,t){this.model.set("isCardBelongToTempAd",!0),this.model.set("tempActiveAdCondition",t),this.hideLoadingView(),this.subFeedVideoView.injectAd(e),this.attach(!0)}},{key:"onTempAdEnd",value:function(){this.log.info("@!! onTempAdEnd subUnitId: ",this.subUnitId),this.log.info("@!! onTempAdEnd isCardBelongToTempAd: ",this.model.get("isCardBelongToTempAd")),this.model.get("isCardBelongToTempAd")&&(this.model.set("isCardBelongToTempAd",!1),this.model.set("tempAdCondition",!1),this.onLocalTimerEnd("Temp Card Close"))}},{key:"isContentViewActive",value:function(){return!(!this.model.get("components.contentVideo.isActive")||!this.model.get("detachToSlider.isStartFromSlider")||!this.model.get("detachToSlider.isDetachToSlider")||this.model.get("isPlacementSingleAd"))}},{key:"_addContentView",value:function(){this.isContentViewActive()&&(this.contentView=new tt({model:this.globalModel,unitType:this.model.get("unitType"),container:this.el}))}},{key:"terminateContent",value:function(){this.isContentViewActive()||this.contentView&&this.contentView.terminate()}},{key:"_stopLocalTimers",value:function(){this.loadingTimer.stop(this.model,"",null,!0),this.contentTimer.stop(this.model,"",null,!0)}},{key:"_onWindowScroll",value:function(){if(this.isDetached&&this.model.get("stickyCard.isActive")){var e=Object(n.a)(this.model.get("videoContainerSelector"));if(e.offset()){var t=e.offset().top,i=t+e.height(),o=this.$el.offset().top,r=o<t;(i<o+this.$el.offset().height&&!this.model.get("detachToSlider.forceDetach.isActive")||r)&&(this.log.info("Unstick Sticky Ad"),this.permanentAttach())}}}},{key:"onWindowResize",value:function(){this.model.get("stickyCard.isActive")&&this.isDetached&&this.currentAnimation===E.ANIMATION_TYPE.none&&(this._setSliderSize(),this.detach(!0,!0))}},{key:"_correctAMPOffset",value:function(){if(this.model.get("stickyCard.isActive")&&this.isDetached&&this.currentAnimation===E.ANIMATION_TYPE.none){var e=this.model.get("containerViewPlaceHolder").getBoundingClientRect();if(this.containerViewPlaceHolderPosition=e.top+e.height,this.globalModel.get("ampPageTopLimit")-this.containerViewPlaceHolderPosition<0)return void this.attach();this.detach(!0,!0)}}},{key:"_correctSliderAMPOffset",value:function(){this.model.set("ampPageBottomLimit",this.globalModel.get("ampPageBottomLimit")),this.model.set("ampPageTopLimit",this.globalModel.get("ampPageTopLimit")),this.isDetached&&this.currentAnimation===E.ANIMATION_TYPE.none&&(this.currentAnimation=E.ANIMATION_TYPE.detaching,this.animationUtil.correctSliderDetachPosition({$el:this.$el,sliderOptions:this.detachToSlider,isSlideVertically:this.isStickyCardActive,cb:this.postDetach.bind(this)}),this.subFeedVideoView.correctSliderAMPOffset(this.detachToSlider))}},{key:"_onStickyTimerEnd",value:function(e){this.log.info(e),this.model.get("stickyCard.restrictions.adPercent.keepUntilScroll")?s.a.once("window:scroll:change",this._attachSticky.bind(this,e)):this._attachSticky(e)}},{key:"_attachSticky",value:function(e){this.log.info(e),this.permanentAttach(),this.rvTimerWasSet=!1}},{key:"_isActiveAdCanStick",value:function(){return!this.globalModel.get("stickyCard.restrictions.adTypeNotAllowed")&&!this.globalModel.get("stickyCard.restrictions.sessionNotAllowed")&&("any"===this.model.get("stickyCard.restrictions.rv")||this.model.get("activeAdRV")===this.model.get("stickyCard.restrictions.rv"))&&this._getQueryFuncResult()}},{key:"_getQueryFuncResult",value:function(){var e=this.globalModel.get("stickyCard.restrictions.isActive.decisionFunction"),t=this.subFeedVideoView.getActiveAd(),i=t&&t.vpaidWrapper&&t.vpaidWrapper.tag;if(e){if(!i)return this.log.warning("no activeAdData - can't evaluate QueryFuncResult"),!1;var n=e(this.model.attributes,i);return this.log.info("query language function results for sticky.isActive",{activeAd:i,function:e,result:n}),n}return!0}},{key:"_onBlockedByExternalUnit",value:function(){this.model.get("floatingView")===a.floatingView.detach&&(this.model.get("blockedByExternalUnit")?this._runSlideOutAnimation((function(){})):(this.isFirstDetach=!0,this.isDetached=!0,this.detach(!0,!1)))}},{key:"_isSingleAd",value:function(){var e=this.getActiveAd();if(e){var t=e.vpaidData;return t.singleAd||t.adjacency}}},{key:"_hide",value:function(){this.$el.hide()}},{key:"_show",value:function(){this.$el.show()}}])&&Di(t.prototype,i),r}(o.b);function Bi(e){return(Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ji(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ui(e,t){return(Ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wi(e,t){return!t||"object"!==Bi(t)&&"function"!=typeof t?Hi(e):t}function Hi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $i(e){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(17),i(5);var zi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ui(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=$i(e);if(t){var o=$i(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Wi(this,i)}}(r);function r(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).globalModel=e.globalModel,t.model=e.model,t.container=e.container,t.parentSelector=t.model.get("parentSelector"),t.model.set("renderWasCalled",!1),t.ad=e.ad,t.closeButtonDelayd=!1,t.createStateHandlers([{event:"playerState:ready",funcName:"_onPlayerStateReady"},{event:"playerState:restarted",funcName:"_onPlayerStateReady"},{event:"isEligibleToPlay:true",funcName:"_onFirstEligibility",listenOnce:!0}]),t.globalModel.on("change:blockedByExternalUnit",t._setBlockedByExternalUnit.bind(Hi(t))),t.ad.setSubModel(t.model),t.model.get("isSuperSlider")&&t.createStateHandlers([{event:"isSuperSliderClosed",funcName:"_SuperSliderClose",listenOnce:!0}]),t.isVVDetachable=t.model.get("detachToSlider.isStartFromSlider")||t.model.get("detachToSlider.isDetachToSlider"),t.model.set("videoViewContainer",t.ad.vpaidWrapper.adTarget),t.containerView=new Jt({model:t.model,globalModel:t.globalModel}),t.render(e.container),t.SubFeedEligibilityService=new u.p(t.model,t.containerView.getVideoPlaceholder(),t.globalModel,t.ad&&t.ad.vpaidData?t.ad.vpaidData.rv:void 0),t.globalModel.get("components.nativeAd.isActive")&&(t.nativeAdView=new kt({model:t.model,globalModel:t.globalModel,container:t.container})),setTimeout(t._createVideoView.bind(Hi(t)),100);var i=t.model.get("observedContainerSelector");return i&&t._setMutationObserver(i),t}return t=r,(i=[{key:"_setMutationObserver",value:function(e){var t=Object(n.a)(e)[0];t&&(this.mutationObserverService=new u.h(this.model,{}),this.mutationObserverService.observe(t))}},{key:"_createVideoView",value:function(){this.model.get("isUseFloatingView")?this.videoView=new Li({model:this.model,adjs:this.ad,globalModel:this.globalModel,nas:this.nativeAdView,eligibilityService:this.SubFeedEligibilityService}):this.videoView=new Ai({model:this.model,eligibilityService:this.SubFeedEligibilityService},this.ad,this.globalModel)}},{key:"render",value:function(e){this.model.get("renderWasCalled")||(this.containerView.render(e,this.ad.adId),this.log.info("render was called with container: "+e,"subUnitId="+this.model.get("subUnitId")),setTimeout(function(){this.model.set("renderWasCalled",!0)}.bind(this),100))}},{key:"terminate",value:function(e,t){this._setTimerReason(t),e&&this.isVVDetachable?(this.videoView.permanentAttach(),this.videoView.checkAndClose()):this.model.set("closeState",a.closeState.terminate)}},{key:"terminateOnContainerChange",value:function(){this.SubFeedEligibilityService.resetPlaceHolders(),this.isTerminatedByFeedX=!0,this.containerView.closeAndRemove(),this.videoView.closeAndRemove()}},{key:"overKill",value:function(e){this.model.set("closeState",a.closeState.terminate),this.videoView.permanentClose(),this.containerView._runAnimation(!1),this.model.off()}},{key:"pause",value:function(e){this.log.info("pause: ",e),this._setTimerReason(e),this.isTerminatedByFeedX||this.videoView.onTimerEnd(e)}},{key:"_createTimers",value:function(){}},{key:"_onFirstEligibility",value:function(){this.model.set("gotFirstEligibility",!0)}},{key:"_SuperSliderClose",value:function(){this.overKill("Close SuperSlider")}},{key:"_setBlockedByExternalUnit",value:function(){this.model.set("blockedByExternalUnit",this.globalModel.get("blockedByExternalUnit"))}}])&&ji(t.prototype,i),r}(b),Gi=i(19);function qi(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Yi=i(5),Ki="tbl-data-mutation-observer",Qi=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.log=new c.a({unitType:this.model.get("unitType"),className:this.constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.feedSelector=this.model.get("parentSelector"),this.isObserveFeedParent=this.model.get("isObserveFeedParent"),this._bindEvents(),this._initMutationObserver(i)}var t,i;return t=e,(i=[{key:"_bindEvents",value:function(){"undefined"!=typeof TRC&&TRC.listen&&(TRC.listen("trcResponseHandled",this._updateMutationObserver.bind(this)),TRC.listen("feed-x-toggle",this._onFeedXToggle.bind(this)),TRC.listen("feedContainerChanged",this._onFeedContainerChanged.bind(this)))}},{key:"_initMutationObserver",value:function(e){var t=Object(n.a)(e||this.feedSelector);this._setObservers(t);var i=this.model.get("mutationSelectorsArray");if(i){var o=Object(n.a)(i.toString());Yi.forEach(o,this._setMutationObserver,this)}}},{key:"_setObservers",value:function(e){this.isObserveFeedParent?Yi.forEach(this._getParents(e),this._setMutationObserver,this):Yi.forEach(e,this._setMutationObserver,this)}},{key:"_getParents",value:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n.parentElement&&t.push(n.parentElement)}return t}},{key:"_setMutationObserver",value:function(e){if(e&&!e.getAttribute(Ki)){var t=Yi.throttle(this._trigger.bind(this,"feed:resize:change",{}),100),i=new MutationObserver(t);e.setAttribute(Ki,!0),i.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0})}}},{key:"_updateMutationObserver",value:function(){var e=Object(n.a)(this.feedSelector);if(e){var t=e.not("[".concat(Ki,"]"));this._setObservers(t)}}},{key:"_updateFeedSelector",value:function(){this.feedSelector=this.model.get("parentSelector"),this._updateMutationObserver()}},{key:"_onFeedXToggle",value:function(e){this._onFeedContainerChanged({eventName:"feedxToggle",containerSelector:e.data})}},{key:"_onFeedContainerChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.eventName,i=this["".concat(t,"ContainerChanged")];Yi.isFunction(i)&&i.bind(this)(),this.log.info("feed container changed",t),e.containerSelector||this.log.error("no valid explore-more selector"),this.model.set("parentSelector",e.containerSelector),this._updatePlacement(e.placement),this._updateFeedSelector(e.containerSelector),this.model.increaseCounter(t),this.model.increaseCounter("feedContainerChanged")}},{key:"exploreMoreContainerChanged",value:function(){this.model.get("disableExploreMoreVideo")&&this.model.set("resetFeedVideo",!0)}},{key:"_updatePlacement",value:function(e){e&&(this.model.set("placement",e),this.model.set("modifiedPlacement",e))}},{key:"_trigger",value:function(e,t){s.a.trigger(e,t)}}])&&qi(t.prototype,i),e}(),Xi=function(){var e;return function(t,i){return e||(e=new Qi(t,i)),e}}(),Ji=i(21);function Zi(e){return(Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e,t){return!t||"object"!==Zi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function on(e){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var rn=i(5),sn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(o,e);var t,i,n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=on(e);if(t){var o=on(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return nn(this,i)}}(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this,e)).model=e,t.log=new c.a({unitType:"FEED_MANAGER",className:"ContinuePLayAdInNextCard",version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t}return t=o,(i=[{key:"_startWatchDivLeaveVeiwPort",value:function(e){this.trakingElement=e,this._watchScroll()}},{key:"_testElementInViewPort",value:function(){var e=rn.getViewPercent(this.trakingElement,this.model.get("width"),rn.getVideoHeight(this.model.get("width")),this.model.get("scrollSelector"));this.log.info("ContinuePLayAdInNextCard",this.trakingElement.getBoundingClientRect()),this.log.info("ContinuePLayAdInNextCard",e),0===e?(s.a.off("window:scroll:change",this._testElementInViewPort,this),this.model.set("elementOutOfView",!0)):this._watchScroll()}},{key:"_watchScroll",value:function(){s.a.once("window:scroll:change",this._testElementInViewPort.bind(this),this)}}])&&en(t.prototype,i),o}(o.a),an=i(65),ln=i.n(an);function cn(e){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dn(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function un(e,t){return(un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hn(e,t){return!t||"object"!==cn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fn(e){return(fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pn=i(5),mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&un(e,t)}(r,e);var t,i,o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=fn(e);if(t){var o=fn(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return hn(this,i)}}(r);function r(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=o.call(this,e)).model=e.model,t.initialModel=t.createSubModel(),t.initialModel.set("detachToSlider",t.model.get("detachToSlider")),t.controllersArray=[],t.model.set("subAdsEligibility",{}),t.log=new c.a({unitType:t.model.get("unitType"),className:t.constructor.name,version:t.model.get("version"),isDebug:t.model.get("isDebug")}),t._overrideVideoContainer(),t.impCount=0,t._addStyleToHeader(),t._createTimers(),t._setSubUnitType(),t.model.set("height",pn.getVideoHeight(t.model.get("width"))),t.isSuperSlider=t.model.get("detachToSlider.isStartFromSlider")&&t.model.get("detachToSlider.isDetachToSlider"),t._bindEvents(),t.windowEventManager=Object(Gi.a)(),t.shouldReport=pn.isFactor(t.model.get("gaFactor")),t.shouldReport&&t.model.get("isReportToKibana")&&(t.model.set("gaFactor",1),t.kibana=new u.g({model:t.model})),t.adsManager=new u.a(t.model,t.kibana),t.model.get("isDetectPubVideo")&&(t.pubVidDetector=new u.n(t.model)),t.pubVidDetector&&t.pubVidDetector.isPubVideoInView()&&t.model.get("isDelaySeer")?t.createStateHandlers([{event:"isNoPubVideoInView",funcName:"_startDelayedServices",isListenOnce:!0}]):t.seerService=new u.o(t.model),t.playerLoader=new u.l(t.model),t.playerService=new u.m(t.model),t.pixelsService=new u.k(t.model),t.competitionDetector=new u.c(t.model),t.feedEventManager=new Xi(t.model,t.model.get("parentSelector"));var i=t.model.get("detachToSlider.isStartFromSlider");return t.tabStatusService=new u.q(t.model),i&&!t.model.get("eligibilityValidator.isActive")?t.model.set("isEligibleToPlay",!0):t.FeedEligibilityService=new Ji.a(t.model,t.model.get("parentSelector")),t.model.get("frameType")===k.a.FRAME_TYPE.amp&&(t.AmpIntersectionHelper=new ln.a(t.model)),t.isWaitingForRV=!1,t.cardLocator=new u.b(t.model),t.log.info("Feed Manager created",t.model),t.isSliderOn=t.model.get("detachToSlider").isStartFromSlider||t.model.get("detachToSlider").isDetachToSlider,t.model.set("isSliderOn",t.isSliderOn),t.firstCardCalled=!1,t.animation=t.model.get("animation"),t.ContinuePLayAdInNextCard=new sn(t.model),t._removeCardForDemo(),t._crossUnitInfo(),t}return t=r,(i=[{key:"_overrideVideoContainer",value:function(){var e=Object(n.a)(this.model.get("parentSelector"));e&&1===e.length||(this._updateModels("videoContainerSelector",!1),this.log.info("multiple feeds detected, setting videoContainerSelector to false"))}},{key:"_createTimers",value:function(){this._createSecondsToCloseTimer(),this._createSecondsToCloseGlobalTimer(),this._createSecondsToPassbackTimer()}},{key:"_onLoadingClick",value:function(){this._createSecondsToCloseGlobalTimer()}},{key:"_createSecondsToCloseTimer",value:function(){var e=this.model.get("secondsToClose");if(e>0){var t={startCondition:{stateToListen:!0,state:"firstGetAdFired"},stopCondition:{stateToListen:l.a.adQState.impression,state:"adQState"},isStartOnce:!0};this.secondsToCloseTimer=new u.r(this.model,t,this.terminate.bind(this,!1,"secondsToClose"),1e3*e)}}},{key:"_createSecondsToCloseGlobalTimer",value:function(){this.secondsToCloseGlobalTimer&&this.secondsToCloseGlobalTimer.stop(this.model,void 0,{},!0);var e=this.model.get("secondsToCloseGlobal");if(e>0){var t={startCondition:{stateToListen:"",state:""}};"showReplay"===this.model.get("onTimerClose")||"close"===this.model.get("onTimerClose")?this.secondsToCloseGlobalTimer=new u.r(this.model,t,this.pause.bind(this,"secondsToCloseGlobal"),1e3*this.model.get("secondsToCloseGlobal")):this.secondsToCloseGlobalTimer=new u.r(this.model,t,this.terminate.bind(this,!1,"secondsToCloseGlobal"),1e3*e),this.secondsToCloseGlobalTimer.start(this.model,"")}}},{key:"_createSecondsToPassbackTimer",value:function(){this.model.get("secondsToPassback")&&(this.passBackTimer=new u.r(this.model,{startCondition:{stateToListen:"",state:""},stopCondition:{stateToListen:!0,state:"isFirstAdLoaded"}},this._triggerPassback.bind(this,"Passback"),1e3*this.model.get("secondsToPassback")),this.passBackTimer.start(this.model,""))}},{key:"subAdsEligibilityChange",value:function(){if(this.log.info("subAdsEligibilityChange, is continueToPlayInNexCard",this.model.get("continueToPlayInNexCard.isActive")),this.model.get("continueToPlayInNexCard.isActive")&&!this.model.get("isSliderOn")&&(this.log.info("subAdsEligibilityChange "),this._isContinuaPLayAdInNextCard()))return this.ContinuePLayAdInNextCard._startWatchDivLeaveVeiwPort(this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.getEl()),void this.createStateHandlers([{event:"elementOutOfView",funcName:"_onTempAdOutOffView",isListenOnce:!0},{event:"temAdCondition:true",funcName:"_onAdCondition",isListenOnce:!0}]);this._getCard("subAdsEligibility")}},{key:"_hasViableSubUnits",value:function(){var e=this.model.get("subAdsEligibility");for(var t in e)if(!0===e[t])return!0;return!1}},{key:"createSubFeedController",value:function(e,t,i){if(this.log.info("videoCardIniOptions ",e),this.log.info("Creating Sub Unit: card number: "+e.cardNumber+" adId:"+t.adId),this.log.info("Last Ad ID = "+this.model.get("lastAdID")+" Next Ad ID = "+t.adId),this.model.get("lastAdID")!==t.adId||this.tempActiveAd){this.model.set("lastAdID",t.adId),this.controllersArray.length>1&&(t.isUsed=!0),0===this.controllersArray.length&&t.vpaidWrapper.nonVideoVpaid&&this._setIniModelToNoslider();var o=this.getSubModel();0===this.controllersArray.length&&this._setIniModelToNoslider(),o.set("parentSelector",this.model.get("parentSelector")),o.set("isSuperSlider",this.isSuperSlider);var r=void 0;if(this.model.get("isNeedAdjacCard")&&!o.get("isSuperSlider")){var s=!1;if(pn.getOrganicCard()&&(r=this.createVideoCardPlaceHolder(e),o.set("adjacCardPlacement",this.model.get("adjacCardPlacement")),o.set("isNeedAdjacCard",!0),this.organicCardInjector=new u.j(this.model),s=this.organicCardInjector.injectOrganicCard("#"+r)),0==s)return this.model.set("organicInjectorFail",!0),void this.overKill("organic card injection fail")}else r=this.createVideoCardPlaceHolder(e);o.set("width",Object(n.a)("#"+r).width()),o.set("cardNumber",e.cardNumber-.5),o.set("subAdId",r),o.set("subUnitId",this.controllersArray.length),o.set("isOpenFloatingViewInViewPort",this.model.get("isOpenFloatingViewInViewPort")),i&&(o.set("isCardBelongToTempAd",!0),o.set("tempAdCondition",this.tempActiveAdCondition),o.set("isOpenInViewPort",!1)),this.log.info("newModel",o.get("tempAdCondition"));var a=new zi({model:o,globalModel:this.model,container:"#"+r,ad:t});this.controllersArray.push(a),this.tempActiveAd&&setTimeout(function(){this.tempActiveAd=void 0}.bind(this))}}},{key:"_getCard",value:function(e){var t;this._isGettingNewCardAvailable()&&(this.firstCardCalled=!0,this.log.info("Requesting New Card, Reason: "+e),this.isOpenInViewPortChange=!1,this.model.get("isOpenMP4OutOfViewPort")&&(this.model.get("detachToSlider.isStartFromSlider")||this.model.get("isEligibleToPlayFirstTime")||!this.model.get("mp4Predict")||(this.log.info("MP4 Predict - card open out of view"),this.isOpenInViewPort=this.model.get("isOpenInViewPort"),this.model.set("isOpenInViewPort",!1),this.model.set("isOpenFloatingViewInViewPort",!1),this.isOpenInViewPortChange=!0)),this.model.get("isNeedAdjacCard")&&!this.hadAdjac?t=this.cardLocator.getSpecificCard(this.model.get("adjacCardPlacement")):this.model.get("isSliderClosed")?(t=this.cardLocator.getCard({onceOutOfView:!0}),this.model.set("isSliderClosed",!1)):t=this.cardLocator.getCard(),t?this._onCardReturn(t):this._waitForCard(),this.isOpenInViewPortChange&&(this.model.set("isOpenInViewPort",this.isOpenInViewPort),this.model.set("isOpenFloatingViewInViewPort",this.isOpenInViewPort)))}},{key:"_isGettingNewCardAvailable",value:function(){if(!this.isWaitingForCard)return this._hasViableSubUnits()?(this.log.info("Has Viable SubUnits, don't get cards "),!1):this.controllersArray.length===this.model.get("maxVideoCards")?(this.log.info("Max number of cards reached , don't get cards "),!1):this.model.get("hasReadyAd")||this.tempActiveAd?!this.model.get("isSliderOn")||!this.firstCardCalled||(this.log.info("Slider is active, don't get cards "),!1):(this.log.info("Don't have ready ads, don't get cards "),!1);this.log.info("Waiting for card, don't get cards ")}},{key:"_waitForCard",value:function(){this.log.info("No Card available waiting for card"),this.isWaitingForCard=!0,this.createStateHandlers([{event:"hasValidCard",funcName:"_onNewCardAvailable",isListenOnce:!0}])}},{key:"_onCardReturn",value:function(e){if(this.videoCardIniOptions=e,this.model.get("isNeedAdjacCard")&&!this.hadAdjac){if(e.cardNumber!==this.model.get("adjacCardPlacement"))return void this._getCard("card found but need Adjac");this.hadAdjac=!0,this._disableStickyForSession()}if(this.isWaitingForCard=!1,this.log.info("Got New Card",e),!this._hasViableSubUnits())if(this.tempActiveAd)this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.extractAd(),this.createSubFeedController(e,this.tempActiveAd,!0);else{var t=this.getReadyAd();t&&this.createSubFeedController(e,t)}}},{key:"newAdLoaded",value:function(){this.log.info("newAdLoaded")}},{key:"_onNewCardAvailable",value:function(){this.log.info("newCardAvailable");var e=this.cardLocator.getCard({cardNumber:this.model.get("hasValidCard")});this._onCardReturn(e)}},{key:"createSubModel",value:function(){return n.a.extend(!0,{},this.model)}},{key:"getSubModel",value:function(){return n.a.extend(!0,{},this.initialModel)}},{key:"addNewSub",value:function(){setTimeout(function(){this.createSubFeedController(),this.addNewSub()}.bind(this),4e4)}},{key:"_bindEvents",value:function(){this.createStateHandlers([{event:"subAdsEligibility",funcName:"subAdsEligibilityChange"},{event:["hasReadyAd:true","blockedByExternalUnit:false"],funcName:"onHasReadyAd"},{event:"closeState",funcName:"_closeStateChange"},{event:"loadingViewState:clicked",funcName:"_onLoadingClick"},{event:"topParentSelectorLost:true",funcName:"_onParentSelectorLost"},{event:"feedxToggle",funcName:"_onFeedContainerChanged"},{event:"feedContainerChanged",funcName:"_onFeedContainerChanged"},{event:"exploreMore",funcName:"_onExploreMore"},{event:"resetFeedVideo",funcName:"_onVideoReset"},{event:"crossUnitInfo",funcName:"_crossUnitInfo"}]),"undefined"!=typeof TRC&&TRC.listen&&(TRC.listen("trcReset",this._onTRCReset.bind(this)),TRC.listen("videoReset",this._onVideoReset.bind(this))),this.isSuperSlider&&this.createStateHandlers([{event:"isSuperSliderClosed:true",funcName:"_SuperSliderClose",listenOnce:!0}])}},{key:"_closeStateChange",value:function(){this.log.warning("CloseState changed to: ",this.model.get("closeState")),this.model.get("closeState")===l.a.closeState.terminate?this.adService?this.adService.close():this.model.set("closeState",l.a.closeState.adManagerStop):this.model.get("closeState")===l.a.closeState.adManagerStop&&this.playerService&&(this.playerService.close(),this.model.off(),s.a.off())}},{key:"onHasReadyAd",value:function(){var e=this;this.log.info("onHasReadyAd"),!this.model.get("isDetectPubVideo")||this.pubVidDetector&&!this.pubVidDetector.isPubVideoInView()?this._getCard("on Ad Impression"):s.a.once("window:scroll:change",(function(){e.onHasReadyAd()}))}},{key:"createVideoCardPlaceHolder",value:function(e){var t=Object(n.a)("<div>");this.isSuperSlider?this.isSuperSlider=!1:(t.addClass("tbl-feed-card"),t.addClass("cm-video-card"));var i=.5;"before"===e.insert&&(i=-.5);var o=e.cardNumber+i,r=("cm_place_holder_"+o).replace(".","");return t.attr("id",r),t.attr("data-card-index",o),!this.model.get("isForceFullContainerWidth")&&this.model.get("exploreMore")||t.css({width:"100%"}),Object(n.a)(e.cardElement)[e.insert](t),r}},{key:"getReadyAd",value:function(){if(this.model.get("hasReadyAd"))return this.model.getNextAd()}},{key:"pause",value:function(e){"secondsToCloseGlobal"===e&&this.model.get("isReplayAd")&&this.model.set("isReasonSecondsToCloseGlobal",!0),this.log.info("Pause Timer reason: "+e+" Cards Number: "+this.controllersArray.length),this.adsManager&&this.adsManager.pauseGetAds();for(var t=0;t<this.controllersArray.length;t++)this.controllersArray[t].pause(e);this._setTimerReason(e)}},{key:"terminate",value:function(e,t){this.log.info("Terminate reason: "+t);for(var i=0;i<this.controllersArray.length;i++)this.controllersArray[i].terminate(e,t);this.model.set("closeState",l.a.closeState.terminate),this._setTimerReason(t)}},{key:"overKill",value:function(e){this.log.info("overKill reason: "+e),this.adsManager.pauseGetAds(),this.playerService.playerDiv&&this.playerService.playerDiv.hide();for(var t=0;t<this.controllersArray.length;t++)this.controllersArray[t].overKill(e);this.model.set("closeState",l.a.closeState.terminate),this._setTimerReason(e),this.model.off(),this.secondsToCloseGlobalTimer&&this.secondsToCloseGlobalTimer.stop(this.model,"",{},!0)}},{key:"_removeCardForDemo",value:function(){if(this.model.get("isCloseScOnConversion")){var e=document.getElementsByClassName("trc-content-sponsored");e.length>0&&(e[e.length-1].parentElement.parentElement.parentElement.style.display="none")}}},{key:"_setTimerReason",value:function(e){this.model.get("closeTimer")===e?this.model.trigger("change:closeTimer",this.model,e):this.model.set("closeTimer",e)}},{key:"_onTRCReset",value:function(){this.model.set("TRCResetCloseUnit",!0),this.overKill("TRCRest"),this._resetFmOnPage()}},{key:"_onVideoReset",value:function(){this.model.set("videoResetCloseUnit",!0),this.overKill("videoReset"),this._resetFmOnPage()}},{key:"_onParentSelectorLost",value:function(){this.overKill("parentSelectorLost"),this._resetFmOnPage()}},{key:"_resetFmOnPage",value:function(){setTimeout(function(){this.model.off(),window.isCmTagFMOnPage=!1}.bind(this),500)}},{key:"_setSubUnitType",value:function(){var e={isSticky:this.model.get("stickyCard.isActive"),isDetachBelow:this.model.get("detachToSlider.isDetachBelow"),isDetachAbove:this.model.get("detachToSlider.isDetachAbove"),isStartFromSlider:this.model.get("detachToSlider.isStartFromSlider"),isDetachToSlider:this.model.get("detachToSlider.isDetachToSlider")};this.model.set("subUnitType",pn.getSubUnitType(e))}},{key:"_addStyleToHeader",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode("#_cm-css-reset._cm-ad video { visibility: hidden !important; }")),e.appendChild(t)}},{key:"_SuperSliderClose",value:function(){this.closedSuperSliderController=this.controllersArray.splice(0,1)[0]}},{key:"_setIniModelToNoslider",value:function(){this.model.get("stickyCard.isActive")&&!this.model.get("stickyCard.restrictions.isFirstCardOnly")||(this.initialModel.set("detachToSlider.isStartFromSlider",!1),this.initialModel.set("detachToSlider.isDetachToSlider",!1))}},{key:"_onTempAdOutOffView",value:function(){this.log.info("_onTempAdOutOffView"),this.model.set("elementOutOfView",!1);var e=this._isFutureCardExist();this.tempActiveAd.onShouldCardSwap(),!0===e.createNewCard?this._getCard("continueToPlayInNexCard"):(0===e.futureCardIndex||e.futureCardIndex)&&(this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.extractAd(this.tempActiveAdCondition),this.controllersArray[e.futureCardIndex].videoView.injectAd(this.tempActiveAd,this.tempActiveAdCondition),this.log.info("@Opp fire _onCardReturn rv:",this.tempActiveAd))}},{key:"_isContinuaPLayAdInNextCard",value:function(){return this.log.info("lastCardOutOfViewport: ",this.model.get("lastCardOutOfViewport")),!(0!==this.model.get("lastCardOutOfViewport")&&!this.model.get("lastCardOutOfViewport"))&&this._isActiveAdPassesCondition()}},{key:"_isActiveAdPassesCondition",value:function(){var e=this._getTempActiveAd();if(!e)return!1;if(!e.isPWOV()){var t=this._getCondition(e);if(!t)return!1;this.log.info("!!!_isActiveAdPassesCondition",t);var i=this._checkAdCondition(e,t);return i?(this.tempActiveAd=e,this.tempActiveAdCondition=t):(this.tempActiveAd=void 0,this.tempActiveAdCondition=void 0),this.log.info("!!!_isActiveAdPassesCondition isPassesCondition",i),this.log.info("!!!_isActiveAdPassesCondition tempActiveAd",this.tempActiveAd),this.log.info("!!!_isActiveAdPassesCondition tempActiveAdCondition",this.tempActiveAdCondition),i}}},{key:"_getCondition",value:function(e){var t=e.adData.requiredViewability?[1]:[0];e.vpaidWrapper.isCPCV&&t.push("CPCV");for(var i=null,n=0;n<t.length;n++)if(i=this.model.get("continueToPlayInNexCard")[t[n]]?this.model.get("continueToPlayInNexCard")[t[n]]:i,"completion"==this.model.get("continueToPlayInNexCard")[t[n]])return"completion";return i}},{key:"_isFutureCardExist",value:function(){var e={futureCardIndex:void 0,createNewCard:!1};this.log.info("!!!@@@ lastCardOutOfViewport",this.model.get("lastCardOutOfViewport"));var t=this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.getEl().getBoundingClientRect().top>0;if(t&&0===this.model.get("lastCardOutOfViewport"))return e;if(!t){for(var i=this.model.get("lastCardOutOfViewport");i<this.controllersArray.length;i++)if(!this.controllersArray[i].videoView.getActiveAd()&&this.controllersArray[i].videoView.getModel().get("isCardBelongToTempAd"))return e.futureCardIndex=i,e;return e.createNewCard=!0,e}for(var n=this.model.get("lastCardOutOfViewport")-1;n>-1;n--)if(!this.controllersArray[n].videoView.getActiveAd()&&this.controllersArray[n].videoView.getModel().get("isCardBelongToTempAd"))return e.futureCardIndex=n,e;return e}},{key:"_checkAdCondition",value:function(e,t){return this.log.info("!!!_checkAdCondition condition:",t),this.log.info("!!!_checkAdCondition isViewabilityFired",e.isViewabilityFired),"viewability"!==t||!e.isViewabilityFired}},{key:"_getTempActiveAd",value:function(){if(this.log.info("check if posible temp ad",this.model.get("lastCardOutOfViewport")),this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView)return this.controllersArray[this.model.get("lastCardOutOfViewport")].videoView.getActiveAd()}},{key:"_onAdCondition",value:function(){this.log.info("add condition done");for(var e=0;e<this.controllersArray.length;e++)this.controllersArray[e].videoView.getModel().get("isCardBelongToTempAd")&&this.controllersArray[e].videoView.onTempAdEnd();this.model.set("temAdCondition",!1),this.tempActiveAd=void 0}},{key:"_onFeedContainerChanged",value:function(){this.playerService.updatePlacement(),this.model.set("hasValidCard",void 0,{silent:!0}),this._closeHiddenFeedSubUnits(),this.cardLocator.updateFeedSelector(),this.model.set("subAdsEligibility",{},{silent:!0}),this.model.set("isSliderClosed",!1,{silent:!0}),this.isWaitingForCard=!1,this.firstCardCalled=!1,this._getCard("feedContainerChanged")}},{key:"_closeHiddenFeedSubUnits",value:function(){this.closedSuperSliderController&&this.closedSuperSliderController.terminateOnContainerChange();for(var e=0;e<this.controllersArray.length;e++){var t=this.controllersArray[e],i=t.model.get("closeState"),n=t.parentSelector!==this.model.get("parentSelector");!i&&n&&t.terminateOnContainerChange()}}},{key:"_triggerPassback",value:function(){this.model.get("isFirstAdLoaded")||(this.log.info("Passback timer done"),s.a.trigger("global:passback",{isApiPassbackExist:this.model.get("isApiPassbackExist")}),this.model.set("closeState",l.a.closeState.terminate))}},{key:"_disableStickyForSession",value:function(){this.model.set("detachToSlider.isDetachToSlider",!1),this.model.set("isSliderOn",!1),this.model.set("stickyCard.restrictions.sessionNotAllowed",!0)}},{key:"_updateModels",value:function(e,t){this.model.set(e,t),this.initialModel.set(e,t)}},{key:"_onExploreMore",value:function(){this.model.get("stickyCard.isActive")||(this._updateModels("detachToSlider.isStartFromSlider",!1),this._updateModels("detachToSlider.isDetachToSlider",!1)),this._updateModels("isEligibleToStick",!1),this._updateModels("startCard",this.model.get("exploreMoreConfig.startCard"))}},{key:"_startDelayedServices",value:function(){this.seerService||(this.seerService=new u.o(this.model))}},{key:"_crossUnitInfo",value:function(){this.model.get("crossUnitInfo")&&this.model.get("crossUnitInfo.state")===l.a.externalUnit.playing?this._blockedByExternalUnit():this._resumeByExternalUnit()}},{key:"_blockedByExternalUnit",value:function(){this._updateModels("blockedByExternalUnit",!0),this._updateControllersModels("blockedByExternalUnit",!0)}},{key:"_resumeByExternalUnit",value:function(){this._updateModels("blockedByExternalUnit",!1),this._updateControllersModels("blockedByExternalUnit",!1)}},{key:"_updateControllersModels",value:function(e,t){for(var i=0;i<this.controllersArray.length;i++)this.controllersArray[i].model.set(e,t)}}])&&dn(t.prototype,i),r}(o.a);t.default=mn},function(e,t,i){"use strict";i.r(t);var n=i(28),o=i.n(n),r=(i(68),i(0)),s=i(19),a=i(10),l=(i(1),i(4));function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.syncUrl=t.get("sync"),this.syncUrl&&(this.log=new l.a({unitType:t.get("unitType"),className:this.constructor.name,version:t.get("version"),isDebug:t.get("isDebug")}),this.timePredict=new a.s({model:t,onPredict:this._syncCookies.bind(this),predictKey:"cookieSync",modelKey:"predictors.time.cookieSync"}),this._syncCookies())}var t,i;return t=e,(i=[{key:"_syncCookies",value:function(){var e=this;this.log.info("Cookie sync request",this.syncUrl);var t=document.createElement("iframe");t.style.display="none",t.src=this.syncUrl,t.onerror=function(){e._stopSync()},document.body.appendChild(t)}},{key:"_stopSync",value:function(){this.log.info("Stopping cookie sync"),this.timePredict.stop()}}])&&c(t.prototype,i),e}(),u=i(7),h=i(49),f=i.n(h),p=i(25),m=i(3),g=i(5),y=(i(11),i(87)),v=m.View.extend({className:"_cm-panel",id:"_cm-css-reset",events:{"click ._cm-close-button":"_onCloseButtonClick","click ._cm-panel-submit":"_onSubmitButtonClick"},container:Object(r.a)("body"),ui:{},initialize:function(e){this.render(),this.ui.name=this.$("._cm-panel-name"),this.ui.email=this.$("._cm-panel-email"),this.ui.details=this.$("._cm-panel-details"),this.ui.success=this.$("._cm-panel-notifications-success"),this.ui.error=this.$("._cm-panel-notifications-error"),this.ui.sending=this.$("._cm-panel-notifications-sending"),this.ui.btnSend=this.$("._cm-panel-submit"),this._hideText(),this._bindEvents()},render:function(){this.$el.append(y),this.container.append(this.el)},_bindEvents:function(){this.listenTo(this.model,"save:success",this._onSaveSuccess)},_onCloseButtonClick:function(){this.$el.hide(),m.trigger("supportTool:event","close")},_onSubmitButtonClick:function(){this._validateForm()&&(this.ui.btnSend[0].disabled=!0,this.model.set({name:this.ui.name.val(),email:this.ui.email.val(),details:this.ui.details.val()}),this.ui.sending.show(),this.model.save())},_validateForm:function(){return this.ui.email.val()&&g.isValidEmail(this.ui.email.val())?(this.ui.email.removeClass("_cm-panel-error"),!0):(this.ui.email.addClass("_cm-panel-error"),!1)},_onSaveSuccess:function(){this._hideText(),this.ui.success.show()},_hideText:function(){this.ui.success.hide(),this.ui.sending.hide(),this.ui.error.hide()}}),b=i(3),_=i(5),S=b.DeepModel.extend({initialize:function(e){var t=r.a.extend(!0,{},e.creativeData),i=r.a.extend(!0,{},e.unitModel);delete t.iframeData,delete t.placementElement,delete i.iframeData,delete i.placementElement,this.set("creativeData",JSON.stringify(t)),this.set("unitModel",JSON.stringify(i)),this.set({userAgent:window.navigator.userAgent,date:new Date,url:window.location.href}),this.set("vpaidLogs",JSON.stringify(e.vpaidLogs)),e.dp&&this.set("demandPartner",e.dp)},save:function(){_.sendMail(this.attributes,this._onSaveSuccess.bind(this),this._onSaveError.bind(this))},_onSaveSuccess:function(){this.trigger("save:success")},_onSaveError:function(){this.trigger("save:error")}}),w=i(12),A=window.define;window.define=null;var T=i(5),P=(i(66),i(67),i(3));window.define=A;var C=i(1),E=i(69),k=i(70),O=i(8),I=i(71);window.startCMTagMain=function(e,t){var n,a,l,c=!1;I.beforeCMTag(e);var h={INLINE:function(){},INLINE_INSTREAM:function(){},SLIDER_OUTSTREAM:function(){},SLIDER_INSTREAM:function(){},"300X600":function(){},EXPANDABLE:function(){},WIDGET_ITEM:function(){},FEED_MANAGER:function(){var n=e.isMobile?i(88).default:i(89).default;l=function(i,n){T.trcPerformanceMeasurement(n.trcPerformanceMeasurementEnabled,"videoCreateUnitModel".concat(n.perfUnitType),C.TRC_PERFORMANCE_ACTIONS.START);var o=new P.DeepModel;o.set(n),t&&t._settings&&(cmTag&&cmTag.logger&&cmTag.logger.info("settings by FPP",t._settings),o.set(t._settings)),function(e){if(e.onPassback)e.isApiPassbackExist=!0;else{if(TRC&&TRC._taboolaClone)for(var t=0;t<TRC._taboolaClone.length;t++)if("video.passback"==TRC._taboolaClone[t].listenTo)return void(e.isApiPassbackExist=!0);e.isApiPassbackExist=!1}}(o.attributes),new k(o.attributes);var r=new i(o.attributes);return T.parseBool(e.isUseCMP)?new u.f(r):r.set("canStartPlayer",!0),function(e){if(!0===e.get("isOppsulaEnabled")){var t={version:e.get("microServices.oppsula.version"),model:e},i=new u.i(t);O.oppsula=i}}(r),function(e){O.serviceLoader.get("video-autoplay-detector",e.get("microServices.autoplayDetector.version"),(function(t){O.autoPlayDetector=new t(e.handleAutoPlayData.bind(e),{isMobile:e.get("isMobile"),timeout:1e3*e.get("autoplayDetectorTimeoutSec")})}))}(r),T.trcPerformanceMeasurement(n.trcPerformanceMeasurementEnabled,"videoCreateUnitModel".concat(n.perfUnitType),C.TRC_PERFORMANCE_ACTIONS.STOP),r}(n,e),function(t,i,n,o){T.parseBool(e.isWaitForStartEvent)?(m.unit=t,m.model=i,m.placement=n,m.isUnitPlay=!1,i.fireUnitDelayedPixel(),window.TRC=window.TRC||{},window.TRCImpl=window.TRCImpl||{},window.TRC.videoFunctions={},window.TRC.videoFunctions.startEvent=function(){c||(m.model.fireUnitLoadAfterDelayPixel(),g(m.unit,m.model,m.placement,m.isUnitPlay),c=!0)}):g(t,i,n,!1)}(i(100).default,l,void 0)},MSN_WIDGET:function(){},RECO_REEL_WIDGET:function(){},CUSTOM:function(){}},m={unit:void 0,model:void 0,placement:void 0,isUnitPlay:!1};function g(e,i,n,o){var r=new e({model:i,placementElement:n});o&&(t.play=r.play.bind(r))}function y(t){"open"===t?(l.set("supportTool",{isOpen:!0}),function(){if(!n&&"OMNI_TAG"!==e.unitType){var t,i=O.player&&O.player.getVpaidLogs?O.player.getVpaidLogs():void 0;l.set("supportTool",{isOpen:!0}),O&&O.supportTool&&O.supportTool.dp&&(t=O.supportTool.dp);var o={creativeData:e,vpaidLogs:T.stripObject(T.arrayToObj(i),[],!0,!0,!0)};o.unitModel=T.stripObject(l.attributes,[],!0,!0,!0),t&&(o.dp=t),a=new S(o),n=new v({model:a})}}()):(l.set("supportTool",{isOpen:!1}),n.remove(),n=null,a=null)}function b(){window.TRC=window.TRC||{},P.$=r.a,T.templateSettings={interpolate:/\{\{(.+?)\}\}/g},cmTag.logger||(cmTag.logger=new p.a(e)),e.documentReadyState=document.readyState,cmTag&&cmTag.logger&&cmTag.logger.info("init",e),cmTag.utils=T,cmTag.$=r.a,t&&(t._events&&(t._events.forEach((function(e){P.on(e.name,e.cb)})),t.on=function(e,t){P.on(e,t)}),t.trigger=function(e,t){P.trigger(e,t)}),cmTag.config||(cmTag.config=e);var i=window;T.isInFriendlyIframe(cmTag.config.iframeData)&&(i=T.getTopWindow()),e.isHideIframe&&T.hideDFPIframe(e.iframeData),!0!==e.hasSupportTool&&"true"!==e.hasSupportTool||P.on("supportTool:event",y),cmTag.config.scrollSelector?(new s.a(i,cmTag.config.scrollSelector),new w.a(e,i,cmTag.config.scrollSelector)):(new s.a(i),new w.a(e,i)),function(){var e=new P.DeepModel;e.set({microServices:O.microServices}),e.set(cmTag.config);var t=e.get("microServices");o.a.init(t),O.serviceLoader=o.a,function(e){O.serviceLoader.get("PMS",e.PMS.version,_.bind(this),_.bind(this,f.a))}(t)}()}function _(t){cmTag&&cmTag.logger&&cmTag.logger.info("PMS Loaded");var i=new t;O.pms=i,function(){var t;if(e.perfUnitType=(t=e.unitType.replace(/_/g,"").toLowerCase(),"".concat(t.charAt(0).toUpperCase()).concat(t.substring(1))),T.trcPerformanceMeasurement(e.trcPerformanceMeasurementEnabled,"videoInitToRender".concat(e.perfUnitType),C.TRC_PERFORMANCE_ACTIONS.START),e.unitName=e.unitType,e.urlPrefix){var i=e.urlPrefix.split("/");e.unitVersion=i[i.length-2],e.unitVersion=e.unitVersion.replace(/_/g,"")}else e.unitVersion=e.version.replace(/_/g,"");h[e.unitType](),l.get("multiUnitManager.isActive")&&E.addUnit(l.get("redId"),l),l.get("cookieMatchActive")&&new d(l)}(),cmTag.units=cmTag.units||{},cmTag.units[T.now()]=e}T.parseBool(e.isStartUnitOnWindowLoaded)?("complete"===document.readyState&&b(),document.onreadystatechange=function(){"complete"===document.readyState&&setTimeout(b,0)}):Object(r.a)("document").ready(b)},t.default=window.cmTag}]);}catch(ex){if(window.location.href.lastIndexOf('cm_isDebug=true')!=-1 || window.location.href.lastIndexOf('cm_isDebug=1')!=-1 ){console.log(e);}}