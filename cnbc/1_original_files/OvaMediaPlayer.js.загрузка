try{!function(i){var s={};function n(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=i,n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t){e.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adPlaying:40,adLoaded:41,startAd:42,globalAdTimeout:53,adUnmuted:58,vpaidProgress:59,unloadPage:60,adDropped:61,blockedActionByHijack:62,fallBackCanvas:70,unfriendlyVideo:83,buffering:90,bufferingEnded:91,blockingTagPassback:94,VpaidVideoSrcOnAdLoaded:95,firstImpression:99,wrappersData:117,slowConnection:122,soundOnHover:123,omidDetected:136,prebidNoResponse:143,prebidWinResponses:144}},function(e,t){e.exports={AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt",Progress:"Progress",TimeUpdated:"TimeUpdated",BlockingTagPassback:"BlockingTagPassback",SlowConnection:"SlowConnection"}},function(e,t){e.exports={START:"Start",STOP:"Stop"}},function(e,t){e.exports={VastFound:"VastFound",VastData:"VastData",ParserError:"parserError",NetworkFail:"networkFail",WrappersData:"WrappersData"}},function(e,t){e.exports={schemaValidationError:101,timeout:304,mediaFileNotSupported:403,undefinedError:900,generalVpaidError:901,noAdsMatcher:"no_fill|no ad|no video|no vast|nofill",codesMatcher:"101|301|302|303|304|402|900|901"}},function(e,t){e.exports={KPI:70,playerDisplayImpression:81,getAd:115,emptyWFResponse:91,noTagsInWFResponse:92,passbackOnEmptyFirstWF:97,forceWf:126,maxEmptyWfs:131,prebidSession:138}},function(s,e,t){!function(e){s.exports=e;var n="listeners",i={on:function(e,t){return a(this,e).push(t),this},once:function(e,t){var i=this;return s.originalListener=t,a(i,e).push(s),i;function s(){r.call(i,e,s),t.apply(this,arguments)}},off:r,emit:function(e,t){var i=this,s=a(i,e,!0);if(!s)return!1;var n=arguments.length;{var r;1===n?s.forEach(function(e){e.call(i)}):2===n?s.forEach(function(e){e.call(i,t)}):(r=Array.prototype.slice.call(arguments,1),s.forEach(function(e){e.apply(i,r)}))}return!!s.length}};function t(e){for(var t in i)e[t]=i[t];return e}function r(e,t){var i,s=this;if(arguments.length){if(t){if(i=a(s,e,!0)){if(!(i=i.filter(function(e){return e!==t&&e.originalListener!==t})).length)return r.call(s,e);s[n][e]=i}}else if(i=s[n],i&&(delete i[e],!Object.keys(i).length))return r.call(s)}else delete s[n];return s}function a(e,t,i){if(!i||e[n]){e=e[n]||(e[n]={});return e[t]||(e[t]=[])}}t(e.prototype),e.mixin=t}(function e(){if(!(this instanceof e))return new e})},function(e,t){e.exports={inner:{NonVideoItemInWaterfall:"nonVideoItemInWaterfall"},outer:{NewCompletion:"NewCompletion",EmitQueueStatus:"emitQueueStatus"}}},function(e,t){e.exports={DIRECT:3,PMP_DIRECT:4,OPEN_EXCHANGE_RTB_DSP:6,OPEN_EXCHANGE_RTB_SSP:8,PREBID:13}},function(e,t,i){window,e.exports=function(i){var s={};function n(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}({"./index.js":function(e,t,i){"use strict";function a(e,t){if("trc"===o.mcrsrvcsnmspc)try{return window.TRC[e][t]}catch(e){}if("cmTag"===o.mcrsrvcsnmspc)try{return window.cmTag.config.ms[e][t]}catch(e){}return null}var o=i("./options.js"),d=i("./utils.js");e.exports={get:function(e,t,i,s){e=d.cleanServiceName(e),t=t||o.serviceDefaultVersion[e];var n,r=a(e,t);r?i&&i(r):(n=document.createElement("script"),r=d.setUrlPrefix(o.base_url),n.async=o.async,n.type="text/javascript",n.src=r+(/.*\/$/g.test(r)?"":"/")+e+"/"+t+"/"+e+".js",n.onload=function(){document.head.removeChild(n);try{i&&i(a(e,t))}catch(e){s&&s()}},n.onerror=function(){document.head.removeChild(n),s&&s()},document.head.appendChild(n))},init:function(e){for(var t in o)e.hasOwnProperty(t)&&(o[t]=e[t])}}},"./options.js":function(e,t,i){"use strict";e.exports={base_url:"//vidstat.taboola.com/",async:!0,mcrsrvcsnmspc:"trc",serviceDefaultVersion:{oppsula:"1.0.1"}}},"./utils.js":function(e,t,i){"use strict";e.exports={setUrlPrefix:function(e){return"string"!=typeof e||0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e},cleanServiceName:function(e){return e.replace(/.js$/,"")}}},0:function(e,t,i){e.exports=i("./index.js")}})},function(e,t){e.exports=function(){return{adimpression:[],impression:[],aderror:[],error:[],adclickthru:[],clickthru:[],adclickthrough:[],clickthrough:[],adclicktracking:[],clicktracking:[],adoloaded:[],loaded:[],adstarted:[],started:[],adstopped:[],stopped:[],adskipped:[],skipped:[],adskippablestatechange:[],skippablestatechange:[],adsizechange:[],sizechange:[],adlinearchange:[],linearchange:[],addurationchange:[],durationchange:[],adexpandedchange:[],expandedchange:[],advolumechange:[],volumechange:[],advideostart:[],start:[],advideofirstquartile:[],firstquartile:[],advideomidpoint:[],midpoint:[],advideothirdquartile:[],thirdquartile:[],advideocomplete:[],complete:[],adinteraction:[],interaction:[],aduseracceptinvitation:[],acceptinvitation:[],aduserminimize:[],minimize:[],aduserclose:[],close:[],adpaused:[],paused:[],pause:[],adplaying:[],playing:[],resume:[],adlog:[],log:[],adfound:[],admute:[],mute:[],adunmute:[],unmute:[],adfullscreen:[],fullscreen:[],creativeview:[],progress:[],viewability:[],viewable50precent1sec:[],fullyviewable1sec:[]}}},function(e,t){function s(e,t){var i=0,s=d(e.wfIndex),n=d(e.waterfallTagId),r=d(e.cpmFloor),a=d(e.fillrate),o=e.getValueByKey("scoreBoost")||0,r={wg:s,wi:n,fr:a,cf:r,mt:function(e){{if("flash"===e)return 1;if("javascript"===e)return 2}return 3}(e.type)||1,advb:o};e.scoreSummary=r;i=1,o=t.get("qsrtscr");if(o&&"function"==typeof o)try{i=o(r,e,t)}catch(e){i=999999}return e.score=i}function d(e){return e=e||0,parseInt(e)}e.exports={sort:function(e,i){return e.sort(function(e,t){return e=s(e,i),s(t,i)<e?1:-1})}}},function(e,t){function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r={new:{id:0,name:"new"},adLoaded:{id:1,name:"adLoaded",timeKey:"ldd"},startAd:{id:2,name:"startAd",timeKey:"st"},adImpression:{id:3,name:"adImpression",timeKey:"imp"},adPlay:{id:4,name:"adPlay",timeKey:"pl"},adError:{id:5,name:"adError",timeKey:"err"},adComplete:{id:6,name:"adComplete",timeKey:"cmp"}};e.exports={Statuses:r,VpaidStatus:function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.statuses=r,this.status=this.statuses.new.id,this.timeBetweenStatuses={},this._startTimer()}var t,i,s;return t=e,(i=[{key:"setStatus",value:function(e){this.timeBetweenStatuses[e.name]=this._getTime(),this.status=e.id,this._startTimer()}},{key:"get",value:function(){var e,t={cs:this._getTime()};for(e in this.timeBetweenStatuses)t[this.statuses[e].timeKey]=this.timeBetweenStatuses[e];return{st:this.status,ts:t}}},{key:"_startTimer",value:function(){this.time=Date.now()}},{key:"_getTime",value:function(){return Date.now()-this.time}}])&&n(t.prototype,i),s&&n(t,s),e}()}},function(e,t,i){"use strict";function r(){}var a={};function o(e){var t=a[e];t&&(clearTimeout(t),delete a[e])}function s(e,t,i){var s=document.createElement("iframe");return s.src=t||"about:blank",s.className="cm-vpaid-iframe",s.marginWidth="0",s.marginHeight="0",s.frameBorder="0",s.width="100%",s.height="100%",i&&(s.style.zIndex=i),s.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(s),s}function n(i,s){return Object.keys(s).forEach(function(e){var t=s[e];i=i.replace(new RegExp("{{"+e+"}}","g"),t)}),i}function d(e,t){e=e.contentWindow&&e.contentWindow.document;return!!e&&(e.write(t),!0)}e.exports={noop:r,validate:function(e,t){return e?null:new Error(t)},clearCallbackTimeout:o,callbackTimeout:function(e,t,i){var s=setTimeout(function(){t=r,delete s[n],i()},e),n=function(){t.apply(this,arguments)&&o(n)};return a[n]=s,n},createElementInEl:function(e,t,i){return t=document.createElement(t),i&&(t.id=i),e.appendChild(t),t},createIframeWithContent:function(e,t,i){if(d(e=s(e,null,i.zIndex),n(t,i)))return e},createIframe:s,setFullSizeStyle:function(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"},simpleTemplate:n,setIframeContent:d,extend:function(t,i){return Object.keys(i).forEach(function(e){t[e]=i[e]}),t},unique:function(e){var t=-1;return function(){return e+"_"+ ++t}}}},function(e,t,i){"use strict";var u=i(24),c={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(i,s){var t,e,n,r,a=!1,o=(s=s||{}).debug||!1;try{var d=u(),h=document.createRange(),l=document.getSelection();if((e=document.createElement("span")).textContent=i,e.style.all="unset",e.style.position="fixed",e.style.top=0,e.style.clip="rect(0, 0, 0, 0)",e.style.whiteSpace="pre",e.style.webkitUserSelect="text",e.style.MozUserSelect="text",e.style.msUserSelect="text",e.style.userSelect="text",e.addEventListener("copy",function(e){var t;e.stopPropagation(),s.format&&(e.preventDefault(),void 0===e.clipboardData?(o&&console.warn("unable to use e.clipboardData"),o&&console.warn("trying IE specific stuff"),window.clipboardData.clearData(),t=c[s.format]||c.default,window.clipboardData.setData(t,i)):(e.clipboardData.clearData(),e.clipboardData.setData(s.format,i))),s.onCopy&&(e.preventDefault(),s.onCopy(e.clipboardData))}),document.body.appendChild(e),h.selectNodeContents(e),l.addRange(h),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");a=!0}catch(e){o&&console.error("unable to copy using execCommand: ",e),o&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(s.format||"text",i),s.onCopy&&s.onCopy(window.clipboardData),a=!0}catch(e){o&&console.error("unable to copy using clipboardData: ",e),o&&console.error("falling back to prompt"),n="message"in s?s.message:"Copy to clipboard: #{key}, Enter",r=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C",t=n.replace(/#{\s*key\s*}/g,r),window.prompt(t,i)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(h):l.removeAllRanges()),e&&document.body.removeChild(e),d()}return a}},function(e,t){e.exports={AdStopped:"AdStopped",adsManagerLoaded:"adsManagerLoaded",complete:"AdVideoComplete",loaded:"AdLoaded",adError:"AdError",start:"AdImpression",firstQuartile:"AdVideoFirstQuartile",midpoint:"AdVideoMidpoint",thirdQuartile:"AdVideoThirdQuartile",click:"AdClickThru",userClose:"AdUserClose",skip:"AdSkipped",durationChange:"AdDurationChange",pause:"AdPaused",resume:"AdPlaying",volumeChange:"AdVolumeChange",mute:"AdVolumeChange",skippableStateChanged:"AdSkippableStateChange",linearChanged:"AdLinearChange",interaction:"AdInteraction",adProgress:"Progress"}},function(e,t,i){e.exports=i(36)},function(e,t,i){!function(se,ne){e.exports=function(){"use strict";function s(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function d(e){return typeof e==="function"}var e=void 0;if(Array.isArray)e=Array.isArray;else e=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=e,n=0,t=void 0,r=void 0,a=function e(t,i){_[n]=t;_[n+1]=i;n+=2;if(n===2)if(r)r(w);else k()};function o(e){r=e}function h(e){a=e}var l=typeof window!=="undefined"?window:undefined,u=l||{},c=u.MutationObserver||u.WebKitMutationObserver,p=typeof self==="undefined"&&typeof se!=="undefined"&&{}.toString.call(se)==="[object process]",v=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function f(){return function(){return se.nextTick(w)}}function m(){if(typeof t!=="undefined")return function(){t(w)};return b()}function g(){var e=0;var t=new c(w);var i=document.createTextNode("");t.observe(i,{characterData:true});return function(){i.data=e=++e%2}}function y(){var e=new MessageChannel;e.port1.onmessage=w;return function(){return e.port2.postMessage(0)}}function b(){var e=setTimeout;return function(){return e(w,1)}}var _=new Array(1e3);function w(){for(var e=0;e<n;e+=2){var t=_[e];var i=_[e+1];t(i);_[e]=undefined;_[e+1]=undefined}n=0}function A(){try{var e=Function("return this")().require("vertx");t=e.runOnLoop||e.runOnContext;return m()}catch(e){return b()}}var k=void 0;if(p)k=f();else if(c)k=g();else if(v)k=y();else if(l===undefined&&"function"==="function")k=A();else k=b();function T(e,t){var i=this;var s=new this.constructor(P);if(s[E]===undefined)Q(s);var n=i._state;if(n){var r=arguments[n-1];a(function(){return N(n,s,r,i._result)})}else H(i,s,e,t);return s}function C(e){var t=this;if(e&&typeof e==="object"&&e.constructor===t)return e;var i=new t(P);L(i,e);return i}var E=Math.random().toString(36).substring(2);function P(){}var V=void 0,S=1,D=2;function I(){return new TypeError("You cannot resolve a promise with itself")}function x(){return new TypeError("A promises callback cannot return that same promise.")}function O(e,t,i,s){try{e.call(t,i,s)}catch(e){return e}}function M(e,s,n){a(function(t){var i=false;var e=O(n,s,function(e){if(i)return;i=true;if(s!==e)L(t,e);else W(t,e)},function(e){if(i)return;i=true;U(t,e)},"Settle: "+(t._label||" unknown promise"));if(!i&&e){i=true;U(t,e)}},e)}function R(t,e){if(e._state===S)W(t,e._result);else if(e._state===D)U(t,e._result);else H(e,undefined,function(e){return L(t,e)},function(e){return U(t,e)})}function F(e,t,i){if(t.constructor===e.constructor&&i===T&&t.constructor.resolve===C)R(e,t);else if(i===undefined)W(e,t);else if(d(i))M(e,t,i);else W(e,t)}function L(t,e){if(t===e)U(t,I());else if(s(e)){var i=void 0;try{i=e.then}catch(e){U(t,e);return}F(t,e,i)}else W(t,e)}function B(e){if(e._onerror)e._onerror(e._result);j(e)}function W(e,t){if(e._state!==V)return;e._result=t;e._state=S;if(e._subscribers.length!==0)a(j,e)}function U(e,t){if(e._state!==V)return;e._state=D;e._result=t;a(B,e)}function H(e,t,i,s){var n=e._subscribers;var r=n.length;e._onerror=null;n[r]=t;n[r+S]=i;n[r+D]=s;if(r===0&&e._state)a(j,e)}function j(e){var t=e._subscribers;var i=e._state;if(t.length===0)return;var s=void 0,n=void 0,r=e._result;for(var a=0;a<t.length;a+=3){s=t[a];n=t[a+i];if(s)N(i,s,n,r);else n(r)}e._subscribers.length=0}function N(e,t,i,s){var n=d(i),r=void 0,a=void 0,o=true;if(n){try{r=i(s)}catch(e){o=false;a=e}if(t===r){U(t,x());return}}else r=s;if(t._state!==V);else if(n&&o)L(t,r);else if(o===false)U(t,a);else if(e===S)W(t,r);else if(e===D)U(t,r)}function q(i,e){try{e(function e(t){L(i,t)},function e(t){U(i,t)})}catch(e){U(i,e)}}var z=0;function G(){return z++}function Q(e){e[E]=z++;e._state=undefined;e._result=undefined;e._subscribers=[]}function K(){return new Error("Array Methods must be provided an Array")}var X=function(){function e(e,t){this._instanceConstructor=e;this.promise=new e(P);if(!this.promise[E])Q(this.promise);if(i(t)){this.length=t.length;this._remaining=t.length;this._result=new Array(this.length);if(this.length===0)W(this.promise,this._result);else{this.length=this.length||0;this._enumerate(t);if(this._remaining===0)W(this.promise,this._result)}}else U(this.promise,K())}e.prototype._enumerate=function e(t){for(var i=0;this._state===V&&i<t.length;i++)this._eachEntry(t[i],i)};e.prototype._eachEntry=function e(t,i){var s=this._instanceConstructor;var n=s.resolve;if(n===C){var r=void 0;var a=void 0;var o=false;try{r=t.then}catch(e){o=true;a=e}if(r===T&&t._state!==V)this._settledAt(t._state,i,t._result);else if(typeof r!=="function"){this._remaining--;this._result[i]=t}else if(s===te){var d=new s(P);if(o)U(d,a);else F(d,t,r);this._willSettleAt(d,i)}else this._willSettleAt(new s(function(e){return e(t)}),i)}else this._willSettleAt(n(t),i)};e.prototype._settledAt=function e(t,i,s){var n=this.promise;if(n._state===V){this._remaining--;if(t===D)U(n,s);else this._result[i]=s}if(this._remaining===0)W(n,this._result)};e.prototype._willSettleAt=function e(t,i){var s=this;H(t,undefined,function(e){return s._settledAt(S,i,e)},function(e){return s._settledAt(D,i,e)})};return e}();function Y(e){return new X(this,e).promise}function J(n){var r=this;if(!i(n))return new r(function(e,t){return t(new TypeError("You must pass an array to race."))});else return new r(function(e,t){var i=n.length;for(var s=0;s<i;s++)r.resolve(n[s]).then(e,t)})}function $(e){var t=this;var i=new t(P);U(i,e);return i}function Z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ee(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function t(e){this[E]=G();this._result=this._state=undefined;this._subscribers=[];if(P!==e){typeof e!=="function"&&Z();this instanceof t?q(this,e):ee()}}t.prototype.catch=function e(t){return this.then(null,t)};t.prototype.finally=function e(t){var i=this;var s=i.constructor;if(d(t))return i.then(function(e){return s.resolve(t()).then(function(){return e})},function(e){return s.resolve(t()).then(function(){throw e})});return i.then(t,t)};return t}();function ie(){var e=void 0;if(typeof ne!=="undefined")e=ne;else if(typeof self!=="undefined")e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if(i==="[object Promise]"&&!t.cast)return}e.Promise=te}return te.prototype.then=T,te.all=Y,te.race=J,te.resolve=C,te.reject=$,te._setScheduler=o,te._setAsap=h,te._asap=a,te.polyfill=ie,te.Promise=te}()}.call(this,i(18),i(19))},function(e,t){var i,s,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{s="function"==typeof clearTimeout?clearTimeout:r}catch(e){s=r}}();var o,d=[],h=!1,l=-1;function u(){h&&o&&(h=!1,o.length?d=o.concat(d):l=-1,d.length&&c())}function c(){if(!h){var e=a(u);h=!0;for(var t=d.length;t;){for(o=d,d=[];++l<t;)o&&o[l].run();l=-1,t=d.length}o=null,h=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===r||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new p(e,t)),1!==d.length||h||a(c)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=v,e.addListener=v,e.once=v,e.off=v,e.removeListener=v,e.removeAllListeners=v,e.emit=v,e.prependListener=v,e.prependOnceListener=v,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t){var i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var s=i(21);"string"==typeof s&&(s=[[e.i,s,""]]);i(23)(s,{})},function(e,t,i){(e.exports=i(22)(!1)).push([e.i,"#_cm-css-reset {\n    height: inherit;\n    width: inherit;\n    direction: ltr;\n    text-align: left;\n}\n\n#_cm-css-reset.vpaid-player-container .vjs-tech {\n    background-color: #000000;\n}\n\n\n#_cm-css-reset.vpaid-player-container {\n    position: relative;\n    z-index: 99;\n}\n\n#_cm-css-reset.vpaid-player-container video ~ iframe {\n    z-index: 10;\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n#_cm-css-reset .vpaid-ad-controls {\n    -webkit-transition: opacity 500ms ease-out;\n    -moz-transition: opacity 500ms ease-out;\n    -o-transition: opacity 500ms ease-out;\n    transition: opacity 500ms ease-out;\n    opacity: 0;\n}\n\n#_cm-css-reset.vpaid-player-container:hover .vpaid-ad-controls {\n    opacity: 1;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-controls,\n#_cm-css-reset.vpaid-player-container .vpaid-ad-pause {\n    height: 30px;\n    right: 0;\n    position: absolute;\n    left: 0px;\n    bottom: 0;\n    z-index: 1001;\n    background-color: rgba(0, 0, 0, 1);\n    border-top: 1px rgba(255, 255, 255, 0.7) solid;\n}\n\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control {\n    width: 2em;\n}\n/*\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control:before {\n    line-height: 2;\n    font-size: 16px;\n}*/\n\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control.c-paused:before {\n    content: \"\\e001\";\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-container {\n    height: 30px;\n    width: 60px;\n    position: relative;\n    float: right;\n    margin-right: 10px;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-mute-container {\n    height: 30px;\n    width: 30px;\n    position: relative;\n    float: right;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-track {\n    height: 8px;\n    border: 1px #000000 solid;\n    box-shadow: 0 0 5px 1px rgb(255, 255, 255);\n    position: absolute;\n    z-index: 0;\n    right: 0;\n    top: 11px;\n    left: 0;\n    background: rgba(51, 51, 51, 0.9)\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-slider {\n    height: 8px;\n    border: 1px #000000 solid;\n    position: absolute;\n    width: 40%;\n    top: 11px;\n    left: 0;\n    background: rgba(183, 234, 187, 0.9);\n    z-index: 1;\n}\n\n\n\n/*#_cm-css-reset .mpegcnv::before {\n    content: \"\";\n    position: absolute;\n    \n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 100;\n}*/\n\n#_cm-css-reset .tbl-text {\n    font-family: Arial,Helvetica,sans-serif;\n    white-space: nowrap;\n    font-size: 11px;\n    color: #fff;\n    left: 10px;\n    top: 4px;\n    position: absolute;\n    font-weight: bold;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-video {\n    z-index: 101;\n}\n\n#_cm-css-reset .vpaid-handler {\n    z-index: 1000;\n    height: 100%;\n    width: 100%;\n}\n\n\n#_cm-css-reset .speaker {\n    position: absolute;\n    width: 46px;\n    height: 46px;\n    bottom: -3px;\n    right: -5px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-on.svg'); \n}\n#_cm-css-reset .speaker.mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-off.svg'); \n}\n\n#_cm-css-reset .hide {\n    display: none\n}\n\n\n#_cm-css-reset .mc-loud-video{\n    position:absolute;\n    pointer-events: none;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-panel {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset .mc-loud-video::--webkit-media-controls-play-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works */\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-start-playback-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls {\n  display:none !important;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-enclosure {\n  display:none !important;\n}\n\n\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show{\n    display: block;\n    margin: 0;\n    padding: 0;\n    position: initial;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show *{\n    position: absolute !important;\n    display: block;\n    margin: 0;\n    padding: 0;\n    background-color: transparent;\n} \n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    z-index: 1000;\n    left: 0;\n    bottom: -32px;\n    -webkit-transition: bottom 0.35s ease-in-out;\n    -moz-transition: bottom 0.35s ease-in-out;\n    -o-transition: bottom 0.35s ease-in-out;\n    transition: bottom 0.35s ease-in-out;\n}\n\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .control {\n    z-index: 100;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .interactive {\n    pointer-events: all;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.hide,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .hide {\n    display: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .show {\n    display: block;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    cursor: default;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area .cm_video_controls_progressbar {\n    height: 100%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area .cm_video_controls_progressbar_bg {\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .white_bg {\n    background: rgba(255,255,255,0.3);\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .blue_bg {\n    background: rgba(21,75,145,1);\n    -webkit-transition : width 0.5s ease;\n    -moz-transition : width 0.5s ease;\n    -o-transition : width 0.5s ease;\n    transition : width 0.5s ease;\n    width: 0%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .blue_bg.init_bg {\n    -webkit-transition : none;\n    -moz-transition : none;\n    -o-transition : none;\n    transition : none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 27px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause {\n    top: 3px;\n    left: 5px;\n    width: 20px;\n    height: 20px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause .pause {\n    width: 40px;\n    height: 27px;\n    top: -7px;\n    left: -8px;\n    background-image: url('https://vidstat.taboola.com/player-assets/pause2.svg');\n    background-size: 36px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause .play {\n    border-top: 5px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 5px solid transparent;\n    left: 6px;\n    top: 5px;\n    z-index: 102;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .title {\n    top: 7px;\n    left: 30px;\n    width: 140px;\n    text-align: left;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .timer {\n    top: 6px;\n    right: 110px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .text {\n    color: white;\n    font-size: 13px;\n    font-weight: bold;\n    font-family: Arial,Helvetica,sans-serif;\n    top: 10px;\n    left: 28px;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    cursor: default;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .text.opt-out-hidden {\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    right: 0px;\n    bottom: 0;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute {\n    width: 35px;\n    height: 27px;\n    right: 8px;\n    bottom: 5px;\n    background-size: 44px;\n    box-sizing: content-box;\n    background-position-y: center;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute.display_mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_muted2.svg');\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute.display_unmute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_playing2.svg');\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .video-controls-scroller-area {\n    width: 80px;\n    height: 100%;\n    right: 5px;\n    top: 0%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .playerSaveButton {\n    position: absolute;\n    border: 1px solid #fff;\n    border-radius: 9px;\n    width: 50px;\n    height: 24px;\n    top: 20%;\n    left: 0;\n    font-size: 14px;\n    color: #fff;\n    text-align: center;\n    line-height: 24px;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls_mobile {\n    width: 100%; \n    height: 100%; \n    top: 0; \n    left: 0; \n    pointer-events: none; \n    z-index: 1001;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area {\n    pointer-events: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause.hide {\n    display: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause.show {\n    display: block;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause {\n    bottom: 28px;\n    left: 5px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause .pause {\n    width: 40px;\n    height: 27px;\n    top: -10px;\n    left: -8px;\n    background-image: url(https://vidstat.taboola.com/player-assets/pause2.svg);\n    background-size: 40px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause .play {\n    border-top: 6px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 6px solid transparent;\n    left: 7px;\n    top: 3px;\n    z-index: 102;\n}\n\n#_cm-css-reset .mc-play {\n    width: 0;\n    height: 0;\n    border-top: 7px solid transparent;\n    border-left: 9px solid #fff;\n    border-bottom: 7px solid transparent;\n    left: 14px;\n    position: absolute;\n    bottom: 10px;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-pause {\n    display: block;\n    width: 42px;\n    height: 42px;\n    left: -4px;\n    position: absolute;\n    bottom: -2px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-pause.svg');\n}\n\n#_cm-css-reset .mc-pause.hide, #_cm-css-reset .mc-play.hide {\n    display: none;\n}\n\n#_cm-css-reset .mc-pause.show, #_cm-css-reset .mc-play.show {\n    display: block;\n}\n\n\n#_cm-css-reset .mc-progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    position: absolute;\n    z-index: 9999;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.white_bg {\n    background: rgba(255,255,255,0.3);\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg {\n    background: rgba(21,75,145,1);\n    -webkit-transition : width 0.5s ease;\n    -moz-transition : width 0.5s ease;\n    -o-transition : width 0.5s ease;\n    transition : width 0.5s ease;\n    position: absolute;\n    bottom: 0%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg.init_bg {\n    -webkit-transition : none;\n    -moz-transition : none;\n    -o-transition : none;\n    transition : none;\n}\n\n#_cm-css-reset > .multi-vpaids {\n    height: 0px;\n}\n\n\n\n\n\n\n#_cm-css-reset *::-webkit-media-controls-panel {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset *::-webkit-media-controls-play-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works! */\n\n#_cm-css-reset *::-webkit-media-controls-start-playback-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n#_cm-css-reset .cm-ad-player {\n    cursor: pointer; \n    position: absolute; \n    left: 0px; \n    top: 0px; \n    z-index: 0;\n}\n\n@supports (object-fit:cover) {\n    #_cm-css-reset .cm-ad-player {\n        object-fit: cover;\n    }\n\n    #_cm-css-reset .cm-ad-player.vertical-video {\n        object-fit: contain;\n    }\n}\n\n#_cm-css-reset .cm-ad-player.ie-black-edges {\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%,-50%);\n}\n\n#_cm-css-reset .cm-ad-player-active {\n    visibility: visible;\n}\n\n#_cm-css-reset ._cm-ad-feed-manager ._cm-ad {\n    display: block !important;\n    visibility: hidden !important;\n}\n\n#_cm-css-reset ._cm-ad-choices-player {\n    position: absolute;\n    top: 16px;\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-ad-choices-player-anchor {\n    display: inline-block;\n    opacity: 0.5;\n    vertical-align: middle;\n}\n\n#_cm-css-reset .interactive-video {\n    position: absolute;\n    z-index: 999 !important;\n    cursor: pointer;\n    transition: visibility 0.2s, opacity 0.5s linear;\n    display: initial !important;\n    opacity: 0.8;\n    font-size: .875rem;\n    padding-left: .75rem;\n    padding-right: .75rem;\n    padding-top: .25rem;\n    padding-bottom: .25rem;\n    font-weight: 600;\n    border-radius: 9999px;\n    font-size: 3.5vmin;\n    text-shadow: 1px 1px black;\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video-lbls {\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video.center {\n    position: relative;\n}\n\n#_cm-css-reset .interactive-video.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video-wrapper {\n    position: absolute;\n    width: 100%;\n    text-align: center;\n}\n\n#_cm-css-reset .interactive-video-wrapper.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n#_cm-css-reset .interactive-video-effect {\n    -webkit-transition : width 0s ease;\n    -moz-transition : width 0s ease;\n    -o-transition : width 0s ease;\n    transition : width 0s ease;\n    height: 1px;\n    background-color: white;\n    pointer-events: none;\n}\n\n#_cm-css-reset .interactive-video-effect-wrapper {\n    padding-left: .75rem;\n}\n\n@media only screen and (max-width : 768px) {\n    #_cm-css-reset .interactive-video {\n        font-size: 3vmin;\n    }\n}\n\n#_cm-css-reset .cm-vpaid-iframe {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    margin: 0px !important;\n    padding: 0px;\n    border: none;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n}\n\n.buff-vid {\n    z-index: 2147483647 !important;\n    position: fixed;\n    right: 0;\n    width: 1px;\n    height: 1px;\n    \n}",""])},function(e,t,i){"use strict";e.exports=function(i){var o=[];return o.toString=function(){return this.map(function(e){var t=function(e,t){var i=e[1]||"",s=e[3];if(!s)return i;if(t&&"function"==typeof btoa){e=function(e){e=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),e="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(e," */")}(s),t=s.sources.map(function(e){return"/*# sourceURL=".concat(s.sourceRoot).concat(e," */")});return[i].concat(t).concat([e]).join("\n")}return[i].join("\n")}(e,i);return e[2]?"@media ".concat(e[2],"{").concat(t,"}"):t}).join("")},o.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},s=0;s<this.length;s++){var n=this[s][0];null!=n&&(i[n]=!0)}for(var r=0;r<e.length;r++){var a=e[r];null!=a[0]&&i[a[0]]||(t&&!a[2]?a[2]=t:t&&(a[2]="(".concat(a[2],") and (").concat(t,")")),o.push(a))}},o}},function(e,t){function i(e){var t;return function(){return t=void 0===t?e.apply(this,arguments):t}}var d={},s=i(function(){return/msie 9\b/.test(window.navigator.userAgent.toLowerCase())}),n=i(function(){return document.head||document.getElementsByTagName("head")[0]}),r=null,a=0;function h(e,t){for(var i=0;i<e.length;i++){var s=e[i],n=d[s.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](s.parts[r]);for(;r<s.parts.length;r++)n.parts.push(u(s.parts[r],t))}else{for(var a=[],r=0;r<s.parts.length;r++)a.push(u(s.parts[r],t));d[s.id]={id:s.id,refs:1,parts:a}}}}function l(e){for(var t=[],i={},s=0;s<e.length;s++){var n=e[s],r=n[0],n={css:n[1],media:n[2],sourceMap:n[3]};i[r]?i[r].parts.push(n):t.push(i[r]={id:r,parts:[n]})}return t}function o(){var e=document.createElement("style"),t=n();return e.type="text/css",t.appendChild(e),e}function u(t,e){var i,s,n;return n=e.singleton?(e=a++,i=r=r||o(),s=c.bind(null,i,e,!1),c.bind(null,i,e,!0)):(i=o(),s=function(e,t){var i=t.css,s=t.media,t=t.sourceMap;if(t&&"function"==typeof btoa)try{i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(JSON.stringify(t))+" */",i='@import url("data:text/css;base64,'+btoa(i)+'")'}catch(e){}s&&e.setAttribute("media",s);if(e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}.bind(null,i),function(){i.parentNode.removeChild(i)}),s(t),function(e){e?e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap||s(t=e):n()}}function c(e,t,i,s){i=i?"":s.css;e.styleSheet?e.styleSheet.cssText=function(e,t,i){var s=["/** >>"+t+" **/","/** "+t+"<< **/"],t=e.lastIndexOf(s[0]),i=i?s[0]+i+s[1]:"";if(0<=e.lastIndexOf(s[0])){s=e.lastIndexOf(s[1])+s[1].length;return e.slice(0,t)+i+e.slice(s)}return e+i}(e.styleSheet.cssText,t,i):(s=document.createTextNode(i),(i=e.childNodes)[t]&&e.removeChild(i[t]),i.length?e.insertBefore(s,i[t]):e.appendChild(s))}e.exports=function(e,a){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");void 0===(a=a||{}).singleton&&(a.singleton=s());var o=l(e);return h(o,a),function(e){for(var t=[],i=0;i<o.length;i++){var s=o[i];(n=d[s.id]).refs--,t.push(n)}e&&h(l(e),a);for(var n,i=0;i<t.length;i++)if(0===(n=t[i]).refs){for(var r=0;r<n.parts.length;r++)n.parts[r]();delete d[n.id]}}}},function(e,t){e.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,i=[],s=0;s<t.rangeCount;s++)i.push(t.getRangeAt(s));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||i.forEach(function(e){t.addRange(e)}),e&&e.focus()}}},function(e,t,i){"use strict";var o=i(13),r=o.unique("vpaidIframe"),d=i(26);function s(e,t,i,s,n){i=i||{},this._id=r(),this._destroyed=!1,this.store=n,this._frameContainer=o.createElementInEl(e,"div"),this._frameContainer.style.position="initial",this._videoEl=t,this._vpaidOptions=s||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');setTimeout(function () {try { if (window.top.onTaboolaVpaidJSVpaidIframeLoaded) { window.top.onTaboolaVpaidJSVpaidIframeLoaded(\'{"data":{"event": "ready", "id": "{{iframeID}}"}, "origin": "{{origin}}"}\'); } } catch (e) {}}, 100);<\/script></body></html>',extraOptions:i.extraOptions||{}}}function h(){l.call(this),function(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}.call(this)}function l(){!function(e){var t=this[e];t&&(t.remove&&t.remove(),delete this[e])}.call(this,"_frame"),u.call(this)}function u(){this._onLoad&&(window.removeEventListener("message",this._onLoad),o.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function c(){return window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}s.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,h.call(this))},s.prototype.isDestroyed=function(){return this._destroyed},s.prototype.loadAdUnit=function(e,n){!function(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}.call(this),h.call(this);var r=this,t=o.createIframeWithContent(this._frameContainer,this._templateConfig.template,o.extend({iframeURL_JS:e,iframeID:this.getID(),origin:c()},this._templateConfig.extraOptions));this.store.get("msnifrmsrchk")&&(t._src=t.src,Object.defineProperty(t,"src",{get:function(){return t._src},set:function(e){}})),this._frame=t,this._onLoad=o.callbackTimeout(this._vpaidOptions.timeout,function(e){a&&"string"==typeof e&&(e=JSON.parse(e));if(e.origin===c()){var t,i,s;if(a&&"string"!=typeof e)t=e.data;else try{t=JSON.parse(e.data)}catch(e){t={}}if(t.id===r.getID()){(t=r._frame.contentWindow?(i=r._frame.contentWindow.getVPAIDAd,o.validate("function"==typeof i,"the ad didn't return a function to create an ad")):"the iframe is not anymore in the DOM tree")||(s=r._frame.contentWindow.document.querySelector(".ad-element"),(s=new d(i(),s,r._videoEl,r._frame)).subscribe("AdStopped",function(){l.call(this),delete this._adUnit}.bind(r)),t=o.validate(s.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")),r._adUnit=s,u.call(r),n(t,t?null:s);try{a&&(window.top.onTaboolaVpaidJSVpaidIframeLoaded=void 0)}catch(e){}return!0}}}.bind(this),function(){n("timeout",null)}.bind(this));var a=this.store.get("istblvpd");if(a)try{window.top.onTaboolaVpaidJSVpaidIframeLoaded=this._onLoad}catch(e){}window.addEventListener("message",this._onLoad)},s.prototype.unloadAdUnit=function(){h.call(this)},s.prototype.getID=function(){return this._id},e.exports=s},function(e,t,i){"use strict";var r=i(27),n=i(28),a=r.checkVPAIDInterface,d=i(13),o=(r.METHODS,"AdClickThru"),h=r.EVENTS.filter(function(e){return e!=o});function l(e,t,i,s){this._isValid=a(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=s,this._subscribers=new n,d.setFullSizeStyle(t),function(){{var t,i;h.forEach(function(e){this._creative.subscribe(function(e){this._subscribers.trigger(e,Array.prototype.slice.call(arguments).slice(1))}.bind(this,e),e)}.bind(this)),this._creative.subscribe(function(e,t,i){this._subscribers.triggerSync(o,{url:e,id:t,playerHandles:i})}.bind(this),o),this._videoEl&&(t=this._iframe.contentDocument.documentElement,i=this._videoEl,t.addEventListener("click",function(e){e.target===t&&i.click()}))}}.call(this))}function u(e,t,i,s){e?e(i,s):i&&t.trigger("AdError",i)}(l.prototype=Object.create(r.prototype)).isValidVPAIDAd=function(){return this._isValid},r.METHODS.forEach(function(n){-1===["subscribe","unsubscribe","initAd"].indexOf(n)&&(l.prototype[n]=function(){var e=r.prototype[n].length,i=Array.prototype.slice.call(arguments),s=e===i.length?i.pop():void 0;setTimeout(function(){var e,t=null;try{e=this._creative[n].apply(this._creative,i)}catch(e){t=e}u(s,this._subscribers,t,e)}.bind(this),0)})}),l.prototype.initAd=function(e,i,s,n,r,a,o){r=r||{},a=d.extend({slot:this._el,videoSlot:this._videoEl},a||{}),setTimeout(function(){var t;try{this._creative.initAd(e,i,s,n,r,a)}catch(e){t=e}u(o,this._subscribers,t)}.bind(this),0)},l.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},l.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},l.prototype.on=l.prototype.subscribe,l.prototype.off=l.prototype.unsubscribe,r.GETTERS.forEach(function(s){l.prototype[s]=function(i){setTimeout(function(){var e,t=null;try{e=this._creative[s]()}catch(e){t=e}u(i,this._subscribers,t,e)}.bind(this),0)}}),l.prototype.setAdVolume=function(t,i){setTimeout(function(){var e;try{this._creative.setAdVolume(t),e=this._creative.getAdVolume()}catch(e){}u(i,this._subscribers,null,e)}.bind(this),0)},l.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=l},function(e,t,i){"use strict";var s=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function n(e,t,i){}n.prototype.handshakeVersion=function(e,t){},n.prototype.initAd=function(e,t,i,s,n,r,a){},n.prototype.startAd=function(e){},n.prototype.stopAd=function(e){},n.prototype.skipAd=function(e){},n.prototype.resizeAd=function(e,t,i,s){},n.prototype.pauseAd=function(e){},n.prototype.resumeAd=function(e){},n.prototype.expandAd=function(e){},n.prototype.collapseAd=function(e){},n.prototype.subscribe=function(e,t,i){},n.prototype.unsubscribe=function(e,t){},n.prototype.getAdLinear=function(e){},n.prototype.getAdWidth=function(e){},n.prototype.getAdHeight=function(e){},n.prototype.getAdExpanded=function(e){},n.prototype.getAdSkippableState=function(e){},n.prototype.getAdRemainingTime=function(e){},n.prototype.getAdDuration=function(e){},n.prototype.getAdVolume=function(e){},n.prototype.getAdCompanions=function(e){},n.prototype.getAdIcons=function(e){},n.prototype.setAdVolume=function(e,t){},a(n,"METHODS",s),a(n,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),a(n,"SETTERS",["setAdVolume"]),a(n,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var r=s.filter(function(e){return-1===["skipAd"].indexOf(e)});function a(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}a(n,"checkVPAIDInterface",function(t){return r.every(function(e){return"function"==typeof t[e]})}),e.exports=n},function(e,t,i){"use strict";function s(){this._subscribers={}}s.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},s.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter(function(e){return"*"!==t&&t!==e.handler})},s.prototype.unsubscribeAll=function(){this._subscribers={}},s.prototype.trigger=function(e,t){for(var i=this.get(e),s=0;s<i.length;s++)!function(e,t){setTimeout(function(){e.handler.call(e.context,t)},0)}(i[s],t)},s.prototype.triggerSync=function(e,t){this.get(e).forEach(function(e){e.handler.call(e.context,t)})},s.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]||[]},s.prototype.isHandlerAttached=function(t,e){return this.get(e).some(function(e){return t===e.handler})},e.exports=s},function(e,t,i){var s;void 0===(s="function"==typeof(s=function(){"use strict";return function(i,s){var n;return function(){var e=this,t=arguments;clearTimeout(n);n=setTimeout(function(){i.apply(e,t)},s)}}})?s.apply(t,[]):s)||(e.exports=s)},function(e,t){function n(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,s;s={},n.m=i=[function(e,t,i){"use strict";function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}i.r(t);var n=(s(a.prototype,[{key:"send",value:function(e){var t=new XMLHttpRequest,i=e.postData||"";t.open(i?"POST":"GET",e.wfUrl,!0),t.withCredentials=this.withCredentials,t.setRequestHeader("Content-type",this.contentType),t.async=this.async,t.timeout=this.timeout,t.gotResponse=!1;var s=this._onFail.bind(t,e),e=this._onReadyStateChanged.bind(t,e);return t.addEventListener("error",s),t.addEventListener("abort",s),t.addEventListener("timeout",s),t.addEventListener("readystatechange",e),t.send(i),!0}},{key:"_onFail",value:function(e){this.gotResponse||(this.gotResponse=!0,e.onFail&&e.onFail([this.status],e.wfUrl))}},{key:"_onReadyStateChanged",value:function(e){4==this.readyState&&(this.gotResponse||(this.gotResponse=!0,e.onSuccess&&e.onSuccess(this.responseText,void 0,e.wfUrl)))}}]),a),r=[{id:5,mime:"application/javascript",video:!1},{id:8,mime:"video/x-ms-wmv",video:!0},{id:10,mime:"video/mp4",video:!0},{id:11,mime:"video/ogg",video:!0},{id:12,mime:"video/webm",video:!0}];function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;!function(e){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),this.async=null==t||t,this.withCredentials=null==i||i,this.timeout=s||5e3,this.contentType=e||"application/x-www-form-urlencoded"}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}).apply(this,arguments)}function d(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var h,t=(d(l.prototype,[{key:"_init",value:function(){this._setCounter(),this.dynamicNoaopMaxValue=this.store.get("dnapmxvl"),this.playerVersion=this.store.get("player_version"),this.timezoneOffset=-1*(new Date).getTimezoneOffset(),this.waterfallVersion=this.store.get("wfv"),this.isAmp=this.store.get("isAmp")?"1":"0",this.encodeWaterfallResponse=this.store.get("encwfrs")?1:void 0,this.changedBaseUrlDc=!1}},{key:"_setCounter",value:function(){this.dast=this.store.get("auc_dast"),window._cm_wfCounters||(window._cm_wfCounters={}),window._cm_wfCounters.hasOwnProperty(this.dast)||(window._cm_wfCounters[this.dast]=1)}},{key:"_setBaseUrl",value:function(){var e,t=this.store.get("wf_base_path")||this.creatives.CM_DOMAIN,i=this.store.get("wf_path")||this.creatives.SERVICE;this.baseUrl="".concat(("string"!=typeof(e=t)||0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e)).concat(/.*\/$/g.test(t)?"":"/").concat(i)}},{key:"changeWfBasePath",value:function(){var e=this.store.get("domain_wf_base_path");!this.changedBaseUrlDc&&this.getWfCounter()>this.store.get("numOfWfUntilDcSwitch")&&e&&(this.changedBaseUrlDc=!0,this.store.set("wf_base_path",e),this._setBaseUrl())}},{key:"_getConsentData",value:function(){this.updateCMPData=this.store.get("updtcmpbfrwf"),this.updateCMPData&&this._initConsentData()}},{key:"_initConsentData",value:function(){this.rboxConsentData=window.TRC&&window.TRC.consentData?window.TRC.consentData:{},this.consentData={cdb:this.store.get("cdb")||this.rboxConsentData.consentDaisyBit,gdprApplies:this.store.get("gdprApplies")||this.rboxConsentData.gdprApplies}}},{key:"_checkMimeTypes",value:function(){var e=document.createElement("video");this.supportedMimeTypes=[],this.supportedMimeTypes.push(5);for(var t=0;t<r.length;t++){var i=r[t];i.video&&e.canPlayType(i.mime)&&this.supportedMimeTypes.push(i.id)}e=void 0,this.supportedMimeTypes=this.supportedMimeTypes.join(",")}},{key:"generateUrl",value:function(e){e="".concat(this.baseUrl,"?").concat(this._setWfUrlQuerystring(e));return window.lastWfUrl=e}},{key:"_setServiceName",value:function(){return this.store.get("wf_path")||this.creatives.SERVICE}},{key:"_setWfUrlQuerystring",value:function(e){if(!e.roll)return"";this._updateConsentData();var t,i=o(this._buildParamsForQuerystring(e),this._buildOptionalParamsForQuerystring(),this._buildGDPRParamsForQuerystring(e)),i=this._appendUnitParams(i,e),i=(t=i,Object.keys(t).map(function(e){return"".concat(e,"=").concat(t[e])}));return(i=this._appendWfExtraParams(i)).join("&")}},{key:"_updateConsentData",value:function(){var t=this;this.updateCMPData&&void 0!==window.__cmp&&window.__cmp("getConsentData",null,function(e){t.consentData.cdbUpdated=t.consentData.cdb!==e.consentData,t.consentData.cdb=e.consentData,t.consentData.gdprApplies=e.gdprApplies})}},{key:"_buildParamsForQuerystring",value:function(e){return{oid:this.creatives.OID,width:this.creatives.PLAYER_WIDTH||this.creatives["PLAYER-WIDTH"],height:this.creatives.PLAYER_HEIGHT||this.creatives["PLAYER-HEIGHT"],pubid:e.pubid||this.creatives.PUBID,tagid:e.tagid||this.creatives.TAGID,crid:this.store.get("creativeId")||"",noaop:this._decideNoaop(e.isFirstRun,this.creatives.NOAOP),sortOrderType:this.creatives.SORTORDERTYPE,cb:(new Date).getTime(),mimes:this.supportedMimeTypes,isvideo:this.creatives.ISVIDEO,plmd:this.creatives.PLMD,mindur:this.creatives.MINDUR,maxdur:this.creatives.MAXDUR,minbr:this.creatives.MINBR,maxbr:this.creatives.MAXBR,st:(t=e.roll.roll_type,i=(e={"pre-roll":i=0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2}).hasOwnProperty(t)?e[t]:i),seq:window._cm_wfCounters[this.dast],pv:this.playerVersion||999,pt:function(e){if(!e||"string"!=typeof e)return 0;var t,i;void 0===t&&(t=0),t^=-1;for(var s=0,n=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):(127<s&&s<2048?t+=String.fromCharCode(s>>6|192):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128)),t+=String.fromCharCode(63&s|128))}return t}(e)).length;s<n;s++)i=255&(t^e.charCodeAt(s)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);return-1^t}(this.store.get("ab_test")||999),tz:this.timezoneOffset,viewable:!document.hidden,ddast:this.store.get("auc_dast"),proto:"2,3,5,6",encoded:1,pstn:this.store.get("pstn")||1,callback:"",wfv:this.waterfallVersion,amp:this.isAmp,qsz:this.store.get("queue_size")||10,ft:this.store.get("frameType"),pb:"yes"===this.store.get("isPrivateBrowsing")?"1":"0",pagg:this.store.get("preset.level")||1,sd:this.store.get("startDelay")};var t,i}},{key:"_decideNoaop",value:function(e,t){var i;return(e?this.store.get("firstWaterfallNoaop"):0<this.dynamicNoaopMaxValue?(i=this.store.get("max_ready_vpaid")||0,e=this.store.get("vpaidReadyCount")||0,Math.min(this.dynamicNoaopMaxValue,i-e)):t)||t}},{key:"_buildOptionalParamsForQuerystring",value:function(){var e=this.store.get("mprdct"),t=this.store.get("subUnitType"),t={dtagid:this.store.get("dtagid")||void 0,dpubid:this.store.get("dpubid")||void 0,abtst:this.store.get("ab_test")||void 0,mPre:void 0!==e?e:void 0,fmli:this.store.get("fmli")||void 0,fmpw:this.store.get("fmpw")||void 0,cirf:this.creatives.CIRF?encodeURIComponent(decodeURIComponent(this.creatives.CIRF)):void 0,en:this.encodeWaterfallResponse,subu:"undefiend"!=typeof t?t:void 0};return JSON.parse(JSON.stringify(t))}},{key:"_buildGDPRParamsForQuerystring",value:function(){return this.store.get("sndgdprprmswf")?{cdb:(this.updateCMPData?this.consentData.cdb:this.store.get("cdb"))||"",gdprApplies:(this.updateCMPData?this.consentData.gdprApplies:this.store.get("gdprApplies"))||!1}:{}}},{key:"_appendUnitParams",value:function(e,t){return 0<Object.keys(t.unitWfParams).length?o(e,t.unitWfParams):e}},{key:"_appendWfExtraParams",value:function(e){var t=this.store.get("wf_xrta");return t&&e.push(t),e}},{key:"generatePOSTParams",value:function(e){return o(this._buildParamsForPOSTData(e),this._buildOptionalParamsForPOSTData())}},{key:"_buildParamsForPOSTData",value:function(e){var t=this.store.get("navigatorConnection")||{};return{fv:this._buildLineItemsDataForPOSTData(),wfv:this.waterfallVersion,adv:this.store.getWfData(),cdl:t.downlink||0,cet:t.effectiveTypeId||0,ct:t.typeId||0,crt:t.rtt||0,csd:!0===t.saveData?1:0,q:e.queueStatus?e.queueStatus.items:[],qs:e.queueStatus?e.queueStatus.size:0,pq:e.queueStatus?e.queueStatus.prevItems:[],drp:btoa(JSON.stringify(e.droppedAdTypes))}}},{key:"_buildLineItemsDataForPOSTData",value:function(){var i=this,e=this.store.get("lineItems")||[];return 0===e.length?[]:e.map(function(e){var t=i.store.get(e);return{li:e,f:t.fails,fr:t.failsRow,c:t.conversions,t:t.tries}})}},{key:"_buildOptionalParamsForPOSTData",value:function(){var e=this.store.get("subUnitType"),t=this.store.get("EP_PLAYER"),i=this.store.get("sessionData"),t={sd:i&&"undefined"!==i?i:void 0,en:this.encodeWaterfallResponse,subu:void 0!==e?e:void 0,ls:!this.sentCookiesData&&t?t:void 0};return this.sentCookiesData||(this.sentCookiesData=!0),JSON.parse(JSON.stringify(t))}},{key:"send",value:function(e){this.XHR.send(e)}},{key:"getWfCounter",value:function(){return window._cm_wfCounters[this.dast]}},{key:"increaseWfCounter",value:function(){window._cm_wfCounters[this.dast]++}},{key:"getConsentData",value:function(){return this.consentData}},{key:"getRboxConsentData",value:function(){return this.rboxConsentData}}]),l);function l(e,t){!function(e){if(!(e instanceof l))throw new TypeError("Cannot call a class as a function")}(this),this.store=e,this.creatives=t,this.XHR=new n(this.store.get("psthdrs")||"application/json",!0,!0,5e3),this._init(),this._setBaseUrl(),this._getConsentData(),this._checkMimeTypes()}try{window.cmTag&&((h=window.cmTag.config.ms||{})["wf-generator"]=h["wf-generator"]||{},h["wf-generator"]["1.1.4"]=t,window.cmTag.set("ms",h))}catch(e){}try{window.TRC=window.TRC||{},window.TRC["wf-generator"]=window.TRC["wf-generator"]||{},window.TRC["wf-generator"]["1.1.4"]=t}catch(e){}}],n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)},function(e,t,i){e.exports=function(V){function i(t){var i=W[t];if(!i)return I;function e(e){return i.hot.active?(W[e]?W[e].parents.indexOf(t)<0&&W[e].parents.push(t):(F=[t],d=e),i.children.indexOf(e)<0&&i.children.push(e)):(console.warn("[HMR] unexpected require("+e+") from disposed module "+t),F=[]),I(e)}for(var s in I)Object.prototype.hasOwnProperty.call(I,s)&&"e"!==s&&Object.defineProperty(e,s,function(t){return{configurable:!0,enumerable:!0,get:function(){return I[t]},set:function(e){I[t]=e}}}(s));return e.e=function(e){function t(){v--,"prepare"===L&&(f[e]||r(e),0===v&&0===p&&a())}return"ready"===L&&S("prepare"),v++,I.e(e).then(t,function(e){throw t(),e})},e}function S(e){L=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}function D(e){return+e+""===e?+e:e}function n(e){if("idle"!==L)throw new Error("check() is only allowed in idle status");return l=e,S("check"),new Promise(function(t,i){if("undefined"==typeof XMLHttpRequest)return i(new Error("No browser support"));try{var s=new XMLHttpRequest,n=I.p+"hot_updater/hot-update.json";s.open("GET",n,!0),s.timeout=1e4,s.send(null)}catch(t){return i(t)}s.onreadystatechange=function(){if(4===s.readyState)if(0===s.status)i(new Error("Manifest request to "+n+" timed out."));else if(404===s.status)t();else if(200!==s.status&&304!==s.status)i(new Error("Manifest request to "+n+" failed."));else{try{var e=JSON.parse(s.responseText)}catch(e){return void i(e)}t(e)}}}).then(function(e){if(!e)return S("idle"),null;m={},f={},B=e.c,O=e.h,S("prepare");e=new Promise(function(e,t){h={resolve:e,reject:t}});return x={},r(0),"prepare"===L&&0===v&&0===p&&a(),e})}function r(e){var t,i;B[e]?(m[e]=!0,p++,t=document.getElementsByTagName("head")[0],(i=document.createElement("script")).type="text/javascript",i.charset="utf-8",i.src=I.p+"hot_updater/hot-update.js",t.appendChild(i)):f[e]=!0}function a(){S("ready");var t=h;if(h=null,t)if(l)o(l).then(function(e){t.resolve(e)},function(e){t.reject(e)});else{var e,i=[];for(e in x)Object.prototype.hasOwnProperty.call(x,e)&&i.push(D(e));t.resolve(i)}}function o(i){function l(e,t){for(var i=0;i<t.length;i++){var s=t[i];e.indexOf(s)<0&&e.push(s)}}if("ready"!==L)throw new Error("apply() is only allowed in ready status");i=i||{};function e(){console.warn("[HMR] unexpected require("+d.moduleId+") to disposed module")}var t,s,n={},r=[],a={};for(s in x)if(Object.prototype.hasOwnProperty.call(x,s)){var o=D(s),d=x[s]?function(e){for(var t=[e],i={},s=t.slice().map(function(e){return{chain:[e],id:e}});0<s.length;){var n=s.pop(),r=n.id,a=n.chain;if((k=W[r])&&!k.hot._selfAccepted){if(k.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:r};if(k.hot._main)return{type:"unaccepted",chain:a,moduleId:r};for(var o=0;o<k.parents.length;o++){var d=k.parents[o],h=W[d];if(h){if(h.hot._declinedDependencies[r])return{type:"declined",chain:a.concat([d]),moduleId:r,parentId:d};0<=t.indexOf(d)||(h.hot._acceptedDependencies[r]?(i[d]||(i[d]=[]),l(i[d],[r])):(delete i[d],t.push(d),s.push({chain:a.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:i}}(o):{type:"disposed",moduleId:s},h=!1,u=!1,c=!1,p="";switch(d.chain&&(p="\nUpdate propagation: "+d.chain.join(" -> ")),d.type){case"self-declined":i.onDeclined&&i.onDeclined(d),i.ignoreDeclined||(h=new Error("Aborted because of self decline: "+d.moduleId+p));break;case"declined":i.onDeclined&&i.onDeclined(d),i.ignoreDeclined||(h=new Error("Aborted because of declined dependency: "+d.moduleId+" in "+d.parentId+p));break;case"unaccepted":i.onUnaccepted&&i.onUnaccepted(d),i.ignoreUnaccepted||(h=new Error("Aborted because "+o+" is not accepted"+p));break;case"accepted":i.onAccepted&&i.onAccepted(d),u=!0;break;case"disposed":i.onDisposed&&i.onDisposed(d),c=!0;break;default:throw new Error("Unexception type "+d.type)}if(h)return S("abort"),Promise.reject(h);if(u)for(o in a[o]=x[o],l(r,d.outdatedModules),d.outdatedDependencies)Object.prototype.hasOwnProperty.call(d.outdatedDependencies,o)&&(n[o]||(n[o]=[]),l(n[o],d.outdatedDependencies[o]));c&&(l(r,[d.moduleId]),a[o]=e)}var v=[];for(E=0;E<r.length;E++)o=r[E],W[o]&&W[o].hot._selfAccepted&&v.push({module:o,errorHandler:W[o].hot._selfAccepted});S("dispose"),Object.keys(B).forEach(function(e){!1===B[e]&&delete installedChunks[e]});for(var f,m,g=r.slice();0<g.length;)if(o=g.pop(),k=W[o]){for(var y={},b=k.hot._disposeHandlers,_=0;_<b.length;_++)(t=b[_])(y);for(R[o]=y,k.hot.active=!1,delete W[o],_=0;_<k.children.length;_++){var w=W[k.children[_]];w&&0<=(f=w.parents.indexOf(o))&&w.parents.splice(f,1)}}for(o in n)if(Object.prototype.hasOwnProperty.call(n,o)&&(k=W[o]))for(T=n[o],_=0;_<T.length;_++)m=T[_],0<=(f=k.children.indexOf(m))&&k.children.splice(f,1);for(o in S("apply"),M=O,a)Object.prototype.hasOwnProperty.call(a,o)&&(V[o]=a[o]);var A=null;for(o in n)if(Object.prototype.hasOwnProperty.call(n,o)){for(var k=W[o],T=n[o],C=[],E=0;E<T.length;E++)m=T[E],t=k.hot._acceptedDependencies[m],0<=C.indexOf(t)||C.push(t);for(E=0;E<C.length;E++){t=C[E];try{t(T)}catch(e){i.onErrored&&i.onErrored({type:"accept-errored",moduleId:o,dependencyId:T[E],error:e}),i.ignoreErrored||A||(A=e)}}}for(E=0;E<v.length;E++){var P=v[E];o=P.module,F=[o];try{I(o)}catch(t){if("function"==typeof P.errorHandler)try{P.errorHandler(t)}catch(e){i.onErrored&&i.onErrored({type:"self-accept-error-handler-errored",moduleId:o,error:e,orginalError:t}),A=(A=!i.ignoreErrored&&!A?e:A)||t}else i.onErrored&&i.onErrored({type:"self-accept-errored",moduleId:o,error:t}),i.ignoreErrored||A||(A=t)}}return A?(S("fail"),Promise.reject(A)):(S("idle"),new Promise(function(e){e(r)}))}function I(e){if(W[e])return W[e].exports;var t,s,t=W[e]={i:e,l:!1,exports:{},hot:(s={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:d!==(t=e),active:!0,accept:function(e,t){if(void 0===e)s._selfAccepted=!0;else if("function"==typeof e)s._selfAccepted=e;else if("object"==typeof e)for(var i=0;i<e.length;i++)s._acceptedDependencies[e[i]]=t||function(){};else s._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)s._selfDeclined=!0;else if("object"==typeof e)for(var t=0;t<e.length;t++)s._declinedDependencies[e[t]]=!0;else s._declinedDependencies[e]=!0},dispose:function(e){s._disposeHandlers.push(e)},addDisposeHandler:function(e){s._disposeHandlers.push(e)},removeDisposeHandler:function(e){e=s._disposeHandlers.indexOf(e);0<=e&&s._disposeHandlers.splice(e,1)},check:n,apply:o,status:function(e){if(!e)return L;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){e=c.indexOf(e);0<=e&&c.splice(e,1)},data:R[t]},d=void 0,s),parents:(u=F,F=[],u),children:[]};return V[e].call(t.exports,t,t.exports,i(e)),t.l=!0,t.exports}var s=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){(function(e,t){if(B[e]&&m[e]){for(var i in m[e]=!1,t)Object.prototype.hasOwnProperty.call(t,i)&&(x[i]=t[i]);0==--p&&0===v&&a()}})(e,t),s&&s(e,t)};var d,h,x,O,l=!0,M="13f87ce5e7ffeb2a618b",R={},F=[],u=[],c=[],L="idle",p=0,v=0,f={},m={},B={},W={};return I.m=V,I.c=W,I.i=function(e){return e},I.d=function(e,t,i){I.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},I.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return I.d(t,"a",t),t},I.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},I.p="",I.h=function(){return M},i(0)(I.s=0)}({"./src/index.js":function(e,t,i){"use strict";var s,i=i("./src/oppsula.js");try{window.cmTag&&((s=window.cmTag.config.ms||{}).oppsula=s.oppsula||{},s.oppsula["1.3.8"]=i,window.cmTag.set("ms",s))}catch(e){}try{window.TRC&&(window.TRC.oppsula=window.TRC.oppsula||{},window.TRC.oppsula["1.3.8"]=i)}catch(e){}e.exports={}},"./src/opportunityType.js":function(e,t,i){"use strict";e.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,firstImpression:99,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adLoaded:41,startAd:42,videoThrottle:43}},"./src/oppsula.js":function(e,t,i){"use strict";var s=function(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e},n=i("./src/xhr.js"),r=i("./src/store.js"),a=i("./src/utils.js"),o=i("./src/opportunityType.js"),d={},s=(s(h,[{key:"registerCallback",value:function(e,t){this[e].push(t)}},{key:"unRegisterCallback",value:function(e,t){this[e].splice(this[e].indexOf(t),1)}},{key:"_activateCallbacks",value:function(e){for(var t=0;t<this[e].length;t++){var i=this[e][t];this[e].splice(this[e].indexOf(i),1),i()}}},{key:"_getRedId",value:function(e){if(e)return e.get("redId")||e.get("red_id")}},{key:"send",value:function(e){e.tms=Date.now(),this.stopped||(this._isBillableEvent(e.rst)||!this.store.get("cmbopps")?this.xhr.send(a.stringify([e]),e.rst):this.opps.push(e))}},{key:"_setFireOppsInterval",value:function(){this.stopped||this.fireOppsInterval||(this.fireOpps=this._fireOpps.bind(this),this.fireOppsInterval=setInterval(this.fireOpps,this.store.get("timbtopps")))}},{key:"destroy",value:function(){this.stopped||(this._activateCallbacks("unloadCallbacks"),window.removeEventListener(this.unloadEventName,this._destroy),this.fireOppsInterval=clearInterval(this.fireOppsInterval),this._fireOpps(),this.stopped=!0,this.store&&this.store.destroy(),this.opps=this.store=this.fireOpps=this.xhr=this._destroy=void 0,d[this.redId]=void 0)}},{key:"_fireOpps",value:function(){this.stopped||(this._activateCallbacks("fireOppsCallbacks"),0<this.opps.length&&this.xhr.send(a.stringify(this.opps)),this.opps=[])}},{key:"_setFireOppsBeforeUnload",value:function(){this._destroy=this.destroy.bind(this),window.addEventListener(this.unloadEventName,this._destroy)}},{key:"_isBillableEvent",value:function(e){return-1<this.billableEvents.indexOf(""+e)}},{key:"OppsID",get:function(){return o}}]),h);function h(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);var i=this._getRedId(e)||this._getRedId(t)||"red_id";return d.hasOwnProperty(i)||(this.redId=i,this.store=new r(e,t),this.baseUrl=a.getOppsServletBaseUrl(this.store),this.xhr=new n(this.baseUrl,this.store.get("psthdrs")),this.opps=[],this.fireOppsInterval=null,this.stopped=!1,this.billableEvents=(this.store.get("bllblevt")||"").split(","),this.unloadCallbacks=[],this.fireOppsCallbacks=[],this._setFireOppsInterval(),this.unloadEventName=a.isOnIOS()?"pagehide":"beforeunload",this._setFireOppsBeforeUnload(),d[i]=this),d[i]}function l(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=s},"./src/store.js":function(e,t,i){"use strict";var s=function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e},s=(i("./src/utils.js"),s(a,[{key:"get",value:function(e){return this._getFromPlayerModel(e)}},{key:"_getFromPlayerModel",value:function(e){var t=this.playerModel?this.playerModel.get(e):void 0;return void 0!==t?t:this._getFromUnitModel(e)}},{key:"_getFromUnitModel",value:function(e){var t=this.unitModel?this.unitModel.get(e):void 0;return void 0!==t?t:this._getFromData(e)}},{key:"_getFromData",value:function(e){return-1===(e=e.toString()).indexOf(".")?this.data[e]:n.get(e,!1,this.data)}},{key:"set",value:function(e,t){e=e.toString(),n.set(e,t,this.data)}},{key:"destroy",value:function(){this.unitModel=this.playerModel=this.data=void 0}}]),a),n={set:function(e,t,i){var s=e.split("."),e=s.pop(),i=r(s,!0,i);return i&&e?i[e]=t:void 0},get:function(e,t,i){return r(e.split("."),t,i)},exists:function(e,t){return void 0!==this.get(e,!1,t)}};function r(e,t,i){for(var s,n=i||data,r=0;n&&(s=e[r]);r++)n=s in n?n[s]:t?n[s]={}:void 0;return n}function a(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,a),this.unitModel=e,this.playerModel=t,this.data={psthdrs:"application/json",timbtopps:2e3}}function o(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=s},"./src/utils.js":function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={getOppsServletBaseUrl:function(e){e=e.get("ms_data.opps_base_path");return this.setUrlPrefix(e)+(/.*\/$/g.test(e)?"":"/")+"OpportunityServlet"},setUrlPrefix:function(e){return"string"!=typeof e||0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e},stringify:function(e,t){try{var i=[];return JSON.stringify(e,function(e,t){if(null!=t&&"object"==(void 0===t?"undefined":s(t))){if(-1<i.indexOf(t))return;i.push(t)}return t},t)}catch(e){return""}},fireOpp:function(e){try{(new Image).src=e}catch(e){}},flattenParams:function(e){var t,i=[];for(t in e)i.push(t+"="+e[t]);return i.join("&")},isOnIOS:function(){return navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)}}},"./src/xhr.js":function(e,t,i){"use strict";var s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=(i("./src/utils.js"),s(r,[{key:"_onFail",value:function(){this.gotResponse||(this.gotResponse=!0)}},{key:"send",value:function(e,t){if(this.baseUrl){var i=this.baseUrl+(void 0!==t?"?rst="+t:""),t=new XMLHttpRequest;return t.open((e=e||"")?"POST":"GET",i,!0),t.withCredentials=this.withCredentials,t.setRequestHeader("Content-type",this.contentType),t.async=this.async,t.timeout=this.timeout,t.gotResponse=!1,t.addEventListener("error",this._onFail),t.addEventListener("abort",this._onFail),t.addEventListener("timeout",this._onFail),t.addEventListener("readystatechange",function(e){4==this.readyState&&(this.gotResponse||(this.gotResponse=!0))}),t.send(e),!0}}}]),r);function r(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,s=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.baseUrl=e,this.async=null==i||i,this.withCredentials=null==s||s,this.timeout=n||5e3,this.contentType=t||"application/x-www-form-urlencoded"}function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=s},0:function(e,t,i){e.exports=i("./src/index.js")}})},function(e,t){var i=i||{};i.dSettings={wirewax:{adtnlscrpts:[{src:"//edge-player.wirewax.com/ww4release/javascripts/wirewax-iframe-api.js",clbk:function(){try{for(var e in this.adUnit.unsubscribe(this.vpaidEvents.AdImpression,"*"),this.adUnit.unsubscribe(this.vpaidEvents.AdVideoComplete,"*"),this.adUnit._iframe.contentWindow.wirewax.events.listeners)this.adUnit._iframe.contentWindow.wirewax.addEventListener(this.adUnit._iframe.contentWindow.wirewax.events.listeners[e],this.onIframeEvent)}catch(e){}}}],ifrmevts:{playerReady:"AdImpression",videoEnd:"AdVideoComplete"},hdtrgt:!0,wtfradpsdbfrrsmad:!0,prvnterlyadimpopp:!0,onrsm:function(){this.adUnit._iframe.contentWindow.wirewax.playerId="wirewax-ad-iframe",this.adUnit._iframe.contentWindow.wirewax.triggerEvent(this.adUnit._iframe.contentWindow.wirewax.events.triggers.CLOSE_WIDGET)}},"the trade desk":{extwnprc:!0,wnprcfld:"wp"},dbm:{extwnprc:!0,wnprcfld:"pr"}},window.TRC=window.TRC||{},window.TRC.dsm=window.TRC.dsm||{},window.TRC.dsm[181]=i.dSettings},function(e,t){var i='function startProtection(o){window.ReportHijackAttempt=window.ReportHijackAttempt||function(){};var e="%%%TEMP%%%",r=new RegExp(e.map(function(e){try{return atob(e)}catch(t){return e}}).join("|"),"i");function p(t){return e.length&&r.test(t)}function i(t,e){window.ReportHijackAttempt(t,e)}function n(e){var r=function(){try{e.removeEventListener("load",r);var t=e.contentWindow.document.createElement("script");t.type="text/javascript",e.contentWindow.hjkFunc=t.innerHTML=window.hjkFunc,e.contentWindow.document.head.appendChild(t)}catch(t){}};e.addEventListener("load",r)}function c(t){if(t.src)return t.src;if(t.childNodes.length)for(var e=0;e<t.childNodes.length;e++)if(t.childNodes[e]&&t.childNodes[e].src)return t.childNodes[e].src;return t.outerHTML}try{!function(){for(var t=document.scripts||[],e=0;e<t.length;e++)t[e].src&&p(t[e].src);var r=document.querySelectorAll("iframe")||[];for(e=0;e<r.length;e++)if(p(r[e].src)){i(r[e].src,!0);break}}(),HTMLIFrameElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLIFrameElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src")),Object.defineProperty(HTMLIFrameElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):(n(this),this._src=t)}})),HTMLIFrameElement.prototype.hasOwnProperty("_setAttribute")||(HTMLIFrameElement.prototype._setAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):(n(this),this._setAttribute(t,e))}),HTMLElement.prototype.hasOwnProperty("_insertBefore")||(HTMLElement.prototype._insertBefore=HTMLElement.prototype.insertBefore,HTMLElement.prototype.insertBefore=function(t,e){if(!p(t.outerHTML))return this._insertBefore(t,e);i(c(t),!1)}),HTMLElement.prototype.hasOwnProperty("_appendChild")||(HTMLElement.prototype._appendChild=HTMLElement.prototype.appendChild,HTMLElement.prototype.appendChild=function(t){if(!p(t.outerHTML))return this._appendChild(t);i(c(t),!1)}),HTMLScriptElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLScriptElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src")),Object.defineProperty(HTMLScriptElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):this._src=t}})),HTMLScriptElement.prototype.hasOwnProperty("_setAttribute")||(HTMLScriptElement.prototype._setAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):this._setAttribute(t,e)}),HTMLObjectElement.prototype._scrollIntoView=HTMLObjectElement.prototype.scrollIntoView,HTMLObjectElement.prototype.scrollIntoView=function(){return!1},HTMLDivElement.prototype._scrollIntoView=HTMLDivElement.prototype.scrollIntoView,HTMLDivElement.prototype.scrollIntoView=function(){return!1},XMLHttpRequest.prototype.hasOwnProperty("_open")||(XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,e,r,o,n){p(e)?i(e,!1):this._open.apply(this,arguments)}),HTMLElement.prototype._click=HTMLElement.prototype.click,HTMLElement.prototype.click=function(){this.hasAttribute("download")||this._click()},o||(window.onerror=function(){return!0}),function(){if(!o){console=console||{};function t(){}for(var e=["debug","error","info","log","warn"],r=0;r<e.length;r++)console[e[r]]&&(console[e[r]]=t)}}()}catch(t){}}startProtection("%%%IS_DEBUG%%%");';try{HijackResponse(i)}catch(e){}window.TRC=window.TRC||{},window.TRC.hjk=window.TRC.hjk||{},window.TRC.hjk[226]=i},function(e,t){var i='!function(){function a(){for(var e=document.scripts||[],t=[],r=0;r<e.length;r++)t.push(e[r].src);return t}function c(e){for(var t=document.querySelectorAll("iframe"),r=[],i=0;i<t.length;i++)r.push(t[i].src),t[i].src&&"undefined"===t[i].src.substr(0,9)&&e&&e(url);return r}function e(e,t,r){var i,o,n=window._vaThis||this;if(window._vaThis?(i=a(),o=c(n._onUndefinedRelativeIframeSrcError),n.scripts=n.scripts.concat(i),n.iframes=n.iframes.concat(o),n.firstCount+=o.length+i.length):(n.data={},n.XHRUrls=[],n.XHRResponses=[],n.iframes=c(n._onUndefinedRelativeIframeSrcError),n.scripts=a(),n.firstCount=n.iframes.length+n.scripts.length,n.timeoutLength=r.timeout||3e3,n.callback=t,n.adImpressionEvent="AdImpression",n.networkCallCounter=0,n.maxNetworkCalls=r.maxNetworkCalls||!1,n.networkCallsLimitExceeded=!1,n.latencies=[],n.iframesWeights={gen:8,ggl:4,pxls:2},n.isVideoUrlPublic=void 0,n.requestId=0,n.requestStartTimes={},n.performance={},Object.defineProperty(n,"AnalyticsData",{get:function(){return n.data},enumerable:!0,configurable:!1}),e&&n.subscribeToAdImpression(e)),r&&(r.withXHR&&window.XMLHttpRequest&&this.createXMLHTTPHook(),r.withIframes&&void 0!==window.HTMLIFrameElement&&this.createIframesSrcHook(r),r.withScripts&&void 0!==window.HTMLScriptElement&&this.createScriptsSrcHook(),r.timeout&&(n.timeoutLength=r.timeout),r.iframesWeights))for(var s in r.iframesWeights)n.iframesWeights[s]=r.iframesWeights[s];window.destroyAnalyticsReporter=function(){n.data=n.XHRUrls=n.XHRResponses=n.iframes=n.scripts=n.timeoutLength=n.iframesWeights=n.requestStartTimes=void 0,window.getVpaidAnalyticsReport=window.destroyAnalyticsReporter=window.onNetworkCallsLimitExceeded=window.setIsVideoUrlPublic=void 0,window.AnalyticsReporter=void 0},window.getVpaidAnalyticsReport=function(){var e,t=window._vaThis||this,r=[],i={scripts:0<t.scripts.length?t.scripts.slice():a(),XHRUrls:t.XHRUrls.slice(),iframes:t.iframes.slice()},o={};for(e in i)r=r.concat(i[e]);i.totalRequests=r,i.totalRequestsCounter=r.length,i.firstCount=t.firstCount,i.latencies=t.latencies.slice();var n,s=i.latencies.reduce(function(e,t){return e+t},0);for(n in i.averageLatency=i.latencies.length?s/i.latencies.length:0,i.averageIntLatency=parseInt(i.averageLatency),t.performance)t.performance[n].start&&t.performance[n].stop&&(o[n]=t.performance[n].stop-t.performance[n].start);return i.performance=o,i}.bind(n),window.setIsVideoUrlPublic=function(e){(window._vaThis||this).isVideoUrlPublic=e}.bind(n),window.setPerformanceMeasurement=function(e,t){var r=window._vaThis||this;r.performance[e]||(r.performance[e]={}),r.performance[e][t]||(r.performance[e][t]=Date.now())}.bind(n)}(window.ignoreGetVpaidAd||"function"==typeof window.getVPAIDAd)&&function(){try{return window.self!==window.top}catch(e){return 1}}()&&(e.prototype.subscribeToAdImpression=function(e){var t=window._vaThis||this;e.subscribe(function(){t.adImpFired=!0,setTimeout(function(){t.sendData()},t.timeoutLength)},t.adImpressionEvent,t)},e.prototype.sendData=function(){var e=window._vaThis||this;e.collectData(e.adImpressionEvent),e.callback(e.adImpressionEvent,e.AnalyticsData)},e.prototype.collectData=function(e){var t=window._vaThis||this,r={};r.eventName=e,r.scripts=0<t.scripts.length?t.scripts.slice():a(),r.XHRUrls=t.XHRUrls.slice(),r.XHRResponses=t.XHRResponses.slice(),r.iframes=t.iframes.slice(),t.data[e]=r},e.prototype.onUrlHooked=function(e,t,r){var i=window._vaThis||this;i[e].push(t),r._id=i.requestId++,i.requestStartTimes[r._id]=Date.now();var o=function(){i.requestStartTimes.hasOwnProperty(this._id)&&(i.latencies.push(Date.now()-i.requestStartTimes[this._id]),delete i.requestStartTimes[this._id]),this.removeEventListener("load",o)}.bind(r);r.addEventListener("load",o),"iframes"!==e||void 0===i.isVideoUrlPublic?i.networkCallCounter++:i.networkCallCounter+=i.getIframeWeight(t),i.isMaxNetworkCallsLimitExceeded()&&i.onNetworkCallsLimitExceeded()},e.prototype.getIframeWeight=function(e){var t=window._vaThis||this;return e.indexOf("imasdk")?t.iframesWeights.ggl:t.isVideoUrlPublic?t.iframesWeights.pxls:t.iframesWeights.gen},e.prototype.createXMLHTTPHook=function(){var n=window._vaThis||this;window.XMLHttpRequest.prototype._vaOpen=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(e,t,r,i,o){return n.onUrlHooked("XHRUrls",t,this),this.addEventListener("load",function(){n.XHRResponses.push("load: "+this.responseText)}),window.XMLHttpRequest.prototype._vaOpen.apply(this,arguments)}},e.prototype.createIframesSrcHook=function(i){var o=window._vaThis||this;Object.defineProperty(HTMLIFrameElement.prototype,"_vaSrc",Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src"));function r(e,t){var r;o.onUrlHooked("iframes",e,t),e&&"undefined"===e.substr(0,9)&&o._onUndefinedRelativeIframeSrcError(e),i.deepIframes&&(r=function(){try{t.removeEventListener("load",r),t.contentWindow.ignoreGetVpaidAd=!0,t.contentWindow._vaThis=o;var e=t.contentWindow.document.createElement("script");e.innerText=o.vpaidAnalyticsFunc,t.contentWindow.document.head.appendChild(e),new t.contentWindow.AnalyticsReporter(null,function(){},i)}catch(e){}},t.addEventListener("load",r))}Object.defineProperty(HTMLIFrameElement.prototype,"src",{get:function(){return this._vaSrc},set:function(e){r(e,this),this._vaSrc=e}}),HTMLIFrameElement.prototype._vaSetAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(e,t){"src"===e&&r(t,this),this._vaSetAttribute(e,t)}},e.prototype.createScriptsSrcHook=function(){var r=window._vaThis||this;Object.defineProperty(HTMLScriptElement.prototype,"_vaSrc",Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src")),Object.defineProperty(HTMLScriptElement.prototype,"src",{get:function(){return this._vaSrc},set:function(e){r.onUrlHooked("scripts",e,this),this._vaSrc=e}}),HTMLScriptElement.prototype._vaSetAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(e,t){"src"===e&&r.onUrlHooked("scripts",t,this),this._vaSetAttribute(e,t)}},e.prototype.unHook=function(){var e=Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"_vaSrc"),t=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"_vaSrc");e&&(Object.defineProperty(HTMLIFrameElement.prototype,"src",e),HTMLIFrameElement.prototype.setAttribute=HTMLIFrameElement.prototype._vaSetAttribute),t&&(Object.defineProperty(HTMLIFrameElement.prototype,"src",t),HTMLScriptElement.prototype.setAttribute=HTMLScriptElement.prototype._vaSetAttribute),window.XMLHttpRequest.prototype._vaOpen&&(window.XMLHttpRequest.prototype.open=window.XMLHttpRequest.prototype._vaOpen)},e.prototype.onNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;e.networkCallsLimitExceeded||(e.adImpFired||e.unHook(),e.networkCallsLimitExceeded=!0,e.sendData(),window.onNetworkCallsLimitExceeded())},e.prototype.isMaxNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;return e.networkCallsLimitExceeded||e.maxNetworkCalls&&e.networkCallCounter>=e.maxNetworkCalls},window.AnalyticsReporter=e)}();';try{VpaidAnalytics(i)}catch(e){}window.TRC=window.TRC||{},window.TRC.vpaidAnalytics=window.TRC.vpaidAnalytics||{},window.TRC.vpaidAnalytics[34]=i},function(e,t){function n(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,s;s={},n.m=i=[function(e,t,i){"use strict";var s="object"==typeof Reflect?Reflect:null,d=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}((e.exports=a).EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,i,s){var n,r;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);return void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener||i),n=e._events),r=n[t]),void 0===r?(r=n[t]=i,++e._eventsCount):("function"==typeof r?r=n[t]=s?[i,r]:[r,i]:s?r.unshift(i):r.push(i),0<(i=h(e))&&r.length>i&&!r.warned&&(r.warned=!0,(i=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=r.length,console&&console.warn&&console.warn(i))),e}function u(e,t,i){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},t=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,d(this.listener,this.target,e))}.bind(e);return t.listener=i,e.wrapFn=t}function c(e,t,i){e=e._events;if(void 0===e)return[];t=e[t];return void 0===t?[]:"function"==typeof t?i?[t.listener||t]:[t]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(t):v(t,t.length)}function p(e){var t=this._events;if(void 0!==t){e=t[e];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function v(e,t){for(var i=new Array(t),s=0;s<t;++s)i[s]=e[s];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s,n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){if((s=0<t.length?t[0]:s)instanceof Error)throw s;n=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw n.context=s,n}e=r[e];if(void 0===e)return!1;if("function"==typeof e)d(e,this,t);else for(var a=e.length,o=v(e,a),i=0;i<a;++i)d(o[i],this,t);return!0},a.prototype.on=a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,u(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,u(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var i,s,n,r,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(s=this._events))return this;if(void 0===(i=s[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,r=i.length-1;0<=r;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,n=r;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(s[e]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",e,a||t)}return this},a.prototype.removeAllListeners=function(e){var t,i;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){for(var s,n=Object.keys(i),r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return c(this,e,!0)},a.prototype.rawListeners=function(e){return c(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return 0<this._eventsCount?n(this._events):[]}},function(e,t,i){e.exports=i(2)},function(e,t,i){"use strict";function n(t,i,e,s){var n="alt_"+i;t.hasOwnProperty(n)||(t[n]="",Object.defineProperty(t,i,{get:function(){return e?e():this[n]},set:function(e){this[n]=e,s&&s(e)&&t.setAttribute(i,e)}}))}function s(e){return void 0===e}i.r(t);var t=i(0),r="Android",a="Fire OS";function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var d=(o(i={},r,{"Chrome Mobile":53,Chromium:53,"Firefox Mobile":49,"Firefox Focus":49,Android:7,"Android Webkit":7,"Amazon Silk Browser":71,"Facebook on Android":void 0,"Opera Mobile":void 0,"Opera Mini":void 0,"MIUI Browser":void 0,"Yandex browser":void 0,"UC Browser":void 0,"Samsung Browser":void 0,Edge:void 0,Opera:void 0}),o(i,"iOS",{"Firefox on iOS":7}),o(i,a,{"Amazon Silk Browser":71}),i);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(f,t.EventEmitter),l(f.prototype,[{key:"isAutoplaySupported",value:function(){var e=this._isAutoplaySupportedByOS();e&&this.os===r&&(e=!this._isDataSaverOn()),this._emitDetectionResult(e)}},{key:"_isAutoplaySupportedByOS",value:function(){return this.os===r?this.isAutoplaySupportedAndroid():this.os===a?this.isAutoplaySupportedFireOS():"iOS"===this.os&&this.isAutoplaySupportedIOS()}},{key:"isAutoplaySupportedIOS",value:function(){if(this.osVersion<10)return!1;var e=this._isAutoplaySupportedOnBrowser(d.iOS);return!!s(e)||e}},{key:"_isAutoplaySupportedOnBrowser",value:function(e){if(e.hasOwnProperty(this.browserName))return s(e[this.browserName])||this.browserMajorVersion>=e[this.browserName]}},{key:"isAutoplaySupportedAndroid",value:function(){var e=this._isAutoplaySupportedOnBrowser(d[r]);return!s(e)&&e}},{key:"isAutoplaySupportedFireOS",value:function(){var e=this._isAutoplaySupportedOnBrowser(d[a]);return!s(e)&&e}},{key:"_isDataSaverOn",value:function(){return this.params.canvas.dataSaverServerSide}},{key:"_emitDetectionResult",value:function(e){this.emit("detectIsAutoplaySupported",e)}}]),f),v="content",i={decodeUrl:!1,secureMediaFiles:!1,isMobile:!1,autoplay:!0,userAgent:{},isMultiVpaidUnit:!1,logToBI:function(){},videoState:v,canvas:{onCanvasUsage:function(){},dataSaverServerSide:!1,dataSaverUrl:"//vidutils.taboola.com",disableWebGl:!1,parent:document.body,defaultVolume:.4,aspectRatio:"16:9",canvasLoadRate:5,mpegServerBaseUrl:"//mpg.taboola.com/getts?url",ignoreAutoplayDetection:!1,additionalCss:{},repeat:!1}};function f(e){var t,i;return function(e){if(!(e instanceof f))throw new TypeError("Cannot call a class as a function")}(this),t=this,(i=!(i=u(f).call(this))||"object"!==h(i)&&"function"!=typeof i?function(){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i).params=e,i.os=i.params.userAgent.os.name,i.osVersion=i.params.userAgent.os.version,i.browserName=i.params.userAgent.browser.name,i.browserMajorVersion=i.params.userAgent.browser.version,i}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var C={Player:null,VideoElement:null,BitBuffer:null,Source:{},Demuxer:{},Decoder:{},Renderer:{},AudioOutput:{},Now:function(){return window.performance?window.performance.now()/1e3:Date.now()/1e3},CreateVideoElements:function(){for(var e=document.querySelectorAll(".jsmpeg"),t=0;t<e.length;t++)new C.VideoElement(e[t])},Fill:function(e,t){if(e.fill)e.fill(t);else for(var i=0;i<e.length;i++)e[i]=t}};function g(e){var t=e.dataset.url;if(!t)throw"VideoElement has no `data-url` attribute";function i(e,t){for(var i in t)e.style[i]=t[i]}this.container=e,i(this.container,{display:"inline-block",position:"relative",minWidth:"80px",minHeight:"80px"}),this.canvas=document.createElement("canvas"),this.canvas.width=960,this.canvas.height=540,i(this.canvas,{display:"block",width:"100%"}),this.container.appendChild(this.canvas),this.playButton=document.createElement("div"),this.playButton.innerHTML=g.PLAY_BUTTON,i(this.playButton,{zIndex:2,position:"absolute",top:"0",bottom:"0",left:"0",right:"0",maxWidth:"75px",maxHeight:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.playButton);var s,n,r={canvas:this.canvas};for(s in e.dataset)try{r[s]=JSON.parse(e.dataset[s])}catch(t){r[s]=e.dataset[s]}this.player=new C.Player(t,r),!r.poster||r.autoplay||this.player.options.streaming||(r.decodeFirstFrame=!1,this.poster=new Image,this.poster.src=r.poster,this.poster.addEventListener("load",this.posterLoaded),i(this.poster,{display:"block",zIndex:1,position:"absolute",top:0,left:0,bottom:0,right:0}),this.container.appendChild(this.poster)),this.player.options.streaming||this.container.addEventListener("click",this.onClick.bind(this)),(r.autoplay||this.player.options.streaming)&&(this.playButton.style.display="none"),this.player.audioOut&&!this.player.audioOut.unlocked&&(n=this.container,(r.autoplay||this.player.options.streaming)&&(this.unmuteButton=document.createElement("div"),this.unmuteButton.innerHTML=g.UNMUTE_BUTTON,i(this.unmuteButton,{zIndex:2,position:"absolute",bottom:"10px",right:"20px",width:"75px",height:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.unmuteButton),n=this.unmuteButton),this.unlockAudioBound=this.onUnlockAudio.bind(this,n),n.addEventListener("touchstart",this.unlockAudioBound,!1),n.addEventListener("click",this.unlockAudioBound,!0))}function y(e,t){this.options=t||{},e.match(/^wss?:\/\//)?(this.source=new C.Source.WebSocket(e,t),t.streaming=!0):(!1!==t.progressive?this.source=new C.Source.AjaxProgressive(e,t):this.source=new C.Source.Ajax(e,t),t.streaming=!1),this.maxAudioLag=t.maxAudioLag||.25,this.loop=!1!==t.loop,this.autoplay=!!t.autoplay||t.streaming,this.onFinished=t.onfinished,this.demuxer=new C.Demuxer.TS(t),this.source.connect(this.demuxer),!1!==t.video&&(this.video=new C.Decoder.MPEG1Video(t),this.renderer=new(!t.disableGl&&C.Renderer.WebGL.IsSupported()?C.Renderer.WebGL:C.Renderer.Canvas2D)(t),this.demuxer.connect(C.Demuxer.TS.STREAM.VIDEO_1,this.video),this.video.connect(this.renderer)),!1!==t.audio&&C.AudioOutput.WebAudio.IsSupported()&&(this.audio=new C.Decoder.MP2Audio(t),this.audioOut=new C.AudioOutput.WebAudio(t),this.demuxer.connect(C.Demuxer.TS.STREAM.AUDIO_1,this.audio),this.audio.connect(this.audioOut)),Object.defineProperty(this,"currentTime",{get:this.getCurrentTime,set:this.setCurrentTime}),Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),(this.unpauseOnShow=!1)!==t.pauseWhenHidden&&document.addEventListener("visibilitychange",this.showHide.bind(this)),this.source.start(),this.autoplay&&this.play()}function b(e,t){"object"===m(e)?(this.bytes=e instanceof Uint8Array?e:new Uint8Array(e),this.byteLength=this.bytes.length):(this.bytes=new Uint8Array(e||1048576),this.byteLength=0),this.mode=t||b.MODE.EXPAND,this.index=0}function _(e,t){this.url=e,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.onReadyCblk=t.onload,this.errHandler=t.errHndlr}function w(e,t){this.url=e,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.fileSize=0,this.loadedSize=0,this.chunkSize=t.chunkSize||1048576,this.isLoading=!1,this.loadStartTime=0,this.throttled=!1!==t.throttled}function A(e,t){this.url=e,this.socket=null,this.callbacks={connect:[],data:[]},this.destination=null,this.reconnectInterval=t.reconnectInterval||5,this.shouldAttemptReconnect=!!this.reconnectInterval,this.completed=!1,this.established=!1,this.progress=0}function k(e){this.bits=null,this.leftoverBytes=null,this.guessVideoFrameEnd=!0,this.pidsToStreamIds={},this.pesPacketInfo={},this.startTime=0,this.currentTime=0}function T(e){this.destination=null,this.canPlay=!1,this.collectTimestamps=!e.streaming,this.timestamps=[],this.timestampIndex=0,this.startTime=0,this.decodedTime=0,Object.defineProperty(this,"currentTime",{get:this.getCurrentTime})}function E(e){C.Decoder.Base.call(this,e);var t=e.videoBufferSize||524288,i=e.streaming?C.BitBuffer.MODE.EVICT:C.BitBuffer.MODE.EXPAND;this.bits=new C.BitBuffer(t,i),this.customIntraQuantMatrix=new Uint8Array(64),this.customNonIntraQuantMatrix=new Uint8Array(64),this.blockData=new Int32Array(64),this.currentFrame=0,this.decodeFirstFrame=!1!==e.decodeFirstFrame}function P(e){C.Decoder.Base.call(this,e);var t=e.audioBufferSize||131072,e=e.streaming?C.BitBuffer.MODE.EVICT:C.BitBuffer.MODE.EXPAND;this.bits=new C.BitBuffer(t,e),this.left=new Float32Array(1152),this.right=new Float32Array(1152),this.sampleRate=44100,this.D=new Float32Array(1024),this.D.set(P.SYNTHESIS_WINDOW,0),this.D.set(P.SYNTHESIS_WINDOW,512),this.V=new Float32Array(1024),this.U=new Int32Array(32),this.VPos=0,this.allocation=[new Array(32),new Array(32)],this.scaleFactorInfo=[new Uint8Array(32),new Uint8Array(32)],this.scaleFactor=[new Array(32),new Array(32)],this.sample=[new Array(32),new Array(32)];for(var i=0;i<2;i++)for(var s=0;s<32;s++)this.scaleFactor[i][s]=[0,0,0],this.sample[i][s]=[0,0,0]}function V(e){this.canvas=e.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0;var t={preserveDrawingBuffer:!!e.preserveDrawingBuffer,alpha:!1,depth:!1,stencil:!1,antialias:!1};if(this.gl=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t),!this.gl)throw new Error("Failed to get WebGL Context");var i,s=this.gl,e=s.createBuffer(),t=new Float32Array([0,0,0,1,1,0,1,1]);s.bindBuffer(s.ARRAY_BUFFER,e),s.bufferData(s.ARRAY_BUFFER,t,s.STATIC_DRAW),this.program=this.createProgram(V.SHADER.VERTEX_IDENTITY,V.SHADER.FRAGMENT_YCRCB_TO_RGBA),i=s.getAttribLocation(this.program,"vertex"),s.enableVertexAttribArray(i),s.vertexAttribPointer(i,2,s.FLOAT,!1,0,0),this.textureY=this.createTexture(0,"textureY"),this.textureCb=this.createTexture(1,"textureCb"),this.textureCr=this.createTexture(2,"textureCr"),this.loadingProgram=this.createProgram(V.SHADER.VERTEX_IDENTITY,V.SHADER.FRAGMENT_LOADING),i=s.getAttribLocation(this.loadingProgram,"vertex"),s.enableVertexAttribArray(i),s.vertexAttribPointer(i,2,s.FLOAT,!1,0,0),this.shouldCreateUnclampedViews=!this.allowsClampedTextureData()}function S(e){this.canvas=e.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0,this.context=this.canvas.getContext("2d")}function D(e){this.context=D.CachedContext=D.CachedContext||new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.destination=this.gain,this.startTime=0,this.buffer=null,this.wallclockStartTime=0,this.volume=1,this.enabled=!0,this.unlocked=!D.NeedsUnlocking(),Object.defineProperty(this,"enqueuedTime",{get:this.getEnqueuedTime})}"complete"===document.readyState?C.CreateVideoElements():document.addEventListener("DOMContentLoaded",C.CreateVideoElements),C.VideoElement=(g.prototype.onUnlockAudio=function(e,t){this.unmuteButton&&(t.preventDefault(),t.stopPropagation()),this.player.audioOut.unlock(function(){this.unmuteButton&&(this.unmuteButton.style.display="none"),e.removeEventListener("touchstart",this.unlockAudioBound),e.removeEventListener("click",this.unlockAudioBound)}.bind(this))},g.prototype.onClick=function(e){this.player.isPlaying?(this.player.pause(),this.playButton.style.display="block"):(this.player.play(),this.playButton.style.display="none",this.poster&&(this.poster.style.display="none"))},g.PLAY_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 200 200" alt="Play video"><circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"/><polygon points="70, 55 70, 145 145, 100" fill="#fff"/></svg>',g.UNMUTE_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 75 75"><polygon class="audio-speaker" stroke="none" fill="#fff" points="39,13 22,28 6,28 6,47 21,47 39,62 39,13"/><g stroke="#fff" stroke-width="5"><path d="M 49,50 69,26"/><path d="M 69,50 49,26"/></g></svg>',g),C.Player=(y.prototype.showHide=function(e){"hidden"===document.visibilityState?(this.unpauseOnShow=this.wantsToPlay,this.pause()):this.unpauseOnShow&&this.play()},y.prototype.play=function(e){this.isPlaying=!0,this.startTime=C.Now()-this.currentTime,this.animationId=requestAnimationFrame(this.update.bind(this)),this.wantsToPlay=!0},y.prototype.pause=function(e){cancelAnimationFrame(this.animationId),this.wantsToPlay=!1,this.isPlaying=!1,this.audio&&this.audio.canPlay&&(this.audioOut.stop(),this.seek(this.currentTime))},y.prototype.getVolume=function(){return this.audioOut?this.audioOut.volume:0},y.prototype.setVolume=function(e){this.audioOut&&(this.audioOut.volume=e)},y.prototype.stop=function(e){this.pause(),this.seek(0),this.video&&!1!==this.options.decodeFirstFrame&&this.video.decode()},y.prototype.seek=function(e){var t=(this.audio&&this.audio.canPlay?this.audio:this.video).startTime;this.video&&this.video.seek(e+t),this.audio&&this.audio.seek(e+t),this.startTime=C.Now()-e},y.prototype.getCurrentTime=function(){return this.audio&&this.audio.canPlay?this.audio.currentTime-this.audio.startTime:this.video.currentTime-this.video.startTime},y.prototype.setCurrentTime=function(e){this.seek(e)},y.prototype.update=function(){this.isPlaying&&(this.animationId=requestAnimationFrame(this.update.bind(this)),this.source.established?this.options.streaming?this.updateForStreaming():this.updateForStaticFile():this.renderer&&this.renderer.renderProgress(this.source.progress))},y.prototype.updateForStreaming=function(){if(this.video&&this.video.decode(),this.audio){for(;this.audioOut.enqueuedTime>this.maxAudioLag&&(this.audioOut.resetEnqueuedTime(),this.audioOut.enabled=!1),this.audio.decode(););this.audioOut.enabled=!0}},y.prototype.updateForStaticFile=function(){var e,t,i,s=this,n=!1,r=0;if(this.audio&&this.audio.canPlay){for(;!n&&this.audio.decodedTime-this.audio.currentTime<.25;)n=!this.audio.decode();this.video&&this.video.currentTime<this.audio.currentTime&&(n=!this.video.decode()),r=this.demuxer.currentTime-this.audio.currentTime}else this.video&&(t=(e=C.Now()-this.startTime+this.video.startTime)-this.video.currentTime,i=1/this.video.frameRate,this.video&&0<t&&(2*i<t&&(this.startTime+=t),n=!this.video.decode()),r=this.demuxer.currentTime-e);this.source.resume(r),n&&this.source.completed&&(this.loop?this.seek(0):(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){s.onFinished()},500),this.pause()))},y),C.BitBuffer=(b.prototype.resize=function(e){var t=new Uint8Array(e);0!==this.byteLength&&(this.byteLength=Math.min(this.byteLength,e),t.set(this.bytes,0,this.byteLength)),this.bytes=t,this.index=Math.min(this.index,this.byteLength<<3)},b.prototype.evict=function(e){var t=this.index>>3,i=this.bytes.length-this.byteLength;if(this.index===this.byteLength<<3||i+t<e)return this.byteLength=0,void(this.index=0);0!=t&&(this.bytes.copyWithin?this.bytes.copyWithin(0,t,this.byteLength):this.bytes.set(this.bytes.subarray(t,this.byteLength)),this.byteLength=this.byteLength-t,this.index-=t<<3)},b.prototype.write=function(e){var t="object"===m(e[0]),i=0,s=this.bytes.length-this.byteLength;if(t)for(var n=i=0;n<e.length;n++)i+=e[n].byteLength;else i=e.byteLength;if(s<i&&(this.mode===b.MODE.EXPAND?(s=Math.max(2*this.bytes.length,i-s),this.resize(s)):this.evict(i)),t)for(n=0;n<e.length;n++)this.appendSingleBuffer(e[n]);else this.appendSingleBuffer(e)},b.prototype.appendSingleBuffer=function(e){e=e instanceof Uint8Array?e:new Uint8Array(e),this.bytes.set(e,this.byteLength),this.byteLength+=e.length},b.prototype.findNextStartCode=function(){for(var e=this.index+7>>3;e<this.byteLength;e++)if(0==this.bytes[e]&&0==this.bytes[e+1]&&1==this.bytes[e+2])return this.index=e+4<<3,this.bytes[e+3];return this.index=this.byteLength<<3,-1},b.prototype.findStartCode=function(e){for(var t;;)if((t=this.findNextStartCode())===e||-1===t)return t;return-1},b.prototype.nextBytesAreStartCode=function(){var e=this.index+7>>3;return e>=this.byteLength||0==this.bytes[e]&&0==this.bytes[1+e]&&1==this.bytes[2+e]},b.prototype.peek=function(e){for(var t=this.index,i=0;e;){var s=8-(7&t),n=s<e?s:e,s=s-n,i=i<<n|(this.bytes[t>>3]&255>>8-n<<s)>>s;t+=n,e-=n}return i},b.prototype.read=function(e){var t=this.peek(e);return this.index+=e,t},b.prototype.skip=function(e){return this.index+=e},b.prototype.rewind=function(e){this.index=Math.max(this.index-e,0)},b.prototype.has=function(e){return(this.byteLength<<3)-this.index>=e},b.MODE={EVICT:1,EXPAND:2},b),C.Source.Ajax=(_.prototype.connect=function(e){this.destination=e},_.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200===this.request.status&&(this.onLoad(this.request.response),this.onReadyCblk()),500!==this.request.status&&502!==this.request.status||this.errHandler({err:"error status ".concat(this.request.status," received for url:").concat(this.url)})}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("GET",this.url),this.request.responseType="arraybuffer",this.request.send()},_.prototype.resume=function(e){},_.prototype.abort=function(){this.request.abort()},_.prototype.onProgress=function(e){this.progress=e.loaded/e.total},_.prototype.onLoad=function(e){this.established=!0,this.completed=!0,this.progress=1,this.destination&&this.destination.write(e)},_),C.Source.AjaxProgressive=(w.prototype.connect=function(e){this.destination=e},w.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&(this.fileSize=parseInt(this.request.getResponseHeader("Content-Length")),this.loadNextChunk())}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("HEAD",this.url),this.request.send()},w.prototype.resume=function(e){!this.isLoading&&this.throttled&&e<8*this.loadTime+2&&this.loadNextChunk()},w.prototype.abort=function(){this.request.abort()},w.prototype.loadNextChunk=function(){var e=this.loadedSize,t=Math.min(this.loadedSize+this.chunkSize-1,this.fileSize-1);e>=this.fileSize?this.completed=!0:(this.isLoading=!0,this.loadStartTime=C.Now(),this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200<=this.request.status&&this.request.status<300?this.onChunkLoad(this.request.response):this.request.readyState===this.request.DONE&&this.loadFails++<3&&this.loadNextChunk()}.bind(this),0===e&&(this.request.onprogress=this.onProgress.bind(this)),this.request.open("GET",this.url+"?"+e+"-"+t),this.request.setRequestHeader("Range","bytes="+e+"-"+t),this.request.responseType="arraybuffer",this.request.send())},w.prototype.onProgress=function(e){this.progress=e.loaded/e.total},w.prototype.onChunkLoad=function(e){this.established=!0,this.progress=1,this.loadedSize+=e.byteLength,this.loadFails=0,this.isLoading=!1,this.destination&&this.destination.write(e),this.loadTime=C.Now()-this.loadStartTime,this.throttled||this.loadNextChunk()},w),C.Source.WebSocket=(A.prototype.connect=function(e){this.destination=e},A.prototype.abort=function(){this.shouldAttemptReconnect=!1,this.socket.close()},A.prototype.start=function(){this.shouldAttemptReconnect=!!this.reconnectInterval,this.progress=0,this.established=!1,this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onmessage=this.onMessage.bind(this),this.socket.onopen=this.onOpen.bind(this),this.socket.onerror=this.onClose.bind(this),this.socket.onclose=this.onClose.bind(this)},A.prototype.resume=function(e){},A.prototype.onOpen=function(){this.progress=1,this.established=!0},A.prototype.onClose=function(){this.shouldAttemptReconnect&&setTimeout(function(){this.start()}.bind(this),1e3*this.reconnectInterval)},A.prototype.onMessage=function(e){this.destination&&this.destination.write(e.data)},A),C.Demuxer.TS=(k.prototype.connect=function(e,t){this.pesPacketInfo[e]={destination:t,currentLength:0,totalLength:0,pts:0,buffers:[]}},k.prototype.write=function(e){var t;for(this.leftoverBytes?(t=e.byteLength+this.leftoverBytes.byteLength,this.bits=new C.BitBuffer(t),this.bits.write([this.leftoverBytes,e])):this.bits=new C.BitBuffer(e);this.bits.has(1504);)this.parsePacket();e=this.bits.byteLength-(this.bits.index>>3);this.leftoverBytes=0<e?this.bits.bytes.subarray(this.bits.index>>3):null},k.prototype.parsePacket=function(){var e=188+(this.bits.index>>3);if(71!==this.bits.read(8))throw"Sync Token not found";this.bits.read(1);var t,i,s,n,r,a,o,d=this.bits.read(1),h=(this.bits.read(1),this.bits.read(13)),l=(this.bits.read(2),this.bits.read(2)),u=(this.bits.read(4),this.pidsToStreamIds[h]);d&&u&&(o=this.pesPacketInfo[u])&&o.currentLength&&this.packetComplete(o),1&l&&(2&l&&(r=this.bits.read(8),this.bits.skip(r<<3)),d&&this.bits.nextBytesAreStartCode()&&(this.bits.skip(24),u=this.bits.read(8),this.pidsToStreamIds[h]=u,t=this.bits.read(16),this.bits.skip(8),a=this.bits.read(2),this.bits.skip(6),i=this.bits.read(8),s=this.bits.index+(i<<3),(o=this.pesPacketInfo[u])&&(n=0,2&a&&(this.bits.skip(4),r=this.bits.read(3),this.bits.skip(1),h=this.bits.read(15),this.bits.skip(1),a=this.bits.read(15),this.bits.skip(1),this.currentTime=n=(1073741824*r+32768*h+a)/9e4,-1===this.startTime&&(this.startTime=n)),this.packetStart(o,n,t?t-i-3:0)),this.bits.index=s),u&&(o=this.pesPacketInfo[u])&&(u=this.bits.index>>3,l=!d&&2&l,(this.packetAddData(o,u,e)||this.guessVideoFrameEnd&&l)&&this.packetComplete(o))),this.bits.index=e<<3},k.prototype.packetStart=function(e,t,i){e.totalLength=i,e.currentLength=0,e.pts=t},k.prototype.packetAddData=function(e,t,i){return e.buffers.push(this.bits.bytes.subarray(t,i)),e.currentLength+=i-t,0!==e.totalLength&&e.currentLength>=e.totalLength},k.prototype.packetComplete=function(e){e.destination.write(e.pts,e.buffers),e.totalLength=0,e.currentLength=0,e.buffers=[]},k.STREAM={PACK_HEADER:186,SYSTEM_HEADER:187,PROGRAM_MAP:188,PRIVATE_1:189,PADDING:190,PRIVATE_2:191,AUDIO_1:192,VIDEO_1:224,DIRECTORY:255},k),C.Decoder.Base=(T.prototype.connect=function(e){this.destination=e},T.prototype.write=function(e,t){this.collectTimestamps&&(0===this.timestamps.length&&(this.startTime=e,this.decodedTime=e),this.timestamps.push({index:this.bits.byteLength<<3,time:e})),this.bits.write(t),this.canPlay=!0},T.prototype.seek=function(e){if(this.collectTimestamps){for(var t=this.timestampIndex=0;t<this.timestamps.length&&!(this.timestamps[t].time>e);t++)this.timestampIndex=t;var i=this.timestamps[this.timestampIndex];i?(this.bits.index=i.index,this.decodedTime=i.time):(this.bits.index=0,this.decodedTime=this.startTime)}},T.prototype.decode=function(){this.advanceDecodedTime(0)},T.prototype.advanceDecodedTime=function(e){if(this.collectTimestamps){for(var t=-1,i=this.timestampIndex;i<this.timestamps.length&&!(this.timestamps[i].index>this.bits.index);i++)t=i;if(-1!==t&&t!==this.timestampIndex)return this.timestampIndex=t,void(this.decodedTime=this.timestamps[this.timestampIndex].time)}this.decodedTime+=e},T.prototype.getCurrentTime=function(){return this.decodedTime},T),C.Decoder.MPEG1Video=(((E.prototype=Object.create(C.Decoder.Base.prototype)).constructor=E).prototype.write=function(e,t){if(C.Decoder.Base.prototype.write.call(this,e,t),!this.hasSequenceHeader){if(-1===this.bits.findStartCode(E.START.SEQUENCE))return!1;this.decodeSequenceHeader(),this.decodeFirstFrame&&this.decode()}},E.prototype.decode=function(){return!!this.hasSequenceHeader&&(-1!==this.bits.findStartCode(E.START.PICTURE)?(this.decodePicture(),this.advanceDecodedTime(1/this.frameRate),!0):(this.bits.byteLength,this.bits.index,!1))},E.prototype.readHuffman=function(e){for(var t=0;0<=(t=e[t+this.bits.read(1)])&&0!==e[t];);return e[t+2]},E.prototype.frameRate=30,E.prototype.decodeSequenceHeader=function(){var e=this.bits.read(12),t=this.bits.read(12);if(this.bits.skip(4),this.frameRate=E.PICTURE_RATE[this.bits.read(4)],this.bits.skip(30),e===this.width&&t===this.height||(this.width=e,this.height=t,this.initBuffers(),this.destination&&this.destination.resize(e,t)),this.bits.read(1)){for(var i=0;i<64;i++)this.customIntraQuantMatrix[E.ZIG_ZAG[i]]=this.bits.read(8);this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.bits.read(1)){for(i=0;i<64;i++){var s=E.ZIG_ZAG[i];this.customNonIntraQuantMatrix[s]=this.bits.read(8)}this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}this.hasSequenceHeader=!0},E.prototype.initBuffers=function(){this.intraQuantMatrix=E.DEFAULT_INTRA_QUANT_MATRIX,this.nonIntraQuantMatrix=E.DEFAULT_NON_INTRA_QUANT_MATRIX,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.currentY=new Uint8ClampedArray(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new Uint8ClampedArray(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new Uint8ClampedArray(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new Uint8ClampedArray(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new Uint8ClampedArray(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new Uint8ClampedArray(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer)},E.prototype.currentY=null,E.prototype.currentCr=null,E.prototype.currentCb=null,E.prototype.pictureType=0,E.prototype.forwardY=null,E.prototype.forwardCr=null,E.prototype.forwardCb=null,E.prototype.fullPelForward=!1,E.prototype.forwardFCode=0,E.prototype.forwardRSize=0,E.prototype.forwardF=0,E.prototype.decodePicture=function(e){if(this.currentFrame++,this.bits.skip(10),this.pictureType=this.bits.read(3),this.bits.skip(16),!(this.pictureType<=0||this.pictureType>=E.PICTURE_TYPE.B)){if(this.pictureType===E.PICTURE_TYPE.PREDICTIVE){if(this.fullPelForward=this.bits.read(1),this.forwardFCode=this.bits.read(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}for(var t,i,s,n,r,a,o=0;(o=this.bits.findNextStartCode())===E.START.EXTENSION||o===E.START.USER_DATA;);for(;o>=E.START.SLICE_FIRST&&o<=E.START.SLICE_LAST;)this.decodeSlice(255&o),o=this.bits.findNextStartCode();-1!==o&&this.bits.rewind(32),this.destination&&this.destination.render(this.currentY,this.currentCr,this.currentCb),this.pictureType!==E.PICTURE_TYPE.INTRA&&this.pictureType!==E.PICTURE_TYPE.PREDICTIVE||(t=this.forwardY,i=this.forwardY32,s=this.forwardCr,n=this.forwardCr32,r=this.forwardCb,a=this.forwardCb32,this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=t,this.currentY32=i,this.currentCr=s,this.currentCr32=n,this.currentCb=r,this.currentCb32=a)}},E.prototype.quantizerScale=0,E.prototype.sliceBegin=!1,E.prototype.decodeSlice=function(e){for(this.sliceBegin=!0,this.macroblockAddress=(e-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.bits.read(5);this.bits.read(1);)this.bits.skip(8);for(;this.decodeMacroblock(),!this.bits.nextBytesAreStartCode(););},E.prototype.macroblockAddress=0,E.prototype.mbRow=0,E.prototype.mbCol=0,E.prototype.macroblockType=0,E.prototype.macroblockIntra=!1,E.prototype.macroblockMotFw=!1,E.prototype.motionFwH=0,E.prototype.motionFwV=0,E.prototype.motionFwHPrev=0,E.prototype.motionFwVPrev=0,E.prototype.decodeMacroblock=function(){for(var e=0,t=this.readHuffman(E.MACROBLOCK_ADDRESS_INCREMENT);34===t;)t=this.readHuffman(E.MACROBLOCK_ADDRESS_INCREMENT);for(;35===t;)e+=33,t=this.readHuffman(E.MACROBLOCK_ADDRESS_INCREMENT);if(e+=t,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=e;else{if(this.macroblockAddress+e>=this.mbSize)return;for(1<e&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureType===E.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));1<e;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),e--;this.macroblockAddress++}this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth;var i=E.MACROBLOCK_TYPE[this.pictureType];this.macroblockType=this.readHuffman(i),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!=(16&this.macroblockType)&&(this.quantizerScale=this.bits.read(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb));for(var s=0!=(2&this.macroblockType)?this.readHuffman(E.CODE_BLOCK_PATTERN):this.macroblockIntra?63:0,n=0,r=32;n<6;n++)0!=(s&r)&&this.decodeBlock(n),r>>=1},E.prototype.decodeMotionVectors=function(){var e,t,i=0;this.macroblockMotFw?(0!==(e=this.readHuffman(E.MOTION))&&1!==this.forwardF?(i=this.bits.read(this.forwardRSize),t=(Math.abs(e)-1<<this.forwardRSize)+i+1,e<0&&(t=-t)):t=e,this.motionFwHPrev+=t,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),0!==(e=this.readHuffman(E.MOTION))&&1!==this.forwardF?(i=this.bits.read(this.forwardRSize),t=(Math.abs(e)-1<<this.forwardRSize)+i+1,e<0&&(t=-t)):t=e,this.motionFwVPrev+=t,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureType===E.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},E.prototype.copyMacroblock=function(e,t,i,s,n){var r,a,o,d,h,l,u,c,p,v,f,m,g=this.currentY32,y=this.currentCb32,b=this.currentCr32,_=(r=this.codedWidth)-16,w=e>>1,A=t>>1,k=1==(1&e),T=1==(1&t),C=((this.mbRow<<4)+A)*r+(this.mbCol<<4)+w,E=(a=this.mbRow*r+this.mbCol<<2)+(r<<2);if(k)if(T)for(;a<E;){for(d=i[C]+i[C+r],C++,o=0;o<4;o++)l=d+(h=i[C]+i[C+r])+2>>2&255,l|=(d=i[++C]+i[C+r])+h+2<<6&65280,l|=d+(h=i[++C]+i[C+r])+2<<14&16711680,d=i[++C]+i[C+r],C++,l|=d+h+2<<22&4278190080,g[a++]=l;a+=_>>2,C+=_-1}else for(;a<E;){for(d=i[C++],o=0;o<4;o++)l=d+(h=i[C++])+1>>1&255,l|=(d=i[C++])+h+1<<7&65280,l|=d+(h=i[C++])+1<<15&16711680,l|=(d=i[C++])+h+1<<23&4278190080,g[a++]=l;a+=_>>2,C+=_-1}else if(T)for(;a<E;){for(o=0;o<4;o++)l=i[C]+i[C+r]+1>>1&255,l|=i[++C]+i[C+r]+1<<7&65280,l|=i[++C]+i[C+r]+1<<15&16711680,l|=i[++C]+i[C+r]+1<<23&4278190080,C++,g[a++]=l;a+=_>>2,C+=_}else for(;a<E;){for(o=0;o<4;o++)l=i[C],l|=i[++C]<<8,l|=i[++C]<<16,l|=i[++C]<<24,C++,g[a++]=l;a+=_>>2,C+=_}if(_=(r=this.halfWidth)-8,T=1==(t/2&1),C=((this.mbRow<<3)+(t/2>>1))*r+(this.mbCol<<3)+(e/2>>1),E=(a=this.mbRow*r+this.mbCol<<1)+(r<<1),1==(e/2&1))if(T)for(;a<E;){for(u=s[C]+s[C+r],v=n[C]+n[C+r],C++,o=0;o<2;o++)p=u+(c=s[C]+s[C+r])+2>>2&255,m=v+(f=n[C]+n[C+r])+2>>2&255,p|=(u=s[++C]+s[C+r])+c+2<<6&65280,m|=(v=n[C]+n[C+r])+f+2<<6&65280,p|=u+(c=s[++C]+s[C+r])+2<<14&16711680,m|=v+(f=n[C]+n[C+r])+2<<14&16711680,u=s[++C]+s[C+r],v=n[C]+n[C+r],C++,p|=u+c+2<<22&4278190080,m|=v+f+2<<22&4278190080,b[a]=p,y[a]=m,a++;a+=_>>2,C+=_-1}else for(;a<E;){for(u=s[C],v=n[C],C++,o=0;o<2;o++)p=u+(c=s[C])+1>>1&255,m=v+(f=n[C++])+1>>1&255,p|=(u=s[C])+c+1<<7&65280,m|=(v=n[C++])+f+1<<7&65280,p|=u+(c=s[C])+1<<15&16711680,m|=v+(f=n[C++])+1<<15&16711680,p|=(u=s[C])+c+1<<23&4278190080,m|=(v=n[C++])+f+1<<23&4278190080,b[a]=p,y[a]=m,a++;a+=_>>2,C+=_-1}else if(T)for(;a<E;){for(o=0;o<2;o++)p=s[C]+s[C+r]+1>>1&255,m=n[C]+n[C+r]+1>>1&255,p|=s[++C]+s[C+r]+1<<7&65280,m|=n[C]+n[C+r]+1<<7&65280,p|=s[++C]+s[C+r]+1<<15&16711680,m|=n[C]+n[C+r]+1<<15&16711680,p|=s[++C]+s[C+r]+1<<23&4278190080,m|=n[C]+n[C+r]+1<<23&4278190080,C++,b[a]=p,y[a]=m,a++;a+=_>>2,C+=_}else for(;a<E;){for(o=0;o<2;o++)p=s[C],m=n[C],p|=s[++C]<<8,m|=n[C]<<8,p|=s[++C]<<16,m|=n[C]<<16,p|=s[++C]<<24,m|=n[C]<<24,C++,b[a]=p,y[a]=m,a++;a+=_>>2,C+=_}},E.prototype.dcPredictorY=0,E.prototype.dcPredictorCr=0,E.prototype.dcPredictorCb=0,E.prototype.blockData=null,E.prototype.decodeBlock=function(e){var t,i,s,n,r=0;this.macroblockIntra?(0<(s=e<4?(i=this.dcPredictorY,this.readHuffman(E.DCT_DC_SIZE_LUMINANCE)):(i=4===e?this.dcPredictorCr:this.dcPredictorCb,this.readHuffman(E.DCT_DC_SIZE_CHROMINANCE)))?(n=this.bits.read(s),this.blockData[0]=0!=(n&1<<s-1)?i+n:i+(-1<<s|n+1)):this.blockData[0]=i,e<4?this.dcPredictorY=this.blockData[0]:4===e?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,t=this.intraQuantMatrix,r=1):t=this.nonIntraQuantMatrix;for(var a,o,d,h=0;;){var l=0,u=this.readHuffman(E.DCT_COEFF);if(1===u&&0<r&&0===this.bits.read(1))break;65535===u?(l=this.bits.read(6),0===(h=this.bits.read(8))?h=this.bits.read(8):128===h?h=this.bits.read(8)-256:128<h&&(h-=256)):(l=u>>8,h=255&u,this.bits.read(1)&&(h=-h));l=E.ZIG_ZAG[r+=l];r++,h<<=1,this.macroblockIntra||(h+=h<0?-1:1),0==(1&(h=h*this.quantizerScale*t[l]>>4))&&(h-=0<h?1:-1),2047<h?h=2047:h<-2048&&(h=-2048),this.blockData[l]=h*E.PREMULTIPLIER_MATRIX[l]}e<4?(a=this.currentY,d=this.codedWidth-8,o=this.mbRow*this.codedWidth+this.mbCol<<4,0!=(1&e)&&(o+=8),0!=(2&e)&&(o+=this.codedWidth<<3)):(a=4===e?this.currentCb:this.currentCr,d=(this.codedWidth>>1)-8,o=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===r?(E.CopyValueToDestination(this.blockData[0]+128>>8,a,o,d),this.blockData[0]=0):(E.IDCT(this.blockData),E.CopyBlockToDestination(this.blockData,a,o,d),C.Fill(this.blockData,0)):1===r?(E.AddValueToDestination(this.blockData[0]+128>>8,a,o,d),this.blockData[0]=0):(E.IDCT(this.blockData),E.AddBlockToDestination(this.blockData,a,o,d),C.Fill(this.blockData,0)),r=0},E.CopyBlockToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]=e[n+0],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=e[n+3],t[i+4]=e[n+4],t[i+5]=e[n+5],t[i+6]=e[n+6],t[i+7]=e[n+7]},E.AddBlockToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]+=e[n+0],t[i+1]+=e[n+1],t[i+2]+=e[n+2],t[i+3]+=e[n+3],t[i+4]+=e[n+4],t[i+5]+=e[n+5],t[i+6]+=e[n+6],t[i+7]+=e[n+7]},E.CopyValueToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]=e,t[i+1]=e,t[i+2]=e,t[i+3]=e,t[i+4]=e,t[i+5]=e,t[i+6]=e,t[i+7]=e},E.AddValueToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]+=e,t[i+1]+=e,t[i+2]+=e,t[i+3]+=e,t[i+4]+=e,t[i+5]+=e,t[i+6]+=e,t[i+7]+=e},E.IDCT=function(e){for(var t,i,s,n,r,a,o,d,h,l,u,c,p,v,f,m,g,y,b=0;b<8;++b)t=e[32+b],i=e[16+b]+e[48+b],s=e[40+b]-e[24+b],a=e[8+b]+e[56+b],o=e[24+b]+e[40+b],h=(p=(473*(n=e[8+b]-e[56+b])-196*s+128>>8)-(r=a+o))-(362*(a-o)+128>>8),v=(l=(d=e[0+b])-t)+(u=(362*(e[16+b]-e[48+b])+128>>8)-i),f=(c=d+t)+i,m=l-u,g=c-i,y=-h-(473*s+196*n+128>>8),e[0+b]=r+f,e[8+b]=p+v,e[16+b]=m-h,e[24+b]=g-y,e[32+b]=g+y,e[40+b]=h+m,e[48+b]=v-p,e[56+b]=f-r;for(b=0;b<64;b+=8)t=e[4+b],i=e[2+b]+e[6+b],s=e[5+b]-e[3+b],a=e[1+b]+e[7+b],o=e[3+b]+e[5+b],h=(p=(473*(n=e[1+b]-e[7+b])-196*s+128>>8)-(r=a+o))-(362*(a-o)+128>>8),v=(l=(d=e[0+b])-t)+(u=(362*(e[2+b]-e[6+b])+128>>8)-i),f=(c=d+t)+i,m=l-u,g=c-i,y=-h-(473*s+196*n+128>>8),e[0+b]=r+f+128>>8,e[1+b]=p+v+128>>8,e[2+b]=m-h+128>>8,e[3+b]=g-y+128>>8,e[4+b]=g+y+128>>8,e[5+b]=h+m+128>>8,e[6+b]=v-p+128>>8,e[7+b]=f-r+128>>8},E.PICTURE_RATE=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],E.ZIG_ZAG=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),E.DEFAULT_INTRA_QUANT_MATRIX=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),E.DEFAULT_NON_INTRA_QUANT_MATRIX=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),E.PREMULTIPLIER_MATRIX=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),E.MACROBLOCK_ADDRESS_INCREMENT=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),E.MACROBLOCK_TYPE_INTRA=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),E.MACROBLOCK_TYPE_PREDICTIVE=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),E.MACROBLOCK_TYPE_B=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),E.MACROBLOCK_TYPE=[null,E.MACROBLOCK_TYPE_INTRA,E.MACROBLOCK_TYPE_PREDICTIVE,E.MACROBLOCK_TYPE_B],E.CODE_BLOCK_PATTERN=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),E.MOTION=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),E.DCT_DC_SIZE_LUMINANCE=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),E.DCT_DC_SIZE_CHROMINANCE=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),E.DCT_COEFF=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),E.PICTURE_TYPE={INTRA:1,PREDICTIVE:2,B:3},E.START={SEQUENCE:179,SLICE_FIRST:1,SLICE_LAST:175,PICTURE:0,EXTENSION:181,USER_DATA:178},E),C.Decoder.MP2Audio=(((P.prototype=Object.create(C.Decoder.Base.prototype)).constructor=P).prototype.decode=function(){var e=this.bits.index>>3;if(e>=this.bits.byteLength)return!1;var t=this.decodeFrame(this.left,this.right);return this.bits.index=e+t<<3,!!t&&(this.destination&&this.destination.play(this.sampleRate,this.left,this.right),this.advanceDecodedTime(this.left.length/this.sampleRate),!0)},P.prototype.getCurrentTime=function(){var e=this.destination?this.destination.enqueuedTime:0;return this.decodedTime-e},P.prototype.decodeFrame=function(e,t){var i=this.bits.read(11),s=this.bits.read(2),n=this.bits.read(2),r=!this.bits.read(1);if(i!==P.FRAME_SYNC||s!==P.VERSION.MPEG_1||n!==P.LAYER.II)return 0;var a=this.bits.read(4)-1;if(13<a)return 0;var o=this.bits.read(2),i=P.SAMPLE_RATE[o];if(3===o)return 0;s===P.VERSION.MPEG_2&&(o+=4,a+=14);var n=this.bits.read(1),d=(this.bits.read(1),this.bits.read(2)),h=0,h=d===P.MODE.JOINT_STEREO?this.bits.read(2)+1<<2:(this.bits.skip(2),d===P.MODE.MONO?0:32);this.bits.skip(4),r&&this.bits.skip(16);var n=144e3*P.BIT_RATE[a]/(i=P.SAMPLE_RATE[o])+n|0,l=0,u=0;s===P.VERSION.MPEG_2?(l=2,u=30):(s=d===P.MODE.MONO?0:1,a=P.QUANT_LUT_STEP_1[s][a],u=63&(l=P.QUANT_LUT_STEP_2[a][o]),l>>=6),u<h&&(h=u);for(var c=0;c<h;c++)this.allocation[0][c]=this.readAllocation(c,l),this.allocation[1][c]=this.readAllocation(c,l);for(c=h;c<u;c++)this.allocation[0][c]=this.allocation[1][c]=this.readAllocation(c,l);for(var p=d===P.MODE.MONO?1:2,c=0;c<u;c++){for(v=0;v<p;v++)this.allocation[v][c]&&(this.scaleFactorInfo[v][c]=this.bits.read(2));d===P.MODE.MONO&&(this.scaleFactorInfo[1][c]=this.scaleFactorInfo[0][c])}for(c=0;c<u;c++){for(var v=0;v<p;v++)if(this.allocation[v][c]){var f=this.scaleFactor[v][c];switch(this.scaleFactorInfo[v][c]){case 0:f[0]=this.bits.read(6),f[1]=this.bits.read(6),f[2]=this.bits.read(6);break;case 1:f[0]=f[1]=this.bits.read(6),f[2]=this.bits.read(6);break;case 2:f[0]=f[1]=f[2]=this.bits.read(6);break;case 3:f[0]=this.bits.read(6),f[1]=f[2]=this.bits.read(6)}}d===P.MODE.MONO&&(this.scaleFactor[1][c][0]=this.scaleFactor[0][c][0],this.scaleFactor[1][c][1]=this.scaleFactor[0][c][1],this.scaleFactor[1][c][2]=this.scaleFactor[0][c][2])}for(var m=0,g=0;g<3;g++)for(var y=0;y<4;y++){for(c=0;c<h;c++)this.readSamples(0,c,g),this.readSamples(1,c,g);for(c=h;c<u;c++)this.readSamples(0,c,g),this.sample[1][c][0]=this.sample[0][c][0],this.sample[1][c][1]=this.sample[0][c][1],this.sample[1][c][2]=this.sample[0][c][2];for(c=u;c<32;c++)this.sample[0][c][0]=0,this.sample[0][c][1]=0,this.sample[0][c][2]=0,this.sample[1][c][0]=0,this.sample[1][c][1]=0,this.sample[1][c][2]=0;for(var b=0;b<3;b++){for(this.VPos=this.VPos-64&1023,v=0;v<2;v++){P.MatrixTransform(this.sample[v],b,this.V,this.VPos),C.Fill(this.U,0);for(var _=512-(this.VPos>>1),w=this.VPos%128>>1;w<1024;){for(var A=0;A<32;++A)this.U[A]+=this.D[_++]*this.V[w++];w+=96,_+=32}for(w=1120-w,_-=480;w<1024;){for(A=0;A<32;++A)this.U[A]+=this.D[_++]*this.V[w++];w+=96,_+=32}for(var k=0===v?e:t,T=0;T<32;T++)k[m+T]=this.U[T]/2147418112}m+=32}}return this.sampleRate=i,n},P.prototype.readAllocation=function(e,t){e=P.QUANT_LUT_STEP_3[t][e],e=P.QUANT_LUT_STEP4[15&e][this.bits.read(e>>4)];return e?P.QUANT_TAB[e-1]:0},P.prototype.readSamples=function(e,t,i){var s,n=this.allocation[e][t],i=this.scaleFactor[e][t][i],e=this.sample[e][t],t=0;n?(i=63===i?0:P.SCALEFACTOR_BASE[i%3]+(1<<(s=i/3|0)>>1)>>s,s=n.levels,n.group?(t=this.bits.read(n.bits),e[0]=t%s,e[1]=(t=t/s|0)%s,e[2]=t/s|0):(e[0]=this.bits.read(n.bits),e[1]=this.bits.read(n.bits),e[2]=this.bits.read(n.bits)),n=65536/(s+1)|0,t=((s=(s+1>>1)-1)-e[0])*n,e[0]=t*(i>>12)+(t*(4095&i)+2048>>12)>>12,t=(s-e[1])*n,e[1]=t*(i>>12)+(t*(4095&i)+2048>>12)>>12,t=(s-e[2])*n,e[2]=t*(i>>12)+(t*(4095&i)+2048>>12)>>12):e[0]=e[1]=e[2]=0},P.MatrixTransform=function(e,t,i,s){var n=e[0][t]+e[31][t],r=.500602998235*(e[0][t]-e[31][t]),a=e[1][t]+e[30][t],o=.505470959898*(e[1][t]-e[30][t]),d=e[2][t]+e[29][t],h=.515447309923*(e[2][t]-e[29][t]),l=e[3][t]+e[28][t],u=.53104259109*(e[3][t]-e[28][t]),c=e[4][t]+e[27][t],p=.553103896034*(e[4][t]-e[27][t]),v=e[5][t]+e[26][t],f=.582934968206*(e[5][t]-e[26][t]),m=e[6][t]+e[25][t],g=.622504123036*(e[6][t]-e[25][t]),y=e[7][t]+e[24][t],b=.674808341455*(e[7][t]-e[24][t]),_=e[8][t]+e[23][t],w=.744536271002*(e[8][t]-e[23][t]),A=e[9][t]+e[22][t],k=.839349645416*(e[9][t]-e[22][t]),T=e[10][t]+e[21][t],C=.972568237862*(e[10][t]-e[21][t]),E=e[11][t]+e[20][t],P=1.16943993343*(e[11][t]-e[20][t]),V=e[12][t]+e[19][t],S=1.48416461631*(e[12][t]-e[19][t]),D=e[13][t]+e[18][t],I=2.05778100995*(e[13][t]-e[18][t]),x=e[14][t]+e[17][t],O=3.40760841847*(e[14][t]-e[17][t]),M=n+(R=e[15][t]+e[16][t]),R=.502419286188*(n-R);n=a+x,x=.52249861494*(a-x),a=d+D,D=.566944034816*(d-D),d=l+V,V=.64682178336*(l-V),l=c+E,E=.788154623451*(c-E),c=v+T,T=1.06067768599*(v-T),v=m+A,A=1.72244709824*(m-A),m=y+_,_=5.10114861869*(y-_),y=M+m,m=.509795579104*(M-m),M=n+v,n=.601344886935*(n-v),v=a+c,c=.899976223136*(a-c),a=d+l,l=2.56291544774*(d-l),d=y+a,y=.541196100146*(y-a),a=M+v,v=1.30656296488*(M-v),M=d+a,d=.707106781187*(d-a),a=y+v,a+=y=.707106781187*(y-v),v=m+l,m=.541196100146*(m-l),l=n+c,c=1.30656296488*(n-c),n=v+l,l=.707106781187*(v-l),v=m+c,n+=v+=m=.707106781187*(m-c),v+=l,l+=m,c=R+_,R=.509795579104*(R-_),_=x+A,x=.601344886935*(x-A),A=D+T,T=.899976223136*(D-T),D=V+E,E=2.56291544774*(V-E),V=c+D,c=.541196100146*(c-D),D=_+A,A=1.30656296488*(_-A),_=V+D,D=.707106781187*(V-D),V=c+A,A=.707106781187*(c-A),c=R+E,R=.541196100146*(R-E),E=x+T,T=1.30656296488*(x-T),x=c+E,E=.707106781187*(c-E),c=R+T,_+=x+=c+=R=.707106781187*(R-T),x+=V+=A,V+=c+=E,c+=D,D+=E+=R,E+=A,A+=R,T=r+(t=10.1900081235*(e[15][t]-e[16][t])),r=.502419286188*(r-t),t=o+O,o=.52249861494*(o-O),O=h+I,I=.566944034816*(h-I),h=u+S,u=.64682178336*(u-S),S=p+P,p=.788154623451*(p-P),P=f+C,C=1.06067768599*(f-C),f=g+k,k=1.72244709824*(g-k),g=b+w,b=5.10114861869*(b-w),w=T+g,g=.509795579104*(T-g),T=t+f,t=.601344886935*(t-f),f=O+P,P=.899976223136*(O-P),O=h+S,S=2.56291544774*(h-S),h=w+O,w=.541196100146*(w-O),O=T+f,f=1.30656296488*(T-f),T=h+O,O=.707106781187*(h-O),h=w+f,f=.707106781187*(w-f),w=g+S,S=.541196100146*(g-S),g=t+P,P=1.30656296488*(t-P),t=w+g,g=.707106781187*(w-g),w=S+P,t+=w+=P=.707106781187*(S-P),w+=g,S=g+P,g=r+b,r=.509795579104*(r-b),b=o+k,o=.601344886935*(o-k),k=I+C,C=.899976223136*(I-C),I=u+p,p=2.56291544774*(u-p),u=g+I,g=.541196100146*(g-I),I=b+k,k=1.30656296488*(b-k),b=u+I,I=.707106781187*(u-I),u=g+k,k=.707106781187*(g-k),g=r+p,r=.541196100146*(r-p),p=o+C,C=1.30656296488*(o-C),o=g+p,p=.707106781187*(g-p),g=r+C,T+=b+=o+=g+=r=.707106781187*(r-C),b+=t,t+=o+=u+=k,o+=h+=f,h+=u+=g+=p,u+=w,w+=g+=I,g+=O,O+=I+=p+=r,I+=S,S+=p+=k,p+=f,f+=k+=r,k+=P,P+=r,i[s+48]=-M,i[s+49]=i[s+47]=-T,i[s+50]=i[s+46]=-_,i[s+51]=i[s+45]=-b,i[s+52]=i[s+44]=-n,i[s+53]=i[s+43]=-t,i[s+54]=i[s+42]=-x,i[s+55]=i[s+41]=-o,i[s+56]=i[s+40]=-a,i[s+57]=i[s+39]=-h,i[s+58]=i[s+38]=-V,i[s+59]=i[s+37]=-u,i[s+60]=i[s+36]=-v,i[s+61]=i[s+35]=-w,i[s+62]=i[s+34]=-c,i[s+63]=i[s+33]=-g,i[s+32]=-d,i[s+0]=d,i[s+31]=-O,i[s+1]=O,i[s+30]=-D,i[s+2]=D,i[s+29]=-I,i[s+3]=I,i[s+28]=-l,i[s+4]=l,i[s+27]=-S,i[s+5]=S,i[s+26]=-E,i[s+6]=E,i[s+25]=-p,i[s+7]=p,i[s+24]=-y,i[s+8]=y,i[s+23]=-f,i[s+9]=f,i[s+22]=-A,i[s+10]=A,i[s+21]=-k,i[s+11]=k,i[s+20]=-m,i[s+12]=m,i[s+19]=-P,i[s+13]=P,i[s+18]=-R,i[s+14]=R,i[s+17]=-r,i[s+15]=r,i[s+16]=0},P.FRAME_SYNC=2047,P.VERSION={MPEG_2_5:0,MPEG_2:2,MPEG_1:3},P.LAYER={III:1,II:2,I:3},P.MODE={STEREO:0,JOINT_STEREO:1,DUAL_CHANNEL:2,MONO:3},P.SAMPLE_RATE=new Uint16Array([44100,48e3,32e3,0,22050,24e3,16e3,0]),P.BIT_RATE=new Uint16Array([32,48,56,64,80,96,112,128,160,192,224,256,320,384,8,16,24,32,40,48,56,64,80,96,112,128,144,160]),P.SCALEFACTOR_BASE=new Uint32Array([33554432,26632170,21137968]),P.SYNTHESIS_WINDOW=new Float32Array([0,-.5,-.5,-.5,-.5,-.5,-.5,-1,-1,-1,-1,-1.5,-1.5,-2,-2,-2.5,-2.5,-3,-3.5,-3.5,-4,-4.5,-5,-5.5,-6.5,-7,-8,-8.5,-9.5,-10.5,-12,-13,-14.5,-15.5,-17.5,-19,-20.5,-22.5,-24.5,-26.5,-29,-31.5,-34,-36.5,-39.5,-42.5,-45.5,-48.5,-52,-55.5,-58.5,-62.5,-66,-69.5,-73.5,-77,-80.5,-84.5,-88,-91.5,-95,-98,-101,-104,106.5,109,111,112.5,113.5,114,114,113.5,112,110.5,107.5,104,100,94.5,88.5,81.5,73,63.5,53,41.5,28.5,14.5,-1,-18,-36,-55.5,-76.5,-98.5,-122,-147,-173.5,-200.5,-229.5,-259.5,-290.5,-322.5,-355.5,-389.5,-424,-459.5,-495.5,-532,-568.5,-605,-641.5,-678,-714,-749,-783.5,-817,-849,-879.5,-908.5,-935,-959.5,-981,-1000.5,-1016,-1028.5,-1037.5,-1042.5,-1043.5,-1040,-1031.5,1018.5,1e3,976,946.5,911,869.5,822,767.5,707,640,565.5,485,397,302.5,201,92.5,-22.5,-144,-272.5,-407,-547.5,-694,-846,-1003,-1165,-1331.5,-1502,-1675.5,-1852.5,-2031.5,-2212.5,-2394,-2576.5,-2758.5,-2939.5,-3118.5,-3294.5,-3467.5,-3635.5,-3798.5,-3955,-4104.5,-4245.5,-4377.5,-4499,-4609.5,-4708,-4792.5,-4863.5,-4919,-4958,-4979.5,-4983,-4967.5,-4931.5,-4875,-4796,-4694.5,-4569.5,-4420,-4246,-4046,-3820,-3567,3287,2979.5,2644,2280.5,1888,1467.5,1018.5,541,35,-499,-1061,-1650,-2266.5,-2909,-3577,-4270,-4987.5,-5727.5,-6490,-7274,-8077.5,-8899.5,-9739,-10594.5,-11464.5,-12347,-13241,-14144.5,-15056,-15973.5,-16895.5,-17820,-18744.5,-19668,-20588,-21503,-22410.5,-23308.5,-24195,-25068.5,-25926.5,-26767,-27589,-28389,-29166.5,-29919,-30644.5,-31342,-32009.5,-32645,-33247,-33814.5,-34346,-34839.5,-35295,-35710,-36084.5,-36417.5,-36707.5,-36954,-37156.5,-37315,-37428,-37496,37519,37496,37428,37315,37156.5,36954,36707.5,36417.5,36084.5,35710,35295,34839.5,34346,33814.5,33247,32645,32009.5,31342,30644.5,29919,29166.5,28389,27589,26767,25926.5,25068.5,24195,23308.5,22410.5,21503,20588,19668,18744.5,17820,16895.5,15973.5,15056,14144.5,13241,12347,11464.5,10594.5,9739,8899.5,8077.5,7274,6490,5727.5,4987.5,4270,3577,2909,2266.5,1650,1061,499,-35,-541,-1018.5,-1467.5,-1888,-2280.5,-2644,-2979.5,3287,3567,3820,4046,4246,4420,4569.5,4694.5,4796,4875,4931.5,4967.5,4983,4979.5,4958,4919,4863.5,4792.5,4708,4609.5,4499,4377.5,4245.5,4104.5,3955,3798.5,3635.5,3467.5,3294.5,3118.5,2939.5,2758.5,2576.5,2394,2212.5,2031.5,1852.5,1675.5,1502,1331.5,1165,1003,846,694,547.5,407,272.5,144,22.5,-92.5,-201,-302.5,-397,-485,-565.5,-640,-707,-767.5,-822,-869.5,-911,-946.5,-976,-1e3,1018.5,1031.5,1040,1043.5,1042.5,1037.5,1028.5,1016,1000.5,981,959.5,935,908.5,879.5,849,817,783.5,749,714,678,641.5,605,568.5,532,495.5,459.5,424,389.5,355.5,322.5,290.5,259.5,229.5,200.5,173.5,147,122,98.5,76.5,55.5,36,18,1,-14.5,-28.5,-41.5,-53,-63.5,-73,-81.5,-88.5,-94.5,-100,-104,-107.5,-110.5,-112,-113.5,-114,-114,-113.5,-112.5,-111,-109,106.5,104,101,98,95,91.5,88,84.5,80.5,77,73.5,69.5,66,62.5,58.5,55.5,52,48.5,45.5,42.5,39.5,36.5,34,31.5,29,26.5,24.5,22.5,20.5,19,17.5,15.5,14.5,13,12,10.5,9.5,8.5,8,7,6.5,5.5,5,4.5,4,3.5,3.5,3,2.5,2.5,2,2,1.5,1.5,1,1,1,1,.5,.5,.5,.5,.5,.5]),P.QUANT_LUT_STEP_1=[[0,0,1,1,1,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,1,1,1,2,2,2,2,2]],P.QUANT_LUT_STEP_2=[[(P.QUANT_TAB={A:91,B:94,C:8,D:12}).C,P.QUANT_TAB.C,P.QUANT_TAB.D],[P.QUANT_TAB.A,P.QUANT_TAB.A,P.QUANT_TAB.A],[P.QUANT_TAB.B,P.QUANT_TAB.A,P.QUANT_TAB.B]],P.QUANT_LUT_STEP_3=[[68,68,52,52,52,52,52,52,52,52,52,52],[67,67,67,66,66,66,66,66,66,66,66,49,49,49,49,49,49,49,49,49,49,49,49,32,32,32,32,32,32,32],[69,69,69,69,52,52,52,52,52,52,52,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36]],P.QUANT_LUT_STEP4=[[0,1,2,17],[0,1,2,3,4,5,6,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,17],[0,1,3,5,6,7,8,9,10,11,12,13,14,15,16,17],[0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],P.QUANT_TAB=[{levels:3,group:1,bits:5},{levels:5,group:1,bits:7},{levels:7,group:0,bits:3},{levels:9,group:1,bits:10},{levels:15,group:0,bits:4},{levels:31,group:0,bits:5},{levels:63,group:0,bits:6},{levels:127,group:0,bits:7},{levels:255,group:0,bits:8},{levels:511,group:0,bits:9},{levels:1023,group:0,bits:10},{levels:2047,group:0,bits:11},{levels:4095,group:0,bits:12},{levels:8191,group:0,bits:13},{levels:16383,group:0,bits:14},{levels:32767,group:0,bits:15},{levels:65535,group:0,bits:16}],P),C.Renderer.WebGL=(V.prototype.resize=function(e,t){this.width=0|e,this.height=0|t,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)},V.prototype.createTexture=function(e,t){var i=this.gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.uniform1i(i.getUniformLocation(this.program,t),e),s},V.prototype.createProgram=function(e,t){var i=this.gl,s=i.createProgram();return i.attachShader(s,this.compileShader(i.VERTEX_SHADER,e)),i.attachShader(s,this.compileShader(i.FRAGMENT_SHADER,t)),i.linkProgram(s),i.useProgram(s),s},V.prototype.compileShader=function(e,t){var i=this.gl,e=i.createShader(e);if(i.shaderSource(e,t),i.compileShader(e),!i.getShaderParameter(e,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(e));return e},V.prototype.allowsClampedTextureData=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,new Uint8ClampedArray([0])),0===e.getError()},V.prototype.renderProgress=function(e){var t=this.gl,i=t.getUniformLocation(this.loadingProgram,"progress");t.uniform1f(i,e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},V.prototype.render=function(e,t,i){var s,n,r,a,o;this.enabled&&(s=this.gl,a=(n=this.width+15>>4<<4)>>1,o=(r=this.height)>>1,this.shouldCreateUnclampedViews&&(e=new Uint8Array(e.buffer),t=new Uint8Array(t.buffer),i=new Uint8Array(i.buffer)),this.updateTexture(s.TEXTURE0,this.textureY,n,r,e),this.updateTexture(s.TEXTURE1,this.textureCb,a,o,t),this.updateTexture(s.TEXTURE2,this.textureCr,a,o,i),s.drawArrays(s.TRIANGLE_STRIP,0,4))},V.prototype.updateTexture=function(e,t,i,s,n){var r=this.gl;r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,i,s,0,r.LUMINANCE,r.UNSIGNED_BYTE,n)},V.IsSupported=function(){try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},V.SHADER={FRAGMENT_YCRCB_TO_RGBA:["precision mediump float;","uniform sampler2D textureY;","uniform sampler2D textureCb;","uniform sampler2D textureCr;","varying vec2 texCoord;","mat4 rec601 = mat4(","1.16438,  0.00000,  1.59603, -0.87079,","1.16438, -0.39176, -0.81297,  0.52959,","1.16438,  2.01723,  0.00000, -1.08139,","0, 0, 0, 1",");","void main() {","float y = texture2D(textureY, texCoord).r;","float cb = texture2D(textureCb, texCoord).r;","float cr = texture2D(textureCr, texCoord).r;","gl_FragColor = vec4(y, cr, cb, 1.0) * rec601;","}"].join("\n"),FRAGMENT_LOADING:["precision mediump float;","uniform float progress;","varying vec2 texCoord;","void main() {","float c = ceil(progress-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),VERTEX_IDENTITY:["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n")},V),C.Renderer.Canvas2D=(S.prototype.resize=function(e,t){this.width=0|e,this.height=0|t,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),C.Fill(this.imageData.data,255)},S.prototype.renderProgress=function(e){var t=this.canvas.width,i=this.canvas.height,s=this.context;s.fillStyle="#222",s.fillRect(0,0,t,i),s.fillStyle="#fff",s.fillRect(0,i-i*e,t,i*e)},S.prototype.render=function(e,t,i){this.YCbCrToRGBA(e,t,i,this.imageData.data),this.context.putImageData(this.imageData,0,0)},S.prototype.YCbCrToRGBA=function(e,t,i,s){if(this.enabled)for(var n=this.width+15>>4<<4,r=0,a=n,o=n+(n-this.width),d=0,h=(n>>1)-(this.width>>1),l=0,u=4*this.width,c=4*this.width,p=this.width>>1,v=this.height>>1,f=0;f<v;f++){for(var m=0;m<p;m++){g=t[d],w=i[d],d++;var g,y=(88*w>>8)-44+(183*g>>8)-91,b=w+(198*w>>8)-227,_=e[r++],w=e[r++];s[l]=_+(g=g+(103*g>>8)-179),s[l+1]=_-y,s[l+2]=_+b,s[l+4]=w+g,s[l+5]=w-y,s[l+6]=w+b,l+=8;_=e[a++],w=e[a++];s[u]=_+g,s[u+1]=_-y,s[u+2]=_+b,s[u+4]=w+g,s[u+5]=w-y,s[u+6]=w+b,u+=8}r+=o,a+=o,l+=c,u+=c,d+=h}},S),C.AudioOutput.WebAudio=(D.prototype.play=function(e,t,i){if(this.enabled){if(!this.unlocked){var s=C.Now();return this.wallclockStartTime<s&&(this.wallclockStartTime=s),void(this.wallclockStartTime+=t.length/e)}this.gain.gain.value=this.volume;e=this.context.createBuffer(2,t.length,e);e.getChannelData(0).set(t),e.getChannelData(1).set(i);t=this.context.createBufferSource();t.buffer=e,t.connect(this.destination);i=this.context.currentTime,e=e.duration;this.startTime<i&&(this.startTime=i,this.wallclockStartTime=C.Now()),t.start(this.startTime),this.startTime+=e,this.wallclockStartTime+=e}},D.prototype.stop=function(){this.gain.gain.value=0},D.prototype.getEnqueuedTime=function(){return Math.max(this.wallclockStartTime-C.Now(),0)},D.prototype.resetEnqueuedTime=function(){this.startTime=this.context.currentTime,this.wallclockStartTime=C.Now()},D.prototype.unlock=function(e){var t;this.unlocked?e&&e():(this.unlockCallback=e,t=this.context.createBuffer(1,1,22050),(e=this.context.createBufferSource()).buffer=t,e.connect(this.destination),e.start(0),setTimeout(this.checkIfUnlocked.bind(this,e,0),0))},D.prototype.checkIfUnlocked=function(e,t){e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE?(this.unlocked=!0,this.unlockCallback&&(this.unlockCallback(),this.unlockCallback=null)):t<10&&setTimeout(this.checkIfUnlocked.bind(this,e,t+1),100)},D.NeedsUnlocking=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},D.IsSupported=function(){return window.AudioContext||window.webkitAudioContext},D.CachedContext=null,D);function I(e,t){return new C.Player(e,t)}function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(L,t.EventEmitter),O(L.prototype,[{key:"_addCanvasProgressPrecentageProperty",value:function(){Object.defineProperty(this,"progressPrecentage",{get:function(){return this.video.currentTime/this.video.duration}})}},{key:"_addCanvasCurrentTimeProperty",value:function(){Object.defineProperty(this,"currentTime",{get:function(){return this.video.currentTime}})}},{key:"_addCanvasMethods",value:function(){this._addMuteButtonClickedMethod(),this._addPlayButtonClickedMethod(),this._addResizeMethod(),this._addUseResumeCallbackMethod(),this._addEmitStartAdMethod(),this._addShowCanvasMethod(),this._addHideCanvasMethod()}},{key:"_addMuteButtonClickedMethod",value:function(){var e=this;this.video.muteButtonClicked=function(){e.muteButtonClick()}}},{key:"_addPlayButtonClickedMethod",value:function(){var e=this;this.video.playButtonClicked=function(){e.playButtonClick()}}},{key:"_addResizeMethod",value:function(){var s=this;this.video.resize=function(){var e=1<arguments.length?arguments:arguments[0],t=e[0],i=e[1],e=e[2];e&&(s.params.canvas.aspectRatio=e),s.onResize(t,i)}}},{key:"_addUseResumeCallbackMethod",value:function(){var e=this;this.video.useResumeCallback=function(){return e}}},{key:"_addEmitStartAdMethod",value:function(){var e=this;this.video.emitStartAd=function(){return e.emitStartAd()}}},{key:"_addShowCanvasMethod",value:function(){var e=this;this.video.showCanvas=function(){return e.show()}}},{key:"_addHideCanvasMethod",value:function(){var e=this;this.video.hideCanvas=function(){return e.hide()}}},{key:"emitStartAd",value:function(){var e=this;this.stratAdCalled=!0,this._playTimeout=setTimeout(function(){e._play()},2e3)}},{key:"backToVideoTag",value:function(i){var s,e,t,n,r,a=this;!this.bypass&&this.src&&(this.bypass=!0,s=this.jsmpeg.currentTime,e=this.video.style,t=this.video.parentElement||this.target,n=parseInt(this.canvas.style.zIndex),r=this.jsmpeg.loop,this.newVid=t.insertBefore(document.createElement("video"),this.canvas),this.newVid.className="mc-loud-video",this.newVid.setAttribute("playsinline",""),this.newVid.setAttribute("autoplay",""),r&&this.newVid.setAttribute("loop",""),this.newVid.style.height=e.height,this.newVid.style.width=e.width,this.newVid.style.top=e.top||"0",this.newVid.style.left=e.left||"0",this.newVid.style.background="#000000",this.newVid.style.zIndex=n,this.newVid.style.display="none",this.newVid.src=this.src,this.newVid.volume="muteChanged"===i.type?this.params.canvas.defaultVolume:0,this.newVid.muted=0===this.newVid.volume,this.newVid.addEventListener("ended",function(e){a._dispatchEvent("ended")},!1),this.newVid.addEventListener("click",function(e){a._dispatchEvent("click",e)}),this.newVid.addEventListener("durationchange",function e(){var t;0!==a.newVid.duration&&(a.newVid.removeEventListener("durationchange",e),t=a.jsmpeg&&0<a.jsmpeg.currentTime?a.jsmpeg.currentTime:s,(0===a.newVid.currentTime||a.newVid.currentTime<t)&&(a.newVid.currentTime=t,a.newVid.addEventListener("timeupdate",function e(){a.newVid.currentTime>t&&(a.newVid.removeEventListener("timeupdate",e),a.tuTicker=clearInterval(a.tuTicker),a.jsmpeg.stop(),a.jsmpeg=void 0,a.newVid.style.display="block",a.canvas.style.display="none",a.video.style.display="none","playChanged"!==i.type&&!a.video.paused||a._pause(),a._dispatchEvent("newVidCreated",a.newVid))})))}),this.newVid.addEventListener("timeupdate",function(){a._dispatchEvent("timeupdate")}),this.newVid.currentTime=s,this.newVid.play().then(function(){a.newVid.currentTime=s}),this.isCanvasFinished=!1)}},{key:"mpegFinish",value:function(){this.isCanvasFinished||(this._dispatchEvent("ended"),this.isCanvasFinished=!0)}},{key:"onLoad",value:function(){var e,t;this.loaded||(this.loaded=!0,e=parseInt(this.video.width),t=parseInt(this.video.height),this.onResize(e,t),this.ready=!0,this.emit("ready"),this.emit("canplay"),this._dispatchEvent("loadedmetadata"))}},{key:"createCanvas",value:function(){var e,t,i=this,s=document.createElement("canvas");s.className="mc-canvas",this.params.isMultiVpaidUnit&&(t="multi-vpaids",(e=s).className.indexOf(t)<0&&(e.className+=" ".concat(t)),e.className=e.className.split(" ").join(" "));var n=this.video.parentElement||this.target;this.canvas=n.appendChild(s),n.className+=" mpegcnv",n._appendChild=n.appendChild,n.appendChild=function(e){n.insertBefore(e,i.canvas)},this.video&&this.video._addEventListener("resize",function(e){i.onResize(e.target.clientWidth,e.target.clientHeight)}),this.canvas.addEventListener("click",function(e){i._dispatchEvent("click",e)})}},{key:"_getAspectRatio",value:function(){var e=this.params.canvas.aspectRatio;if(e&&e.indexOf(":")){e=e.split(":");if(2===e.length&&e[0]&&e[1])return e}return!1}},{key:"onResize",value:function(e,t){var i,s,n,r;(e||t)&&((r=this._getAspectRatio())?e?(t=t||this.video.clientHeight,s=e,i=Math.floor(parseFloat(e)*parseInt(r[1])/parseInt(r[0]))):(e=this.video.clientWidth,i=t,s=Math.floor(parseFloat(t)*parseInt(r[0])/parseInt(r[1]))):(s=e,i=t),this.newVid?(this.newVid.style.width="".concat(e,"px"),this.newVid.style.height="".concat(t,"px")):this.jsmpeg&&this.canvas&&(n=this.video.videoWidth/this.video.videoHeight,r=e/t,this.canvas.style.position="absolute",this.canvas.style.top="0px",n<=1&&1<r?this._rescaleVerticalToWide(e,t):(this.canvas.style.left="0px",this.canvas.style.width=s+"px",this.canvas.style.height=i+"px",this.canvas.style.marginTop=(t-i)/2+"px",this.canvas.style.marginLeft=(e-s)/2+"px")),this.height=t,this.width=e)}},{key:"_rescaleVerticalToWide",value:function(e,t){var i=this.video.videoHeight/t,i=this.video.videoWidth/i,e=(e-i)/2;this.canvas.style.width=i+"px",this.canvas.style.height=t+"px",this.canvas.style.left=e+"px",this.canvas.parentElement&&this.canvas.parentElement.parentElement&&(this.canvas.parentElement.parentElement.style.backgroundColor="black")}},{key:"hookMethod",value:function(e,i,s){this.hooks||(this.hooks=[]),this.hooks[i]=e[i];var n=this;e[i]=function(){var e={};if(s(arguments,e)){if(!n.hooks.hasOwnProperty(i)||"function"!=typeof n.hooks[i])return!1;var t=n.hooks[i].apply(this,arguments);return e.res||t}}}},{key:"subscribe",value:function(e,t){this.on(e,t)}},{key:"unsubscribe",value:function(e,t){this.off(e,t)}},{key:"_dispatchEvent",value:function(e,t){var i={};i.type=e,i.data=t||{},this.emit(e,i)}},{key:"errHndlr",value:function(e){this.logToBI("jsmpegError",e),this.video.destroy()}},{key:"isUrlInRslvWhiteList",value:function(e){if(!this.clntRedirRslvWhiteList.length)return!0;for(var t=0;t<this.clntRedirRslvWhiteList.length;++t)if(-1<e.indexOf(this.clntRedirRslvWhiteList[t]))return!0;return!1}},{key:"setSrc",value:function(e){if((e=e.trim())&&!this.hasVidUrl){this.logToBI("canvasUrl",{url:e},!1,!1),this.hasVidUrl=!0,this.video&&this.video._vidSetAttr("src",e),this.src=e;var t=this.params.canvas.canvasLoadRate,i=parseInt(this.video.clientWidth),s=parseInt(this.video.clientHeight),s={loadeReadyRate:t,canvas:this.canvas,audio:!1,centerVertically:!0,autoplay:this.shouldAutoPlay,loop:this.loop||!1,pcy:s,pcx:i,onload:this.onLoad.bind(this),errHndlr:this.errHndlr.bind(this),onfinished:this.mpegFinish.bind(this),progressive:!1,canvasCss:this.canvasCss,disableGl:this.params.canvas.disableWebGl},i=this.params.canvas.mpegServerBaseUrl+"="+encodeURIComponent(e);return(/\.mpg$/.test(e)||/\.mpeg$/.test(e))&&(i=e),this.jsmpeg=new I(i,s),this._setVideoDuration(this.src),!1}}},{key:"_play",value:function(){var e=this;this.blockActions||(clearTimeout(this._playTimeout),this._timeUpdateTicker(),this.ready?((this.newVid||this.jsmpeg).play(),setTimeout(function(){e._dispatchEvent("playing")},this.playingEventTimeout),this.status="PLAYING",this._render()):this.on("ready",function(){e._dispatchEvent("play"),e._play()}))}},{key:"_timeUpdateTicker",value:function(){var e=this;clearInterval(this.tuTicker),this.tuTicker=setInterval(function(){e._dispatchEvent("timeupdate"),0<e.quartiles.length&&e.video.currentTime/e.video.duration>=e.quartiles[0].percentage&&e.logToBI("canvas_quartiles",{event:e.quartiles.shift().event})},250)}},{key:"_pause",value:function(){this.stopped||(this.status="PAUSED",this._render(),this.newVid?this.newVid.pause():this.jsmpeg&&this.jsmpeg.pause(),this.tuTicker&&(this.tuTicker=clearInterval(this.tuTicker)))}},{key:"muteButtonClick",value:function(e){var t;this.stopped||(t=!!this.newVid&&!this.newVid.muted,this.logToBI("canvasMuteToggle",{muted:t}),this.newVid?(this.newVid.volume=t?0:this.params.canvas.defaultVolume,this.newVid.muted=0===this.newVid.volume):this.backToVideoTag({type:"muteChanged"}))}},{key:"playButtonClick",value:function(e){var t;this.stopped||(t="PLAYING"===this.status?"PAUSED":"PLAYING",this.logToBI("canvasPlayToggle",{status:t,view:this.newVid?"newVid":"canvas"}),this.status=t,this.newVid?(t=this.newVid||this.jsmpeg,"PLAYING"===this.status?t.play():t.pause(),this._render()):this.backToVideoTag({type:"playChanged"}))}},{key:"modifyVideo",value:function(i){var s=this;this.stopped||(i._vidSetAttr=i.setAttribute,i.getAttribute=function(e,t){return s.vidAttr[e]},i.setAttribute=function(e,t){if(!s.stopped)return s.vidAttr[e]=t,"volume"===e&&(s._volume=t),s.logToBI("hookSetAttribute",{key:e,val:t}),"src"===e?void s.setSrc(t):i._vidSetAttr(e,t)},this.hookMethod(i,"play",function(){if(!s.stopped)return s._play(),setTimeout(function(){s._dispatchEvent("playing")},s.playingEventTimeout),!1}),this.hookMethod(i,"pause",function(){if(!s.stopped)return s._pause(),s._dispatchEvent("pause"),!0}),this.hookMethod(i,"stop",function(){if(!s.stopped)return s.jsmpeg.stop(),!0}),n(i,"paused",function(){return"PAUSED"===s.status},null),n(i,"src",function(){return s.src},this.setSrc.bind(this)),n(this.video,"volume",function(){return s.newVid?s.newVid.volume:s._volume},function(e){return s._volume=e,!0}),n(i,"currentTime",function(){var e=s.newVid||s.jsmpeg;return e?e.currentTime:0},function(e){s.newVid?s.newVid.currentTime=e:s.jsmpeg.seek(e)}),n(i,"ended",function(){return s.newVid?s.newVid.ended:s.isCanvasFinished},null),n(i,"duration",function(){if(s.duration)return s.duration},function(e){s.duration=e}))}},{key:"_setVideoDuration",value:function(e){var t=this,i=document.createElement("video");i.src=e,i.addEventListener("loadedmetadata",function(){t.video&&(t.video.duration=i.duration),i.src="",i=void 0}),i.load()}},{key:"_render",value:function(){this.newVid||this.canvas}},{key:"hide",value:function(){this.stopped||(this.canvas.style.display="none",this._render())}},{key:"show",value:function(){this.stopped||(this.canvas.style.display="block",this._render())}},{key:"removeDomMember",value:function(e){e.parentNode.removeChild(e)}},{key:"restartAd",value:function(){var e=this;this.stopped||(this.newVid?(this.newVid.currentTime=0,this.newVid.play()):this.jsmpeg&&(this.blockActions=!0,this.jsmpeg.stop(),setTimeout(function(){e.jsmpeg.play()},20),setTimeout(function(){e.blockActions=!1},2e3)))}},{key:"destroy",value:function(){if(this.stopped)this.logToBI("canvasDuplicatedDestroy",{});else{for(var e in this.stopped=!0,clearTimeout(this._playTimeout),clearInterval(this.tuTicker),this.jsmpeg=void 0,this._events)this.removeAllListeners(e);this.removeDomMember(this.canvas),this.canvas=void 0}}}]),L);function L(e,t){var i,s;return function(e){if(!(e instanceof L))throw new TypeError("Cannot call a class as a function")}(this),i=this,(s=!(s=M(L).call(this))||"object"!==x(s)&&"function"!=typeof s?function(){if(void 0!==i)return i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():s).video=e,s.params=t,s.target=s.params.canvas.parent,s.logToBI=s.params.logToBI,s.playingEventTimeout=s.params.canvas.playingEventTimeout||100,s.createCanvas(),s.modifyVideo(e),s.shouldAutoPlay=!1,s.canvasCss=t.canvas.additionalCss||{},s.bypass=!1,s.clntRedirRslvWhiteList=s.params.clientRedirRslvWhiteList||[],s.ready=!1,s.loop=!1,s.vidAttr={},e.muted=!0,s.status="LOADING",s._addCanvasProgressPrecentageProperty(),s._addCanvasCurrentTimeProperty(),s._addCanvasMethods(),s.quartiles=[{event:"AdVideoFirstQuartile",percentage:.25},{event:"AdVideoMidpoint",percentage:.5},{event:"AdVideoThirdQuartile",percentage:.75}],s.logToBI("canvas",{ctor:!0}),s}function B(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var W=(B(U.prototype,[{key:"_addVideoTagMethods",value:function(){this._addClearVideoSourcesMethod(),this._addRestartMethod(),this._addAppendSourceMethod(),this._addAppendVideoSourcesMethod(),this._addProtectVideoPauseMethod(),this._addGetSrcMethod(),this._addHookMutedPropertyMethod(),this._addSupressErrorEventsMethod(),this._addDispatchEventMethod(),this._addSubscribeMethod(),this._addUnsubscribeMethod()}},{key:"_addClearVideoSourcesMethod",value:function(){this.video.clearVideoSources=function(){for(;this.childNodes.length;)this.removeChild(this.childNodes[0])}}},{key:"_addRestartMethod",value:function(){this.video.restart=function(){this.currentTime=0,this.play()}}},{key:"_addAppendSourceMethod",value:function(){this.video.appendSource=function(e,t){var i;this.forceCanvas?(this.setAttribute("src",e),this.setAttribute("type",t)):((i=document.createElement("source")).src=e,i.setAttribute("type",t),this.appendChild(i)),this.relevantSources++}}},{key:"_addAppendVideoSourcesMethod",value:function(){var r=this;this.video.appendVideoSources=function(e){var t=null;r.video.clearVideoSources();for(var i=0;i<e.length;i++){var s=e[i],n=s.url;r.video.canPlayType(s.originalType)&&(r.params.decodeUrl&&(n=decodeURI(n)),r.params.secureMediaFiles&&(n=n.replace("http:","https:")),t||((t=s).mediaUrl=n),r.video.appendSource(n,s.originalType))}return t}}},{key:"_addProtectVideoPauseMethod",value:function(){this.video.protectPause=function(){this._play=this.play,this.play=function(){this.resumeInvoked&&this._play()}}}},{key:"_addGetSrcMethod",value:function(){this.video.getSrc=function(){return this.src||this.currentSrc||""}}},{key:"_addHookMutedPropertyMethod",value:function(){this.params.isMobile&&(this.video.hookMutedProperty=function(){this.__defineSetter__("_muted",this.__lookupSetter__("muted")),this.__defineSetter__("muted",function(e){return this.mutedChangeByUserGesture?(this._muted=e,void this.__defineSetter__("muted",this.__lookupSetter__("_muted"))):void(this._muted=!0)})})}},{key:"_addSupressErrorEventsMethod",value:function(){this.video.supressErrorEvents=function(){this.__addEventListener=this.addEventListener,this.addEventListener=function(e,t){"error"!==e&&this.__addEventListener(e,t)}}}},{key:"_addDispatchEventMethod",value:function(){this.video._dispatchEvent=function(e,t){var i=document.createEvent("Event");i.initEvent(e,!0,!0),i.data=t||{},this.dispatchEvent(i)}}},{key:"_addSubscribeMethod",value:function(){this.video.subscribe=function(e,t){this.addEventListener(e,t,!0)}}},{key:"_addUnsubscribeMethod",value:function(){this.video.unsubscribe=function(e,t){this.removeEventListener(e,t,!0)}}},{key:"_addVideoTagProperties",value:function(){this._addTbVersionProperty(),this._addProgressPrecentageProperty(),this._addRemainingTimeProperty(),this._addRelevantSourcesProperty(),this._addBufferSizeProperty(),this._addResumeInvokedProperty(),this._addMutedChangeByUserGestureProperty(),this._hookSrcProperty()}},{key:"_addTbVersionProperty",value:function(){Object.defineProperty(this.video,"TB__VERSION",{get:function(){return"2.2.17"}})}},{key:"_addProgressPrecentageProperty",value:function(){Object.defineProperty(this.video,"progressPrecentage",{get:function(){return this.currentTime/this.duration}})}},{key:"_addRemainingTimeProperty",value:function(){Object.defineProperty(this.video,"remainingTime",{get:function(){return this.duration-this.currentTime}})}},{key:"_addRelevantSourcesProperty",value:function(){Object.defineProperty(this.video,"relevantSources",{get:function(){return this._relevantSources||0},set:function(e){this._relevantSources=e}})}},{key:"_addBufferSizeProperty",value:function(){Object.defineProperty(this.video,"bufferSize",{get:function(){if(this.buffered)return 0===this.buffered.length||0!==this.buffered.start(0)?0:this.buffered.end(0)-this.buffered.start(0)}})}},{key:"_addResumeInvokedProperty",value:function(){Object.defineProperty(this.video,"resumeInvoked",{get:function(){return this._resumeInvoked||!1},set:function(e){this._resumeInvoked=e}})}},{key:"_addMutedChangeByUserGestureProperty",value:function(){this.params.isMobile&&Object.defineProperty(this.video,"mutedChangeByUserGesture",{get:function(){return this._mutedChangeByUserGesture||!1},set:function(e){this._mutedChangeByUserGesture=e}})}},{key:"_hookSrcProperty",value:function(){var t=this;n(this.video,"src",null,function(e){return!(""==e&&!t.video.removeSrc)})}},{key:"_addVideoTagAttributes",value:function(){this.params.isMobile&&(this.video.muted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),"iOS"===this.params.userAgent.os.name&&this.video.removeAttribute("autoplay",""))}}]),U);function U(e){return function(e){if(!(e instanceof U))throw new TypeError("Cannot call a class as a function")}(this),this.video=document.createElement("video"),this.params=e,this._addVideoTagMethods(),this._addVideoTagProperties(),this._addVideoTagAttributes(),this.video}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}).apply(this,arguments)}function j(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var N,q=i,i=(j(z.prototype,[{key:"_initVideoElementParams",value:function(e){e=0<arguments.length&&void 0!==e?e:{};this.params=H({},q,e),this.params.canvas=H({},q.canvas,e.canvas),this.params.secureMediaFiles=this.params.secureMediaFiles&&"https:"===window.location.protocol}},{key:"_initVideoMobileParams",value:function(){this.params.isMobile&&(this.params.logToBI("videoElement",{forceCanvas:this.params.canvas.force},!1,!1),this.params.canvas.force?this._isAutoplayContent()||this._initCanvas():this._shouldDetectAutoplay()&&this._detectAutoplay())}},{key:"_isAutoplayContent",value:function(){return this.params.videoState===v&&this.params.canvas.useAutoplayForContent}},{key:"_shouldDetectAutoplay",value:function(){return this.params.isMobile&&!this.params.canvas.ignoreAutoplayDetection}},{key:"_detectAutoplay",value:function(){var e=new p(this.params);e.on("detectIsAutoplaySupported",this._onIsAutoplaySupportedDetected.bind(this)),e.isAutoplaySupported()}},{key:"_onIsAutoplaySupportedDetected",value:function(e){this.params.logToBI("videoElement",{isAutoplaySupported:e},!1,!1),e||this._initCanvas()}},{key:"_initCanvas",value:function(){this.canvasInited||(this.canvasInited=!0,this.video.forceCanvas=!0,this.canvas=new F(this.video,this.params),this._handleEventListenersVideoToCanvas(),this._registerToCanvasEvents(),this.params.canvas.onCanvasUsage())}},{key:"_overrideVideoAddEventListener",value:function(){this.eventsCb={};var s=this;this.video._addEventListener=this.video.addEventListener,this.video.addEventListener=function(e,t,i){s._addEventCb(e,t),this._addEventListener(e,t,i)}}},{key:"_addEventCb",value:function(e,t){this.eventsCb[e]=this.eventsCb[e]||[],this.eventsCb[e].push(t)}},{key:"_handleEventListenersVideoToCanvas",value:function(){this._removeListenersFrom(this.video),this._addListenersTo(this.canvas),this._overrideAddEventListener(this.canvas)}},{key:"_removeListenersFrom",value:function(e){for(var t in this.eventsCb){var i=!0,s=!1,n=void 0;try{for(var r,a=this.eventsCb[t][Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;e.unsubscribe(t,o)}}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}}}},{key:"_addListenersTo",value:function(e){for(var t in this.eventsCb){var i=!0,s=!1,n=void 0;try{for(var r,a=this.eventsCb[t][Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;e.subscribe(t,o)}}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}}}},{key:"_overrideAddEventListener",value:function(i){var s=this;this.video.addEventListener=function(e,t){s._addEventCb(e,t),i.subscribe(e,t)}}},{key:"_addGetSrcMethod",value:function(){this.video.getSrc=function(){return this.src||this.currentSrc||""}}},{key:"_registerToCanvasEvents",value:function(){this._registerToCanvasNewVidCreatedEvent()}},{key:"_registerToCanvasNewVidCreatedEvent",value:function(){var t=this;this._onNewVidCreated=function(e){e=e.data;e.style.pointerEvents="all",e.style.zIndex=e.style.zIndex||t.zIndex,t.newVidCreated=!0,t._removeCanvasMethods(),t._unregisterFromCanvasEvents(),t.video._dispatchEvent("canvasToVideo",{videoElement:e}),t.params.logToBI("canvasToVideo",{newVidCreated:!0})},this.canvas.on("newVidCreated",this._onNewVidCreated)}},{key:"_addMuteButtonClickedMethod",value:function(){var e=this;this.video.muteButtonClicked=function(){e.canvas&&e.canvas.muteButtonClick()}}},{key:"_addPlayButtonClickedMethod",value:function(){var e=this;this.video.playButtonClicked=function(){e.canvas&&e.canvas.playButtonClick()}}},{key:"_addResizeMethod",value:function(){var s=this,n=arguments;this.video.resize=function(){var e,t,i;s.canvas&&(e=(i=1<n.length?n:n[0])[0],t=i[1],(i=i[2])&&(s.params.canvas.aspectRatio=i),s.canvas.onResize(e,t))}}},{key:"_addUseResumeCallbackMethod",value:function(){var e=this;this.video.useResumeCallback=function(){return e.canvas}}},{key:"_addEmitStartAdMethod",value:function(){var e=this;this.video.emitStartAd=function(){return e.canvas.emitStartAd()}}},{key:"_addShowCanvasMethod",value:function(){var e=this;this.video.showCanvas=function(){return e.canvas.show()}}},{key:"_addHideCanvasMethod",value:function(){var e=this;this.video.hideCanvas=function(){return e.canvas.hide()}}},{key:"_addVideoElementProperties",value:function(){this._addVideoStateProperty(),this._addForceCanvasProperty(),this._addBufferingProperty()}},{key:"_addVideoStateProperty",value:function(){Object.defineProperty(this.video,"videoState",{get:function(){return this._videoState||v},set:function(e){this._videoState=e}})}},{key:"_addForceCanvasProperty",value:function(){var e;this.params.isMobile&&(e=this.video.forceCanvas||!1,Object.defineProperty(this.video,"forceCanvas",{get:function(){return this._forceCanvas||e},set:function(e){this._forceCanvas=e}}))}},{key:"_addBufferingProperty",value:function(){var e;this.params.isMobile&&(e=this.video.buffering||!1,Object.defineProperty(this.video,"buffering",{get:function(){return this._buffering||e},set:function(e){this._buffering=e}}))}},{key:"_addVideoElementMethods",value:function(){this._addRegisterProgressEventsMethod(),this._addRegisterTickingEventsMethod(),this._addDestroyMethod()}},{key:"_addRegisterProgressEventsMethod",value:function(){var s=this;this.video.registerProgressEvents=function(e){s._progressEvents={};for(var t=0;t<e.length;t++){var i="precentage"===e[t].offsetType?e[t].offset:e[t].offset/s.video.duration;s._progressEvents[i]={offset:i,fired:!1}}}}},{key:"_addRegisterTickingEventsMethod",value:function(){var t=this;this.video.registerTickingEvents=function(e){t._ticker=e}}},{key:"_addDestroyMethod",value:function(){var e=this;this.video.destroy=function(){e.video.pause(),e.video.clearVideoSources(),e._cleanVideoSrcProp(),e.canvas&&e.canvas.destroy()}}},{key:"_cleanVideoSrcProp",value:function(){this.video.removeSrc=!0,this.video.src=""}},{key:"_removeCanvasMethods",value:function(){this.video.emitStartAd=this.video.showCanvas=this.video.hideCanvas=void 0}},{key:"_unregisterFromCanvasEvents",value:function(){this.canvas.off("newVidCreated",this._onNewVidCreated),this._onNewVidCreated=void 0}},{key:"_addTimeupdateEvents",value:function(){this.quartiles={q1:!1,q2:!1,q3:!1};var n=this;this.video.addEventListener("timeupdate",function e(){if(!this._buffering){.75<=this.progressPrecentage&&!n.quartiles.q3?(n.quartiles.q3=!0,this._dispatchEvent("thirdQuartile")):.5<=this.progressPrecentage&&!n.quartiles.q2?(n.quartiles.q2=!0,this._dispatchEvent("midpoint")):.25<=this.progressPrecentage&&!n.quartiles.q1&&(n.quartiles.q1=!0,this._dispatchEvent("firstQuartile"));var t,i,s=!0;for(t in n._progressEvents)n._progressEvents[t].fired||(n._progressEvents[t].offset<=this.progressPrecentage?(n._progressEvents[t].fired=!0,this._dispatchEvent("timeProgress",{pre:this.progressPrecentage,time:this.currentTime})):s=!1);n._ticker&&(i=Math.floor(this.currentTime),this._currentTimeFloored!==i&&i%n._ticker==0&&(this._currentTimeFloored=i,this._dispatchEvent("ticking",{time:i}))),s&&n.quartiles.q3&&!n._ticker&&this.unsubscribe("timeupdate",e)}})}},{key:"_loopThroughMediaSources",value:function(){var t=this;this.video.addEventListener("ended",function(){var e;t._isPlayingContent()&&1<t.video.childNodes.length&&(e=t.video.removeChild(t.childNodes[0]),t.video.appendChild(e),t.video.load(),t.video.play())})}},{key:"_isPlayingContent",value:function(){return this.video.videoState===v}}]),z);function z(e){return function(e){if(!(e instanceof z))throw new TypeError("Cannot call a class as a function")}(this),this._initVideoElementParams(e),this.video=new W(this.params),this._overrideVideoAddEventListener(),this._initVideoMobileParams(),this._addVideoElementProperties(),this._addVideoElementMethods(),this._addTimeupdateEvents(),this._loopThroughMediaSources(),this.video.videoState=e.videoState||v,this.video}try{window.cmTag&&((N=window.cmTag.config.ms||{})["video-element"]=N["video-element"]||{},N["video-element"]["2.2.17"]=i,window.cmTag.set("ms",N))}catch(e){}try{window.TRC=window.TRC||{},window.TRC["video-element"]=window.TRC["video-element"]||{},window.TRC["video-element"]["2.2.17"]=i}catch(e){}}],n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=1)},function(t,i,s){"use strict";s.r(i),s.d(i,"default",function(){return Gs});s(20);function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var o=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.parent=e,this.getAdSkippableRemainingTime=this.build_vpaid_get_controller(e,"getAdSkippableRemainingTime",-1),this.getAdLinear=this.build_vpaid_get_controller(e,"getAdLinear",!0),this.getAdWidth=this.build_vpaid_get_controller(e,"getAdWidth",0,"width"),this.getAdHeight=this.build_vpaid_get_controller(e,"getAdHeight",0,"height"),this.getAdExpanded=this.build_vpaid_get_controller(e,"getAdExpanded",!0),this.getAdSkippableState=this.build_vpaid_get_controller(e,"getAdSkippableState",!0),this.getAdRemainingTime=this.build_vpaid_get_controller(e,"getAdRemainingTime",-1),this.getAdDuration=this.build_vpaid_get_controller(e,"getAdDuration",-1),this.getAdCompanions=this.build_vpaid_get_controller(e,"getAdCompanions",[]),this.getAdIcons=this.build_vpaid_get_controller(e,"getAdIcons",[]),this.pauseAd=this.build_vpaid_set_controller(e,"pauseAd"),this.resumeAd=this.build_vpaid_set_controller(e,"resumeAd"),this.expandAd=this.build_vpaid_set_controller(e,"expandAd"),this.collapseAd=this.build_vpaid_set_controller(e,"collapseAd"),this.skipAd=this.build_vpaid_set_controller(e,"skipAd"),this.stopAd=this.build_vpaid_set_controller(e,"stopAd"),this.store=t,this.isMultiAdsActive=this.store.get("mltads")}var e,t,s;return e=i,(t=[{key:"startAd",value:function(){this.parent.vpaidHandler.startAd()}},{key:"getAdVolume",value:function(){if(!this.isMultiAdsActive)return this.parent.volume()}},{key:"setAdVolume",value:function(e,t){this.isMultiAdsActive||this.store.get("forceMute")&&0<e||(this.parent.volume(e),this.parent.runningVpaid&&this.parent.runningVpaid.vpaid&&this.parent.runningVpaid.vpaid.setAdVolume(e))}},{key:"resizeAd",value:function(e,t,i){if(!this.isMultiAdsActive)return!!this.parent.runningVpaid&&this.parent.runningVpaid.resize(e,t,i)}},{key:"muteAd",value:function(){}},{key:"unmuteAd",value:function(){}},{key:"setParam",value:function(e,t){return this.store(e,t)}},{key:"getParam",value:function(e){return this.store(e)}},{key:"gotVpaid",get:function(){return!!(this.parent&&this.parent.scheduleMaster&&this.parent.scheduleMaster.gotVpaid)}},{key:"gotAd",get:function(){return!(!this.gotVpaid||!this.parent.scheduleMaster.runningVpaid.adPlaying)}},{key:"build_vpaid_set_controller",value:function(e,t){function i(){return!!e.scheduleMaster.gotVpaid&&(!!e.scheduleMaster.runningVpaid.vpaid[i.type]&&e.scheduleMaster.vpaid[i.type]())}return i.proxy=e,i.type=t,i}},{key:"build_vpaid_get_controller",value:function(e,t,i,s){function n(){return e.scheduleMaster.gotVpaid?e.scheduleMaster.vpaid[n.type]():n.default_value_key&&null!=e.options[n.default_value_key]?e.options[n.default_value_key]:n.default_value}return n.proxy=e,n.default_value=i,n.default_value_key=s||void 0,n.type=t,n}}])&&n(e.prototype,t),s&&n(e,s),i}();function f(e,t,i,s,n,r,a,o,d,h){var l=6<arguments.length&&void 0!==a&&a,o=7<arguments.length&&void 0!==o?o:5e3,u=8<arguments.length&&void 0!==d?d:"application/x-www-form-urlencoded",c=!(!(9<arguments.length&&void 0!==h)||h),p=[];function v(t,i,s,n,r,e,a){if(t){i=i||"";var o=new XMLHttpRequest;return o.open(i?"POST":"GET",t,!0),!(o.withCredentials=!0)===e&&(o.withCredentials=!1),o.setRequestHeader("Content-type",u),o.async=null==r||r,o.callback="function"==typeof s?s:function(){},o.fallback="function"==typeof n?n:function(){},o.timeout=a,o.gotResponse=!1,o.addEventListener("error",function(e){this.gotResponse||(this.gotResponse=!0,o.fallback())}),o.addEventListener("load",function(e){this.gotResponse||(this.gotResponse=!0,o.fallback())}),o.addEventListener("abort",function(e){this.gotResponse||(this.gotResponse=!0,o.fallback())}),o.addEventListener("timeout",function(e){this.gotResponse||(this.gotResponse=!0,o.fallback())}),o.addEventListener("readystatechange",function(e){if(4==this.readyState&&!this.gotResponse)switch(this.gotResponse=!0,this.status+""){case"200":case"204":case"460":this.callback(this.responseText,p,t);break;default:if(!c)return p.push(this.status),void function(e,t,i,s,n,r,a){c=!0,l&&(e+="".concat(-1<e.indexOf("?")?"&":"?","rt=1&prst=").concat(a||""));v(e,t,i,s,n,!1,r)}(t,i,s,n,r,a,this.status);p.push(this.status),this.fallback(p,t)}}),o.send(i),1}}v(e,t,i,s,n,r,o)}function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}o.prototype.getAdSkippableRemainingTime=o.prototype.build_vpaid_get_controller(parent,"getAdSkippableRemainingTime",-1);i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.label="["+e+"]",this.isDevelopModeOn=-1<this.debugLevels.indexOf("develop"),this.isTrackerOn=-1<this.debugLevels.indexOf("*")||-1<this.debugLevels.indexOf("qa")||this.isDevelopModeOn}var e,i,s;return e=t,(i=[{key:"table",value:function(e){this.isDevelopModeOn&&console.table(e)}},{key:"_templateLogging",value:function(e,t,i,s){if(this.isTrackerOn){var n,r="";for(n in i)r+="".concat(n,": ").concat(i[n],"; ");"string"==typeof t?console[s]("%c".concat(this.label," [").concat(e,"] ").concat(t),r):console[s]("%c".concat(this.label," [").concat(e,"]"),r,t)}}},{key:"debug",value:function(e,t,i){}},{key:"error",value:function(e,t,i){this._templateLogging(e,t,i,"error")}},{key:"warn",value:function(e,t,i){this._templateLogging(e,t,i,"warn")}},{key:"info",value:function(e,t,i){this._templateLogging(e,t,i,"info")}},{key:"log",value:function(e,t,i){this._templateLogging(e,t,i,"log")}},{key:"time",value:function(e){this.isTrackerOn&&console.time(e)}},{key:"timeEnd",value:function(e){this.isTrackerOn&&console.timeEnd(e)}}])&&r(e.prototype,i),s&&r(e,s),t}();i.prototype.debugLevels="";var d=i,i=s(11),h=s.n(i),i=s(0),l=s.n(i),i=s(4),a=s.n(i);function u(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var c=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.decodedData=atob(e),this.nextBits=0,this.numBitsRemaining=0,this.isEndOfStream=!1,this.pointerInDecodedData=0}var e,i,s;return e=t,(i=[{key:"getNextByte",value:function(){return this.pointerInDecodedData===this.decodedData.length?-1:this.decodedData.charCodeAt(this.pointerInDecodedData++)}},{key:"read",value:function(){if(this.isEndOfStream)return-1;if(0===this.numBitsRemaining){if(this.nextBits=this.getNextByte(),-1===this.nextBits)return this.isEndOfStream=!0,-1;this.numBitsRemaining=8}return this.numBitsRemaining--,this.nextBits>>7-this.numBitsRemaining&1}},{key:"isEof",value:function(){return this.isEndOfStream||0==this.numBitsRemaining&&this.pointerInDecodedData==this.decodedData.length}},{key:"readChar",value:function(){for(var e=0,t=0;t<7;t++)e|=this.read()<<t;return String.fromCharCode(e)}},{key:"readByte",value:function(){for(var e=0,t=0;t<8;t++)e|=this.read()<<t;return e}},{key:"read7bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=this.readChar();return t}},{key:"read8bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t}},{key:"readBytes",value:function(e){for(var t=new ArrayBuffer(e),i=0;i<e;i++)t[i]=this.readByte();return t}},{key:"readInt",value:function(e){if(void 0!==e){for(var t=0,i=0;i<e;i++)t|=this.read()<<i;return t}for(var s=0,i=3;0<=i;i--)s+=this.readByte(),0<i&&(s<<=8);return s}},{key:"readLong",value:function(){for(var e=0,t=7;0<=t;t--)e+=this.readByte(),0<t&&(e<<=8);return e}},{key:"readShort",value:function(){for(var e=0,t=1;0<=t;t--)e+=this.readByte(),0<t&&(e<<=8);return e}},{key:"readFloat",value:function(){for(var e=new ArrayBuffer(4),t=new DataView(e),i=0;i<4;i++)t.setUint8(i,this.readByte());return t.getFloat32(0)}},{key:"readDouble",value:function(){for(var e=new ArrayBuffer(8),t=new DataView(e),i=0;i<8;i++)t.setUint8(i,this.readByte());return t.getFloat64(0)}},{key:"readBool",value:function(){return 0<this.read()}}])&&u(e.prototype,i),s&&u(e,s),t}();function p(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var v=1,m=2,g=3,y=4,b=5,_=6,w=7,A=8,k=9,T=10,C=function(){function d(e,t){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.results=null,e){var i=[];this.dastKeys={0:{name:"stid",type:m},1:{name:"extuid",type:g},2:{name:"excid",type:T},3:{name:"ciuid",type:g},4:{name:"ciuidst",type:g},5:{name:"ciums",type:m},6:{name:"szid",type:T},7:{name:"cirid",type:b},8:{name:"cisid",type:b},9:{name:"segid",type:b},10:{name:"pstn",type:b},11:{name:"plcmnt",type:b},12:{name:"RID",type:m},13:{name:"cirf",type:b},14:{name:"base64",type:m},15:{name:"crid",type:m},16:{name:"cibp",type:w},17:{name:"cisbp",type:w},18:{name:"ciprbp",type:w},19:{name:"cmbb",type:w},20:{name:"noaop",type:T},21:{name:"ciage",type:v},22:{name:"cigndr",type:T},23:{name:"invc",type:m},24:{name:"slid",type:m},25:{name:"oslid",type:m},26:{name:"cntry",type:A},27:{name:"rgn",type:b},28:{name:"cty",type:b},29:{name:"citbp",type:w},30:{name:"rcatid",type:b},31:{name:"brsr",type:m},32:{name:"osid",type:m},33:{name:"frimp",type:m},34:{name:"frclk",type:m},35:{name:"frcnv",type:m},36:{name:"pubid",type:m},37:{name:"subid",type:m},38:{name:"ltstmp",type:g},39:{name:"mtmdlid",type:g},40:{name:"mdlid",type:g},41:{name:"cu1",type:m},42:{name:"cu2",type:m},43:{name:"cu3",type:m},44:{name:"cu4",type:m},45:{name:"cu5",type:m},46:{name:"cu6",type:m},47:{name:"cu7",type:m},48:{name:"cu8",type:m},49:{name:"cipid",type:m},50:{name:"cicmp",type:m},51:{name:"impts",type:m},52:{name:"clcts",type:m},53:{name:"convts",type:m},54:{name:"adid",type:g},55:{name:"dcid",type:T},56:{name:"compid",type:m},58:{name:"siteid",type:m},59:{name:"pix",type:g},60:{name:"chan",type:g},61:{name:"bo",type:A},62:{name:"so",type:A},63:{name:"oid",type:T},64:{name:"csec",type:g},65:{name:"skw",type:m},66:{name:"alng",type:m},67:{name:"auc64",type:g},68:{name:"mid",type:A},69:{name:"wif",type:_},70:{name:"ciipd",type:g},71:{name:"sec",type:_},72:{name:"adt",type:m},73:{name:"nsl",type:_},74:{name:"pti",type:_},75:{name:"dncf",type:_},76:{name:"obp",type:w},77:{name:"tz",type:b},78:{name:"md",type:_},79:{name:"mmt",type:v},83:{name:"udc",type:_},84:{name:"umexcid",type:T},85:{name:"verticalId",type:m},86:{name:"mbr",type:T},87:{name:"ts",type:g},88:{name:"omni",type:m},89:{name:"rpm",type:w},90:{name:"abt",type:b},91:{name:"dspadid",type:b},92:{name:"dspbid",type:b},93:{name:"dspcid",type:b},94:{name:"dspcrid",type:b},95:{name:"dspid",type:m},96:{name:"dspseat",type:b},97:{name:"urlDepth",type:m},98:{name:"ordid",type:g},99:{name:"servingDomain",type:b},100:{name:"omniType",type:k},101:{name:"frmi",type:g},102:{name:"fmmt",type:v},103:{name:"cmt",type:v},104:{name:"lat",type:w},105:{name:"long",type:w},106:{name:"prrp",type:w},107:{name:"pfrp",type:w},108:{name:"pgtp",type:k},109:{name:"tblc",type:k},110:{name:"mcr",type:A},111:{name:"ct",type:T},112:{name:"platform",type:k},113:{name:"cncat",type:b},114:{name:"cisrf",type:b},115:{name:"sortOrderType",type:v},116:{name:"groupId",type:b},117:{name:"testId",type:b},118:{name:"prl",type:m},119:{name:"pfrl",type:m},120:{name:"rtd",type:g},121:{name:"rndmt",type:m},122:{name:"sesid",type:b},123:{name:"seshas",type:g},124:{name:"palfr",type:w},125:{name:"splcmt",type:b},126:{name:"wurflb",type:b},127:{name:"wurflbv",type:b},128:{name:"wurflo",type:b},129:{name:"wurflov",type:b},130:{name:"wurflbn",type:b},131:{name:"wurflff",type:b},132:{name:"wurflmn",type:b},133:{name:"difa",type:b},134:{name:"aid",type:b},135:{name:"extuidst",type:b},136:{name:"tbuidst",type:b},137:{name:"aname",type:b},138:{name:"abRTB",type:b},139:{name:"mda",type:b},140:{name:"audsegid",type:b},141:{name:"smdt",type:g},142:{name:"at",type:m},143:{name:"ip",type:b},144:{name:"bundid",type:b},145:{name:"sturl",type:b},146:{name:"asiid",type:b},147:{name:"sid",type:b},148:{name:"appver",type:b},149:{name:"floor",type:y},150:{name:"instl",type:_},151:{name:"blang",type:b},152:{name:"gdpr",type:_},153:{name:"uconsnt",type:_},154:{name:"pcat",type:b},155:{name:"sdepth",type:m},156:{name:"pubidstr",type:b},157:{name:"tagidstr",type:b},158:{name:"uconsntstr",type:b},159:{name:"burl",type:b},160:{name:"pwidth",type:m},161:{name:"pheight",type:m},162:{name:"ctcs",type:T},163:{name:"cetcs",type:T},164:{name:"dspcats",type:b},165:{name:"smidis",type:m},166:{name:"smivrtb",type:m},167:{name:"smiv",type:m},168:{name:"mfrn",type:b},169:{name:"mfri",type:m},170:{name:"mfrp",type:y},171:{name:"mfrpl",type:m},172:{name:"mvecpmn",type:b},173:{name:"mvecpmi",type:m},174:{name:"mvecpmp",type:y},175:{name:"mvecpmpl",type:m},176:{name:"mfrtbn",type:b},177:{name:"mfrtbi",type:m},178:{name:"mfrtbp",type:y},179:{name:"mfrtbpl",type:m},180:{name:"mdisn",type:b},181:{name:"mdisi",type:m},182:{name:"mdisp",type:y},183:{name:"mdispl",type:m},184:{name:"debug",type:b},185:{name:"tpubid",type:m},186:{name:"scp",type:y},187:{name:"sii",type:g},188:{name:"csiid",type:b},189:{name:"ft",type:m},190:{name:"mfril",type:g},191:{name:"mvecpmil",type:g},192:{name:"mfrtbil",type:g},193:{name:"mdisil",type:g},194:{name:"subu",type:m},195:{name:"rid",type:b},196:{name:"muid",type:b},197:{name:"gdprven",type:_},198:{name:"gdprpur",type:_},199:{name:"pubnm",type:b},200:{name:"mPre",type:y},201:{name:"dspuid",type:b},202:{name:"tnetid",type:m},203:{name:"oafp",type:y},204:{name:"oee",type:_},205:{name:"itn",type:_},206:{name:"matchSource",type:m},207:{name:"ccpa",type:b},208:{name:"rs",type:m},209:{name:"dspat",type:m},210:{name:"ds",type:m},211:{name:"sdkt",type:b},212:{name:"sdkv",type:b},213:{name:"sdkos",type:b},214:{name:"uis",type:m},215:{name:"umt",type:g},216:{name:"fagg",type:m},217:{name:"ut",type:_}},e=(e=(e=e.substring(2,e.length-1)).replace(/_/g,"/")).replace(/-/g,"+"),this.bis=new c(e),this.bis.readInt(16);for(var s={};;){var n=this.bis.readInt(8);if(this.bis.isEof())break;if(this.dastKeys.hasOwnProperty(n)){var r=this.dastKeys[n];if(r.type==g&&(o=this.bis.readLong()),r.type==b){try{var a=this.decodeBerLength()}catch(e){i.push("key:".concat(n,",\n\t\t\t\t\t ").concat(e));continue}var o="";-1==a?0==this.bis.readByte()&&(o="ENTER_PLACEMENT_ID_HERE"):o=this.bis.read7bitString(a)}r.type==m&&(o=this.bis.readInt()),r.type==k&&(o=this.bis.readInt(4)),r.type==y&&(o=this.bis.readDouble()),r.type==v&&127<(o=this.bis.readByte())&&(o-=256),r.type==T&&(o=this.bis.readByte()),r.type==_&&(o=this.bis.readBool()),r.type==A&&32767<(o=this.bis.readShort())&&(o-=65536),r.type==w&&(o=this.bis.readFloat()),s[r.name]=o}else i.push("missing key:".concat(n," in dastDecoder"))}this.results=s,0<i.length&&t.set("dastDecoderError",i)}}var e,t,i;return e=d,(t=[{key:"fetchResults",value:function(){return this.results}},{key:"decodeBerLength",value:function(){var e=this.bis.readByte();if(255==e)return-1;if(128!=(128&e))return e=1e3<e?1e3:e;if(0==(e&=127))throw"Indefinite length not supported";if(4<e)throw"Encoding too long";for(var t=0,i=0;i<e;i++)t=(t<<8)+(255&this.bis.readByte());return t=1e3<t?1e3:t}}])&&p(e.prototype,t),i&&p(e,i),d}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var P=32766,V=null,S=void 0;function D(e){if(e){var t=parseInt(e.get("ga_factor"));if(null!==V||!t)return V;if(1===t)return V=!0;e=L(0,t=100<t?100:t);return V=e===t}}function I(e){return 0!==(e=Math.max(Math.min(100,e),0))&&(1===e||L(0,e)===e)}function x(e,t,i){D(i)&&function(e,t,i){var s=i.get("player_version"),n=i.get("ab_test")||"";n="".concat(n).concat(R(t.tag));var r=new XMLHttpRequest;r.open("POST","".concat(i.get("kbnul"),"/putes"),!0);n={event:e,timestamp:(new Date).toISOString(),version:s,abTest:n};n=Object.assign(n,t),r.send(G(F(n)))}(e,t,i)}function O(e,t,i,s){D(s)&&function(e,t,i,s){var n=s.get("player_version"),r=s.get("ab_test")||"",a=new XMLHttpRequest;a.open("POST","".concat(s.get("kbnul"),"/putes/").concat(e),!0);r={event:t,timestamp:(new Date).toISOString(),version:n,abTest:r};r=Object.assign(r,i),a.send(G(F(r)))}(e,t,i,s)}function M(e){return e?1:0}function R(e){return"".concat(e.requiredViewabilityDrawn?"!ronrv":"").concat(e.moatSampling?"!mtsmp":"")}function F(e){var t,r,a;return r=!0,a=[],function e(t,i,s){var n=0;if(void 0===t)n=0;else if("boolean"==typeof t)n=4;else if("string"==typeof t)n=2*(t=r&&t.length>P?i[s]="STRING TOO LONG":t).length;else if("number"==typeof t)n=8;else if("function"==typeof t)try{n=2*t.toString().length}catch(e){}else if("object"===E(t)&&-1===a.indexOf(t))for(var s in a[a.length]=t)n+=8,n+=e(t[s],t,s);return n}(t=e,t,null),e}function L(e,t){return Math.floor(Math.random()*(t-e+1))+e}var B="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function W(e,t){var i=B,s=[],n=0;for(t=t||i.length,e=e||22,n=0;n<e;n++)s[n]=i[0|Math.random()*t];return s.join("")}function U(e){return"string"==typeof e&&0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")?"//"+e:e}function H(e){if(!e||"string"!=typeof e)return 0;var t;void 0===t&&(t=0);var i;t^=-1;for(var s=0,n=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):(127<s&&s<2048?t+=String.fromCharCode(s>>6|192):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128)),t+=String.fromCharCode(63&s|128))}return t}(e)).length;s<n;s++)i=255&(t^e.charCodeAt(s)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);return-1^t}function j(e,t){-1===e.className.indexOf(t)&&(e.className+=" "+t),e.className=e.className.split("  ").join(" ")}function N(e,t){e.className=e.className.split(t).join("").split("  ").join(" ")}function q(e,t,i,s,n){try{!n&&e.contentWindow.console.error&&(e.contentWindow.console.error=function(){});var r="iframe"==e.tagName.toLowerCase()?e.contentDocument:e;if(!r)return;r.querySelectorAll(t).forEach(function(e){q(e,t,i,s,n)}),i(r.querySelectorAll(s))}catch(e){return}}function z(e){try{return/\{\s*\[native code\]\s*\}/.test(e.toString())}catch(e){return 1}}function G(e,t){try{var i,s=[],n=null;z(Array.prototype.toJSON)||(n=Array.prototype.toJSON,delete Array.prototype.toJSON),i=JSON.stringify(e,function(e,t){if(null!=t&&"object"==E(t)){if(-1<s.indexOf(t))return;s.push(t)}return t},t)}catch(e){i=""}return null!==n&&(Array.prototype.toJSON=n),i}function Q(e,t,i){e&&e.push(t,i,3<arguments.length&&void 0!==arguments[3]&&arguments[3],!(4<arguments.length&&void 0!==arguments[4])||arguments[4])}function K(e){return 1<e?e/100:e}function X(e){return parseInt(e)}function Y(e){return e<1e3?1e3*e:e}function J(e,t){var i={cijs:"convusmp",ttype:e,cisd:"convusmp",cipid:t.get("cipid")||"",crid:t.get("creativeId")||"",dast:t.get("auc_dast")||"",cmcv:"",uv:t.get("unit_version")||"",unm:t.get("unit_type")||"",cb:Date.now(),abt:t.get("ab_test")||"",mp:t.get("modifiedPlacement")||void 0,su:t.get("subUnitType")||""};return i=Object.assign(i,(e=t,t=window.cmTag&&window.cmTag.config?window.cmTag.config:{baseReportD:"taboola.com",dataCenter:"am"},{baseReportD:e.get("baseReportD")||t.baseReportD,dataCenter:e.get("dataCenter")||t.dataCenter}))}function $(e){var t,i=Z(e)+"?";for(t in e)void 0!==e[t]&&(i+=t+"="+e[t]+"&");document.createElement("img").src=i}function Z(e){return S.get("pixelsUrl")||"//conv".concat(e.dataCenter,"mp.").concat(e.baseReportD,"/st")}function ee(e,t,i){var s=2<arguments.length&&void 0!==i?i:{},n=t.get("creatives"),r=encodeURIComponent(n.VIDEO_URL&&n.VIDEO_URL.url?n.VIDEO_URL.url:n.VIDEO_URL),i=(new Date).getTime();return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/(%%|\[)referrer(%%|\])/gi,n.REFERRER)).replace(/(%%|\[)domain(%%|\])/gi,n.DOMAIN)).replace(/(%%|\[)video-url(%%|\])/gi,r)).replace(/(%%|\[)page-url(%%|\])/gi,n.PAGE_URL)).replace(/(%%|\[)player-width(%%|\])/gi,n.PLAYER_WIDTH)).replace(/(%%|\[)player-height(%%|\])/gi,n.PLAYER_HEIGHT)).replace(/(%%|\[)timestamp(%%|\])/gi,Math.floor(i/1e3))).replace(/(%%|\[)vidlength(%%|\])/gi,n.VIDLENGTH)).replace(/(%%|\[)keywords(%%|\])/gi,n.KEY_WORDS)).replace(/(%%|\[)description(%%|\])/gi,n.DESCRIPTION)).replace(/(%%|\[)vertical(%%|\])/gi,n.VERTICAL)).replace(/(%%|\[)tag(%%|\])/gi,n.TAG||"")).replace(/(%%|\[)title(%%|\])/gi,n.TITLE)).replace(/(%%|\[)cirf(%%|\])/gi,encodeURIComponent(decodeURIComponent(n.CIRF)))).replace(/(%%|\[)cb(%%|\])/gi,"R0."+i)).replace(/(%%|\[)country(%%|\])/gi,t.get("country"))).replace(/(%%|\[)ip(%%|\])/gi,t.get("ip"))).replace(/(%%|\[)ua(%%|\])/gi,encodeURIComponent(navigator.userAgent))).replace(/(%%|\[)dast(%%|\])/gi,t.get("auc_dast")||"")).replace(/(%%|\[)impression_id(%%|\])/gi,s.impressionId||"")).replace(/(%%|\[)duration(%%|\])/gi,s.adDuration||0)).replace(/%%[^%]*%%/gi,"")}function te(e,t,i){var s=e.document.createElement("script");s.type="text/javascript",s.innerHTML=t,s.onload=function(){i&&i()},s.onerror=function(e){i&&i(e)},e.document.head.appendChild(s)}function ie(e){return"https:"===window.location.protocol&&e.get("scrmf")}function se(e){return btoa(unescape(encodeURIComponent(G(e)))).replace(/\//g,"_").replace(/\+/g,"-")}function ne(e){if(!e)return a.a.undefinedError;try{if(e.eventData){var t=G(e.eventData),i=t.match(a.a.codesMatcher);if(i&&i[0])return parseInt(i[0]);if(t.toLowerCase().match(a.a.noAdsMatcher))return a.a.schemaValidationError;if(t.toLowerCase().match("timeout"))return a.a.timeout}}catch(e){}return a.a.undefinedError}function re(e,t,i,s){t=1<arguments.length&&void 0!==t?t:{},i=2<arguments.length&&void 0!==i?i:"content",s=3<arguments.length&&void 0!==s?s:function(){};return new(e.get("videoElement"))({decodeUrl:e.get("dcdvdurl"),secureMediaFiles:e.get("scrmf"),isMobile:e.get("isMobile"),isMultiVpaidUnit:e.get("isMultiVpaidUnit"),logToBI:s||function(){},videoState:i,userAgent:e.get("wurfl"),canvas:{force:e.get("forcecnvsmpg"),onCanvasUsage:t.onCanvasUsage||function(){},dataSaverServerSide:e.get("dataSaver"),dataSaverUrl:e.get("dtsvrurl"),disableWebGl:e.get("dsbgl"),parent:t.target||document.body,defaultVolume:e.get("dfltvlm"),aspectRatio:e.get("playerAspectRatio"),canvasLoadRate:e.get("cnvsldrt"),mpegServerBaseUrl:e.get("gtvid2"),additionalCss:t.additionalCss||{},repeat:e.get("repeat")||!1,useAutoplayForContent:e.get("useapforcntnt")||!1,playingEventTimeout:e.get("plyngevnttmt")}})}function ae(i,e){(e=e||[]).map(function(e){if("string"==typeof e)delete i[e];else if(e instanceof RegExp)for(var t in i)t.match(e)&&delete i[t]})}var oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function de(e,t){O("secure_player",e,t,S)}function he(e){if(e.isResolved)return e;var t=!0,i=!1,s=!1,e=e.then(function(e){return t=!(s=!0),e},function(e){throw t=!(i=!0),e});return e.isFulfilled=function(){return s},e.isPending=function(){return t},e.isRejected=function(){return i},e}function le(e,t){if(!e)return{};try{return new C(e,S).fetchResults()}catch(e){return t&&t(e),{}}}function ue(e){var e=0<arguments.length&&void 0!==e?e:"",t={};return e.substring(e.indexOf("?")+1).split("&").forEach(function(e){e=e.split("=");0<e.length&&(t[e[0]]=e[1]||"")}),t}function ce(e,t){return window.TRC&&window.TRC.performance&&window.TRC.performance.mark&&(t=t.toUpperCase(),window.TRC.PerfEvenType&&window.TRC.PerfEvenType[t])&&(e=e,window.TRC.performance.perfString&&window.TRC.performance.perfString.indexOf(e)<0)}function pe(e,t){var i;!S.get("prfrmncmsrmnts")||ce(i="".concat(e).concat(t),t)&&window.TRC.performance.mark(i,null,"","",e,window.TRC.PerfEvenType[t.toUpperCase()])}function ve(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var fe=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.event="queueStatusChanged",this.backfillPriority=this.store.get("mxbckflldlyitms")?this.store.get("bfprty"):void 0,this.previousQueue=[],this._initQueueStatus()}var e,i,s;return e=t,(i=[{key:"_initQueueStatus",value:function(){this.queueStatus={requiredViewabilityCount:0,nonRVCount:0,adLoadedCount:0,adxCard:!1,size:0,singleAd:!1,items:[],previousQueue:[],adjacencyAd:!1}}},{key:"onItemRemovedFromQueue",value:function(e){var t=this._getItemFromQueue(e);t&&((t=Object.assign({},t)).vw=e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},this.previousQueue.push(Object.assign({},t)))}},{key:"_getItemFromQueue",value:function(e){for(var t=0;t<this.queueStatus.items.length;t++){var i=this.queueStatus.items[t];if(e.wfIndex===i.seq&&parseInt(e.waterfallTagId)===i.wti)return i}return!1}},{key:"onScheduleChange",value:function(e,t,i){this._initQueueStatus(),this.queueStatus.size=e.length,this.queueStatus.adxCard=t,this.queueStatus.previousQueue=this.previousQueue;for(var s=0;s<e.length;s++){var n=e[s];n.requiredViewability?this.queueStatus.requiredViewabilityCount++:this.queueStatus.nonRVCount++,n.vpaidWrapper.adLoadedFired&&this.queueStatus.adLoadedCount++,n.singleAd&&(this.queueStatus.singleAd=!0),n.adjacencyAd&&(this.queueStatus.adjacencyAd=!0),this.queueStatus.items.push(this._getItemStatus(n))}this.emit(i)}},{key:"_getItemStatus",value:function(e){return{aid:e.advId,bf:e.priority===this.backfillPriority,br:e.brand,cmpid:e.campaignId,crid:e.creativeId,cstmdl:e.cstmdl,dp:e.dp,t:e.itemType,li:e.lineItemId,pid:e.pubId,rv:e.requiredViewability,pr:e.vpaidWrapper?e.vpaidWrapper.getPrice(!0):"",sa:e.singleAd,seq:e.wfIndex,wti:parseInt(e.waterfallTagId),vw:e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},mt:e.vpaidWrapper?e.vpaidWrapper.type:"",ves:e.vpaidWrapper?e.vpaidWrapper.earlySrcVPAID:void 0,adjc:e.adjacencyAd}}},{key:"emit",value:function(e){this.store.emit(e||this.event,this.queueStatus)}}])&&ve(e.prototype,i),s&&ve(e,s),t}(),me=s(5);function ge(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ye=null,be=function(){function r(e){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),!ye){this.costModels={};var t,i=e.get("cpcvcmpgntps"),s=e.get("cstmdltps");for(t in s){var n=s[t];this.costModels[n]={costModel:n,type:t,isCPCV:-1<i.indexOf(n)}}ye=this}return ye}var e,t,i;return e=r,(t=[{key:"isCPCV",value:function(e){return this.costModels.hasOwnProperty(e)&&this.costModels[e].isCPCV}}])&&ge(e.prototype,t),i&&ge(e,i),r}(),_e=s(7),i=s(1),we=s.n(i);function Ae(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function ke(e,t,i,s,n){var r,a,o=document.createElement("script"),d=[];t={adData:{ids:t,duration:i,url:n},dispatchEvent:function(e){this.sendEvent?(d&&(d.push(e),e=d,d=!1),this.sendEvent(e)):d.push(e)}},i="_moatApi"+Math.floor(1e8*Math.random());try{a=(r=e.ownerDocument).defaultView||r.parentWindow}catch(e){r=document,a=window}return a[i]=t,o.type="text/javascript",e&&e.insertBefore(o,e.childNodes[0]||null),o.src="https://z.moatads.com/"+s+"/moatvideo.js#"+i,t}var Te=function(){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.options=e,this.moatAbTest=this.options.tag.getValueByKey("mttst"),this.moatAbTest&&(this.moatAbTest+="_"),this.moatAbTest="".concat(this.moatAbTest).concat(this.options.store.get("unit_type")||"").concat(this.options.store.get("isMobile")?"_Mobile":"");var t=this._createLevels(),e=this.options.moatTag?new Function(this.options.moatTag):ke;this.moatApiReference=e(this.options.container||document.body,t,this.options.duration||0,this.options.moatPartnerCode,this.options.url),Q(this.options.vpaidLog,"moatTracker",{}),this.debugTracker=this.options.debugTracker,this.events=[we.a.AdLoaded,"startAd",we.a.AdStarted,we.a.AdImpression,we.a.AdVideoStart,we.a.AdClickThru,we.a.AdStopped,we.a.AdPlaying,we.a.AdPaused,we.a.AdVideoFirstQuartile,we.a.AdVideoMidpoint,we.a.AdVideoThirdQuartile,we.a.AdVideoComplete,we.a.AdVolumeChange],this.stopped=!1}var e,t,s;return e=i,(t=[{key:"_createLevels",value:function(){if(this.options.moatTag)return{};if(!this.options.tag)return{level1:"",level2:"",level3:"",level4:"",slicer1:"",slicer2:""};var e={level1:this.moatAbTest,level2:this.options.tag.advId,level3:this.options.tag.lineItemId,level4:this.options.store.get("domain")||"",slicer1:this.options.url,slicer2:this.options.tag.tagId,zMoataucdast:this.options.store.get("auc_dast"),zMoatdast:this.options.tag.vidDast,zMoatabt:"".concat(this.options.store.get("ab_test")).concat(R(this.options.tag)),zMoatpdast:this.options.playerDast,zMoatframetype:this.options.store.get("frameType"),zMoatsubunittypeid:this.options.store.get("subUnitType"),zMoatos:+this.options.tag.waterfallTagId+1},t=this.options.store.get("dast");return t.hasOwnProperty("cisid")&&(e.zMoatimprid=t.cisid),e}},{key:"dispatch",value:function(e){this.stopped||-1<this.events.indexOf(e.type)&&(this.moatApiReference.dispatchEvent(e),this.debugTracker.info("Moat dispatching event:".concat(e.type),e))}},{key:"dispose",value:function(){this.stopped=!0,this.moatApiReference=this.events=this.options=void 0}}])&&Ae(e.prototype,t),s&&Ae(e,s),i}(),i=s(14),Ce=s.n(i),Ee=s(2);function Pe(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ve=s(6),Se=function(){function r(e,t,i,s,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),Ve.mixin(this),pe("videoVideoControlsRender",Ee.START),this.store=t,this.video=e,this.target=e.parentElement||i,this.isMobile=this.store.get("isMobile"),this.useVideoControls=this.store.get("useVideoControls"),this.disclosureText=this.store.get("disctxt"),this.defaultVolume=this.store.get("dfltvlm"),this.hideAdsPlayPauseButton=this.store.get("hdeadsplypusbtn"),this.showAdMuteButton=this.store.get("shwadmtebtn"),this.initBg=!1,this.vpaidWrapper=n,this.state={},this._onSoundChange=function(){},this.isMobile?this._buildMobileControls():this._buildDesktopControls(),this._createElements(),this._addControlsEventListeres(),this._addSoundEventListener(),this._handleProgressBarDisplay(),this._setInitialState(s),this.store.on("playerStatusChanged",this._onPlayerStatusChanged.bind(this)),pe("videoVideoControlsRender",Ee.STOP)}var e,t,i;return e=r,(t=[{key:"_setInitialState",value:function(e){e={volume:0,volumeBeforeMute:0,adDuration:0,adCurrentTime:0,adTickerId:0,adLastTickTime:0,isMuted:0===this.store.get("volume")||this.isMobile,isPaused:!1,playerState:e,vidDuration:30,vidCurrentTime:0,isVisible:"ad"!==e};this.setState(e)}},{key:"_buildDesktopControls",value:function(){this._createElements=this._createDesktopElements.bind(this),this._addControlsEventListeres=this._addDesktopControlsEventListeners.bind(this),this._renderControls=this._renderDesktopControls.bind(this),this._onVolumeStateChanged=this._onDesktopVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyDesktopControlsEvents.bind(this)}},{key:"_buildMobileControls",value:function(){this._createElements=this._createMobileElements.bind(this),this._addControlsEventListeres=this._addMobileControlsEventListeners.bind(this),this._renderControls=this._renderMobileControls.bind(this),this._onVolumeStateChanged=this._onMobileVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyMobileControlsEvents.bind(this),this.resetAdControls=function(){}}},{key:"resetAdControls",value:function(){this._isAdState()&&this.vpaidWrapper&&this.setState({preventAdTicker:""!==this.vpaidWrapper.getVideoUrl(),isMuted:!0})}},{key:"_onPlayerStatusChanged",value:function(e){this.setState({playerState:e})}},{key:"_isAdState",value:function(){return"ad"===this.state.playerState}},{key:"_isWorkingVpaid",value:function(e){return this._isAdState()&&e.workingVpaid}},{key:"_onControlsVisibilityChanged",value:function(){var e=this;this.useVideoControls&&requestAnimationFrame(function(){N(e.element,e.state.isVisible?"hide":"show"),j(e.element,e.state.isVisible?"show":"hide")})}},{key:"_addDesktopControlsEventListeners",value:function(){this.target.addEventListener("dragstart",function(){}),this.element.addEventListener("click",function(e){e.stopPropagation()}),this._bindedOnProgressBarDown=this._onProgressBarDown.bind(this),this.progressBarArea.addEventListener("mousedown",this._bindedOnProgressBarDown),this._bindedOnPlayPauseClicked=this._onDesktopPlayPauseClicked.bind(this),this.playBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this._bindedOnProgressBarOut=this._onProgressBarOut.bind(this),this._bindedOnProgressBarMove=this._onProgressBarMove.bind(this),this._addContentVideoEventListeners(),this._bindedOnMuteClicked=this._onDesktopMuteClicked.bind(this)}},{key:"_addMobileControlsEventListeners",value:function(){this._bindedOnPlayPauseClicked=this._onMobilePlayPauseClicked.bind(this),this._bindedOnMuteClicked=this._onMobileMuteClicked.bind(this),this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this.playPauseArea.addEventListener("click",this._bindedOnPlayPauseClicked),this.video&&this.video.addEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_addSoundEventListener",value:function(){this.soundElement.addEventListener("click",this._bindedOnMuteClicked)}},{key:"_handleProgressBarDisplay",value:function(){this.store.get("hdprgrsbr")&&this.progressBarArea&&(this.progressBarArea.style.display="none")}},{key:"_createDesktopElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls hide",this.element.innerHTML="<div class='video_controls video_controls_main_area'>\n                <div class='title text'>".concat(this.disclosureText,"</div>\n                <div class='cm_video_controls_progressbar_area'>\n                    <div class='cm_video_controls_progressbar_bg white_bg'></div>\n                    <div class='cm_video_controls_progressbar blue_bg'></div>\n                </div>\n                <div class='cm_video_controls_mute interactive display_mute'></div>\n                <div class='cm_video_controls_playpause interactive hide'>\n                    <div class='pause hide'></div>\n                    <div class='play'></div>\n                </div>\n            </div>"),this.target.appendChild(this.element),this.mainArea=this.element.children[0],this.progressBarArea=this.mainArea.children[1],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this.soundElement=this.mainArea.children[2],this.playPauseArea=this.mainArea.children[3],this.pauseBtn=this.playPauseArea.children[0],this.playBtn=this.playPauseArea.children[1],this.store.get("can_opt_out")||j(this.mainArea.children[0],"opt-out-hidden")}},{key:"_createMobileElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls_mobile",this.element.innerHTML='<div class="mc-pause hide" style="pointer-events: all;"></div>\n            <div class="speaker mute" style="pointer-events: all;"></div>\n            <div class="mc-progressbar_area">\n                <div class=\'mc-progressbar_bg white_bg\'></div>\n                <div class=\'mc-progressbar_bg blue_bg\'></div>\n            </div>\n            <div class="tbl-text">'.concat(this.disclosureText,"</div>"),(this.video.parentElement||this.target).appendChild(this.element),this.playPauseArea=this.element.children[0],this.soundElement=this.element.children[1],this.progressBarArea=this.element.children[2],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1]}},{key:"_setVideoProgress",value:function(){var s=this;requestAnimationFrame(function(){var e,t=100-(s.state.vidDuration-s.state.vidCurrentTime)/s.state.vidDuration*100,i=t+"%";s.progressBarPercentager.style.width!==i&&(e=parseInt(s.progressBarPercentager.style.width),isNaN(e)||parseInt(t)<e?s.initBg||(s.initBg=!0,j(s.progressBarPercentager,"init_bg")):s.initBg&&(s.initBg=!1,N(s.progressBarPercentager,"init_bg")),s.progressBarPercentager.style.width=i)})}},{key:"_addContentVideoEventListeners",value:function(){this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this._bindedOnVideoClick=this._onVideoClick.bind(this),this.video.addEventListener("durationchange",this._bindedOnVideoEvent),this.video.addEventListener("progress",this._bindedOnVideoEvent),this.video.addEventListener("timeupdate",this._bindedOnVideoEvent),this.video.addEventListener("playing",this._bindedOnVideoEvent),this.video.addEventListener("pause",this._bindedOnVideoEvent),this.video.addEventListener("click",this._bindedOnVideoClick)}},{key:"_onVideoClick",value:function(e){this.video.currentTime===this.video.duration&&(this._isAdState()||(this.video.play(),e.stopPropagation()))}},{key:"_onVideoEvent",value:function(e){var t;this._isAdState()||("timeupdate"!==e.type?(t={volume:this.video.volume,isMuted:0===this.video.volume},"pause"!==e.type&&"playing"!==e.type||(t.isPaused="pause"===e.type),this.setState(t)):this.setState({vidDuration:this.video.duration,vidCurrentTime:this.video.currentTime}))}},{key:"setVpaidHandler",value:function(e){this.vpaid=e,this._addVpaidListeners()}},{key:"_addVpaidListeners",value:function(){this._bindedOnVpaidEvent=this._onVpaidEvent.bind(this),this.vpaid.on("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.on("AdPaused",this._bindedOnVpaidEvent),this.vpaid.on("AdPlaying",this._bindedOnVpaidEvent)}},{key:"_removeVpaidListeners",value:function(){this.vpaid&&this._bindedOnVpaidEvent&&(this.vpaid.off("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.off("AdPaused",this._bindedOnVpaidEvent),this.vpaid.off("AdPlaying",this._bindedOnVpaidEvent))}},{key:"_onVpaidEvent",value:function(e){var t;this._isWorkingVpaid(this.vpaidWrapper)&&(t={},"AdVolumeChange"===e.type?this.isMobile||(t.volume=this.vpaidWrapper.adVolume,t.isMuted=0===this.vpaidWrapper.adVolume):(e="AdPaused"===e.type,this.state.isPaused!==e&&(t.isPaused=e)),this.setState(t))}},{key:"_onAdTicks",value:function(){var e=Date.now(),t={};this.state.isPaused?0!=this.state.adLastTickTime&&(this.adStartTime+=e-this.state.adLastTickTime):(t.adCurrentTime=(e-this.adStartTime)/1e3,t.adCurrentTime>this.state.adDuration&&(t.adCurrentTime=0<this.adStartTime?this.state.adDuration:0),t.vidDuration=t.adDuration,t.vidCurrentTime=t.adCurrentTime),t.adLastTickTime=e,this.setState(t)}},{key:"_isAdsPlayPauseButtonHidden",value:function(){return this.hideAdsPlayPauseButton&&this._isAdState()}},{key:"_onDesktopPlayPauseClicked",value:function(e){var t=!this.state.isPaused;this._isAdsPlayPauseButtonHidden()||(!this.isMobile&&this.video&&(t?this.video.pause():this.video.play()),this.setState({isPaused:t}),e.stopPropagation())}},{key:"_onMobilePlayPauseClicked",value:function(e){this.video.playButtonClick&&this.video.playButtonClick(),this.setState({isPaused:!this.state.isPaused}),e.stopPropagation()}},{key:"_onDesktopMuteClicked",value:function(e){var t;this.showAdMuteButton&&(0===this.state.volume&&this.emit("unmuteClicked"),t={},this.store.set("forceMute",!this.state.isMuted),this.state.isMuted?0===this.state.volumeBeforeMute&&(t.volumeBeforeMute=this.defaultVolume):t.volumeBeforeMute=this.state.volume,t.volume=this.state.isMuted?this.state.volumeBeforeMute||t.volumeBeforeMute:0,this.setState(t),e.stopPropagation())}},{key:"_onMobileMuteClicked",value:function(e){this.showAdMuteButton&&(0===this.state.volume&&this.emit("unmuteClicked"),this.video.muteButtonClicked&&this.video.muteButtonClicked(),this.setState({isMuted:!this.state.isMuted}),e.stopPropagation())}},{key:"_onProgressBarDown",value:function(e){this._sendProgressBarPercentagesChanged(e.offsetX/this.progressBarArea.offsetWidth,e),this.progressBarArea.addEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mousemove",this._bindedOnProgressBarMove),e.stopPropagation()}},{key:"_sendProgressBarPercentagesChanged",value:function(e,t){this.store.emit("videoProgressBar",e),t.stopPropagation()}},{key:"_onProgressBarOut",value:function(e){this.progressBarArea.removeEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mousemove",this._bindedOnProgressBarMove),e.stopPropagation()}},{key:"_onProgressBarMove",value:function(e){this._sendProgressBarPercentagesChanged(e.offsetX/this.progressBarArea.offsetWidth,e)}},{key:"_didStateChanged",value:function(e){for(var t in e)if(void 0!==e[t]&&!this.state.hasOwnProperty(t)||this.state[t]!==e[t])return!0;return!1}},{key:"setState",value:function(e){var t;this.state&&e&&0<Object.keys(e).length&&this._didStateChanged(e)&&(t=!1,void 0!==e.playerState&&(this.state.playerState=e.playerState,this._updateMuteAndPlayPauseVisibility()),void 0===e.volume&&void 0===e.isMuted||(t=!0,this._onVolumeStateChanged(e),this._setVpaidVolume(),this._onSoundChange(this.state.isMuted)),void 0!==e.isPaused&&this.state.isPaused!==e.isPaused&&(t=!0,this.state.isPaused=e.isPaused,this._onPausedChanged(),this._isAdState()||this._toggleVpaidPlayPause(e)),void 0!==e.preventAdTicker&&e.preventAdTicker!==this.state.preventAdTicker&&(this.state.preventAdTicker=e.preventAdTicker,this.state.adTickerId=clearInterval(this.state.adTickerId),this.state.preventAdTicker?this.vpaidWrapper.registerToVPAIDVideoTimeupdateEvent():(this.adStartTime=Date.now(),this.vpaidWrapper.getAdDuration(),this.state.adTickerId=setInterval(this._onAdTicks.bind(this),250))),void 0===e.vidDuration&&void 0===e.vidCurrentTime||(this.state.vidDuration=e.vidDuration||this.state.vidDuration,this.state.vidCurrentTime=e.vidCurrentTime||this.state.vidCurrentTime,this._setVideoProgress()),void 0!==e.isVisible&&(this.state.isVisible=e.isVisible,this._onControlsVisibilityChanged()),t&&this._renderControls())}},{key:"_onDesktopVolumeStateChanged",value:function(e){0===e.volume||e.isMuted?(this.state.volumeBeforeMute=void 0!==e.volumeBeforeMute?e.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.store.emit("volumeBeforeMuteChanged",this.state.volumeBeforeMute),this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=!1,this.state.volume=void 0!==e.volume?e.volume:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onMobileVolumeStateChanged",value:function(e){0===e.volume||e.isMuted?(this.state.volumeBeforeMute=void 0!==e.volumeBeforeMute?e.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=(void 0!==e.isMuted?e:this.state).isMuted,this.state.volume=void 0!==e.volume?e.volume:this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onPausedChanged",value:function(){this.video&&(this._isAdsPlayPauseButtonHidden()||this._isVideoEmpty()||!this.isMobile||(this.state.isPaused?this.video.pause():this.video.play()))}},{key:"_isVideoEmpty",value:function(){return!(this.video.src&&this.video.attributes.src&&""!==this.video.attributes.src.value||0!==this.video.childNodes.length)}},{key:"_renderDesktopControls",value:function(){this._renderDesktopVolume(),this._renderDesktopPlayPause()}},{key:"_renderDesktopVolume",value:function(){var e;this._isAdState()||(e=1<this.state.volume?this.state.volume/100:this.state.volume,this.video.volume=e,this.video.muted=this.state.isMuted),N(this.soundElement,"display_unmute"),N(this.soundElement,"display_mute"),j(this.soundElement,"display_".concat(this.state.isMuted?"mute":"unmute"))}},{key:"_renderDesktopPlayPause",value:function(){var e=this.state.isPaused?this.playBtn:this.pauseBtn,t=this.state.isPaused?this.pauseBtn:this.playBtn;N(t,"show"),j(t,"hide"),N(e,"hide"),j(e,"show")}},{key:"_renderMobileControls",value:function(){this._setMobilePlayPauseButton(),this._setMobileSoundButton()}},{key:"_setMobilePlayPauseButton",value:function(){var e=this;requestAnimationFrame(function(){e.state.isPaused?(N(e.playPauseArea,"mc-pause"),j(e.playPauseArea,"mc-play")):(N(e.playPauseArea,"mc-play"),j(e.playPauseArea,"mc-pause"))})}},{key:"_setMobileSoundButton",value:function(){var e=this;!this._isAdState()&&this.video&&(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted),requestAnimationFrame(function(){(e.state.isMuted?j:N)(e.soundElement,"mute")})}},{key:"_toggleVpaidPlayPause",value:function(){this._isAdState()&&this.vpaid&&(this.state.isPaused?this.vpaid.vpaidHandler.pauseAd():this.vpaid.vpaidHandler.resumeAd())}},{key:"_setVpaidVolume",value:function(){this._isAdState()&&this.vpaid&&this.vpaidWrapper&&this.vpaidWrapper.workingVpaid&&this.vpaidWrapper.setAdVolume(this.state.volume,!0)}},{key:"getValueFromControlsState",value:function(e){return this.state.hasOwnProperty(e)?this.state[e]:void 0}},{key:"destroy",value:function(){this._removeVpaidListeners(),this._destroyControlsEvents(),this._destroySoundEvents(),this.element.parentElement.removeChild(this.element),this.vpaid=this._bindedOnVpaidEvent=void 0,clearInterval(this.state.adTickerId)}},{key:"_destroyDesktopControlsEvents",value:function(){this.target.removeEventListener("dragstart",function(){}),this.element.removeEventListener("click",function(e){e.stopPropagation()}),this.progressBarArea.removeEventListener("mousedown",this._bindedOnProgressBarDown),this.video.removeEventListener("durationchange",this._bindedOnVideoEvent),this.video.removeEventListener("progress",this._bindedOnVideoEvent),this.video.removeEventListener("playing",this._bindedOnVideoEvent),this.video.removeEventListener("pause",this._bindedOnVideoEvent),this.video.removeEventListener("click",this._bindedOnVideoClick),this.playBtn.removeEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroyMobileControlsEvents",value:function(){this.playPauseArea.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroySoundEvents",value:function(){this.soundElement.removeEventListener("click",this._bindedOnMuteClicked),this.video&&this.video.removeEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_updateMuteAndPlayPauseVisibility",value:function(){var e=this;requestAnimationFrame(function(){N(e.playPauseArea,"hide"),N(e.playPauseArea,"show"),N(e.soundElement,"hide"),N(e.soundElement,"show"),j(e.playPauseArea,e._isAdsPlayPauseButtonHidden()?"hide":"show"),j(e.soundElement,e.showAdMuteButton?"show":"hide")})}},{key:"setOnSoundChangeCallback",value:function(e){this._onSoundChange=e}},{key:"setVideo",value:function(e){this.video=e,this.video.volume===this.state.volume&&this.video.muted===this.state.isMuted||(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted)}}])&&Pe(e.prototype,t),i&&Pe(e,i),r}();function De(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ie={vastDuration:"vdr",videoElementDuration:"edr",vastWidth:"vwd",videoElementWidth:"ewd",vastHeight:"vht",videoElementHeight:"eht",vastBitrate:"vbr",videoElementUrl:"vu",videoElementType:"vt",vastOriginalType:"ot",vastSubType:"st",effectiveConnectionType:"ect",connectionType:"ct",vasts:"vst",canvas:"cnv",canvasToVideo:"ctv",videoUrlChanged:"vuc",winningPrice:"wp"},xe=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.hadImpression=!1,this.onNavigatorConnectionChange=this._onNavigatorConnectionChange.bind(this),this.store.on("navigatorConnectionChange",this.onNavigatorConnectionChange);e=this.store.get("navigatorConnection")||{};this.dast={vdr:void 0,edr:void 0,vwd:void 0,ewd:void 0,vht:void 0,eht:void 0,vbr:void 0,vu:void 0,vt:void 0,ot:void 0,st:void 0,ect:e.effectiveTypeId,ct:e.typeId,vst:[],cnv:!1,ctv:!1,vuc:!1,wp:void 0}}var e,i,s;return e=t,(i=[{key:"set",value:function(e){this.stopped||(e.hasOwnProperty("vu")&&""!==e.vu&&(e.vt=this._getVideoTypeFromUrl(e.vu),this.hadImpression&&e.vu!==this.dast.vu&&(this.dast.vuc=!0)),this.dast=Object.assign(this.dast,e))}},{key:"_getVideoTypeFromUrl",value:function(e){var t=void 0,e=e.match(/\.([^\/#?]+)([#?][^\/]*)?$/);return t=e&&1<e.length?e[1]:t}},{key:"addWrapper",value:function(e){this.stopped||(e.hasOwnProperty("wu")&&""!==e.wu&&(e.wu=this._getHostnameFromWrapperUrl(e.wu)),this.dast.vst.push(e))}},{key:"_getHostnameFromWrapperUrl",value:function(e){var t,i=document.createElement("a");return i.href=e,t=i.hostname,i=null,t}},{key:"_onNavigatorConnectionChange",value:function(e){this.stopped||(this.dast.ect=e.effectiveTypeId,this.dast.ct=e.typeId)}},{key:"get",value:function(){if(!this.stopped)return se(this.dast)}},{key:"getByKey",value:function(e){return this.dast[Ie[e]||e]}},{key:"destroy",value:function(){this.stopped=!0,this.store.off("navigatorConnectionChange",this.onNavigatorConnectionChange),this.store=this.onNavigatorConnectionChange=this.dast=void 0}},{key:"onImpression",value:function(){this.hadImpression=!0}},{key:"getWrappers",value:function(){return this.dast.vst}}])&&De(e.prototype,i),s&&De(e,s),t}(),i=s(12),Oe=s.n(i);function Me(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Re=s(6),Fe=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),Re.mixin(this),this.watchVideoInterval=i.get("wtchvdointrvl"),this.unitPredictorsInterval=i.get("rprtvidsttsintrvl"),this.newCompletionByVideoProgress=i.get("q5byprgrss"),this.isMobile=i.get("isMobile")||!1,this.timeoutLengthToAdCompletion=e.tag.getValueByKey("".concat(this.isMobile?"mbl":"dsk","tmouttoadcmpltn")),this.newCompletionByVideoProgressFired=!1,this.isVForceActive=i.get("vForce"),this.reportWatchTimeInterval=e.tag.getValueByKey("wtchprgrssopp"),this.isDirectDemand=e.tag.isDirectDemand,this.bufferingEventsToReport=e.tag.getValueByKey("rprtbuffrng"),this.bufferingDetected=!1,this.lastPlayPos=0,this.bufferingCounter=0,this.wrapperIndex=e.wrapperIndex,this.debugTracker=e.debugTracker,this.stopped=!1,this.frameType=i.get("frameType"),this.maxDurationLimit=i.get("prftchmxlngth")}var e,t,i;return e=s,(t=[{key:"prefetchVideo",value:function(e,t){var i=this;"javascript"===e||"video"===e&&this.isIOS?this.video.addEventListener("loadedmetadata",function(){return i._onPrefetchVideoMetaData(t)}):(this.video.buffering=!0,this.playPromise=this.video.play(),null!=this.playPromise&&(this.playPromise=he(this.playPromise),this.debugTracker.info("Vpaid.video.play()"),this.playPromise.catch(function(e){i.stopped||i.debugTracker&&i.debugTracker.info("buffering video error:".concat(e))})))}},{key:"_onPrefetchVideoMetaData",value:function(e){this.video.duration<this.maxDurationLimit&&this._prefetchOverTempVideo(e)}},{key:"_prefetchOverTempVideo",value:function(e){var t,i=this;this.debugTracker.info("Vpaid._prefetchOverTempVideo()"),0!==this.frameType&&1!==this.frameType||(t=function(){var e=window;try{for(;e.document!==e.top.document;)e=e.top;return e}catch(e){return window}}())&&t.document&&t.document.body&&(this._createBufferingVideo(t,e),this.fakePlayPromise=this.bufferingVideo.play(),null!=this.fakePlayPromise&&(this.fakePlayPromise=he(this.fakePlayPromise),this.fakePlayPromise.catch(function(e){i.stopped||i.debugTracker&&i.debugTracker.info("buffering video error:".concat(e))})))}},{key:"_createBufferingVideo",value:function(e,t){this.bufferingVideo=e.document.createElement("video"),this.bufferingVideo.id="prefetchWrapper".concat(this.wrapperIndex),this.bufferingVideo.src=t||this.playingMediaFile.mediaUrl,this.bufferingVideo.muted=!0,this.bufferingVideo.setAttribute("muted",""),this.bufferingVideo.setAttribute("playsinline",""),j(this.bufferingVideo,"buff-vid"),this.bufferingVideo.style.top="".concat(+this.wrapperIndex,"px"),e.document.body.appendChild(this.bufferingVideo)}},{key:"pausePrefetchVideo",value:function(){this.bufferingVideo&&(this.bufferingVideo.pause(),this.debugTracker.info("Vpaid.pausePrefetchVideo()"))}},{key:"_destroyPrefetchVideo",value:function(){this.bufferingVideo&&this.bufferingVideo.parentElement&&(this.bufferingVideo.pause(),this.bufferingVideo.removeAttribute("src"),this.bufferingVideo.load(),this.bufferingVideo.parentElement.removeChild(this.bufferingVideo),this.debugTracker.info("Vpaid._destroyPrefetchVideo()"))}},{key:"resumeAd",value:function(){this.stopped||this.activeVideoElement&&this.watchVideoInterval&&this.activeVideoElement.duration&&(this.emit("activeAdCurrentTime",{currentTime:this.activeVideoElement.currentTime.toFixed(3),duration:this.activeVideoElement.duration.toFixed(3)}),this.watchActiveVideoElement())}},{key:"pauseAd",value:function(){this.activeVideoElement&&this.watchVideoInterval&&this.unwatchActiveVideoElement()}},{key:"stopAd",value:function(){this.stopped||(this.debugTracker.info("Vpaid -> stopAd()"),this.activeVideoElement&&this.watchVideoInterval&&this.unwatchActiveVideoElement(),this.bufferingVideo&&(this.debugTracker.info("Vpaid -> stopAd() -> _destroyPrefetchVideo()"),this._destroyPrefetchVideo()))}},{key:"_fireAdImpression",value:function(){this._onAdImpression()}},{key:"_onAdImpression",value:function(){this.stopped||(this.activeVideoElement=this.getActiveVideoElement(),!this.isVForceActive&&this.activeVideoElement&&this.watchVideoInterval&&this.watchActiveVideoElement())}},{key:"watchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId||(this._sampleVideoCurrentTimeIntervalId=setInterval(this._sampleVideoCurrentTimeHandler.bind(this),50))}},{key:"unwatchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId&&(clearInterval(this._sampleVideoCurrentTimeIntervalId),this._sampleVideoCurrentTimeIntervalId=void 0)}},{key:"_sampleVideoCurrentTimeHandler",value:function(){this.reportCurrentTimeToUnitPredictors(),this.testNewCompletion(),this.reportWatchTime(),this.checkBuffering()}},{key:"reportCurrentTimeToUnitPredictors",value:function(){var e;this.unitPredictorsInterval&&this.activeVideoElement.currentTime&&this.activeVideoElement.duration&&((e=Math.floor(1e3*this.activeVideoElement.currentTime/this.unitPredictorsInterval))&&this._currentIntervalMultiplier!==e&&(this._currentIntervalMultiplier=e,this.emit("activeAdCurrentTime",{currentTime:this.activeVideoElement.currentTime.toFixed(3),duration:this.activeVideoElement.duration.toFixed(3)})))}},{key:"testNewCompletion",value:function(){this.newCompletionByVideoProgress&&!this.newCompletionByVideoProgressFired&&1e3*this.activeVideoElement.currentTime>this.timeoutLengthToAdCompletion&&(this.emit(_e.outer.NewCompletion),this.newCompletionByVideoProgressFired=!0)}},{key:"checkBuffering",value:function(){var e;this.bufferingEventsToReport&&this.bufferingCounter<this.bufferingEventsToReport&&(e=this.activeVideoElement.currentTime,this.bufferingDetected?e>this.lastPlayPos+.03&&(this.bufferingDetected=!1,this.emit("bufferingEnded"),this.bufferingCounter++):e<this.lastPlayPos+.03&&(this.bufferingDetected=!0,this.emit("buffering")),this.lastPlayPos=e)}},{key:"reportWatchTime",value:function(){var e;this.reportWatchTimeInterval&&this.isDirectDemand&&(0<(e=Math.floor(this.activeVideoElement.currentTime))&&this._currentTimeFloored!==e&&e%this.reportWatchTimeInterval==0&&(this._currentTimeFloored=e,this.emit("watchProgress",{currentTime:e})))}},{key:"getActiveVideoElementDuration",value:function(){return this.activeVideoElement?this.activeVideoElement.duration:null}},{key:"onComplete",value:function(){this._destroyPrefetchVideo()}},{key:"reportBufferToDebugTracker",value:function(){this.bufferingVideo&&this.video&&this.video.buffered&&0<this.video.buffered.length&&this.video.buffered.end(0)&&this.debugTracker.info("startAd() - video currentTime:".concat(this.video.currentTime,"; buffered:").concat(0<this.video.buffered.length?this.video.buffered.end(0):0," sec"))}}])&&Me(e.prototype,t),i&&Me(e,i),s}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function We(e,t,i){return(We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=je(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=je(i);return e=s?(e=je(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==Le(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ne=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(r,Fe);var e,t,i,n=He(r);function r(e,t,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=n.call(this,e,t,i)).vpaidLog=t,s.store=i,s.target=e.slot,s.video=e.videoSlot,s.mediaFiles=e.vpaidFiles,s.mediaFile,s.mediaUrl,s.playerWidth=0,s.playerhHeight=0,s.adVolume=0,s.skipTime=60,s.eventsToFire={adLoaded:!1,adImpression:!1},s.adPaused=!0,s.playerReady=!1,s.videoLength=0,s.vpaidEvents=Object.assign({},we.a),s._createBindedCallback(),s.playerDAST=e.playerDAST,s.tag=e.tag,0<e.trackingPixels.progress.length&&(s.progressEvents=e.trackingPixels.progress),s.store.on("stop",function(){s.stopAd()}),s.firstPauseAd=!0,s}return e=r,(t=[{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&void 0!==e&&this.off(t,e)}},{key:"handshakeVersion",value:function(){return"1.1"}},{key:"initAd",value:function(e,t,i){this.stopped||(this.resizeAd(e,t,i),this._prepareVideoTag())}},{key:"resizeAd",value:function(e,t,i,s){this.stopped||(this.playerWidth=parseInt(e),this.playerhHeight=parseInt(t),this.video.style.width=this.playerWidth+"px",this.target.style.width=this.playerWidth+"px",this.video.style.height=this.playerhHeight+"px",this.target.style.height=this.playerhHeight+"px",this.video.setAttribute("width",this.playerWidth),this.target.setAttribute("width",this.playerWidth),this.video.setAttribute("height",this.playerhHeight),this.target.setAttribute("height",this.playerhHeight),this._resizeAd(this.playerWidth,this.playerhHeight,i,s))}},{key:"startAd",value:function(){this._bindedOnPlay(),this.startAdFired=!0}},{key:"_onStartAd",value:function(){this.debugTracker.info("VideoVpaid -> startAd()"),this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> startad() -> _fireAdImpression()")}},{key:"pauseAd",value:function(){this.debugTracker.info("VideoVpaid -> pauseAd()"),We(je(r.prototype),"pauseAd",this).call(this),this.stopped||(this.video.pause(),this.firstPauseAd&&(this.debugTracker.info("VideoVpaid -> pauseAd() - reset currentTime"),this.video.currentTime=0,this.firstPauseAd=!1,this.video.buffering=!1))}},{key:"resumeAd",value:function(){We(je(r.prototype),"resumeAd",this).call(this),this.stopped||(this._sendAdPlayingOnProgress=!0,this.video.play())}},{key:"stopAd",value:function(){We(je(r.prototype),"stopAd",this).call(this),this.stopped||(this.stopped=!0,this.video.destroy(),this._disconnectFromVideoTag(),this.vpaidLog=this.store=this.mediaFiles=this.target=this.video=this._onError=this._onSwitchFromCanvasToVideo=this.isReplayable=this.eventsToFire=this.progressEvents=void 0,setTimeout(this.onAfterStop,50))}},{key:"restartAd",value:function(){}},{key:"skipAd",value:function(){this.stopped||this.getAdSkippableState()&&(this.emit(this.vpaidEvents.AdSkipped),this.stopAd())}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdVolume",value:function(e){e&&e(null,this.adVolume)}},{key:"getAdDuration",value:function(){return this.video.duration||this.videoLength}},{key:"getAdSkippableState",value:function(){return 0==this.getAdSkippableRemainingTime()}},{key:"getAdSkippableRemainingTime",value:function(){var e=this.getAdRemainingTime()-this.skipTime;return 0<e?e:0}},{key:"getAdRemainingTime",value:function(){return this.stopped?0:this.video.remainingTime}},{key:"getAdWidth",value:function(){return this.video.videoWidth}},{key:"getAdHeight",value:function(){return this.video.videoHeight}},{key:"getAdIcons",value:function(){return[]}},{key:"getAdCompanions",value:function(){return[]}},{key:"getAdExpanded",value:function(){return!0}},{key:"getAdLinear",value:function(){return!0}},{key:"setAdVolume",value:function(e){this.stopped||(this.video.volume=this.adVolume=parseFloat(e)<=1?e:parseInt(e)/100,this.video.muted=0==e)}},{key:"_connectToVideoTag",value:function(){this.stopped||(this.video.addEventListener("canplay",this._bindedOnCanPlay,!0),this.video.addEventListener("durationchange",this._bindedOnDurationChange,!0))}},{key:"_connectVideoEvents",value:function(){this.stopped||(this.video.addEventListener("play",this._bindedOnPlay,!0),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.video.addEventListener("pause",this._bindedOnPause,!0),this.video.addEventListener("ended",this._bindedOnComplete,!0),this.video.addEventListener("error",this._bindedOnPlayerError,!0),this.video.addEventListener("click",this._bindedOnClickThru,!0),this.video.addEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.addEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.addEventListener("ticking",this._bindedOnTicking,!0),this.video.addEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.addEventListener("midpoint",this._bindedOnProgress,!0),this.video.addEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.addEventListener("timeProgress",this._bindedOnProgress,!0),this.video.addEventListener("waiting",this._bindedOnWaiting,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("canplay",this._bindedOnCanPlay,!0),this.video.removeEventListener("play",this._bindedOnPlay,!0),this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.video.removeEventListener("pause",this._bindedOnPause,!0),this.video.removeEventListener("ended",this._bindedOnComplete,!0),this.video.removeEventListener("error",this._bindedOnPlayerError,!0),this.video.removeEventListener("click",this._bindedOnClickThru,!0),this.video.removeEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.removeEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.removeEventListener("ticking",this._bindedOnTicking,!0),this.video.removeEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("midpoint",this._bindedOnProgress,!0),this.video.removeEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("timeProgress",this._bindedOnProgress,!0),this.video.removeEventListener("durationchange",this._bindedOnDurationChange,!0),this.video.removeEventListener("waiting",this._bindedOnWaiting,!0),this._bindedOnCanPlay=this._bindedOnPlay=this._bindedOnPause=this._bindedOnComplete=this._bindedOnPlayerError=this._bindedOnVolumeChange=this._bindedOnTimeUpdate=this._bindedOnTicking=this._bindedOnProgress=this._bindedOnDurationChange=this._bindedOnWaiting=this._bindedOnPlaying=this._bindedOnPlaying=this._bindedOnClickThru=void 0}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this.playingMediaFile=this.video.appendVideoSources(this.mediaFiles),this.playingMediaFile&&(this.mediaUrl=this.playingMediaFile.mediaUrl,this.debugTracker.time("[VpaidWrapper".concat(this.wrapperIndex,"] video.src->onCanPlay")),this.playerDAST.set({vu:this.playingMediaFile.mediaUrl,vbr:this.playingMediaFile.bitrate,vwd:this.playingMediaFile.width,vht:this.playingMediaFile.height,ot:this.playingMediaFile.originalType,st:this.playingMediaFile.subType})))}},{key:"_createBindedCallback",value:function(){this._bindedOnCanPlay=this._onCanPlay.bind(this),this._bindedOnPause=this._onPause.bind(this),this._bindedOnComplete=this._onComplete.bind(this),this._bindedOnPlayerError=this._onPlayerError.bind(this),this._bindedOnVolumeChange=this._onVolumeChange.bind(this),this._bindedOnTimeUpdate=this._onTimeUpdate.bind(this),this._bindedOnTicking=this._onTicking.bind(this),this._bindedOnProgress=this._onProgress.bind(this),this._bindedOnDurationChange=this._onDurationChange.bind(this),this._bindedOnWaiting=this._onWaiting.bind(this),this._bindedOnPlay=this._onPlay.bind(this),this._bindedOnPlaying=this._onPlaying.bind(this),this._bindedOnClickThru=this._onClickThru.bind(this)}},{key:"_onCanPlay",value:function(){this.stopped||(this.videoLength=this.video.duration,Q(this.vpaidLog,"canplay",{videoCanPlay:!0}),this.logVideoBuffer("Canplay"),this.playerReady||(this.playerReady=!0,this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdLoaded()"),this._fireAdLoaded(),this.debugTracker.timeEnd("[VpaidWrapper".concat(this.wrapperIndex,"] video.src->onCanPlay")),this.adPaused||(this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdImpression() because !adPaused"))))}},{key:"_onPlay",value:function(e,t){this.debugTracker.info("VideoVpaid -> onPlay()"),this.stopped||(this.adPaused?(this.adPaused=!1,e&&(this.debugTracker.info("VideoVpaid -> onPlay() -> before setTimeout(_fireAdImpression()) in ".concat(t," ms")),setTimeout(function(){this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onPlay() -> setTimeout(_fireAdImpression())")}.bind(this),t))):this._sendAdPlayingOnProgress=!0)}},{key:"_onPlaying",value:function(e){this._conditionalDispatchAdPlaying()}},{key:"_conditionalDispatchAdPlaying",value:function(){this._sendAdPlayingOnProgress&&(this.emit(this.vpaidEvents.AdPlaying),this._sendAdPlayingOnProgress=!1)}},{key:"_onPause",value:function(){this.stopped||(this.adPaused=!0,parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.emit(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function(){this.stopped||(this.emit(this.vpaidEvents.AdVideoComplete),this.stayAlive||this.emit(this.vpaidEvents.AdStopped),We(je(r.prototype),"onComplete",this).call(this))}},{key:"_onPlayerError",value:function(){this.stopped||0<--this.video.relevantSources||this.emit(this.vpaidEvents.AdError)}},{key:"_onVolumeChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{volume:this.video.volume}})}},{key:"_onTimeUpdate",value:function(){this.stopped||(this.videoLength=this.getAdDuration(),this.videoLength&&this._conditionalDispatchAdPlaying())}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_onDurationChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdDurationChange)}},{key:"_onWaiting",value:function(){Q(this.vpaidLog,"waiting",{videoCurrentTime:this.video.currentTime})}},{key:"_onClickThru",value:function(e){e?(this._sendAdPlayingOnProgress=!0,this.video.play()):(this.emit(this.vpaidEvents.AdClickThru,{eventData:{playerHandles:!0}}),this.video.pause())}},{key:"_registerToProgressEvent",value:function(){this.progressEvents&&this.video.registerProgressEvents(this.progressEvents)}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;0<e&&this.video.registerTickingEvents(e)}},{key:"_fireAdLoaded",value:function(){this.eventsToFire.adLoaded||this.emit(this.vpaidEvents.AdLoaded),this.eventsToFire.adLoaded=!0}},{key:"_fireAdImpression",value:function(){We(je(r.prototype),"_fireAdImpression",this).call(this),this.stopped||this.eventsToFire.adImpression||(this.emit(this.vpaidEvents.AdVideoStart),this.emit(this.vpaidEvents.AdImpression),this.debugTracker.timeEnd("[VpaidWrapper".concat(this.wrapperIndex,"] startAd->impression")),this.eventsToFire.adImpression=!0,this.adPaused=!1,this._registerToProgressEvent(),this._registerToTickingEvent())}},{key:"_onProgress",value:function(e){"firstQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoFirstQuartile):"midpoint"===e.type?this.emit(this.vpaidEvents.AdVideoMidpoint):"thirdQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoThirdQuartile):"timeProgress"===e.type&&this._onTimeProgressEvent(e.data)}},{key:"_onTimeProgressEvent",value:function(e){for(var t=0;t<this.progressEvents.length;t++)this.progressEvents[t].fired||this.progressEvents[t].offset<=("time"===this.progressEvents[t].offsetType?e.time:e.pre)&&(this.progressEvents[t].fired=!0,this.emit(this.vpaidEvents.Progress,{eventData:this.progressEvents[t]}),this.progressEvents.splice(t,1))}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){return this.stopped?"":this.video.getSrc()}},{key:"dontDie",value:function(){this.stayAlive=!0}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"logVideoBuffer",value:function(e){void 0!==this.video.bufferSize&&Q(this.vpaidLog,"videoBuffer",{status:e,buffered:this.video.bufferSize},!1,!1)}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_resizeAd",value:function(e,t,i,s){}},{key:"getActiveVideoElement",value:function(){return this.video}}])&&Be(e.prototype,t),i&&Be(e,i),r}();function qe(e){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Ge(e,t,i){return(Ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xe(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Xe(i);return e=s?(e=Xe(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==qe(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ye=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(n,Ne);var e,t,i,s=Ke(n);function n(e,t,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),i=s.call(this,e,t,i),window.setTimeout(e.onReady,0),i}return e=n,(t=[{key:"startAd",value:function(){this.video.play(),Ge(Xe(n.prototype),"startAd",this).call(this)}},{key:"_onCanPlay",value:function(){this.playerReady||this.video.pause(),Ge(Xe(n.prototype),"_onCanPlay",this).call(this)}},{key:"_onPlay",value:function(){this.startAdFired&&Ge(Xe(n.prototype),"_onPlay",this).call(this,this.playerReady,200)}},{key:"_onClickThru",value:function(){this.stopped||(this.store.set("forcePause",!1),Ge(Xe(n.prototype),"_onClickThru",this).call(this,this.adPaused))}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.debugTracker.info("VideoVpaidDesk -> _prepareVideoTag()"),this.video.removeAttribute("controls"),this._connectToVideoTag(),this._connectVideoEvents(),this._loadVideoTagSources())}},{key:"isReplayable",value:function(){return!0}},{key:"dontDie",value:function(){this.stayAlive=!0}}])&&ze(e.prototype,t),i&&ze(e,i),n}();function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Ze(e,t,i){return(Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=it(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function et(e,t){return(et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tt(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=it(i);return e=s?(e=it(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==Je(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var st=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}(n,Ne);var e,t,i,s=tt(n);function n(e,t,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(i=s.call(this,e,t,i)).firstResumeAd=!0,i._initVpaid(e),window.setTimeout(e.onReady,0),i}return e=n,(t=[{key:"initAd",value:function(e,t,i){Ze(it(n.prototype),"initAd",this).call(this,e,t,i)}},{key:"startAd",value:function(){this.debugTracker.info("VideoVpaidMob -> startAd()"),this.debugTracker.time("[VpaidWrapper".concat(this.wrapperIndex,"] startAd->impression")),this.isVForceActive||(this.video.buffering=!1),this._onStartAd(this)}},{key:"resizeAd",value:function(e,t,i,s){Ze(it(n.prototype),"resizeAd",this).call(this,e,t,i,s),this.video.resize&&this.video.resize(e,t,s)}},{key:"stopAd",value:function(){this.stopped||(this.timeUpdateInterval=clearTimeout(this.timeUpdateInterval),Ze(it(n.prototype),"stopAd",this).call(this))}},{key:"_createBindedCallback",value:function(){Ze(it(n.prototype),"_createBindedCallback",this).call(this),this._bindedOnPlaying=this._onPlaying.bind(this)}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.video.removeAttribute("controls"),this._connectToVideoTag(),this._loadVideoTagSources(),this.prefetchVideo("video",this.mediaUrl),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.isIOS&&this.video.load())}},{key:"_connectToVideoTag",value:function(){this.stopped||(0<this.slowConnectionLength&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),Ze(it(n.prototype),"_connectToVideoTag",this).call(this),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.addEventListener("click",this._bindedOnClickThru,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.removeEventListener("click",this._bindedOnClickThru,!0)}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this._sortMediaFiles(),Ze(it(n.prototype),"_loadVideoTagSources",this).call(this))}},{key:"_onPlaying",value:function(){this.stopped||(this.eventsToFire.adImpression&&(this.adPaused=!1),Q(this.vpaidLog,"videoPlaying",{vidCurrentTime:this.video.currentTime}))}},{key:"_onPlay",value:function(){var e=this;if(!this.stopped){if(this.debugTracker.info("VideoVpaidMob -> onPlay()"),!this.video.forceCanvas&&this.store.get("dataSaverDetected")||(this.debugTracker.info("VideoVpaidMob -> _onPlay() -> video.play()because canvas or !dataSaverDetected!"),this.video.play()),this.startAdFired)return this.emit(this.vpaidEvents.AdPlaying),!0;this.emit(this.vpaidEvents.AdVideoStart),Ze(it(n.prototype),"_onPlay",this).call(this,!0,2e3),this.timeUpdateInterval=setInterval(function(){e.stopped||e._onTimeUpdate()},250)}}},{key:"_onPlayerError",value:function(){this.isCanvasMpeg||Ze(it(n.prototype),"_onPlayerError",this).call(this)}},{key:"_onClickThru",value:function(){if(event.preventDefault(),event.stopPropagation(),!this.stopped){if(this.isIOS){var e=(new Date).getTime();if(null!==this.lastClickTime&&e-this.lastClickTime<=100)return;this.lastClickTime=e}Ze(it(n.prototype),"_onClickThru",this).call(this,this.adPaused||this.store.get("dataSaverDetected")&&0===this.video.currentTime)}}},{key:"_onCanPlay",value:function(){this.stopped||(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this._preventAdLoadIfVideoBufferTooShort()||Ze(it(n.prototype),"_onCanPlay",this).call(this))}},{key:"isReplayable",value:function(){return!this.video.forceCanvas}},{key:"_initVpaid",value:function(e){var t=this;this.videoLength=e.extra.duration||30,this.clickableTarget=e.clickableTarget||null,this.tag=e.tag,this.isCanvasMpeg=this.video.forceCanvas,this.lastClickTime=null,this.isIOS="iOS"===this.store.get("wurfl.os.name"),this.isCanvasMpeg&&this.video.addEventListener("canvasToVideo",function(){t.playerDAST.set({ctv:!0}),t.adPaused=t.video.paused}),this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0,this.minBufferSize=this.store.get("mnbfrsz")||1)}},{key:"_sortMediaFiles",value:function(){var i=this.playerWidth;this.mediaFiles.sort(function(e,t){return Math.abs(i-e.width)-Math.abs(i-t.width)}).sort(function(e,t){return e.bitRate-t.bitRate})}},{key:"_resizeAd",value:function(e,t){this.newVidCreated&&this.newVid&&(this.newVid.style.width="".concat(e,"px"),this.newVid.style.height="".concat(t,"px"))}},{key:"resumeAd",value:function(){this.debugTracker.info("VideoVpaidMob -> resumeAd()"),this.firstResumeAd&&(this.debugTracker.info("VideoVpaidMob -> first resumeAd()"),this.isIOS?this._handleIOSFirstResumeAd():this._handleAndroidFirstResumeAd(),this._connectVideoEvents(),this.firstResumeAd=!1),Ze(it(n.prototype),"resumeAd",this).call(this)}},{key:"_handleIOSFirstResumeAd",value:function(){this.pausePrefetchVideo(),this.reportBufferToDebugTracker()}},{key:"_handleAndroidFirstResumeAd",value:function(){this.video.buffered&&0<this.video.buffered.length&&this.video.buffered.end(0)&&this.debugTracker.info("VideoVpaidMob -> startAd() - video currentTime:".concat(this.video.currentTime,"; buffered:").concat(this.video.buffered.end(0)," sec")),this.video.currentTime=0}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_preventAdLoadIfVideoBufferTooShort",value:function(){return!!this._isBufferTooShort()&&(this._onSlowConnecionDetected(),!0)}},{key:"_isBufferTooShort",value:function(){var e=0<this.slowConnectionLength,t=!this.video.forceCanvas&&this.video.buffered&&0<this.video.buffered.length;return e&&t&&this.video.buffered.end(0)<this.minBufferSize}}])&&$e(e.prototype,t),i&&$e(e,i),n}();function nt(e){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function at(e,t,i){return(at="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=ht(i);return e=s?(e=ht(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==nt(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var lt=s(25),ut=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(r,Fe);var e,t,i,n=dt(r);function r(e,t,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=n.call(this,e,t,i)).vpaidLog=t,s.store=i,s.stopped=!1,s.target=e.slot,s.video=e.videoSlot,s.mediaFiles=e.vpaidFiles,s.mediaUrl,s.debugTracker=new d("JsVpaid"),s.baseUrl=s.store.get("base_url"),s._onError=e.onError,s.vpaidEvents=Object.assign({},we.a),s.volume=0,s.isMuted=!0,s.pauseVideoProtection=s.store.get("pusvidprtctn"),s.vpaidResourcesHandler=e.vpaidResourcesHandler,s.playerDAST=e.playerDAST,s.adSettings=e.adSettings,s.vpaidInit={},s.secureMediaFile=ie(i),s.tag=e.tag,s.logVpaidTextElements=s.store.get("lgvpdtxtelmnts"),s.countdownRegex=s.store.get("cntdwnrgx"),s.countdownRegex&&(s.countdownRegex=new RegExp(s.countdownRegex,"ig")),s.store.on("stop",function(){s.stopAd()}),s.minValidVideoDuration=s.store.get("mnvlddrtn"),s.adImpressionEvent=s.tag.getValueByKey("adimpevt"),s}return e=r,(t=[{key:"initAd",value:function(e,t,i,s,n,r){var a=this.mediaFiles[0];this.secureMediaFile&&(Q(this.vpaidLog,"shouldSecureUrl",{replacedProtocol:-1<a.url.indexOf("http:")},!1,!1),a.url=a.url.replace("http:","https:")),this.playerDAST.set({vbr:a.bitrate,vwd:a.width,vht:a.height,ot:a.originalType,st:a.subType}),this.mediaUrl=a.url,this.debugTracker.info("Loading","Iframe was loaded!"),this._shouldHideTarget()&&(this.target.style.display="none");a=this.tag.getValueByKey("aduntladtmt")||1e4,a=new lt(this.target,this.video,{extraOptions:{zIndex:"1"}},{timeout:a},this.store);this.vpaid=a,this.vpaidInit={width:e,height:t,viewMode:i,bitRate:s,creativeData:n,environmentVars:r},a.loadAdUnit(this.mediaUrl,this._onLoadAdUnit.bind(this))}},{key:"handshakeVersion",value:function(e){return"2.0"}},{key:"resizeAd",value:function(e,t,i,s){this.stopped||(this.target.style.width=e+"px",this.target.style.height=t+"px",this.target.setAttribute("width",e),this.target.setAttribute("height",t),this._safeCall("resizeAd",[e,t,i]),this._resizeAd([e,t,s]))}},{key:"stopAd",value:function(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"pauseAd",value:function(){var e=this;at(ht(r.prototype),"pauseAd",this).call(this);var t=function(){};(this.pauseVideoProtection||this.adRestarted)&&(t=function(){!e.stopped&&e.video&&(Q(e.vpaidLog,"pauseAdProtection",{paused:e.video.paused,adRestarted:e.adRestarted}),e.video.paused||e.video.pause())}),this.video.resumeInvoked=!1,this._safeCall("pauseAd",[t])}},{key:"resumeAd",value:function(e){var t=this;at(ht(r.prototype),"resumeAd",this).call(this);e=e?function(){t.video.play()}:function(){};this.adSettings&&this.adSettings.hasOwnProperty("onrsm")&&this.adSettings.onrsm&&(e=this.adSettings.onrsm.bind(this)),this.video.resumeInvoked=!0,this._safeCall("resumeAd",[e])}},{key:"skipAd",value:function(){this._safeCall("skipAd",[])}},{key:"startAd",value:function(){this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoStartAdUnitTime","start"),this._safeCall("startAd",[])}},{key:"expandAd",value:function(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function(){this._safeCall("collapseAd",[])}},{key:"restartAd",value:function(e,t){this.stopped||(this.clickThruUrl=t,""===this._getVideoSrc(this.video)?e&&(this.video.src=e,this._bindedOnRestartVideoLoad=this._onRestartVideoLoad.bind(this),this.video.addEventListener("canplay",this._bindedOnRestartVideoLoad),this.video.load()):this._onRestartVideoLoad())}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"getAdWidth",value:function(){return this._activeVideoElement?this._activeVideoElement.videoWidth:this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function(){return this._activeVideoElement?this._activeVideoElement.videoHeight:this._safeCall("getAdHeight",[])}},{key:"getAdSkippableRemainingTime",value:function(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function(e){return this._safeCall("getAdRemainingTime",[e])}},{key:"getAdDuration",value:function(e){return this._safeCall("getAdDuration",[e])}},{key:"getAdSkippableState",value:function(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function(e){return this._safeCall("getAdVolume",[e])}},{key:"getAdIcons",value:function(e){this._safeCall("getAdIcons",[e])}},{key:"getAdCompanions",value:function(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function(){return this._safeCall("getAdLinear",[])}},{key:"setAdVolume",value:function(e){var t=this;this.volume=e,this.video.muted=this.isMuted=0===this.volume,this._safeCall("setAdVolume",[e,function(){t.adRestarted&&(t.video.volume=e,t.video.muted=0===e)}])}},{key:"isReplayable",value:function(){return this.video&&""!==this._getVideoSrc(this.video)}},{key:"getDOMContainer",value:function(){return this.target}},{key:"checkUnfriendlyIframe",value:function(){var t,i=function(e){if(!e)return null;for(var t=e.querySelector("iframe");t;)try{t=t.contentDocument.querySelector("iframe")}catch(e){break}return t}(this.target);try{return i&&i.contentDocument,!1}catch(e){return t=i.src,Q(this.vpaidLog,"unfriendlyIframe",{src:t}),!0}}},{key:"getVideoUrl",value:function(){if(this.stopped)return"";var e=this.getActiveVideoElement();return e?this._getVideoSrc(e):""}},{key:"getVPAIDVideoElement",value:function(){return this._activeVideoElement||null}},{key:"logVideoUrl",value:function(){var e=this.getVideoUrl();e&&(Q(this.vpaidLog,"jsVpaidVideoUrl",{videoUrl:e}),this.vpaidLog.friendlyVideoUrl=!0)}},{key:"toggleIframeContentDisplay",value:function(e){try{var t="none";"hide"===e?t="hidden":"show"===e&&(t="visible"),this.adUnit._iframe.contentWindow.document.body.style.visibility=t}catch(e){Q(this.vpaidLog,"toggleIframeContentDisplayFail",{ex:e})}}},{key:"setCompletionOnAdStoppedTimeout",value:function(){var e=this,t=this.tag.getValueByKey("cmpltonstpdms");0<t&&(this.completionOnAdStoppedTimeout||(this.completionOnAdStoppedTimeout=setTimeout(function(){e.stopped||e.emit(e.vpaidEvents.AdStopped)},t)))}},{key:"handleVpaidContent",value:function(){var e=this;this.adUnit._iframe&&(this.logVpaidTextElements||this.countdownRegex)&&setTimeout(function(){e.vpaidTextElements={},e._getAndHandleVpaidContent(e.adUnit._iframe),0<Object.keys(e.vpaidTextElements).length&&Q(e.vpaidLog,"vpaidTextElements",e.vpaidTextElements)},1)}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"_onLoadAdUnit",value:function(e,t){try{if(this.stopped)return;if(e)return void this._onLoadAdUnitError(e);Q(this.vpaidLog,"loadVPAIDJSScript",{scriptLoaded:!0}),this.adUnit=t,this.store.get("imapihok")&&this._hookIMA(),this._bindIframe(t),this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoJsVpaidAdUnitTime","start"),this._bindAdUnitEvents(t),t.handshakeVersion("2.0",this._onHandshake.bind(this)),this._handleCompleteOnAdStopped()}catch(e){Q(this.vpaidLog,"loadVPAIDJSScriptErr",{err:e.message})}}},{key:"_onLoadAdUnitError",value:function(e){Q(this.vpaidLog,"loadVPAIDJSScript",{scriptLoadedError:!0}),this.store&&this.store.get("aduntldflbfruntld")?this._onError(e,"adUnitLoadFailed"):this._onError()}},{key:"_onHandshake",value:function(){this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoInitAdUnitTime","start"),this.adUnit.initAd(this.vpaidInit.width,this.vpaidInit.height,this.vpaidInit.viewMode,-1,this.vpaidInit.creativeData,{})}},{key:"_handleCompleteOnAdStopped",value:function(){var e=this.store.get("cmpltonstpddmn");e&&0<e.length&&-1!=this.mediaUrl.search(new RegExp(e.join("|"),"i"))&&(this.completeOnAdStop=!0)}},{key:"_bindIframe",value:function(e){e=e._iframe;this.vpaidResourcesHandler.inject(e,this),this._onBindIframe(e),this._loadAdditionalScripts()}},{key:"_bindAdUnitEvents",value:function(e){var t,i=this;for(t in this.vpaidEvents)!function(t){e.subscribe(t,function(e){i._allEventsHandler(t,e)})}(t)}},{key:"_allEventsHandler",value:function(e,t){if(!this.stopped){if(this._shouldHideTarget()&&"block"!==this.target.style.display&&(this.target.style.display="block"),this.adImpressionEvent){if(e===this.vpaidEvents.AdImpression)return;e===this.adImpressionEvent&&(this.adImpressionEvent=void 0,this._allEventsHandler(this.vpaidEvents.AdImpression))}e===this.vpaidEvents.AdStopped?(this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.onComplete()):e===this.vpaidEvents.AdLoaded?(this.adLoaded=!0,this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoInitAdUnitTime","stop")):e===this.vpaidEvents.AdImpression?this._onAdImpression():e===this.vpaidEvents.AdError&&this._onAdError(),this.emit(e,{eventData:t})}}},{key:"_onAdImpression",value:function(){at(ht(r.prototype),"_onAdImpression",this).call(this);var e=this.video.src;e&&Q(this.vpaidLog,"videoUrl",{url:e}),this.pauseVideoProtection&&this.video&&this.video.protectPause(),this._registerToTickingEvent(),this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoStartAdUnitTime","stop")}},{key:"_dispatchAdImpression",value:function(){return!0}},{key:"_safeCall",value:function(t,i){if(!this.stopped&&this.adUnit){"resizeAd"===t&&this._resizeAd(i);try{return this.adUnit[t].apply(this.adUnit,i)}catch(e){return Q(this.vpaidLog,"initJsError",{err:e.message,funcName:t,args:i,stack:e.stack}),this._onSafeCallAdError(e),!1}}}},{key:"_resizeAd",value:function(e,t,i,s){}},{key:"_onSafeCallAdError",value:function(e){}},{key:"_getVideoSrc",value:function(e){if(!this.stopped)return e.getSrc?e.getSrc():e.src||e.currentSrc||""}},{key:"_stopAd",value:function(){at(ht(r.prototype),"stopAd",this).call(this),this.stopped||(this.adUnit&&this._destroyAdUnit(),this._bindedOnTicking&&(this.video.removeEventListener("ticking",this._bindedOnTicking),this._bindedOnTicking=void 0),this.stopped=!0,this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.iframe=this.vpaid=this.imaApi=this.callIMAApi=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=this._onSwitchFromCanvasToVideo=this.vpaidLog=this.store=this.tag=this.registerAnalyticsToVpaidLog=void 0,this.onAfterStop())}},{key:"_destroyAdUnit",value:function(){if(this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoJsVpaidAdUnitTime","stop"),this.vpaidLog.saveToDbWithoutReport(),this.vpaidResourcesHandler.destroy(this.adUnit._iframe),this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&this.additionalScripts&&0<this.additionalScripts.length)try{for(var e=0;e<this.additionalScripts.length;e++)this.adUnit._iframe.contentDocument.head.removeChild(this.additionalScripts[e]);this.onIframeEvent=void 0}catch(e){}this.adUnit._destroy()}},{key:"_onRestartVideoLoad",value:function(){var t=this;this.adRestarted=!0,this._bindedOnRestartVideoLoad&&(this.video.removeEventListener("canplay",this._bindedOnRestartVideoLoad),this._bindedOnRestartVideoLoad=void 0),this.video.currentTime=0,this._resizeVideotoParentSize(),this.video.play();function i(){t.clickThruUrl&&t.emit(t.vpaidEvents.AdClickThru,{eventData:{url:t.clickThruUrl,playerHandles:!0}})}this.video.addEventListener("ended",function e(){t.video.removeEventListener("ended",e),t.video.removeEventListener("click",i),t._allEventsHandler(t.vpaidEvents.AdStopped,{}),t._allEventsHandler(t.vpaidEvents.AdVideoComplete,{})}),this.video.addEventListener("click",i)}},{key:"_resizeVideotoParentSize",value:function(){this.video.style.width=this.target.style.width,this.video.style.height=this.target.style.height}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_getActiveVideoInIframes",value:function(e){var t=this,i=null;if(!e||0===e.length)return i;try{q(e[0],"iframe",function(e){e.forEach(function(e){i||(!t.minValidVideoDuration||e.duration&&e.duration>t.minValidVideoDuration)&&(i=e)})},"video",this.store.get("debug"))}catch(e){}return i}},{key:"_getAndHandleVpaidContent",value:function(e){try{for(var t=e.contentWindow.document.body.getElementsByTagName("*")||[],i=0;i<t.length;i++){var s,n=t[i],r=n.nodeName.toLowerCase();"script"!==r&&("iframe"===r?this._getAndHandleVpaidContent(n):(s=n.textContent?n.textContent.trim():"")&&this._logVpaidTextElements(n,r,s))}}catch(e){}}},{key:"_logVpaidTextElements",value:function(e,t,i){this.logVpaidTextElements&&(this.vpaidTextElements[t]=this.vpaidTextElements[t]||[],this.vpaidTextElements[t].push({id:e.id,className:e.className,text:i}))}},{key:"_loadAdditionalScripts",value:function(){if(this.adSettings&&this.adSettings.hasOwnProperty("adtnlscrpts")&&this.adSettings.adtnlscrpts){this.additionalScripts=[],this.onIframeEvent=this._onIframeEvent.bind(this);try{for(var e=0;e<this.adSettings.adtnlscrpts.length;e++){var t=this.adUnit._iframe.contentDocument.createElement("script");t.src=this.adSettings.adtnlscrpts[e].src,t.type="text/javascript",t.onload=this.adSettings.adtnlscrpts[e].clbk.bind(this),this.adUnit._iframe.contentDocument.head.appendChild(t),this.additionalScripts.push(t)}}catch(e){}}}},{key:"_onIframeEvent",value:function(e){this.stopped||this._shouldListenToIframeEvents()&&this.adSettings.ifrmevts.hasOwnProperty(e.name)&&this.vpaidEvents.hasOwnProperty(this.adSettings.ifrmevts[e.name])&&this._allEventsHandler(this.adSettings.ifrmevts[e.name],{})}},{key:"_shouldListenToIframeEvents",value:function(){return this.adSettings&&this.adSettings.hasOwnProperty("ifrmevts")&&this.adSettings.ifrmevts}},{key:"_onAdError",value:function(){this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoInitAdUnitTime","stop"),this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoStartAdUnitTime","stop"),this.vpaidResourcesHandler.setPerformanceMeasurement(this.adUnit._iframe,"videoJsVpaidAdUnitTime","stop")}},{key:"_shouldHideTarget",value:function(){return this.adSettings.hasOwnProperty("hdtrgt")&&this.adSettings.hdtrgt}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;0<e&&(this._bindedOnTicking=this._onTicking.bind(this),this.video.addEventListener("ticking",this._bindedOnTicking),this.video.registerTickingEvents(e))}},{key:"getActiveVideoElement",value:function(){if(!this.stopped)return this._activeVideoElement||(this._getVideoSrc(this.video)?(this._activeVideoElement=this.video,Q(this.vpaidLog,"jsVpaidVideo",{videoType:"local"})):(this._activeVideoElement=this._getActiveVideoInIframes(this.target.querySelectorAll("iframe")),this._activeVideoElement?Q(this.vpaidLog,"jsVpaidVideo",{videoType:"friendlyIframe"}):Q(this.vpaidLog,"jsVpaidVideo",{videoType:"unfriendlyIframe"})),this._activeVideoElement)}}])&&rt(e.prototype,t),i&&rt(e,i),r}();function ct(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var pt=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.iframe=e,this.channel=void 0,this.sid=void 0,this.store=t,this.vpaidLog=i,this.protocol=this.store.get("httpsOverride")?"https:":window.location.protocol||"http:"}var e,t,i;return e=s,(t=[{key:"listenToMessages",value:function(){this.iframe.contentWindow.addEventListener("message",this.onmessage.bind(this))}},{key:"removeMessagesListener",value:function(){this.iframe.contentWindow.removeEventListener("message",this.onmessage.bind(this))}},{key:"onmessage",value:function(e){if(e){var t={};try{t=JSON.parse(e.data.replace("ima://",""))}catch(e){return}"viewabilityMeasurement"!==t.type&&(void 0!==t.channel&&void 0===this.channel&&(this.channel=t.channel),void 0!==t.sid&&"*"!==t.sid&&void 0===this.sid&&(this.sid=t.sid)),void 0!==this.channel&&void 0!==this.sid&&this.removeMessagesListener()}}},{key:"callApi",value:function(e,t){var i;this.channel&&this.sid&&this.iframe&&(i={name:"adsManager",type:e.replace("Ad",""),sid:this.sid,channel:this.channel},"volume"==e&&(i.data={volume:t}),i="\n                    var ifrms = document.querySelectorAll('iframe');\n\n                    ifrms.forEach(ifrm => {\n                        if (ifrm.src.indexOf('imasdk.googleapis.com') > -1 && ifrm.src.indexOf('bridge') > -1 && (ifrm.src.indexOf('#".concat(this.sid,"') > -1 || ifrm.src.indexOf('#").concat(this.channel,"') > -1)) {\n                            ifrm.contentWindow.postMessage('ima://").concat(G(i),"', '").concat(this.protocol,"//imasdk.googleapis.com');\n                        }\n                    });\n                "),te(this.iframe.contentWindow,i))}}])&&ct(e.prototype,t),i&&ct(e,i),s}();function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ft(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function mt(e,t,i){return(mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bt(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function gt(e,t){return(gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function yt(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=bt(i);return e=s?(e=bt(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==vt(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _t=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gt(e,t)}(r,ut);var t,i,s,n=yt(r);function r(e,t,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(i=n.call(this,e,t,i))._initVpaid(e),setTimeout(e.onReady,2),i}return t=r,(i=[{key:"resumeAd",value:function(){mt(bt(r.prototype),"resumeAd",this).call(this,this.adRestarted)}},{key:"setAdVolume",value:function(e){this.store.get("frcvlm")&&(this.video.volume=e,this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{dispatcher:this}})),mt(bt(r.prototype),"setAdVolume",this).call(this,e)}},{key:"onMuteChanged",value:function(e){this.isMuted=e}},{key:"_initVpaid",value:function(e){this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.adLoaded=!1,this.callIMAApi=void 0}},{key:"_hookIMA",value:function(){this.imaApi=new pt(this.adUnit._iframe,this.store,this.vpaidLog),this.imaApi.listenToMessages(),this.callIMAApi=this.imaApi.callApi.bind(this.imaApi)}},{key:"_onBindIframe",value:function(e){this._soundProtection(this.video),this._blockDOMObjectInWin(e.contentWindow)}},{key:"_soundProtection",value:function(e){var t=this;e.addEventListener("volumechange",function(){t.adLoaded&&t.isMuted&&0!=e.volume&&t.emit(t.vpaidEvents.SoundViolation,{eventData:{vol:e.volume}}),e.volume!==t.volume&&(Q(this.vpaidLog,"soundProtection",{selfSound:t.volume,videoSound:e.volume}),e.volume=t.volume)})}},{key:"_blockDOMObjectInWin",value:function(e){var t="\n        ".concat(this.store.get("jsnoflshdtct")?"window.navigator.__defineGetter__('plugins', function () { return []; });":"",'\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );');try{te(e,t)}catch(e){console.log(e)}}},{key:"_onSafeCallAdError",value:function(t){this._onAdError(e)}}])&&ft(t.prototype,i),s&&ft(t,s),r}();function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function kt(e,t,i){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Et(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function Tt(e,t){return(Tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Et(i);return e=s?(e=Et(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==wt(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pt=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tt(e,t)}(a,ut);var e,t,i,s=Ct(a);function a(e,t,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(i=s.call(this,e,t,i))._initVpaid(e),setTimeout(e.onReady,2),i}return e=a,(t=[{key:"initAd",value:function(e,t,i,s,n,r){this.isIOS&&this.slowConnectionLength&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),kt(Et(a.prototype),"initAd",this).call(this,e,t,i,s,n,r)}},{key:"resumeAd",value:function(){kt(Et(a.prototype),"resumeAd",this).call(this,this.video.useResumeCallback&&this.video.useResumeCallback()||this.adRestarted)}},{key:"startAd",value:function(){this.video.emitStartAd&&this.video.emitStartAd(),this.pausePrefetchVideo(),this.reportBufferToDebugTracker(),kt(Et(a.prototype),"startAd",this).call(this)}},{key:"setAdVolume",value:function(e,t){this.video.mutedChangeByUserGesture=t,kt(Et(a.prototype),"setAdVolume",this).call(this,e)}},{key:"isReplayable",value:function(){return this.video&&!this.video.forceCanvas&&""!==this._getVideoSrc(this.video)}},{key:"removeClickableTarget",value:function(){this.isIOS&&this.clickableTarget&&this.clickableTarget.parentNode.removeChild(this.clickableTarget)}},{key:"_initVpaid",value:function(e){var t=this;this.isCanvasMpeg=this.video.forceCanvas,this.pauseVideoProtection=this.store.get("pusvidprtctn")&&!this.isCanvasMpeg,this.isIOS="iOS"===this.store.get("wurfl.os.name"),this.clickableTarget=e.clickableTarget,this.store.get("sprssviderr")&&this.video.supressErrorEvents(),this.video.addEventListener("canvasToVideo",function(){t.playerDAST.set({ctv:!0})}),this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0,this.minBufferSize=this.store.get("mnbfrsz")||1)}},{key:"_onBindIframe",value:function(e){this._unmuteHook()}},{key:"_unmuteHook",value:function(){this.store.get("mtdhkactv")&&this.video.hookMutedProperty()}},{key:"_resizeAd",value:function(e){this.stopped||this.video.resize&&this.video.resize(e)}},{key:"_stopAd",value:function(){this.stopped||(this.video.destroy(),this.onComplete(),kt(Et(a.prototype),"_stopAd",this).call(this))}},{key:"prefetchVideo",value:function(e,t){this.debugTracker.info("JsVpaidMob -> prefetchVideo() -> super.prefetchVideo();"),kt(Et(a.prototype),"prefetchVideo",this).call(this,e,t)}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_allEventsHandler",value:function(e,t){this.stopped||e===this.vpaidEvents.AdLoaded&&(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this._preventAdLoadIfVideoBufferTooShort())||kt(Et(a.prototype),"_allEventsHandler",this).call(this,e,t)}},{key:"_preventAdLoadIfVideoBufferTooShort",value:function(){return!!this._isBufferTooShort()&&(this._onSlowConnecionDetected(),!0)}},{key:"_isBufferTooShort",value:function(){var e=0<this.slowConnectionLength,t=this.video&&this.video.getSrc(),i=!this.video.forceCanvas&&this.video.buffered&&0<this.video.buffered.length;return e&&t&&i&&this.video.buffered.end(0)<this.minBufferSize}}])&&At(e.prototype,t),i&&At(e,i),a}(),i=s(15),Vt=s.n(i);function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function It(e,t,i){return(It="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Mt(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(i):t.value}})(e,t,i||e)}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=Mt(i);return e=s?(e=Mt(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==St(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Rt=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(r,Fe);var e,t,i,n=Ot(r);function r(e,t,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=n.call(this,e,t,i)).adContainer=e.slot,s.videoElement=document.querySelector("._cm-content-video")||e.videoSlot,s.tag=e.tag,s.vpaidEvents=Object.assign({},we.a),s.imaEvents=Object.assign({},Vt.a),s.onReadyEvent=e.onReady,s.vpaidLog=t,s.store=i,s._initializeIMA(),s}return e=r,(t=[{key:"_initializeIMA",value:function(){var e;this.store.get("isImaScriptLoaded")?this._onImaLoad():((e=document.createElement("script")).onload=this._onImaLoad.bind(this),e.src=this.store.get("imscrptsrc"),document.getElementsByTagName("head")[0].appendChild(e))}},{key:"_onImaLoad",value:function(){this.store.set("isImaScriptLoaded",!0),this.tag.url+="&description_url="+encodeURIComponent(this.store.get("cirf")),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.videoElement),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsRequest=new google.ima.AdsRequest,this._bindImaVpaidLoadEvents(),setTimeout(this.onReadyEvent,0)}},{key:"_bindImaVpaidLoadEvents",value:function(){var t=this;this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){t._allEventsHandler(e)},!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){t._allEventsHandler(e)},!1)}},{key:"initAd",value:function(e,t,i,s,n,r){this.adDisplayContainer.initialize(),this.adsRequest.adTagUrl=this.tag.url,this.adsRequest.linearAdSlotWidth=e,this.adsRequest.linearAdSlotHeight=t,this.adsRequest.nonLinearAdSlotWidth=e,this.adsRequest.nonLinearAdSlotHeight=t,this.adsRequest.vastLoadTimeout=1e4,this.adsRequest.videoPlayActivation="click",this.adsRequest.videoPlayMuted="muted",this.adsRequest.setAdWillAutoPlay(!0),this.adsRequest.setAdWillPlayMuted(!0),this.adsRequest.setContinuousPlayback(!0),this.adsLoader.requestAds(this.adsRequest)}},{key:"startAd",value:function(){this.width=this.videoElement.width||this.videoElement.getClientRects()[0].width,this.height=this.videoElement.height||this.videoElement.getClientRects()[0].height;try{this.adsManager.init(this.width,this.height,google.ima.ViewMode.NORMAL),this.adsManager.start()}catch(e){var t=this.imaEvents.adError;this.emit(t,{eventData:e})}}},{key:"_allEventsHandler",value:function(e){var t=e.type,t=this.imaEvents[t];if(t){if(t===this.imaEvents.adsManagerLoaded)this.adsManager=e.getAdsManager(this.videoElement),this._bindAdManagerEvents(),t=this.imaEvents.loaded;else if(t===this.imaEvents.adError)this.stopAd();else{if(t===this.imaEvents.loaded)return void(this.ad=e.getAd());t===this.imaEvents.click&&(this.clickThroughUrl=this._getAdProp("clickThroughUrl"),e.url=this.clickThroughUrl,e.playerHandles=!0)}e="adError"===e.type?JSON.stringify(e.g.g):e;this.emit(t,{eventData:e})}}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"handshakeVersion",value:function(){return"2.0"}},{key:"resizeAd",value:function(e,t,i,s){this.stopped||this.adsManager&&(this.height=t,this.width=e,this.adsManager.resize(e,t,google.ima.ViewMode.NORMAL))}},{key:"pauseAd",value:function(){this.adsManager.pause()}},{key:"resumeAd",value:function(e){this.adsManager.resume()}},{key:"stopAd",value:function(){this.adsManager&&this.adsManager.stop(),window.setTimeout(this._stopAd.bind(this),1)}},{key:"_bindAdManagerEvents",value:function(){var e,t=[google.ima.AdErrorEvent.Type.AD_ERROR,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.VOLUME_CHANGED,google.ima.AdEvent.Type.VOLUME_MUTED,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,google.ima.AdEvent.Type.LINEAR_CHANGED,google.ima.AdEvent.Type.INTERACTION,google.ima.AdEvent.Type.AD_PROGRESS];for(e in t)this.adsManager.addEventListener(t[e],this._allEventsHandler,!1,this)}},{key:"_getAdProp",value:function(e){for(var t in this.ad){t=this.ad[t][e];if(null!=t)return t}return null}},{key:"_getMediaUrl",value:function(){if(this.ad)return this.ad.getMediaUrl()}},{key:"isReplayable",value:function(){return!1}},{key:"getAdWidth",value:function(){if(this.ad)return this.ad.getWidth()}},{key:"getAdHeight",value:function(){if(this.ad)return this.ad.getHeight()}},{key:"getAdRemainingTime",value:function(){return this.adsManager.getRemainingTime()}},{key:"getAdDuration",value:function(){this.ad&&this.ad.getDuration()}},{key:"getAdSkippableState",value:function(){return this.adsManager.getAdSkippableState()}},{key:"getAdVolume",value:function(){return this.adsManager.getVolume()}},{key:"getAdCompanions",value:function(){this.ad&&this.ad.getCompanionAds(this.width,this.height)}},{key:"getAdExpanded",value:function(){this.ad&&this.ad.expand()}},{key:"getAdLinear",value:function(){if(this.ad)return this.ad.isLinear()}},{key:"getAdSkippableRemainingTime",value:function(){this.ad&&this.ad.getSkipTimeOffset()}},{key:"getDOMContainer",value:function(){return this.adContainer}},{key:"setAdVolume",value:function(e){this.adsManager.setVolume(e)}},{key:"skipAd",value:function(){this.adsManager.skip()}},{key:"collapseAd",value:function(){this.adsManager.collapse()}},{key:"expandAd",value:function(){this.adsManager.expand()}},{key:"checkUnfriendlyIframe",value:function(){return!0}},{key:"_stopAd",value:function(){It(Mt(r.prototype),"stopAd",this).call(this),this.stopped||(this.stopped=!0,this.iframe=this.vpaid=this.callIMAApi=this.video=this.vpaidEvents=this.target=this.vpaidLog=this.store=this.tag=void 0,this.adsManager&&this.adsManager.destroy(),this.adsLoader&&this.adsLoader.destroy(),this.adDisplayContainer&&this.adDisplayContainer.destroy(),this.emit(this.imaEvents.AdStopped),this.onAfterStop())}},{key:"removeClickableTarget",value:function(){}},{key:"onAfterStop",value:function(){}},{key:"restartAd",value:function(e,t){}},{key:"setCompletionOnAdStoppedTimeout",value:function(){}},{key:"toggleIframeContentDisplay",value:function(){}}])&&Dt(e.prototype,t),i&&Dt(e,i),r}(),Ft={AdxVpaid:{type:"adx",id:18},iasBlockingTagVpaid:{type:"iasBlockingTag",id:22},doubleVerifyBlockingTagVpaid:{type:"dvBlockingTag",id:23},moatBlockingTagVpaid:{type:"moatBlockingTag",id:24},fortknoxBlockingTagVpaid:{type:"fortknoxBlockingTag",id:25},imaTagVpaid:{type:"ima",id:27}};function Lt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Bt=s(6),Wt=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),Bt.mixin(this),this.vpaidLog=t,this.store=i,this.stopped=!1,this.target=e.slot,this.debugTracker=new d("BlockingTagsVpaid"),this.baseUrl=this.store.get("base_url"),this._onError=e.onError,this.vpaidEvents=Object.assign({},we.a),this.tag=e.tag.url,this.checkForConversionCounter=this.store.get("blckngtgcnvrsncnt")}var e,t,i;return e=s,(t=[{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"handshakeVersion",value:function(e){return"2.0"}},{key:"isReplayable",value:function(){return!1}},{key:"getAdWidth",value:function(){return this.width||this.store.get("width")}},{key:"getAdHeight",value:function(){return this.height||this.store.get("height")}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVPAIDVideoElement",value:function(){return null}},{key:"stopAd",value:function(){this.stopped=!0}},{key:"initAd",value:function(e,t,i,s,n,r){}},{key:"startAd",value:function(){}},{key:"resizeAd",value:function(e,t,i){}},{key:"getVideoUrl",value:function(){}},{key:"logVideoUrl",value:function(){}},{key:"pauseAd",value:function(){}},{key:"resumeAd",value:function(){}},{key:"skipAd",value:function(){}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdSkippableRemainingTime",value:function(){}},{key:"getAdRemainingTime",value:function(){}},{key:"getAdDuration",value:function(){}},{key:"getAdSkippableState",value:function(){}},{key:"getAdVolume",value:function(){}},{key:"getAdIcons",value:function(){}},{key:"getAdCompanions",value:function(){}},{key:"getAdExpanded",value:function(){}},{key:"getAdLinear",value:function(){}}])&&Lt(e.prototype,t),i&&Lt(e,i),s}();function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nt(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=qt(i);return e=s?(e=qt(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==Ut(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var zt={type:Ft.doubleVerifyBlockingTagVpaid.id,vpaid:function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(n,Wt);var e,t,i,s=Nt(n);function n(e,t,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(i=s.call(this,e,t,i)).impressionType=void 0,i.type=Ft.doubleVerifyBlockingTagVpaid.type,Q(i.vpaidLog,"blockingTag",{tag:i.tag,type:"doubleVerify"}),setTimeout(e.onReady,2),i}return e=n,(t=[{key:"initAd",value:function(e,t,i,s,n,r){var a;this.stopped||(a=this._parseDOMFromString(this.tag),this.blockingTagScripts=a.getElementsByTagName("script"),this.blockingTagScripts&&0!==this.blockingTagScripts.length?(this.adTagImage=this._parseImageSourceFromTag(a,"text/adtag"),this.passbackImage=this._parseImageSourceFromTag(a,"text/passback"),this.adTagImage&&this.passbackImage?this.emit(this.vpaidEvents.AdLoaded,{}):this.emit(this.vpaidEvents.AdError,{error:"imagesParsingIssue"})):this.emit(this.vpaidEvents.AdError,{error:"scriptParsingIssue"}))}},{key:"_parseDOMFromString",value:function(e){return(new DOMParser).parseFromString(e,"text/html")}},{key:"_parseImageSourceFromTag",value:function(e,t){try{var i=e.querySelector('script[type="'.concat(t,'"]'));return this._parseDOMFromString(i.innerHTML).getElementsByTagName("img")[0].src}catch(e){return""}}},{key:"_getMediaUrl",value:function(){return this.hadImpression?this.impressionType===this.vpaidEvents.AdImpression?this.adTagImage:this.passbackImage:""}},{key:"startAd",value:function(){var e=this;this.stopped||(this.iframe=document.createElement("iframe"),this.iframe.onload=function(){e.iframe.contentWindow.document.open(),e.iframe.contentWindow.document.write(e.tag),e.iframe.contentWindow.document.close(),e._checkForConversion()},this.target.appendChild(this.iframe))}},{key:"_checkForConversion",value:function(){var i=this;this.checkForConversionCounter--<=0?this.emit(this.vpaidEvents.AdError,{error:"noConversion"}):setTimeout(function(){for(var e=i.iframe.contentWindow.document.getElementsByTagName("img"),t=0;t<e.length;t++)if(e[t].src===i.adTagImage?(i.hadImpression=!0,i.impressionType=i.vpaidEvents.AdImpression):e[t].src===i.passbackImage&&(i.hadImpression=!0,i.impressionType=i.vpaidEvents.BlockingTagPassback,i.emit(i.vpaidEvents.BlockingTagPassback,{})),i.hadImpression)return i.imageElement=e[t],i._setImagePlacement(),void i.emit(i.vpaidEvents.AdImpression,{});i._checkForConversion()},1e3)}},{key:"_setImagePlacement",value:function(){this.iframe.contentWindow.document.body.style.margin=0,this.imageElement.style.marginLeft=(this.width-this.imageElement.width)/2+"px",this.imageElement.style.marginTop=(this.height-this.imageElement.height)/2+"px"}},{key:"isReplayable",value:function(){return!1}},{key:"resizeAd",value:function(e,t,i){this.stopped||(this.width=e,this.height=t,this.iframe.style.width=this.width+"px",this.iframe.style.height=this.height+"px",this._setImagePlacement())}},{key:"getAdWidth",value:function(){return this.width||this.store.get("width")}},{key:"getAdHeight",value:function(){return this.height||this.store.get("height")}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){return this._getMediaUrl()}},{key:"getVPAIDVideoElement",value:function(){return null}},{key:"stopAd",value:function(){this.stopped=!0}},{key:"logVideoUrl",value:function(){this.hadImpression&&Q(this.vpaidLog,"blockingTagImageUrl",{url:this.passbackImage})}}])&&Ht(e.prototype,t),i&&Ht(e,i),n}()};function Gt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Qt=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.vpaidLog=e,this.store=t,this.isMobile=this.store.get("isMobile"),this.handlers={video:{handlerType:"VideoVpaid".concat(this.isMobile?"Mobile":""),handler:this.isMobile?st:Ye,filterVpaidFiles:function(e){return e.vpaidFiles.video}},javascript:{handlerType:"JsVpaid".concat(this.isMobile?"Mobile":""),handler:this.isMobile?Pt:_t,filterVpaidFiles:function(e){return e.vpaidFiles.vpaid.javascript}},dvBlockingTag:{handlerType:"dvBlockingTag",handler:zt.vpaid},ima:{handlerType:"ima",handler:Rt}}}var e,t,s;return e=i,(t=[{key:"create",value:function(e,t){if(!this.stopped){if(!this.handlers.hasOwnProperty(e))return Q(this.vpaidLog,"creatingVpaidHandler",{error:"typeNotFound",type:e}),null;var i=this.handlers[e].handler;return this.handlers[e].hasOwnProperty("filterVpaidFiles")&&(t.vpaidFiles=this.handlers[e].filterVpaidFiles(t)),Q(this.vpaidLog,"creatingVpaidHandler",{type:this.handlers[e].handlerType}),new i(t,this.vpaidLog,this.store)}}},{key:"destroy",value:function(){this.stopped=!0,this.vpaidLog=this.store=this.handlers=void 0}}])&&Gt(e.prototype,t),s&&Gt(e,s),i}();function Kt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Xt=void 0,Yt=function(){function i(e,t){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Xt)return Xt;this.debugTracker=new d("ClickThroughHandler"),this.store=e,this.ovaMediaPlayer=t,this.isMultiAdsActive=this.store.get("mltads"),Xt=this}var e,t,s;return e=i,(t=[{key:"invokeClick",value:function(e){this.isMultiAdsActive||this.store.set("forcePause",!1),e&&e.url&&(e.playerHandles&&e.url&&this._openClickThroughUrl(e.url),this.ovaMediaPlayer.options.onAdClick(this.ovaMediaPlayer,this,e.url))}},{key:"_openClickThroughUrl",value:function(e){this.debugTracker.info("Opening Url","Opening url: ".concat(e)),e=ee(e,this.store),this.store.get("isInApp")&&window.taboolaMobile&&window.taboolaMobile.getSupportedFeatures&&window.taboolaMobile.getSupportedFeatures().VideoClick?window.taboolaBridge.emit("videoClick",e):window.open(e)}}])&&Kt(e.prototype,t),s&&Kt(e,s),i}();function Jt(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var $t=s(6),Zt=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),$t.mixin(this),this.creativeExtensions=e,this.target=t,this.vpaidLog=i,this.stopped=!1,this.debugTracker=new d("CreativeExtensionsHandler")}var e,t,i;return e=s,(t=[{key:"handleExternalScripts",value:function(){if(!this.stopped)for(var e,t=0;t<this.creativeExtensions.length;t++)this.creativeExtensions[t].attributes?(e=this.creativeExtensions[t].attributes.type?this.creativeExtensions[t].attributes.type.value.toLowerCase():null)&&(e=e.toLowerCase(),Q(this.vpaidLog,"creativeExtensions",{type:e,src:this.creativeExtensions[t].element}),"gdn"===e||"ias"===e?this._appendExternalScripts(this.creativeExtensions[t].element):"moat"===e&&this._pushExternalMoatTracker(this.creativeExtensions[t].element)):(this._appendExternalScripts(this.creativeExtensions[t]),this.debugTracker.info("jsTrackers scripts was loaded",{script:this.creativeExtensions[t]}))}},{key:"_appendExternalScripts",value:function(e){for(var t=(new DOMParser).parseFromString(e,"text/html").getElementsByTagName("script"),i=0;i<t.length;i++)this.target.appendChild(this._generateScriptElement(t[i]))}},{key:"_generateScriptElement",value:function(e){for(var t=document.createElement("script"),i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i].name,e.attributes[i].value);return t.innerHTML=e.innerHTML,t}},{key:"_pushExternalMoatTracker",value:function(e){this.emit("externalMoat",e)}},{key:"destroy",value:function(){this.stopped=!0,this.creativeExtensions=this.target=this.vpaidLog=void 0}}])&&Jt(e.prototype,t),i&&Jt(e,i),s}(),ei={vpaidCrawler:{serviceKey:"vpaidCrawler",storePathKey:"vpdcrwlr",versionRegex:/(?:\/vpaidCrawler\/)(.*)\/vpaidCrawler.js/,storeDataKey:"vpaidCrawlerFuncString",jsonpCallbackName:"vpdcrwlrclb"},hjk:{serviceKey:"hjk",storePathKey:"hjk",versionRegex:/(?:\/vpaid\/hjk.)(.*).js/,storeDataKey:"hjkFuncString",jsonpCallbackName:"hjkclb"},vpaidAnalytics:{serviceKey:"vpaidAnalytics",storePathKey:"anltcsurl",versionRegex:/(?:\/vpaid\/vpaidAnalytics.)(.*).js/,storeDataKey:"analyticsFuncString",jsonpCallbackName:"anltcsclb"},dsm:{serviceKey:"dsm",storePathKey:"dsu",versionRegex:/(?:\/vpaid\/ds\/)(.*)\//,storeDataKey:"dsm",jsonpCallbackName:""}};function ti(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ii=s(6),si=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),ii.mixin(this),this.store=e,this.tag=t,this.vpaidLog=i,this.vpaidCrawler=e.get(ei.vpaidCrawler.storeDataKey),this.vpaidCrawler||(this.hjk=e.get(ei.hjk.storeDataKey),this.vpaidAnalytics=e.get(ei.vpaidAnalytics.storeDataKey)),this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this)}var e,t,i;return e=s,(t=[{key:"inject",value:function(e,t){e&&(this.vpaidCrawler?this._injectVpaidCrawler(e):(Q(this.vpaidLog,"injectResource",{vpaidCrawler:!1}),this._injectHJK(e),this._injectVpaidAnalytics(e,t)))}},{key:"_injectVpaidCrawler",value:function(t){var e=this._getVpaidAnalyticsOptions();this.vpaidCrawler=this.vpaidCrawler.replace('"%%%ANALYTICS_OPTIONS%%%"',G(e)),e.deepIframes&&(t.contentWindow.vpaidCrawlerFunc=this.vpaidCrawler),this.onResourceMessage=this._onResourceMessage.bind(this),window.addEventListener("message",this.onResourceMessage),te(t.contentWindow,this.vpaidCrawler),this.vpaidLog.getVpaidAnalyticsReport=t.contentWindow.analyticsReporter.getReport,this.setVpaidAnalyticsIsVideoUrlPublic=function(e){t.contentWindow.analyticsReporter.isVideoUrlPublic=e}}},{key:"_onResourceMessage",value:function(e){var t;!this.stopped&&e.data&&"resourceEvent"===e.data.type&&(Q(this.vpaidLog,"resourceEvent",e.data.eventData,!1,!1),-1<(t=e.data.eventData.event).indexOf("malicious")?this._onCrawlerHijackAttempt(t,e.data.eventData):"undefinedIframeSrc"===t?this._onUndefinedRelativeIframeSrcError(e.data.eventData.url):"maxNetworkCalls"===t&&this._onNetworkCallsLimitExceeded())}},{key:"_injectHJK",value:function(e){this.hjk?(e.contentWindow.hjkFunc=this.hjk,e.contentWindow.ReportHijackAttempt=this._onHijackAttempt.bind(this),te(e.contentWindow,this.hjk)):Q(this.vpaidLog,"injectResource",{hjk:!1})}},{key:"_injectVpaidAnalytics",value:function(e,t){var i;this.vpaidAnalytics?(i=this._getVpaidAnalyticsOptions(),te(e.contentWindow,this.vpaidAnalytics),i.deepIframes&&(e.contentWindow.AnalyticsReporter.prototype.vpaidAnalyticsFunc=this.vpaidAnalytics),e.contentWindow.AnalyticsReporter.prototype._onUndefinedRelativeIframeSrcError=this._onUndefinedRelativeIframeSrcError.bind(this),e.contentWindow.onNetworkCallsLimitExceeded=this._onNetworkCallsLimitExceeded.bind(this),new e.contentWindow.AnalyticsReporter(t,function(){},i),this.vpaidLog.getVpaidAnalyticsReport=e.contentWindow.getVpaidAnalyticsReport,e.contentWindow.setIsVideoUrlPublic&&(this.setVpaidAnalyticsIsVideoUrlPublic=e.contentWindow.setIsVideoUrlPublic)):Q(this.vpaidLog,"injectResource",{vpaidAnalytics:!1})}},{key:"_getVpaidAnalyticsOptions",value:function(){var e=this.store.get("anltcsOptions"),t=this.tag.getValueByKey("mxntwrkclls")||0,i=this.store.get("ifrmswghts");return t&&(e.maxNetworkCalls=t),i&&(e.iframesWeights=i),e}},{key:"_onHijackAttempt",value:function(e,t){this._onCrawlerHijackAttempt("maliciousUrl",{url:e,isEarly:t})}},{key:"_onVpaidResourceEvent",value:function(e,t){this.emit("vpaidResourceEvent",{event:e,data:t})}},{key:"_onCrawlerHijackAttempt",value:function(e,t){this._onVpaidResourceEvent("hijackAttempt",{type:e,data:t})}},{key:"_onUndefinedRelativeIframeSrcError",value:function(e){this._onVpaidResourceEvent("undefinedIframeSrc",{url:e})}},{key:"_onNetworkCallsLimitExceeded",value:function(){this._onVpaidResourceEvent("maxNetworkCalls",{maxNetworkCalls:this.tag.getValueByKey("mxntwrkclls")})}},{key:"destroy",value:function(e){this.stopped||(this.stopped=!0,e&&e.contentWindow&&(this.vpaidCrawler?this._destroyVpaidCrawler(e):this._destroyHJKAndAnalytics(e)))}},{key:"setPerformanceMeasurement",value:function(e,t,i){e&&e.contentWindow&&this._measurePerformance(e,t,i)}},{key:"_destroyVpaidCrawler",value:function(e){window.removeEventListener("message",this.onResourceMessage),e.contentWindow.analyticsReporter.destroy(),e.contentWindow.destroyCrawler(),this.vpaidLog.getVpaidAnalyticsReport=null}},{key:"_destroyHJKAndAnalytics",value:function(e){e.contentWindow.ReportHijackAttempt=null,e.contentWindow.destroyAnalyticsReporter&&e.contentWindow.destroyAnalyticsReporter()}},{key:"_measurePerformance",value:function(e,t,i){e.contentWindow.setPerformanceMeasurement&&e.contentWindow.setPerformanceMeasurement(t,i)}}])&&ti(e.prototype,t),i&&ti(e,i),s}(),i=s(3),ni=s.n(i);function ri(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return ai(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(i="Object"===i&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ai(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,t=function(){};return{s:t,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){a=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw n}}}}function ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function oi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var di=s(6),hi=s(29),li=0,ui=0,ci=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),di.mixin(this),this.mainVpaid=e.mainVpaid,this.store=e.store,this.wflog=e.wflog,this.wflog&&this.wflog.increaseNumberOfConnectedVpaids(),this.isVForceActive=this.store.get("vForce"),this.created=Date.now(),this.loadedEvent="",this.manager=e.manager,this.clickThoughHandler=new Yt(this.store,this.manager.mainVpaid.vpaidHandler.parent),this.index=++li,this.vpaidWrapperIndex="VpaidWrapper".concat(this.index),this.tagid=e.tagid,this.tag=Object.assign({},e.tag),this.tag.vpaidWrapperData={},this.error="",this.readyInMS=0,this.isMultiAdsActive=this.store.get("mltads"),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.isAdErrorBeforeAdLoadedActive=this.store.get("aderrbfradlddopactv"),this.adLoadedFired=!1,this.hijackFired=!1,this.blockBringToFront=this.isMultiVpaidUnit&&this.store.get("blckbrngtofrnt"),this.toggleIframeContentDisplayActive=this.store.get("tglifrmcntndsplyactv"),this.waitForAdPausedBeforeResumeAd=this.store.get("wtfradpsdbfrrsmad"),this.externalPlayerItem=this.tag.externalPlayerItem,this.defaultTagPrice=this.store.get("dftgprc"),this.moatTrackers=[],this.bfPriority=this.store.get("bfprty"),this.isVerticalVideoSupported=this.tag.getValueByKey("spprtvrtclvd"),this.targetCSS=this.store.get("adtrgtcss")?this.tag.getValueByKey("trgtcss"):void 0,this.playerDAST=new xe(this.store),this.vpaidStatuses=Oe.a.Statuses,this.vpaidStatus=new Oe.a.VpaidStatus,this.creatives={},this.stayAlive=!1,this.oldStatus="",this.stopReason="",this.config={},this.vast=[],this.iconsPrograms=[],this.isMobile=this.store.get("isMobile")||!1,this.isIOS=!1,this.isMobile&&(this.isIOS="iOS"===this.store.get("wurfl.os.name")),this.timeoutLengthToAdCompletion=this.tag.getValueByKey("".concat(this.isMobile?"mbl":"dsk","tmouttoadcmpltn")),this.newCompletionByVideoProgress=this.store.get("q5byprgrss"),this.fireNewCompletionPixel=0<this.timeoutLengthToAdCompletion,this.fireNewCompletionPixel&&(this.timeoutLengthToAdCompletion=Y(this.timeoutLengthToAdCompletion)),this.timeoutToAdCompletion=null,this.timeoutToAdCompletionStartTime=0,this.newCompletionEventFired=!1,this.globalAdTimeout=null,this.globalAdTimeoutStartTime=0,this.globalAdTimeoutLength=this.tag.getValueByKey("global_ad_timeout"),this.globalAdTimeoutLength&&0<this.globalAdTimeoutLength&&(this.globalAdTimeoutLength=Y(this.globalAdTimeoutLength)),this.store.get("dbncadvltm")?this.setAdVolume=hi(this._setAdVolume,this.store.get("dbncadvltm")):this.setAdVolume=this._setAdVolume,this.tag.advId&&this._pushUniqueAdvIdsToWaterfallLog(),this.tag.moatSampling=this._decideMoat(),this.tag.moatSampling||(this.delayVideoVpaidImpressionForNonMoatRV=this.tag.getValueByKey("dlyimpnonmoatrv")),this.pwov=this.tag.pwov,this.vpaidLog=e.vpaidLog,Q(this.vpaidLog,"firstWaterfall",{isFromTb:!!this.wflog.get("firstWfFromTb")}),this._copyFromStoreToBi("connectionType",!1);var i=this.store.get("navigatorConnection");if(Q(this.vpaidLog,"navigatorConnection",{effectiveTypeId:i.effectiveTypeId,typeId:i.typeId},!1,!1),this._wfStats=e.wfStats,this._wfStats.increaseVpaidsCount(),this.oppsID=l.a,this.shouldMuteVid=this.store.get("dskVidMuted")&&!this.store.get("isMobile"),this.opportunityManager=e.opportunityManager,this.vpaidEventToPixelId={},this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoFirstQuartile]=this.oppsID.videoFirstQuartile,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoMidpoint]=this.oppsID.videoMidpoint,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoThirdQuartile]=this.oppsID.videoThirdQuartile,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoComplete]=this.oppsID.videoComplete,this._sendOpp(this.oppsID.tagStarted),this.unloadCallback=function(e){t._sendOpp(t.oppsID.unloadPage)},this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!0),this.debugTracker=new d(this.vpaidWrapperIndex),this.pixelManager=e.pixelManager,this.vpaidResourcesHandler=new si(this.store,this.tag,this.vpaidLog),this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this),this.vpaidResourcesHandler.on("vpaidResourceEvent",this.onVpaidResourceEvent),e.creatives)for(var s in e.creatives)this.creatives[s]=e.creatives[s];if(e.config)for(var s in e.config)this.config[s]=e.config[s];if(this.adVolume=K(parseInt(this.config.VOLUME)?parseInt(this.config.VOLUME):0),this.vpaidEvents=e.vpaidEvents,this.delayedQuartilesOpps=[],this.placement=this.createPlacement(this.tag,this.mainVpaid,this.store),this.localTarget=this.placement.localTarget,this.adTarget=this.placement.adTarget,this.vpaidHandlersFactory=new Qt(this.vpaidLog,this.store),this.handlerOptions={applyBypass:!!this.creatives.AFBP,slot:this.localTarget,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay,protection:this.config.vpaid_protect_path,tag:this.tag,onReady:this._onHandlerCreated.bind(this),onError:this._onHandlerError.bind(this),playerDAST:this.playerDAST,vpaidResourcesHandler:this.vpaidResourcesHandler,wrapperIndex:this.index,debugTracker:this.debugTracker,extra:{}},this.externalPlayerItem)this._setNonVideoVpaid();else{if(this.nonVideoVpaid)return this._setNonVideoVpaid(),void this._createHandler({type:this.nonVideoVpaidType,handlerOptions:this.handlerOptions,vastOptions:{}});this.store.get("vpdcntrcstmcss")&&((this.adTarget||this.localTarget).style.cssText+=this.store.get("vpdcntrcstmcss")),this.isIOS&&(this.clickableTarget=this._createClickableTarget(this.localTarget)),this.localVideo=this._createLocalVideo(this.localTarget),this.handlerOptions.videoSlot=this.localVideo,this.handlerOptions.clickableTarget=this.clickableTarget||null,this.parser=e.vastParser,this.isReportWrappersOpenTime=this.store.get("rprtwrpropntime"),this._createBindedFuncitons(),this._registerToVastParserEvents(),this.adFoundDispatched=!1,this.vpaidHandler=!1,this.stopped=!1,this._handleWfItemByType(),this.isVForceActive=this.store.get("vForce")||!1,Q(this.vpaidLog,"vForce",{vForceIsActive:this.isVForceActive},!1,!1),this.reportVideoStatusToUnitInterval=this.store.get("rprtvidsttsintrvl"),this._initTimers(),this.store.get("useVideoControls")&&!1!==this.tag.getValueByKey("ad_controls")&&(this.VideoControls=new Se(this.localVideo,this.store,this.localTarget,"ad",this),this.VideoControls.setVpaidHandler(this),this.VideoControls.setOnSoundChangeCallback(this._onSoundChange.bind(this)),this.VideoControls.once("unmuteClicked",this._sendFirstUnmuteOpp.bind(this))),this.handelsEarlyAI=this.store.get("erlyai"),this.store.get("debug")&&this._addCopyToClipboardBtn(),this.isReplayable=!1,this._onGotAdIconsBinded=this._onGotAdIcons.bind(this),this._appendVpaidCSS(),this._sendTimeupdateToWrapper=this.tag.getValueByKey("sndvptmrst"),this._reportBuffering=this.tag.getValueByKey("rprtbuffrng")}}var e,t,i;return e=n,(t=[{key:"_createBindedFuncitons",value:function(){this.bindedOnVastFound=this._onVastFound.bind(this),this.bindedCreateHandler=this._createHandler.bind(this),this.bindedOnParserError=this._onParserError.bind(this),this.bindedOnNetworkError=this._onNetworkError.bind(this),this.bindedOnBuffering=this._onBuffering.bind(this),this.bindedOnBufferingEnd=this._onBufferingEnd.bind(this)}},{key:"_registerToVastParserEvents",value:function(){this.parser.on(ni.a.VastFound,this.bindedOnVastFound),this.parser.on(ni.a.VastData,this.bindedCreateHandler),this.parser.on(ni.a.ParserError,this.bindedOnParserError),this.parser.on(ni.a.NetworkFail,this.bindedOnNetworkError),this._registerToVastParserWrapperDataEvent()}},{key:"_unregisterToVastParserEvents",value:function(){this.parser.off(ni.a.VastFound,this.bindedOnVastFound),this.parser.off(ni.a.VastData,this.bindedCreateHandler),this.parser.off(ni.a.ParserError,this.bindedOnParserError),this.parser.off(ni.a.NetworkFail,this.bindedOnNetworkError),this.isReportWrappersOpenTime&&this.parser.off(ni.a.WrappersData,this.bindedOnWrappersData)}},{key:"_registerToVastParserWrapperDataEvent",value:function(){this.isReportWrappersOpenTime&&(this.bindedOnWrappersData=this._onWrappersData.bind(this),this.parser.on(ni.a.WrappersData,this.bindedOnWrappersData))}},{key:"_decideMoat",value:function(){return!this.store.get("isInApp")&&!this.tag.getValueByKey("dsblmt")&&(this.tag.requiredViewability||this.store.get("moat"))}},{key:"_setNonVideoVpaid",value:function(){this.vpaidHandler=!1,this.stopped=!1,this.isVForceActive=this.store.get("vForce")||!1,this.isReplayable=!1}},{key:"_addCopyToClipboardBtn",value:function(){var e=this,t=document.createElement("div");t.className="playerSaveButton",t.style.zIndex=ui+10,t.innerHTML="SAVE",this.localVideo.parentElement.appendChild(t),t.addEventListener("click",function(){Ce()(e.vpaidLog.toString())})}},{key:"_handleWfItemByType",value:function(){this.tag.t!==Ft.imaTagVpaid.id?this.tag.isPrebid?this._handlePrebidItem():this._parseItem():this._createHandler()}},{key:"_handlePrebidItem",value:function(){this.tag.prebidHandler.once("receivedBids",this._onPrebidResponse.bind(this)),this.tag.prebidHandler.once("noBids",this._onNoPebidBids.bind(this)),this.tag.prebidHandler.requestBids(this.tag.url,this.localTarget,this.vpaidLog)}},{key:"_onPrebidResponse",value:function(e){this.stopped||(this.tag.request=e.req,this.prebidAdapterSpec=e.spec,this.prebidConf=e.conf,this._sendOpp(this.oppsID.prebidWinResponses,{}),"GET"===this.tag.request.method&&this.tag.request.data&&(this.tag.request.url+="?".concat(function(t){try{return Object.keys(t).map(function(e){return"".concat(e,"=").concat(t[e])}).join("&")}catch(e){return""}}(this.tag.request.data))),this.tag.url=this.tag.request.url,this._parseItem())}},{key:"_onNoPebidBids",value:function(){this.stopped||(this._sendOpp(this.oppsID.prebidNoResponse,{}),this._handleVpaidEvents(this.vpaidEvents.AdError,{}))}},{key:"_parseItem",value:function(){this.parser.stopped||(this.tag.vast?this.parser.parseVastFromString(this.tag.vast):this.parser.parseVastFromUrl(this.tag.url,this.tag.request&&"GET"!==this.tag.request.method?this.tag.request.data:void 0))}},{key:"_initTimers",value:function(){this._waitForEvent(this.vpaidEvents.AdLoaded,this.tag.getValueByKey("altmot")||this.tag.ADTO,this._onAdLoadedEvent.bind(this),this._onAdLoadedTimeout.bind(this)),this._setTimers()}},{key:"_setTimers",value:function(){var e=this._initTimersStart?Date.now()-this._initTimersStart:0;this._initTimersStart=Date.now(),this._initTillAdstartTimeout(e),this._initAutoKillTimeOut(e)}},{key:"_initTillAdstartTimeout",value:function(e){var t=this;this.tillAdstartTimeout&&clearTimeout(this.tillAdstartTimeout);var i=this.type&&this.store.getByTech("adto",this.type)||this.tag.getValueByKey("adto")||this.tag.ADTO;0<(i-=e)&&(this.tillAdstartTimeout=setTimeout(function(){Q(t.vpaidLog,"AdStopADTO",{}),t.error="adto",t._firePixel("AdError",{eventData:{iabErrorCode:a.a.timeout}}),t.stop(t.error,t.oppsID.adtoTimeout)},i))}},{key:"_initAutoKillTimeOut",value:function(e){var t=this;this.autoKill&&clearTimeout(this.autoKill);var i=this.type&&this.store.getByTech("vakll",this.type)||this.tag.getValueByKey("vakll")||9e4;0<(i-=e)&&(this.autoKill=setTimeout(function(){Q(t.vpaidLog,"AutoKill",{timeout:i}),t.error="autoKill",t.emit(t.vpaidEvents.AdVideoComplete,{eventData:t}),t._firePixel("AdError",{eventData:{iabErrorCode:a.a.timeout}}),t.stop(t.error,t.oppsID.globalTimeout)},i))}},{key:"_killTimers",value:function(){if(clearTimeout(this.autoKill),clearTimeout(this.tillAdstartTimeout),clearTimeout(this.adloadedTimeout),this.pendingEvents)for(var e in this.pendingEvents)-1!=this.pendingEvents[e].timeoutId&&clearTimeout(this.pendingEvents[e].timeoutId);this.pendingEvents={}}},{key:"_createClickableTarget",value:function(e){if(!this.stopped){var t=document.createElement("div"),i=this.store.get("width"),s=this.store.get("height");return t.className="cm-ad-click-target",t.style.cssText="width: ".concat(i,"px; height: ").concat(s,"px; cursor: pointer; position: absolute; top: 0px; left: 0px;"),t.style.display="",t.setAttribute("width",i),t.setAttribute("height",s),e.appendChild(t),t}}},{key:"_createLocalVideo",value:function(e){var t=this;if(!this.stopped){var i=this.store.get("width"),s=this.store.get("height"),n=this._createVideoElement(e);return n.className="cm-ad-player",n.style.cssText="width: ".concat(i,"px; height: ").concat(s,"px;"),n.style.display="",!1===this.tag.getValueByKey("strch")?n.style.objectFit="contain":"IE"===this.store.get("wurfl.browser.name")&&j(n,"ie-black-edges"),n.volume=0,this.shouldMuteVid&&(n.muted=!0),n.setAttribute("width",i),n.setAttribute("height",s),n.addEventListener("timeupdate",function(e){t._onTimeupdate(n)}),this.config.videoSlotControls&&n.removeAttribute("controls"),this.store.get("addprld")&&n.setAttribute("preload","auto"),e.appendChild(n),n}}},{key:"_createVideoElement",value:function(e){var t=this;return re(this.store,{target:e,onCanvasUsage:function(){t.playerDAST.set({cnv:!0})}},"ad",Q.bind(this,this.vpaidLog))}},{key:"_onHandlerError",value:function(e,t){Q(this.vpaidLog,"earlyError",{errMsg:e}),this.loadedEvent||(this.status="error",this.stopped||(this.emit(this.vpaidEvents.AdError,{eventData:e}),"adUnitLoadFailed"===t&&(Q(this.vpaidLog,"adUnitLoadFailed",{errMsg:e}),this._firePixel("AdError",{eventData:{iabErrorCode:a.a.timeout}}),this.stop("adUnitLoadFailed",l.a.adUnitLoadFailed))))}},{key:"_onHandlerCreated",value:function(){this.stopped||(Q(this.vpaidLog,"createdVpaidHandler",{}),this._connectToVpaidHandler(),this.vpaidHandler.handshakeVersion("2.0"),Q(this.vpaidLog,"initAd",{}),this.vpaidHandler.initAd(this.config.width,this.config.height,this.config.viewMode,this.config.bitrate,{AdParameters:this.creatives.AdParameters},{slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay}))}},{key:"_connectToVpaidHandler",value:function(){if(!this.stopped)for(var e in this.vpaidEvents)this.vpaidHandler.subscribe(this._handleVpaidEvents.bind(this,this.vpaidEvents[e]),this.vpaidEvents[e])}},{key:"_adLoadedHandler",value:function(e){var t,i,s=this;this.stopped||(this.adLoadedFired=!0,this.debugTracker.time("[VpaidWrapper".concat(this.index,"] adLoaded->startAd()")),this.debugTracker.info("RequiredViewability:".concat(this.tag.requiredViewability)),this.loadedEvent=this.loadedEvent+" "+e,this.readyInMS=Date.now()-this.created,this.debugTracker.info("Ad loaded now => pause it srcEvent",e),this._sendOpp(l.a.adLoaded),this.vpaidStatus.setStatus(this.vpaidStatuses.adLoaded),this.status="ready",this.isUnPaused=!0,this.store.emit("vpaidReady",this),this.asyncAdimpression=this.tag.getValueByKey("asyncAdimpression"),this.asyncAdimpression&&(t=this.tag.getValueByKey("aaViewability")?"unit::viewability":"unit::conversion",Q(this.vpaidLog,"asyncAdimpression",{event:t}),this.on(t,function(){Q(s.vpaidLog,"asyncAdimpressionEvent",{event:t}),s.onAsyncAdmpression()})),this.setAdVolume(this.adVolume),this.adFoundDispatched=!0,this.vpaidHandler.checkUnfriendlyIframe&&(this.isUnfriendlyIframe=this.vpaidHandler.checkUnfriendlyIframe()),this.type&&"javascript"==this.type&&(this.logVpaidFamily(),this.earlySrcVPAID=!1,(i=this._isVideoSrcExist())&&(this._sendOpp(this.oppsID.VpaidVideoSrcOnAdLoaded),this.earlySrcVPAID=!0,this.isMobile&&this.vpaidHandler.prefetchVideo&&(this.vpaidHandler.prefetchVideo("javascript",i),this.debugTracker.info("_adLoadedHandler() -> javascript vpaidHandler.prefetchVideo() src:".concat(i))))),this.vpaidResourcesHandler&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic(""!==this.getVideoUrl()),"any"!==(i=this.store.get("rvfrquesttsemttr"))&&this.tag.requiredViewability!==i||this.store.emit(_e.outer.EmitQueueStatus))}},{key:"startAd",value:function(e){var t=this;this.startTimestamp=new Date,this.adStarted=!0,this.debugTracker.timeEnd("[VpaidWrapper".concat(this.index,"] adLoaded->startAd()")),this.setAdVolume(this.adVolume),this._startForceAdVolumeInterval(),this.options=Object.assign(e||{},this.store.get("getAdData")),this.isStarted=!0,this.store.incr("ads_started"),this._sendOpp(this.oppsID.startAd),this.vpaidStatus.setStatus(this.vpaidStatuses.startAd),this._dispatchToMoat("startAd"),Q(this.vpaidLog,"adOptions",{count:this.options.count,getAdRetries:this.options.getAdRetries,requiredViewability:this.options.requiredViewability},!1,!1),Q(this.vpaidLog,"startAd",{}),this.earlyAdImpression||this._waitForEvent(this.vpaidEvents.AdImpression,this.store.get("adimptmot"),this._onAdImpressionEvent.bind(this),this._onAdImpressionTimeout.bind(this)),this.isUnPaused?(this.debugTracker.info("startAd()"),this.vpaidHandler.startAd()):(this.debugTracker.info("resumeAd() from startAd()"),this.vpaidHandler.resumeAd()),clearTimeout(this.tillAdstartTimeout),this.working=!0,this.earlyAdImpression&&setTimeout(function(){t._onAdImpression()},500),this.nonVideoVpaid||this.externalPlayerItem||(this.vpaidHandler.on("activeAdCurrentTime",function(e){t.emit("activeAdCurrentTime",e)}),this.newCompletionByVideoProgress&&this.vpaidHandler.on(_e.outer.NewCompletion,function(){t._newCompletionHandler("timerEnded")}),this.tag.getValueByKey("wtchprgrssopp")&&this.tag.isDirectDemand&&this.vpaidHandler.on("watchProgress",function(e){t._onVpaidTimeupdated(e.currentTime)}),this._reportBuffering&&(this.vpaidHandler.on("buffering",this.bindedOnBuffering),this.vpaidHandler.on("bufferingEnded",this.bindedOnBufferingEnd)))}},{key:"_startForceAdVolumeInterval",value:function(){var e,t,i=this;this.isMobile||this.nonVideoVpaid||this.externalPlayerItem||(e=this.store.get("frcadvlmtrvl"),!this.setAdVolumeInterval&&0<e&&(t=this.store.get("stpfrcvlevnt")||this.vpaidEvents.AdVideoFirstQuartile,this.vpaidHandler.subscribe(function(){i._stopForceAdVolumeInterval()},t),this.setAdVolumeInterval=setInterval(function(){i.vpaidHandler&&!i.vpaidHandler.stopped?i.setAdVolume(i.adVolume):clearInterval(i.setAdVolumeInterval)},e)))}},{key:"_stopForceAdVolumeInterval",value:function(){this.isMobile||(clearInterval(this.setAdVolumeInterval),this.setAdVolumeInterval=0)}},{key:"restartAd",value:function(){var e=this;this.isReplayable&&(this.opportunityManager.unpause(),this._sendOpp(this.oppsID.replayAd),this.opportunityManager.pause(),this.pixelManager.pause(),this.working=this.isStarted=this.adStarted=!0,this.store.incr("ads_started"),this._setClickThroughData(),this.vpaidHandler.restartAd(this.getVideoUrl(),this.clickThruUrl),setTimeout(function(){e.bringToFront()}))}},{key:"isReplayableVpaid",value:function(){return this.isVForceActive&&this.tag.getValueByKey("rplvpdactv")&&this.vpaidHandler&&this.vpaidHandler.isReplayable()}},{key:"dontDie",value:function(){this.tag&&(this.tag.singleAd||this.tag.adjacencyAd)&&(this.stayAlive=!0,this.vpaidHandler&&this.vpaidHandler.dontDie&&this.vpaidHandler.dontDie(),this._killTimers())}},{key:"_handleStopped",value:function(e){this.moveToBack(),this.stop(e.type,e.oppType),this.working=!1}},{key:"pauseAd",value:function(){!this.stopped&&this.isUnPaused&&(this.waitForAdPausedBeforeResumeAd&&(this.isUnPaused&&(this.adPausedFired=!1),this.resumeOnAdPaused&&(this.resumeOnAdPaused=!1)),this.pauseAdStartTime=Date.now(),this.working=!1,this.vpaidHandler.pauseAd(),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout())}},{key:"resumeAd",value:function(){this.stopped||!this.isMultiAdsActive&&this.store.get("forcePause")||(!this.waitForAdPausedBeforeResumeAd||this.adPausedFired?(this.resumeOnAdPaused=!1,this.working=!0,this.vpaidHandler.resumeAd(),this.externalPlayerItem||j(this.localVideo,"cm-ad-player-active"),this.workingVpaid||(this._isDelayedVideoVpaidImpression()&&(this._fireNetworkAdImpression(),this.pixelManager.firePixel("AdVideoStart",this.vpaidLog)),this.tag.moatSampling&&this.isVForceActive&&(this._dispatchToMoat("AdImpression",!0,!0),this._dispatchToMoat("AdVideoStart",!0,!0))),this.isMultiVpaidUnit&&(this.isVerticalVideoSupported&&this.isVertical||this.resizeAd(this.store.get("width"),this.store.get("height"))),this.VideoControls&&!this.workingVpaid&&(this.VideoControls.resetAdControls(),this.isMobile&&this.store.emit("playerStatusChanged","ad")),this.store.set("ad_controls",!1!==this.tag.getValueByKey("ad_controls")),this.workingVpaid=!0,!this.isVForceActive||this.nonVideoVpaid||this.externalPlayerItem||(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent()),this._reportVideoProgress()):this.resumeOnAdPaused=!0)}},{key:"_reportVideoProgress",value:function(){var i=this;this.isVideoProgressingInterval||(this.videoProgressing=!0,this.isVideoProgressingInterval=setInterval(function(){i.vpaidHandler.getAdRemainingTime(function(e,t){i.isUnPaused&&(t=parseInt(t),(!i.lastRemainingTime||t<i.lastRemainingTime?(i.lastRemainingTime=t,!i.videoProgressing):i.videoProgressing)&&(i.videoProgressing=!i.videoProgressing,Q(i.vpaidLog,"videoProgress",{progress:i.videoProgressing,reaminingTime:t},!1,!1)))})},1e3))}},{key:"_setGlobalAdTimeout",value:function(){var e=this;this.globalAdTimeoutLength&&0<this.globalAdTimeoutLength&&!this.globalAdTimeout&&(this.globalAdTimeoutStartTime=Date.now(),this.globalAdTimeout=setTimeout(function(){e.stopped||e.stop("global_ad_timeout",e.oppsID.globalAdTimeout)},this.globalAdTimeoutLength))}},{key:"_pauseGlobalAdTimeout",value:function(){this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this.globalAdTimeoutLength-=Date.now()-this.globalAdTimeoutStartTime)}},{key:"_setTimeoutToAdCompletion",value:function(){var e=this,t=this.newCompletionByVideoProgress&&null!=this.vpaidHandler.activeVideoElement;!this.timeoutToAdCompletion&&0<this.timeoutLengthToAdCompletion&&!this.newCompletionEventFired&&!t&&(this.timeoutToAdCompletionStartTime=Date.now(),this.timeoutToAdCompletion=setTimeout(function(){e.stopped||e._newCompletionHandler("timerEnded")},this.timeoutLengthToAdCompletion))}},{key:"_pauseAdTimeoutToCompletion",value:function(){this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.timeoutLengthToAdCompletion-=Date.now()-this.timeoutToAdCompletionStartTime)}},{key:"_fireNewCompletionEvent",value:function(){this.newCompletionEventFired||(this._sendOpp(this.oppsID.newCompletion),this.vpaidStatus.setStatus(this.vpaidStatuses.adComplete),this.newCompletionEventFired=!0,this.emit(_e.outer.NewCompletion))}},{key:"getVideoUrl",value:function(){return this.videoUrl||(this.videoUrl=this.vpaidHandler.getVideoUrl?this.vpaidHandler.getVideoUrl():""),this.videoUrl}},{key:"_setVideoDataToPlayerDAST",value:function(){var e={vu:this.getVideoUrl()},t=this.localVideo;(t=this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement?this.vpaidHandler.getVPAIDVideoElement()||t:t)&&(e.edr=t.duration,e.ewd=parseInt(t.videoWidth),e.eht=parseInt(t.videoHeight)),this.playerDAST.set(e)}},{key:"_logVideoUrlCounter",value:function(){var e=(e=this.getVideoUrl())||"na",t=this.store.get("videoUrlsCounter")||{};t[e]=t.hasOwnProperty(e)?++t[e]:1,Q(this.vpaidLog,"videoUrlCounter",{videoUrl:e,counter:t[e]},!1,!1);e=Object.keys(t);Q(this.vpaidLog,"sessionUniqueVideoUrls",{counter:e.length,urls:e},!0,!1),this.store.set("videoUrlsCounter",t)}},{key:"_dispatchToMoat",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!1!==t){if(this.isVForceActive){if(("AdImpression"===e||"AdVideoStart"===e)&&!i)return;if("AdPaused"===e&&!this.isFirstAdPaused)return void(this.isFirstAdPaused=!0)}for(var s=0;s<this.moatTrackers.length;s++)this.moatTrackers[s].dispatch({type:e,adVolume:this.adVolume})}}},{key:"_handleVpaidEvents",value:function(e,t){var i=this;if(this.vpaidEvents){if("javascript"===this.type&&(this.tag.getValueByKey("cmpltonstpd")||this._getAdSettingValue("cmpltonstpd")||this.vpaidHandler.completeOnAdStop)){if(e===this.vpaidEvents.AdVideoComplete)return void(this.vpaidHandler&&this.vpaidHandler.setCompletionOnAdStoppedTimeout&&this.vpaidHandler.setCompletionOnAdStoppedTimeout());e===this.vpaidEvents.AdStopped&&(e=this.vpaidEvents.AdVideoComplete)}!this.isFirstVpaidEvent&&this.vpaidHandler&&this.vpaidHandler._getMediaUrl()&&(this.isFirstVpaidEvent=!0,Q(this.vpaidLog,"mediaUrl",{url:this.vpaidHandler._getMediaUrl()},!1,!1),this._checkIfGoogle());var s=!0;if(!this.stopped){var n=this._firePixel(e,t);switch(e!==this.vpaidEvents.TimeUpdated&&this.debugTracker.info("VpaidHandler-event",e),this._dispatchToMoat(e,n),this._onEvent(e),e){case this.vpaidEvents.AdLoaded:this._adLoadedHandler(e),this.vpaidLog.getVpaidAnalyticsReport&&(r=this.vpaidLog.getVpaidAnalyticsReport(),Q(this.vpaidLog,"vpaidAnalyticsUntilAdloaded",r)),this.vpaidHandler.getAdIcons&&this.vpaidHandler.getAdIcons(this._onGotAdIconsBinded);break;case this.vpaidEvents.AdImpression:if(this.store.emit("playContentAfterFirstAd"),this._setVideoDataToPlayerDAST(),s=this._onAdImpression(e),this._pushConversionDataToWaterfallLog(),this._logVideoUrlCounter(),this._handleVerticalAd(parseInt(this.store.get("width")),parseInt(this.store.get("height"))),this.earlyAdImpression)return;this.isVForceActive||(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent());break;case this.vpaidEvents.AdVideoStart:this.setAdVolume(this.adVolume),this.adFoundDispatched||(this.adFoundDispatched=!0,this.emit(this.vpaidEvents.AdFound)),this.isUnPaused=!0,this.debugTracker.info("_handleVpaidEvents() -> AdStarted || AdVideoStart -> this.isUnPaused = false");break;case this.vpaidEvents.AdSkipped:this._handleStopped({type:e,oppType:this.oppsID.adSkiped}),this.adStoppedHandler(e);break;case this.vpaidEvents.AdStopped:this.adStoppedHandler(e),this._handleStopped({type:e});break;case this.vpaidEvents.AdLog:this.debugTracker.info("VpaidHandler-Log",arguments);break;case this.vpaidEvents.AdError:this.vpaidStatus.setStatus(this.vpaidStatuses.adError);var r=this.oppsID.adError;this.isAdErrorBeforeAdLoadedActive&&!this.adLoadedFired&&(r=this.oppsID.adErrorBeforeLoad),"video"===this.type?this.stop("Mp4AdError",r):this.stop("AdError",r,t);break;case this.vpaidEvents.SoundViolation:this.store.get("sndvltopp")&&!this.alreadySentSoundViolation&&(this.alreadySentSoundViolation=!0,this._sendOpp(this.oppsID.soundViolation));break;case this.vpaidEvents.AdPaused:this.pauseAdStartTime=void 0,this.adPausedFired=!0,this.waitForAdPausedBeforeResumeAd&&this.resumeOnAdPaused&&this.resumeAd(),this.isUnPaused=!1,this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdClickThru:t=this._adClickThroughData(t),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdPlaying:this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this._fireAdPlaying();case this.vpaidEvents.AdStarted:this.isUnPaused=!0;break;case this.vpaidEvents.AdVolumeChange:t&&t.eventData&&t.eventData.volume&&(this.adVolume=K(t.eventData.volume),this._dispatchToMoat(e,!0===this.hadImpression));break;case this.vpaidEvents.TimeUpdated:Q(this.vpaidLog,"videoTicking",{time:t.eventData.time}),this._onVpaidTimeupdated(t.eventData.time);break;case this.vpaidEvents.BlockingTagPassback:this._sendOpp(this.oppsID.blockingTagPassback);break;case this.vpaidEvents.SlowConnection:this._sendOpp(this.oppsID.slowConnection)}this.emit(e,{type:e,data:t});var a=this.nonVideoVpaid?0:this.externalPlayerItem?this.getExternalAdCurrentTime():this.localVideo.currentTime;if(-1===["AdDurationChange","AdSizeChange","AdLinearChange","AdLog","AdSkippableStateChange","AdExpandedChange","AdInteraction","AdUserClose","AdSkipped","Progress","AdVolumeChange"].indexOf(e)&&Q(this.vpaidLog,"event_"+e,{isViewable:!document.hidden,vidCurrentime:a,eventDataStr:t?G(t.eventData):null}),n&&this.vpaidEventToPixelId.hasOwnProperty(e)&&(this.hadImpression?this._sendOpp(this.vpaidEventToPixelId[e]):this.delayedQuartilesOpps.push(this.vpaidEventToPixelId[e])),this.vpaidEvents)if(e===this.vpaidEvents.AdClickThru)this.clickThruUrl=t&&t.eventData?t.eventData.url:"",this.clickThoughHandler.invokeClick(t.eventData);else if(e==this.vpaidEvents.AdVideoComplete){if(this.adCompleted=!0,this._newCompletionHandler(this.vpaidEvents.AdVideoComplete,n),this.tag.singleAd&&!this.isVForceActive&&this.store.emit("closePlayer"),this.stayAlive)return this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout)),void this.emit("end");this.vpaidHandler.stopAd(),setTimeout(function(){i.working=!1,i.workingVpaid=!1,i.stop("AdVideoComplete"),i.status="stopped"},2)}this.manager&&s&&this.manager.trigger(e,this,t?t.eventData:null)}}}},{key:"_onVpaidTimeupdated",value:function(e){this._sendOpp(this.oppsID.vpaidProgress,{sdid:e})}},{key:"_onGotAdIcons",value:function(e,t){Q(this.vpaidLog,"ad_choices",{vpaid:{error:e,result:t}},!1,!1)}},{key:"_newCompletionHandler",value:function(e,t){!this.newCompletionEventFired&&(this.timeoutToAdCompletion||this.fireNewCompletionPixel||this.newCompletionByVideoProgress)&&(this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion)),this._validateNewCompletionFiring(e,t)?this._fireNewCompletionEvent():Q(this.vpaidLog,"fireNewCompletionPrevented",{reason:e},!1,!1))}},{key:"_validateNewCompletionFiring",value:function(e,t){return e===this.vpaidEvents.AdVideoComplete?t&&this.opportunityManager.alreadySent(this.tag,this.oppsID.videoComplete):"timerEnded"===e}},{key:"_setClickThroughData",value:function(){this.clickThruUrl=this.clickThruUrl||this.pixelManager.getClickThruUrl()}},{key:"_adClickThroughData",value:function(e){if(e&&e.eventData&&e.eventData.url)return e;var t=this.pixelManager.getClickThruUrl();return t&&(t={url:t},e?e.eventData=Object.assign(e.eventData||{},t):e={eventData:t}),e}},{key:"_checkIfGoogle",value:function(){var e,t,i=this.localTarget.querySelector("iframe");if(i){var s=(e=i,t=this.store.get("debug"),{current:e,hasNext:function(){try{return!t&&e.contentWindow.console.error&&(this.current.contentWindow.console.error=function(){}),this.current=this.current.contentDocument.querySelector("iframe"),!0}catch(e){return!1}}});for(this.isGoogleIframe=!1;!this.isGoogleIframe&&s.hasNext();)this._isGoogleIframe(s.current)&&(this.isGoogleIframe=!0)}}},{key:"_isGoogleIframe",value:function(e){return e&&-1<e.src.indexOf("imasdk.googleapis.com")&&-1<e.src.indexOf("bridge")}},{key:"_onAdImpression",value:function(){var e=!0,t=this.store.get("rstmrai");return this.fireViewTracking&&this.fireViewTracking(),t&&this._killTimers(),!this.adStarted&&this.handelsEarlyAI?(this.earlyAdImpression=!0,this.isVForceActive&&this.pauseAd(),this.isUnPaused=!1,Q(this.vpaidLog,"earlyAdImpression",{early:!0}),clearTimeout(this.tillAdstartTimeout),this.tag.getValueByKey("prvnterlyadimpopp")||this.adSettings&&this.adSettings.prvnterlyadimpopp||this._fireAdImpression(),!1):(this.hadImpression?e=!1:(t=this.store.get("conversionsCount")+1,this.store.set("conversionsCount",t),Q(this.vpaidLog,"success",{count:t},!0,!1),this.setAdVolume(this.adVolume),this.emit(this.vpaidEvents.AdImpression),this._fireAdImpression(),this.adImpInMS=Date.now()-this.created,this.hadImpression=!0,this._wfStats.increaseSuccess(),this.vpaidHandler&&this.vpaidHandler.logVideoUrl&&this.vpaidHandler.logVideoUrl(),this.vpaidHandler&&!this.vpaidHandler.activeVideoElement&&this._sendOpp(this.oppsID.unfriendlyVideo),this.isReplayable=this.isReplayableVpaid(),Q(this.vpaidLog,"restartAd",{isReplayable:this.isReplayable},!1,!1),this.playerDAST.onImpression()),this.earlyAdImpression&&this.manager&&this.manager.trigger("AdImpression",this,null),e)}},{key:"_firePixel",value:function(e,t){if("AdVideoComplete"===e&&!this.hadImpression||e===this.vpaidEvents.AdImpression&&this.hadImpression||this.asyncAdimpression)return!0;if(this._isDelayedVideoVpaidImpression()){if("AdImpression"===e||"AdVideoStart"===e)return!1;if("AdPaused"===e&&!this.ignoredFirstAdPausedPixel)return this.ignoredFirstAdPausedPixel=!0}return(t=t||{}).impressionId=this.parser?this.parser.startTime:"",t.adDuration=1e3*(this.externalPlayerItem?this.getExternalAdDuration():this.localVideo.duration||0),this.pixelManager.firePixel(e,this.vpaidLog,t)}},{key:"_fireAdImpression",value:function(e){this.adimpFired||(this._isDelayedVideoVpaidImpression()||this.asyncAdimpression&&!e||(Q(this.vpaidLog,"fireAsyncAdimpression",{end:!0}),this._fireNetworkAdImpression()),this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression))}},{key:"_isDelayedVideoVpaidImpression",value:function(){return!("video"!==this.type||!this.isVForceActive||!this.tag.moatSampling&&"any"!==this.delayVideoVpaidImpressionForNonMoatRV&&this.tag.requiredViewability!=this.delayVideoVpaidImpressionForNonMoatRV)}},{key:"_fireNetworkAdImpression",value:function(){for(this._sendOpp(this.oppsID.tagImpression),this.pixelManager.firePixel(this.vpaidEvents.AdImpression,this.vpaidLog),this.adimpFired=!0,this.store.get("isFirstImpression")&&(this.store.set("isFirstImpression",!1),this.fire99());this.delayedQuartilesOpps&&this.delayedQuartilesOpps.length;)this._sendOpp(this.delayedQuartilesOpps.shift())}},{key:"_fireAdPlaying",value:function(){!this.adPlayingFired&&this.hadImpression&&this.workingVpaid&&(this.adPlayingFired=!0,this._sendOpp(this.oppsID.adPlaying),this.vpaidStatus.setStatus(this.vpaidStatuses.adPlay))}},{key:"onAsyncAdmpression",value:function(){Q(this.vpaidLog,"fireAsyncAdimpression",{start:!0}),this._fireAdImpression(!0)}},{key:"adStoppedHandler",value:function(e){var t=this;this.stop(),setTimeout(function(){t._cleanVpaid()},1e4)}},{key:"_setAdVolume",value:function(e,t){this.stopped||this.nonVideoVpaid||this.externalPlayerItem||(t&&this.localTarget.querySelector(":hover")==this.localVideo&&this.opportunityManager.send(this.tag,this.oppsID.soundOnHover,this.playerDAST.get()),e=K(e),this.adVolume=e,this.shouldMuteVid&&(this.localVideo.volume=e,this.localVideo.muted=0===e),0<this.adVolume&&this.setAdVolumeInterval&&this._stopForceAdVolumeInterval(),this.store.get("frcmtfrms")&&this._setVolumeInIframes(this.localTarget.getElementsByTagName("iframe"),e),this.vpaidHandler&&(this.vpaidHandler.setAdVolume(e,t),this.vpaidHandler.callIMAApi&&this.vpaidHandler.callIMAApi("volume",e)))}},{key:"_setVolumeInIframes",value:function(e,t){var i=this;q(e[0],"iframe",function(e){e.forEach(function(e){i._overideVolumeInIframe(e),e.setAttribute("tbvol",t),e.volume=t,i.shouldMuteVid&&(e.muted=0===t)})},"video",this.store.get("debug"))}},{key:"_overideVolumeInIframe",value:function(e){var t;e&&e.sv||(t=this,e.sv=!0,e.addEventListener("volumechange",function(){e.volume!==parseFloat(this.getAttribute("tbvol"))?(e.volume=0,t.emit(t.vpaidEvents.SoundViolation,{})):e.volume=t.adVolume}))}},{key:"_onParserError",value:function(e){this.stopped||(this.status="error",this.error=e.type||"",this.isPlaying=!1,Q(this.vpaidLog,"AdError",{errType:e.type,handlerType:e.handlerType,isPraserError:!0}),this.parser&&this.parser.trackingPixels&&this.pixelManager.loadPixelData(this.parser.trackingPixels),this.stop(this.error,e.oppsId))}},{key:"_onNetworkError",value:function(e){this.stopped||(this.status="error",this.error=e?"xhrStatuses_".concat(e):"",this.isPlaying=!1,this.stop(this.error,l.a.networkError))}},{key:"_updateAdVideoDurationOnVideoControls",value:function(e){this.VideoControls&&this.VideoControls.setState({vidDuration:e,vidCurrentTime:0})}},{key:"_getMediaType",value:function(){return"video"===this.type?1:"javascript"===this.type?2:"adx"===this.type?5:void 0}},{key:"_onVastFound",value:function(e){this.stopped||!this.tag.isPrebid||(e=this.tag.prebidHandler.interpretResponse(this.prebidAdapterSpec,e,this.prebidConf))&&(this.tag.prebidHandler.logInterpretedResponse(this.vpaidLog,e),this.tag.prebidPrice=e.cpm)}},{key:"_createHandler",value:function(e){this.stopped||(e.vastOptions.omidElements.length&&this.opportunityManager.send(this.tag,this.oppsID.omidDetected,this.playerDAST.get()),e?(this.setVastPrice(e.vastOptions.price),this.setVastIcons(e.vastOptions.icons||[]),this.setExternalScripts(e.vastOptions.creativeExtensions||[]),this.playerDAST.set({vdr:e.handlerOptions.extra.duration}),this.playerDAST.addWrapper(e.vastOptions.analysis||[]),this.handlerOptions.adParams=e.handlerOptions.adParams,this.handlerOptions.vpaidFiles=e.handlerOptions.vpaidFiles,this.handlerOptions.extra.duration=e.handlerOptions.extra.duration,this.handlerOptions.trackingPixels=e.handlerOptions.trackingPixels):e={type:"ima"},this.nonVideoVpaid||(this.vpaidLog.setVastWrapperCount(this.parser.wrappersCount),this._setTimers(),this.creatives.AdParameters=this.handlerOptions.adParams,this.handlerOptions.adSettings=this._getAdSettings(),this.adSettings&&this.adSettings.hasOwnProperty("wtfradpsdbfrrsmad")&&!0===this.adSettings.wtfradpsdbfrrsmad&&(this.waitForAdPausedBeforeResumeAd=!0)),this.vpaidHandler=this.vpaidHandlersFactory.create(e.type,this.handlerOptions),this.vpaidHandler?this.nonVideoVpaid||(this.type=e.type,this.store.emit(_e.outer.EmitQueueStatus),this.tag.vpaidWrapperData.mediatype=this._getMediaType(),this.debugTracker.info("ParserResponded[".concat(this.type,"-").concat(this.isMobile?"mob":"desk","]"),this.handlerOptions.vpaidFiles),this.pixelManager.loadPixelData(this.handlerOptions.trackingPixels),this._setClickThroughData(),this._updateAdVideoDurationOnVideoControls(this.handlerOptions.extra.duration),this.vpaidHandler.removeClickableTarget(),this._createMoatTracker()):this._onParserError({type:"handlerCreatingFail",handlerType:e.type,oppsId:this.oppsID.mediaFileNotSupported}))}},{key:"_createMoatTracker",value:function(e){var t=this.moatTrackersCreativeExtensions||[];this.tag.moatSampling&&t.push(void 0);for(var i=0;i<t.length;i++)this.moatTrackers.push(new Te({moatTag:t[i],container:this.vpaidHandler.getDOMContainer(),tag:this.tag,moatPartnerCode:this.tag.getValueByKey("moatPartnerCode"),duration:this.vpaidHandler.getAdDuration(),url:this.vpaidHandler.mediaFiles[0].url,store:this.store,vpaidLog:this.vpaidLog,playerDast:this.playerDAST.get(),debugTracker:this.debugTracker}));this._extractWinningPrice()}},{key:"_getAdSettings",value:function(e){return this.adSettings=this.store.getByAdInline(this.playerDAST.getWrappers())||{},0<Object.keys(this.adSettings).length&&Q(this.vpaidLog,"adSettings",this.adSettings,!0,!1),this.adSettings}},{key:"_cleanIframe",value:function(){var e=this.localTarget.querySelectorAll("iframe");this._clearIframe(e&&e.length?e[0]:null)}},{key:"_cleanVpaid",value:function(){if(!(this.clean||this.stayAlive&&this.isReplayable)){this.clean=!0,this.vpaidLog&&(this.vpaidLog.saveToDb(),this.vpaidLog.getVpaidAnalyticsReport=void 0),this.wflog&&!this.wflog.containsExternalPlayerItem&&(this.wflog.complete(),this.wflog=void 0),this.pixelManager&&this.pixelManager.destroy(),this.localTarget&&(this.localVideo&&this.localVideo.parentElement&&this.localTarget.removeChild(this.localVideo),this._cleanIframe(),this.localTarget.parentNode.removeChild(this.localTarget)),this.adTarget&&this.adTarget.parentNode&&this.adTarget.parentNode.removeChild(this.adTarget),this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this._killTimers(),this.nonVideoVpaid||this.externalPlayerItem||(this._unregisterToVastParserEvents(),this.parser.destroy()),this._reportBuffering&&this.vpaidHandler&&(this.vpaidHandler.off("buffering",this.bindedOnBuffering),this.vpaidHandler.off("bufferingEnded",this.bindedOnBufferingEnd));for(var e=0;e<this.moatTrackers.length;e++)this.moatTrackers[e].dispose();this.creativeExtensionsHandler&&(this.creativeExtensionsHandler.off("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.destroy()),this.status="stopped",this.working=!1,this.VideoControls&&this.VideoControls.destroy(),this.playerDAST&&this.playerDAST.destroy(),this.vpaidHandlersFactory&&this.vpaidHandlersFactory.destroy(),this.store&&(this._bindedOnAdLoadVideoThrottleDelayEnd&&(this.store.off(this.onThrottleEndEventName,this._bindedOnAdLoadVideoThrottleDelayEnd),this._bindedOnAdLoadVideoThrottleDelayEnd=void 0),this._bindedOnRemovedFromVideoThrottleListeners&&(this.store.off(this.onRemovedFromThrottleListenersEventName,this._bindedOnRemovedFromVideoThrottleListeners),this._bindedOnRemovedFromVideoThrottleListeners=void 0)),this.isVideoProgressingInterval&&(this.isVideoProgressingInterval=clearInterval(this.isVideoProgressingInterval)),this.creatives=this.vpaidLog=this.parser=this.debugTracker=this.manager=this.tag=this.vast=this.pixelManager=this.config=this.vpaidEvents=this.localTarget=this.vpaidHandler=this.store=this._wfStats=this.localVideo=this.VideoControls=this.adSettings=this.creativeExtensionsHandler=this.moatTrackers=this.moatTrackersCreativeExtensions=void 0,this.isPlaying=!1,window.setTimeout(this.onAfterStop,0),this.emit("vpaidCleaned")}}},{key:"_clearIframe",value:function(e){e&&(q(e,"iframe",function(e){var t=cmTag.$;e.forEach(function(e){t(e).remove()})},"*",this.store.get("debug")),e&&e.parentNode.removeChild(e))}},{key:"bringToFront",value:function(){var e;this.localTarget&&!this.blockBringToFront&&(e=this.store.get("height"),this.localTarget.style.display="block",this.localTarget.style.height="".concat(e,"px"),e=99+ui++,this.localTarget.style.zIndex=e,this.clickableTarget&&(this.clickableTarget.style.zIndex=e),this.vpaidHandler&&(this.vpaidHandler.zIndex=e),this.VideoControls&&this.VideoControls.setState({isVisible:!0}),this.toggleIframeContentDisplay("hide"))}},{key:"moveToBack",value:function(){this.localTarget&&(this.localTarget.style.zIndex=0,this.clickableTarget&&(this.clickableTarget.style.zIndex=0))}},{key:"subscribe",value:function(e,t){this.stopped||this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents&&this.vpaidEvents[t]&&(e?this.off(t,e):this.off(t))}},{key:"stop",value:function(e,t,i){var s,n=this;if(!e&&this.pixelManager.getState()===this.vpaidEvents.AdVideoThirdQuartile&&!this.adCompleted)return Q(this.vpaidLog,"earlyAdStopped",{early:!0},!0,!1),void this._handleVpaidEvents(this.vpaidEvents.AdVideoComplete,{});"global_ad_timeout"!==e&&"undefinedIframeSrc"!==e&&this.stayAlive&&this.isReplayable||this.stopped||(this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!1),e&&"hijackAttempt"!==e&&(i&&i.eventData?Q(this.vpaidLog,e,{eventDataStr:G(i.eventData),status:this.status}):Q(this.vpaidLog,e,{status:this.status})),this._stopForceAdVolumeInterval(),this.hadImpression||(s=this.store.get("failsCount")+1,this.store.set("failsCount",s),Q(this.vpaidLog,"fails",{count:s},!0,!1)),this._wfStats&&(this.hadImpression||this._wfStats.increaseFailure(),Q(this.vpaidLog,"wfStats",{data:this._wfStats.getData()},!1,!1)),this.isStarted&&this.store.decr("ads_started"),this.stopReason=e,this.oldStatus+=this.status,this.isPlaying=!1,void 0!==t&&this._sendOpp(t,i),"NoMediaFileAfterSort"===e&&t===this.oppsID.mediaFileNotSupported&&this._firePixel("AdError",{eventData:{iabErrorCode:a.a.mediaFileNotSupported}}),"playerClosed"===e&&this.hadImpression&&this.pixelManager.firePixel("close",this.vpaidLog,{}),this.stopped=!0,this.vpaidHandler&&(this.vpaidHandler.onAfterStop=this._cleanVpaid.bind(this),this.vpaidHandler.stopAd()),this.emit("end"),this.store.emit("vpaidEnded",this),setTimeout(function(){n._cleanVpaid()},2),"global_ad_timeout"===e&&(this.isReplayable=!1,this.isVForceActive||this.store.emit("hideAdPlayer")))}},{key:"callVpaidMethod",value:function(e,t,i){if(!this.stopped){if(this.vpaidHandler&&this.vpaidHandler.callIMAApi&&("pauseAd"!=e&&"resumeAd"!=e||this.vpaidHandler.callIMAApi(e)),"resizeAd"!==e&&Q(this.vpaidLog,"vpaidApi_"+e,{}),"setAdVolume"==e&&(this.adVolume=K(t[0])),"pauseAd"==e&&(this.isUnPaused=!1),"resizeAd"!=e||this.nonVideoVpaid||this.externalPlayerItem||this._resizeContainers(t[0],t[1],t[2]),"resizeAd"==e&&this.externalPlayerItem&&this._resizeLocalTarget(),!this.vpaidHandler||!this.vpaidHandler[e])return i;try{return this.vpaidHandler[e].apply(this.vpaidHandler,t)}catch(e){return i}}}},{key:"_resizeContainers",value:function(e,t,i){this.localVideo.style.width=e+"px",this.localVideo.style.height=t+"px",this.localVideo.setAttribute("width",e),this.localVideo.setAttribute("height",t),this._resizeLocalTarget(e,t,i)}},{key:"_resizeLocalTarget",value:function(e,t,i){this.localTarget.style.width=e+"px",this.localTarget.style.height=t+"px",this.localTarget.setAttribute("width",e),this.localTarget.setAttribute("height",t)}},{key:"onAfterStop",value:function(){}},{key:"_hijackAttempt",value:function(e,t){"maliciousUrl"===e?this.hijackFired||(this.hijackFired=!0,Q(this.vpaidLog,"hijackAttempt",{type:"url",badUrl:t.url,earlyHijack:t.isEarly||!1},!1,!1),!1!==this.store.get("hjkstp")&&this.stop("hijackAttempt",l.a.hijackAttempt)):"maliciousAction"===e&&(this._sendOpp(this.oppsID.blockedActionByHijack),Q(this.vpaidLog,"hijackAttempt",{type:"action",action:t.action}))}},{key:"_onVpaidResourceEvent",value:function(e){"hijackAttempt"===e.event?this._hijackAttempt(e.data.type,e.data.data):"undefinedIframeSrc"===e.event?(Q(this.vpaidLog,"undefinedRelativeIframeSrcError",{url:e.data.url}),this.store.get("stpvpdonudfndsrc")&&this.stop("undefinedIframeSrc",l.a.networkError)):"maxNetworkCalls"===e.event&&(Q(this.vpaidLog,"vpaidAnalyticsCallLimit",{adImpression:this.adimpFired,limitExceeded:!0,maxNetworkCalls:e.data.maxNetworkCalls}),this.adimpFired||this.stop("networkCallsLimitExceeded",l.a.maxNetworkCalls))}},{key:"fire99",value:function(){this._sendOpp(this.oppsID.firstImpression)}},{key:"_onEvent",value:function(e,t){var i;this.pendingEvents&&this.pendingEvents.hasOwnProperty(e)&&(-1!=(i=this.pendingEvents[e]).timeoutId&&clearTimeout(i.timeoutId),i.cb&&"function"==typeof i.cb&&i.cb(t),delete this.pendingEvents[e])}},{key:"_waitForEvent",value:function(e,t,i,s){function n(){}var r=-1,a=this;0<t&&s&&"function"==typeof s&&(r=setTimeout(function(){Q(this.vpaidLog,"vpaidTimeout_"+e,{}),s(),delete a.pendingEvents[e],r=null,s=i=n}.bind(this),t)),this.pendingEvents||(this.pendingEvents={}),this.pendingEvents[e]={cb:i,timeoutId:r}}},{key:"_onAdLoadedTimeout",value:function(){this.error="adloadedTimeout",this._firePixel("AdError",{eventData:{iabErrorCode:a.a.timeout}}),this.stop(this.error,this.oppsID.adloadedTimeout)}},{key:"_onAdLoadedEvent",value:function(){}},{key:"_onAdImpressionTimeout",value:function(){this.error="adImpressionTimeout",this.stop(this.error)}},{key:"_onAdImpressionEvent",value:function(){}},{key:"setVastPrice",value:function(e){0<(this.tag.vpaidWrapperData.vastPrice=e)&&Q(this.vpaidLog,"vastPrice",{value:e})}},{key:"setExternalScripts",value:function(e){0!==e.length&&(this.pushExternalMoatTracker=this._pushExternalMoatTracker.bind(this),this.creativeExtensionsHandler=new Zt(e,this.localTarget,this.vpaidLog),this.creativeExtensionsHandler.on("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.handleExternalScripts())}},{key:"_pushExternalMoatTracker",value:function(e){this.moatTrackersCreativeExtensions=this.moatTrackersCreativeExtensions||[],this.moatTrackersCreativeExtensions.push(e)}},{key:"setVastIcons",value:function(e){this.tag.getValueByKey("fkadchcs")?(this.hasAdChoices=!0,Q(this.vpaidLog,"ad_choices",{fakeAdChoices:!0})):(this.tag.vpaidWrapperData.icons=e,this.hasAdChoices=e.length,this.hasAdChoices&&this._addAdChoiceDiv(e))}},{key:"_addAdChoiceDiv",value:function(e){Q(this.vpaidLog,"ad_choices",{vast:!0});var t,i=ri(e);try{for(i.s();!(t=i.n()).done;){var s,n,r,a=t.value;a.attributes.program&&-1===this.iconsPrograms.indexOf(a.attributes.program)&&(this.iconsPrograms.push(a.attributes.program),(s=document.createElement("div")).className="_cm-ad-choices-player",s.style.zIndex=1,a.attributes.xPosition&&(s.style.left="initial",s.style[a.attributes.xPosition]="13px"),a.attributes.yPosition&&(s.style.top="initial",s.style[a.attributes.yPosition]="16px"),n=document.createElement("a"),a.clickThroughUrl&&(n.href=a.clickThroughUrl),n.onclick=this._appendOnClick(a),n.target="_blank",n.className="_cm-ad-choices-player-anchor",n.style.width=a.attributes.width||"19px",n.style.height=a.attributes.height||"15px",a.staticresource?n.style.background="#fff url(".concat(a.staticresource,") no-repeat center center"):a.htmlresource&&(n.innerHTML+=a.htmlresource),a.iconViewTracking.length&&(r=a.iconViewTracking,this.fireViewTracking=function(){setTimeout(function(e){var t,i=ri(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;(new Image).src=s}}catch(e){i.e(e)}finally{i.f()}},5e3,r)}),s.appendChild(n),this.localVideo.parentElement.appendChild(s))}}catch(e){i.e(e)}finally{i.f()}}},{key:"_appendOnClick",value:function(s){return function(){var e,t=ri(s.clickTracking);try{for(t.s();!(e=t.n()).done;){var i=e.value;(new Image).src=i}}catch(e){t.e(e)}finally{t.f()}}}},{key:"_copyFromStoreToBi",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.store.get(e)&&Q(this.vpaidLog,e,this.store.get(e),!1,t)}},{key:"mute",value:function(){this.stopped||(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&0<this.adVolume&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=0,this.VideoControls&&this.VideoControls.setState({isMuted:!0}))}},{key:"unmute",value:function(){this.stopped||(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&0===this.adVolume&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=K(this.store.get("dfltvlm")),this.VideoControls&&(this.store.get("forceMute")?this.adVolume=0:(this.VideoControls.setState({isMuted:!1}),this.adVolume=K(this.VideoControls.getValueFromControlsState("volume")))))}},{key:"updateStatusesOnGetAd",value:function(e){Q(this.vpaidLog,"statusesOnGetAd",{status:this.status,hadImpression:!!this.hadImpression,isStarted:!!this.isStarted,requiredViewability:e.requiredViewability})}},{key:"logVpaidFamily",value:function(){var e=[],t=[];if(this.vpaidHandler.adUnit._iframe&&this.vpaidHandler.adUnit._iframe.contentWindow)for(var i,s=this.vpaidHandler.adUnit._iframe.contentWindow.document.scripts,n=0;n<s.length;n++)-1<s[n].src.indexOf("z.moatads.com")&&4<s[n].src.split("/").length&&e.push(s[n].src.split("/")[3]),-1<s[n].src.indexOf("sc.iasds01.com")&&(2===(i=s[n].src.match(/EntityId=([^&]*)/)).length&&t.push("ias-".concat(i[1])));var r="".concat(this.tag.dp).concat(0<e.length?e.join("_"):"").concat(0<t.length?t.join("_"):"").concat(this.isGoogleIframe?"_ggl":"").concat(this.isUnfriendlyIframe?"_ui":"");r!==this.tag.dp&&Q(this.vpaidLog,"vpaidFamily",{family:r})}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped)try{null!=e&&!isNaN(parseInt(e))||(e=!1),null!=t&&!isNaN(parseInt(t))||(t=!1);var s,n,r,a,o=0,d=0;if(!e&&!t)return void this.debugTracker.error("resize","No `height` or `width` specified!");t&&e?(d=this._convertSizeFromNumberToPixels(t),o=this._convertSizeFromNumberToPixels(e)):(n=(i=i&&1<i.split(":").length?i:this.store.get("playerAspectRatio")).split(":"),e?(s=parseInt(n[1])/parseInt(n[0]),o=this._convertSizeFromNumberToPixels(e),d=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(o)*s))):(s=parseInt(n[0])/parseInt(n[1]),d=this._convertSizeFromNumberToPixels(t),o=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(d)*s)))),o&&d&&(r=parseFloat(o),a=parseFloat(d),this.localTarget.style.width=o,this.localTarget.style.height=d,this.localTarget.setAttribute("width",r),this.localTarget.setAttribute("height",a),this.nonVideoVpaid||this.externalPlayerItem||(this.localVideo.style.width=o,this.localVideo.style.height=d,this.localVideo.setAttribute("width",r),this.localVideo.setAttribute("height",a)),this.clickableTarget&&(this.clickableTarget.style.width=o,this.clickableTarget.style.height=d,this.clickableTarget.setAttribute("width",r),this.clickableTarget.setAttribute("height",a)),this.isMultiAdsActive&&(!this.isVerticalVideoSupported||a<r?(this.store.set("width",r.toString()),this.store.set("height",a.toString()),this.store.emit("resizeVpaidWrapper",{width:r,height:a})):this.isVertical=!0),this._handleVerticalAd(r,a,i),this.isVForceActive&&this.vpaidHandler.resizeAd(r,a,this.config.viewMode||"normal",i)),this.blockBringToFront&&(this.blockBringToFront=!1,this.bringToFront())}catch(e){this.debugTracker.error("resize","Resizing component failed!")}}},{key:"_handleVerticalAd",value:function(e,t,i){this.localVideo&&this._isVerticalAd(e,t,i)&&(j(this.localVideo,"vertical-video"),N(this.localVideo,"ie-black-edges"))}},{key:"_isVerticalAd",value:function(e,t,i){return!!this.isVerticalVideoSupported&&(e<=t||(i&&-1<i.indexOf(":")?(i=i.split(":"),parseInt(i[1])>=parseInt(i[0])):!(!this.localVideo.videoWidth||!this.localVideo.videoHeight)&&this.localVideo.videoHeight>=this.localVideo.videoWidth))}},{key:"_convertSizeFromNumberToPixels",value:function(e){e+="";return e.search(/px$/g)<0&&(e+="px"),e}},{key:"getCurrentVolume",value:function(){return this.VideoControls?this.VideoControls.getValueFromControlsState("volume"):this.adVolume}},{key:"_onSoundChange",value:function(e){this.vpaidHandler&&this.vpaidHandler.onMuteChanged&&this.vpaidHandler.onMuteChanged(e)}},{key:"_pushConversionDataToWaterfallLog",value:function(){var e,t;this.wflog&&(!(e=this.getVideoUrl())||(t=this.store.get("wfLogUniqueVideoUrls_".concat(this.wflog.index))||[]).indexOf(e)<0&&(t.push(e),this.wflog.push("uniqueVideoUrlsCounter",t.length),this.store.set("wfLogUniqueVideoUrls_".concat(this.wflog.index),t)),this.wflog.push("wfConversionsCounter",this.wflog.get("wfConversionsCounter",0)+1),this.wflog.sendDataOnConversion())}},{key:"_pushUniqueAdvIdsToWaterfallLog",value:function(){var e;!this.wflog||(e=this.store.get("wfLogUniqueAdvIds_".concat(this.wflog.index))||[]).indexOf(this.tag.advId)<0&&(e.push(this.tag.advId),this.wflog.push("uniqueAdvIdsCounter",e.length),this.store.set("wfLogUniqueAdvIds_".concat(this.wflog.index),e))}},{key:"_appendVpaidCSS",value:function(){var e=this.tag.getValueByKey("vpdcss"),t=[];if(void 0!==e){for(var i in e){var s=null;if(s=-1<this.localTarget.className.indexOf(i)?this.localTarget:this.localTarget.querySelectorAll(i)[0])for(var n in e[i])s.style[n]=e[i][n];else t.push("No element matching ".concat(i))}Q(this.vpaidLog,"appendVpaidCSS",{success:0===t.length,style:G(e),errors:t.join(",")})}}},{key:"toggleIframeContentDisplay",value:function(e){!this.stopped&&this.isMultiVpaidUnit&&this.toggleIframeContentDisplayActive&&this.vpaidHandler.toggleIframeContentDisplay&&this.vpaidHandler.toggleIframeContentDisplay(e)}},{key:"_sendOpp",value:function(e,t){if(!this.stopped&&this.opportunityManager){var i={};if(this.store.get("erronopp"))switch(e){case this.oppsID.adError:case this.oppsID.adErrorBeforeLoad:i.sdid=ne(t);break;case this.oppsID.adUnitLoadFailed:case this.oppsID.adloadedTimeout:case this.oppsID.adtoTimeout:case this.oppsID.globalTimeout:i.sdid=a.a.timeout;break;case this.oppsID.emptyVast:i.sdid=a.a.schemaValidationError;break;case this.oppsID.mediaFileNotSupported:i.sdid=a.a.mediaFileNotSupported;case this.oppsID.wrappersData:i.debugData=t&&t.debugData||""}e===this.oppsID.vpaidProgress&&(i.sdid=t.sdid),e===this.oppsID.tagImpression&&this._isVideoSrcExist()&&this._addBufferingData(i),i.vidCurrentTime=this.localVideo?this.localVideo.currentTime:void 0,this.opportunityManager.send(this.tag,e,this.playerDAST.get(),i)}}},{key:"_addBufferingData",value:function(e){this.localVideo.buffered&&0<this.localVideo.buffered.length&&this.localVideo.buffered.end(0)&&(e.bis=this.localVideo.buffered.end(0))}},{key:"_isVideoSrcExist",value:function(){return this.localVideo&&!this.localVideo.forceCanvas&&this.localVideo.getSrc&&this.localVideo.getSrc()}},{key:"getAdDuration",value:function(){var i=this;isNaN(this.localVideo.duration)?this.vpaidHandler&&this.vpaidHandler.getAdDuration(function(e,t){i._setVideoControlsDuration(t)}):this._setVideoControlsDuration(this.localVideo.duration)}},{key:"_setVideoControlsDuration",value:function(e){this.VideoControls&&this.VideoControls.setState({vidDuration:e})}},{key:"registerToVPAIDVideoTimeupdateEvent",value:function(){var t,i=this;this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement&&(null!==(t=this.vpaidHandler.getVPAIDVideoElement())&&t.addEventListener("timeupdate",function(e){i._onTimeupdate(t)}))}},{key:"_onTimeupdate",value:function(e){this.workingVpaid&&0<e.currentTime&&this.VideoControls&&this.VideoControls.setState({preventAdTicker:!0,vidDuration:e.duration,vidCurrentTime:e.currentTime})}},{key:"getVpaidStatus",value:function(){return this.vpaidStatus.get()}},{key:"_sendFirstUnmuteOpp",value:function(){this._sendOpp(this.oppsID.adUnmuted)}},{key:"getPrice",value:function(e){var t=this.tag.vpaidWrapperData&&this.tag.vpaidWrapperData.vastPrice?this.tag.vpaidWrapperData.vastPrice:this.tag.price;return this.tag.isPrebid&&this.store.get("isprbdprc")&&void 0!==this.tag.prebidPrice&&(t=this.tag.prebidPrice,this.setVastPrice(t)),t||void 0!==this.defaultTagPrice?e?function(e){for(var t,i=JSON.stringify(e),s="",n=0;n<i.length;n++)t=n%"PlAyER".length,s+=String.fromCharCode(i[n].charCodeAt(0).toString(10)^"PlAyER"[t].charCodeAt(0).toString(10));try{s=btoa(s)}catch(e){return!1}return s}(t):t:""}},{key:"_getAdSettingValue",value:function(e){return this.adSettings&&this.adSettings.hasOwnProperty(e)?this.adSettings[e]:void 0}},{key:"_extractWinningPrice",value:function(){var e,t;this._getAdSettingValue("extwnprc")&&(e=this._getAdSettingValue("wnprcfld"),t=this._getAdSettingValue("blkemptywp"),(t=this.pixelManager.extractWinningPrice(e,t))&&(Q(this.vpaidLog,"winningPrice",t,!1,!1),this.playerDAST.set({wp:t})))}},{key:"getVpaidData",value:function(e){if(this.stopped)return{};this.tag.nas&&(this.tag.nas.isClickable=void 0!==this.tag.nas.isClickable?this.tag.nas.isClickable:this._isNativeAdSettingsClickable());var t=this.vpaidHandler.getAdWidth()||this.playerDAST.getByKey(Ie.vastWidth),i=this.vpaidHandler.getAdHeight()||this.playerDAST.getByKey(Ie.vastHeight);return{adjacency:this.tag.adjacencyAd,advId:this.tag.advId,backfill:this.tag.priority===this.bfPriority,brand:this.tag.brand,campaignId:this.tag.campaignId,costModel:this.tag.cstmdl,cpcv:this.tag.isCPCV,creativeId:this.tag.creativeId,dp:this.tag.dp,itemType:this.tag.itemType,lineItem:this.tag.lineItemId,nonVideoVpaid:this.nonVideoVpaid,price:this.getPrice(e),pubId:this.tag.pubId,replayable:this.isReplayable,rv:this.tag.requiredViewability,singleAd:this.tag.singleAd,vpaidStatus:this.vpaidStatus.get(),wfSequence:this.tag.sequenceId,wfTagId:this.tag.wfIndex,adNativeSettings:this.tag.nas,adWidth:t||0,adHeight:i||0,supportVerticalVideo:this.isVerticalVideoSupported,vastClickThruLink:this.clickThruUrl,eventTrackers:this._getUnitEventTrackers(),supportVideoCurrentTimeEvents:!(!this.vpaidHandler||!this.vpaidHandler.activeVideoElement),duration:this.vpaidHandler&&this.vpaidHandler.activeVideoElement?this.vpaidHandler.getActiveVideoElementDuration():null,earlySrcVPAID:this.earlySrcVPAID,startTimestamp:this.startTimestamp}}},{key:"_isNativeAdSettingsClickable",value:function(){var e=this.tag.nas.link||this.clickThruUrl;return void 0!==e&&""!==e}},{key:"_getUnitEventTrackers",value:function(){var i=this,e=this.store.get("untetrk")||[],s={};return e.forEach(function(e){var t=i.pixelManager.getPixels(e);0<t.length&&(s[e]=t)}),s}},{key:"setDebugData",value:function(e){this.stopped||(this.tag.vpaidWrapperData.debugData=e)}},{key:"setDebugDataFunc",value:function(e){this.stopped||(this.tag.setDebugDataFunc=e)}},{key:"_onBuffering",value:function(){this.emit("buffering"),this._sendOpp(this.oppsID.buffering)}},{key:"_onBufferingEnd",value:function(){this.emit("bufferingEnded"),this._sendOpp(this.oppsID.bufferingEnded)}},{key:"_onWrappersData",value:function(e){this._sendOpp(this.oppsID.wrappersData,e)}},{key:"skipAd",value:function(){this.stopped||this.vpaidHandler.skipAd()}},{key:"getLocalTarget",value:function(){return this.localTarget}},{key:"getHandlerOptions",value:function(){return this.handlerOptions}},{key:"setVpaidHandler",value:function(e){this.vpaidHandler=e}},{key:"getVpaidLog",value:function(){return this.vpaidLog}},{key:"createPlacement",value:function(e,t,i){var s=this._createAdTargetElement(i);return{adTarget:s,localTarget:this._createLocalTarget(s,e,t,i)}}},{key:"_createLocalTarget",value:function(e,t,i,s){var n=i.config.target,i=document.createElement("div");return this._styleElement(i,n,s),this._appendExtraCSSRules(i,t,s),e?(N(i,"multi-vpaids"),e.appendChild(i),n.appendChild(e)):n.appendChild(i),i}},{key:"_styleElement",value:function(e,t,i){var s=i.get("noplrcntr"),i=i.get("mltads");return s?(localTarget.id="_cm-css-reset",e.className=li++):(e.style.cssText=t.style.cssText,e.className="".concat(t.className||""," ").concat(li++),e.id="vpaid-player-container"),e.style.position="absolute",e.style.overflow="hidden",e.style.top="0",e.style.height="0",e.style.left="0",e.style.zIndex="1",e.style.background="transparent",i&&e.className.indexOf("_cm-video-ad")<0&&(e.className="_cm-video-ad ".concat(e.className),e.id="vpaid-player-container"),e}},{key:"_appendExtraCSSRules",value:function(e,t,i){var s=i.get("adtrgtcss")?t.getValueByKey("trgtcss"):void 0;if(s)for(var n in s)e.style[n]=s[n]}},{key:"_createAdTargetElement",value:function(e){var t,i=e.get("mltads");return(e.get("isMultiVpaidUnit")||i)&&((t=document.createElement("div")).className="_cm-ad",t.id="_cm-css-reset"),t}}])&&oi(e.prototype,t),i&&oi(e,i),n}();function pi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var vi={undefinedIframeSrc:"undefinedIframeSrc",event_AdImpression:"conversion",event_SoundViolation:"soundViolation",adStartTimeout:"adStartTimeout",AutoKill:"auto_kill",AdStopADTO:"before_startAd_timeout",queueTrimmed:"queueTrimmed",adPlayTimeout:"adPlayTimeout",queueExpired:"removed_from_queue",tagError:"tagError",vastFilterdByRegex:"vast_blacklisted",event_AdLoaded:"adLoaded",fetchVastXhr:"fetchVastXhr",fetchVastFallToXhr:"fetchVastFallToXhr",vpaidTimeout_AdLoaded:"adload_timeout",creatingVpaidHandler:"initVpaid",createdVpaidHandler:"before_adload",creatingVpaidHandlerError:"creatingVpaidHandlerError",networkError:"networkError",adUnitLoadFailed:"vpaid_unit_failed",adloadedTimeout:"adload_timeout",adImpressionTimeout:"adImpressionTimeout",playerClosed:"playerClosed",idleMode:"idleMode",hijackAttempt:"vpaid_blacklisted_url"},fi=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vast_blacklisted","tagError","queueTrimmed","before_startAd_timeout","auto_kill","vpaidTimeout","creatingVpaidHandlerError","networkError","vpaid_unit_failed","adload_timeout","adImpressionTimeout","idleMode","vpaid_blacklisted_url","removed_from_queue"],mi={NoMediaFiles:"empty_vast",event_AdError:"ad_error",vastxhrerror_noflash:"vast_fetch_fail",WrapperError:"wrapper_error",ParsingError:"xml_parsing_error",NoMediaFileAfterSort:"unsupported_mediafile"},gi={BfRon:!0},yi={difa:"idfa",aid:"appId",aname:"appName"},bi=1e4,_i=function(){function n(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.tag=e,this.store=t,this.created=Date.now(),this.dataChanged=!1,this.friendlyVideoUrl=!1,this.iframesDetector=this.store.get("iframesDetector");var s=this.store.get("dast"),t="";s&&(t=s.cicmp);s=this.store.get("subUnitType");this.sessionStarted=this.store.get("session_started")||this.created,this.data={_id:W(10),player_id:this.store.get("player_id"),tag:e,isMobile:e.isMobile,created:(new Date).toISOString(),timeSinceSessionStarted:this.created-this.sessionStarted,dp:e.dp,status:"new",statuses:["new"],itemScore:-1,fullPageUrl:this.store.get("fullPageUrl"),documentVisible:!document.hidden,oneAuction:this.store.get("mltads"),su:null!=s?s:-99999,redId:this.store.get("red_id")||"na",displayLineItem:t,updatesCount:0,serverSideDataSaver:this.store.get("serverSideDataSaver")||"na",clientSideDataSaver:this.store.get("clientSideDataSaver")||"na",dataSaver:this.store.get("dataSaver"),taboolaVpaid:this.store.get("istblvpd"),hasDsm:!!this.store.get("dsm"),hasVpaidAnalytics:!!this.store.get("analyticsFuncString"),isAmp:this.store.get("isAmp"),isCPCV:e.isCPCV,isPrivateBrowsing:this.store.get("isPrivateBrowsing")||"na",frameType:this.store.get("frameType")||-1},Object.assign(this.data,this._getDastData()),this.isReportDb=!1,this.dtor=!1,this._dataModified=!0,this.updatingInterval=setInterval(function(){i._dataModified&&i._sendData()},bi)}var e,t,i;return e=n,(t=[{key:"_getDastData",value:function(){var e,t=this.store.get("dast")||{},i={},s=!1;for(e in yi){var n=t[e];n&&(i[yi[e]]=n,s=!0)}return i.inApp=s,this.store.set("isInApp",s),i}},{key:"push",value:function(e,t,i){var s=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];if(this.data){if(-1<e.indexOf("AdError")||"event_SoundViolation"===e?this._addStatus(this._prettyErrorStatus(e,t)):vi.hasOwnProperty(e)&&"conversion"!==this.data.status?this._addStatus(vi[e]):gi.hasOwnProperty(e)&&(this.data["is"+e]=!0),s&&(s=Date.now()-this.created,t.time=s),this._dataChanged(),!i&&this.data.hasOwnProperty(e))return Array.isArray(this.data[e])||(this.data[e]=[this.data[e]]),this.data[e].push(t),void(3<this.data[e].length&&this.data[e].splice(0,1));this.data[e]=t,-1!==fi.indexOf(this.data.status)&&this._setDpStats()}}},{key:"_dataChanged",value:function(){this._dataModified=!0}},{key:"_sendData",value:function(){this._collectDataFromVpaidAnalytics(),this.data&&this.data.updatesCount++,x("VpaidLog",this.data,this.store),this._dataModified=!1}},{key:"_collectDataFromVpaidAnalytics",value:function(){try{var e,t;this.getVpaidAnalyticsReport&&((e=this.getVpaidAnalyticsReport()).realTotalRequestsCounter=e.totalRequestsCounter,this._wrappersCount&&(e.totalRequestsCounter+=this._wrappersCount,e.wrappersCount=this._wrappersCount),t=this.iframesDetector.detect(e.iframes,this.friendlyVideoUrl),e.totalRequestsCounter+=this.iframesDetector.calculateWeightsByIframeType(t),e.totalRequestsCounter-=e.iframes.length,this.push("vpaidAnalytics",e,!0),this.push("vpaidIframesDetection",t,!0))}catch(e){this.push("vpaidAnalyticsCollectFail",{ex:e})}}},{key:"_prettyErrorStatus",value:function(e,t){e=t.errType||e;return mi.hasOwnProperty(e)?mi[e]:"error_".concat(e)}},{key:"_setDpStats",value:function(){var e,t;this.isDPStatusSet||this.store.get("static_schedule")||(t=Date.now(),this.data.dtor=!0,this.data.timeFromLastPlayFromQueue=t-this.store.get("playFromQueue"),this.data.timeFromLastPlayFromQueueFound=t-this.store.get("playFromQueueFound"),this.isDPStatusSet=!0,this._incrStats(".tries"),"conversion"===this.data.status?(this._incrStats(".conversions"),this.store.set(this.tag.dp+".failsRow",0),e=this.store.get(this.tag.lineItem+".failsRow"),this.store.set(this.tag.lineItem+".failsInARowTillConversion",e<0?0:e),this.store.set(this.tag.lineItem+".failsRow",0)):(this._incrStats(".fails"),this.store.get(this.tag.lineItem+".failsRow")<0?this.store.set(this.tag.lineItem+".failsRow",1):this._incrStats(".failsRow")),t=this.store.get(this.tag.dp)||{fails:0,failsRow:0,conversions:0},(e=this.store.get(this.tag.lineItem)||{}).fails||(e.fails=0),e.failsRow||(e.failsRow=0),e.conversions||(e.conversions=0),t.lineItems=t.lineItems||[],-1===t.lineItems.indexOf(this.tag.lineItem)&&t.lineItems.push(this.tag.lineItem),this.data.lineItemLog=e,this.data.dpLog=t,this.data.conversionsCount=this.store.get("conversionsCount"),this.data.unit={width:this.store.get("width"),height:this.store.get("height")},-1===(t=this.store.get("lineItems")||[]).indexOf(this.tag.lineItem)&&(t.push(this.tag.lineItem),this.store.set("lineItems",t)),this.store.set(this.tag.lineItem,e))}},{key:"_incrStats",value:function(e){this.store.incr(this.tag.dp+e),this.store.incr(this.tag.lineItem+e)}},{key:"saveToDb",value:function(){this.saveToDbWithoutReport(),this._reportDb()}},{key:"saveToDbWithoutReport",value:function(){if(this.data){var e;this._collectDataFromVpaidAnalytics(),this._setDpStats();try{e=cmTag.utils.getLoopTime()}catch(e){}e&&(this.data.loopTime=e)}}},{key:"_reportDb",value:function(){this.isReportDb||(this.data.updatesCount++,x("VpaidLog",this.data,this.store),this.tag=null,this.data=null,this.store=null,this.isReportDb=!0,this._dataModified=!1,clearInterval(this.updatingInterval))}},{key:"_addStatus",value:function(e){var t=this;-1===fi.indexOf(this.data.status)&&(this.data.status=e,this.data.statuses.push(e),"conversion"===e&&setTimeout(function(){t._sendData()},2e3))}},{key:"toString",value:function(){return G(this.data,4)}},{key:"setVastWrapperCount",value:function(e){this._wrappersCount=e}}])&&pi(e.prototype,t),i&&pi(e,i),n}();function wi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ai=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.parameters=e,this.store=t,this.debugTracker=new d("OpportunityManager"),this._initOppsAggregator(),this.isOppsulaRegisterAPI=this.oppsAggregator&&this.oppsAggregator.registerCallback,this._sentOpps={},this._oppsToSendOnlyOnce=[l.a.tagImpression,l.a.adLoaded,l.a.videoFirstQuartile,l.a.videoMidpoint,l.a.videoThirdQuartile,l.a.videoComplete,l.a.videoComplete,l.a.soundOnHover],this._isPaused=!1,this.vpaidLog=i,this.billableEvents=this.store.get("bllblevt").split(",")}var e,t,i;return e=s,(t=[{key:"_initOppsAggregator",value:function(){this.store.get("usopsla")&&this.store.get("oppsula")?this.oppsAggregator=this.store.get("oppsula"):this.oppsAggregator=this.store.get("oppsAggregator")}},{key:"alreadySent",value:function(e,t){return!(!this._sentOpps[e.sequenceId]||!this._sentOpps[e.sequenceId][e.lineItemId])&&-1!=this._sentOpps[e.sequenceId][e.lineItemId].indexOf(t)}},{key:"send",value:function(e,i,t){var s,n,r,a,o,d,h,l,u,c,p=this,v=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};e&&(this._isPaused?this.debugTracker.info("OpportunityPixel","[tag-"+(+e.waterfallTagId+1)+"] Disgarded sending '"+i):-1!=this._oppsToSendOnlyOnce.indexOf(i)&&this.alreadySent(e,i)||(s=v.debugData||this._getDebugDataStrFromUnit(e),this._sentOpps[e.sequenceId]=this._sentOpps[e.sequenceId]||{},this._sentOpps[e.sequenceId][e.lineItemId]=this._sentOpps[e.sequenceId][e.lineItemId]||[],this._sentOpps[e.sequenceId][e.lineItemId].push(i),this.debugTracker.info("OpportunityPixel","[tag-"+(+e.waterfallTagId+1)+"] Sending '"+i,{color:"#6ef936"}),n=e.lineItemStats,r=this.store.get("pstn")||1,a=e.vidDast||e.dast,o=(new Date).getTime()-e.created,d="".concat(this.store.get("ab_test")).concat(R(e)),h=e.vpaidWrapperData||(e.vpaidWrapper&&e.vpaidWrapper.tag?e.vpaidWrapper.tag.vpaidWrapperData:void 0),t={st:(l=e.rollType,u=(c={"pre-roll":u=0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2}).hasOwnProperty(l)?c[l]:u),rs:e.sequenceId,os:+e.waterfallTagId+1,tms:Date.now(),d:o,rst:i,dast:a,pstn:r,dp:H(e.dp),mob:M(this.store.get("isMobile")),vstt:M(!document.hidden),unv:this.store.get("unit_version"),unt:H(this.store.get("unit_type")),abt:d,frd:this.store.get("fdScore"),agl:this.store.get("preset.level"),rp:h&&h.vastPrice,mty:h&&h.mediatype,fv_t:n&&n.tries,fv_c:n&&n.conversions,fv_f:n&&n.fails,fv_fr:n&&n.failsRow,awr:this.store.get("performance.dtsvrRoundTripAverageDuration"),pm:this.store.get("performance.performanceMeasurment"),dbg:s,su:this.store.get("subUnitType"),pdast:t,extpvid:window.TRCImpl&&window.TRCImpl.external_page_view},this.store.get("modifiedPlacement")&&(v.mp=this.store.get("modifiedPlacement")),this._addExtraParams(v,t),this._addCmTagParams(t),this._addDelayedParams(t,e),this._addExternalPlayerPriceParam(t,e),function(e){for(var t in e)void 0===e[t]&&delete e[t]}(t),e=this._isBillableEvent(i),this.oppsAggregator&&!e?(this._reportOppToKibana(t,i,v.vidCurrentTime),this.oppsAggregator.send(t)):(e=(e||!this.store.get("non_bllb_opps_base_path")?this.store.get("opps_base_path"):this.store.get("non_bllb_opps_base_path"))||creativeConfig.CM_DOMAIN,this.url="".concat(U(e)).concat(/.*\/$/g.test(e)?"":"/","OpportunityServlet?rst=").concat(i),this.postHeaders=this.store.get("psthdrs")||"application/json",f(this.url,G([t]),function(e,t){p.oppFireSuccess(e,t,i)},function(e,t){p.oppFireFailure(e,t,i)},void 0,!1,!1,5e3,this.postHeaders,!1))))}},{key:"_getDebugDataStrFromUnit",value:function(e){if(e.setDebugDataFunc)return e.setDebugDataFunc();var t=this.store.get("debugDataFunc");return t?t():e.vpaidWrapperData&&e.vpaidWrapperData.debugData?e.vpaidWrapperData.debugData:this.store.get("debugStr")||void 0}},{key:"_addCmTagParams",value:function(e){var t=this.store.get("oppsQS")||{};Object.assign(e,t)}},{key:"_addDelayedParams",value:function(e,t){t=this._delayedParams(t)||{};Object.assign(e,t)}},{key:"_addExternalPlayerPriceParam",value:function(e,t){t.externalPlayerItem&&t.externalPlayerCpm&&(e.cisbp=se(t.externalPlayerCpm))}},{key:"_addExtraParams",value:function(e,t){for(var i in e)"vidCurrentTime"!==i&&(t[i]=e[i])}},{key:"oppFireSuccess",value:function(e,t,i){"0"!==e&&Q(this.vpaidLog,"billableEventsTracking",{opp:i,type:"serverError",xhrErrors:t},!1,!1)}},{key:"oppFireFailure",value:function(e,t,i){Q(this.vpaidLog,"billableEventsTracking",{opp:i,type:"sendingError",url:t,error:e},!1,!1)}},{key:"_reportOppToKibana",value:function(e,t,i){var s={rstStr:function(e,t){for(var i in e)if(e[i]===t)return i;return""}(l.a,t)};i&&this._isQuartileOpportunity(t)&&(s.vidCurrentTime=i),Q(this.vpaidLog,"Opps",Object.assign({},e,s))}},{key:"_isQuartileOpportunity",value:function(e){return 21<=e&&e<=25}},{key:"_flattenParams",value:function(e){return e.map(function(e){return e.key+"="+e.value})}},{key:"_delayedParams",value:function(e){return{"auc-dast":this.parameters.AUC_DAST,sts:this.parameters.STS,wp:this.parameters.WP,vpd:e.pubId||this.parameters.VPD,vptd:e.tagId||this.parameters.VPTD,vmt:(e.isRon?1:0)||this.parameters.VMT||0,pv:this.store.get("player_version")||999,pt:H(this.store.get("ab_test")||999),w:X(this.store.get("width")).toString(),h:X(this.store.get("height")).toString(),rv:e.requiredViewability}}},{key:"destroy",value:function(){this.debugTracker=void 0,this.store=void 0,this.oppsAggregator=void 0,this.billableEvents=void 0}},{key:"pause",value:function(){this._isPaused=!0}},{key:"unpause",value:function(){this._isPaused=!1}},{key:"_isBillableEvent",value:function(e){return-1<this.billableEvents.indexOf(""+e)}},{key:"isRegisterAvailable",value:function(e,t,i){this.isOppsulaRegisterAPI&&(i?this.oppsAggregator.registerCallback(e,t):this.oppsAggregator.unRegisterCallback(e,t))}}])&&wi(e.prototype,t),i&&wi(e,i),s}(),ki=s(10),Ti=s.n(ki);function Ci(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ei=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.trackingPixels=Object.assign({},ki),this.pixelDataLoaded=!1,this.events=[],this.done=[],this.store=e,this.vpaidEvents=we.a,this.state="",this.clickThruUrl="",this._isPaused=!1,this.buildPixelsRestrictions(),this._isPaused=!1,this.replacePixelMacros=this.store.get("rplcpxlmcrplchldr"),this.fireMultiplePixels=this.store.get("frmltplpxls")||[]}var e,i,s;return e=t,(i=[{key:"getState",value:function(){return this.state}},{key:"buildPixelsRestrictions",value:function(){this.pixelsRestrictions={},this.pixelsRestrictions.baseState=this.vpaidEvents.AdVideoThirdQuartile,this.pixelsRestrictions[this.vpaidEvents.AdVideoComplete]=this.vpaidEvents.AdVideoThirdQuartile}},{key:"loadPixelData",value:function(e){this.pixelDataLoaded,this.pixelDataLoaded=!0,this.trackingPixels=e}},{key:"getClickThruUrl",value:function(){if(!this.clickThruUrl)for(var e=["adclickthrough","clickthrough","adclickthru","clickthru"],t=0;t<e.length;t++){var i=e[t];if(this.trackingPixels&&this.trackingPixels.hasOwnProperty(i)&&0<this.trackingPixels[i].length){this.clickThruUrl=this.trackingPixels[i][0].pixel;break}}return this.clickThruUrl}},{key:"firePixel",value:function(e,t,i){if(this._isPaused)return!1;if(!this.isValid(e,i))return!1;for(var s=this.getPixels(e,i),n=0;n<s.length;n++)this._sendPixel(s[n].pixel,s[n].method,e,t,i);return this.events.push(e),""===this.state&&e===this.pixelsRestrictions.baseState&&(this.state=this.pixelsRestrictions.baseState),!0}},{key:"_cleanPixelType",value:function(e){return e.toLowerCase().replace(/^advideo|^aduser|^ad/gi,"")}},{key:"_getAllLinkedPixelTypes",value:function(e){var t,i=[];return"clickthrough"===(e=this._cleanPixelType(e))||"clickthru"===e?i.push("adclicktracking","clicktracking"):("start"===e&&i.push("creativeview"),t="ed",e.match(new RegExp("".concat(t,"$")))&&this._pushLinkedPixelTypesEdEnding(e,i),this._pushLinkedPixelTypes(e,i)),i}},{key:"_pushLinkedPixelTypes",value:function(e,t){t.push(e,"aduser".concat(e),"advideo".concat(e),"ad".concat(e))}},{key:"_pushLinkedPixelTypesEdEnding",value:function(e,t){for(var i=e.charAt(e.length-3)===e.charAt(e.length-4)?3:2,s=0;s<i;s++)e=e.slice(0,-1),this._pushLinkedPixelTypes(e,t)}},{key:"getPixels",value:function(e,t){var i=[];if("progress"!==e.toLowerCase())for(var s=this._getAllLinkedPixelTypes(e),n=0;n<s.length;n++)this.trackingPixels&&this.trackingPixels.hasOwnProperty(s[n])&&(i=i.concat(this._checkConcatPixels(this.trackingPixels[s[n]])));else t&&t.hasOwnProperty("eventData")&&t.eventData.hasOwnProperty("pixel")&&t.eventData.pixel&&(i=i.concat(t.eventData));return i}},{key:"_removePixel",value:function(e,t){for(var i,s=this._getAllLinkedPixelTypes(e),n=0;n<s.length;n++)!this.trackingPixels.hasOwnProperty(s[n])||-1<(i=this.trackingPixels[s[n]].indexOf(t))&&this.trackingPixels[s[n]].splice(i,1)}},{key:"isValid",value:function(e,t){return!this.pixelsRestrictions.hasOwnProperty(e)||(!(e!==this.vpaidEvents.AdVideoComplete||!t||!0!==t.newCompletion)||this.pixelsRestrictions[e]===this.state&&(this.state=e,!0))}},{key:"destroy",value:function(){this.trackingPixels=this.done=this.events=this.vpaidEvents=this.pixelsRestrictions=this.state=this.clickThruUrl=void 0}},{key:"_checkConcatPixels",value:function(e){return e&&e.length?e:[]}},{key:"_sendPixel",value:function(e,t,i,s,n){if("about:blank"!==e){s&&s.data;if(-1===this.done.indexOf(e)){var r=s&&s.tag?s.tag.advId:null;-1===this.fireMultiplePixels.indexOf(i)&&this.done.push(e);try{return e=this._replaceMacros(e,n),r&&(s.tag.getValueByKey("pxlnotsmtp")||(e+=(-1<e.search(/\?/)?"&":"?")+(new Date).getTime())),"img"===t?(new Image).src=e:"js"===t&&this._sendJSPixel(e),!0}catch(e){return!1}}}}},{key:"_sendJSPixel",value:function(e){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.async=!0,document.body.appendChild(t)}},{key:"_replaceMacros",value:function(e,t){return e=ee(e,this.store,t),e=this._replaceCachebustingMacro(e),this.replacePixelMacros&&(e=this._replaceErrorMacro(e,t),e=this._replaceTimestampMacro(e),e=this._replaceVideoMacro(e,t),e=this._replaceVideoCurrentTimeMacro(e,t)),e}},{key:"_replaceCachebustingMacro",value:function(e){var t=Date.now().toString().substring(5);return e.replace("[CACHEBUSTING]",t)}},{key:"_replaceVideoMacro",value:function(e,t){return-1<e.indexOf("[ASSETURI]")?t&&t.dispatcher&&t.dispatcher.getVideoUrl?e.replace("[ASSETURI]",t.dispatcher.getVideoUrl()):e.replace("[ASSETURI]",""):e}},{key:"_replaceTimestampMacro",value:function(e){return-1<e.indexOf("[TIMESTAMP]")?e.replace("[TIMESTAMP]",(new Date).toISOString()):e}},{key:"_replaceVideoCurrentTimeMacro",value:function(t,e){if(-1<t.indexOf("[CONTENTPLAYHEAD]"))try{if(e&&e.dispatcher&&e.dispatcher.video){var i=e.dispatcher.video.currentTime,s=10<=(s=Math.floor(i/60))?s:"0"+s,n=10<=(n=Math.floor(i%60))?n:"0"+n,r=i.toFixed(3).split(".")[1];return t.replace("[CONTENTPLAYHEAD]","00:".concat(s,":").concat(n,".").concat(r))}}catch(e){return t.replace("[CONTENTPLAYHEAD]","")}return t}},{key:"_replaceErrorMacro",value:function(e,t){return-1===e.indexOf("[ERRORCODE]")?e:e.replace("[ERRORCODE]",ne(t))}},{key:"pause",value:function(){this._isPaused=!0}},{key:"extractWinningPrice",value:function(e,t){var i,s=this.getPixels(this.vpaidEvents.AdImpression),n=void 0;if(0<s.length)for(var r=new RegExp("".concat(e,"=(.*?)(&|$)"),"gi"),a=0;a<s.length;a++){var o=r.exec(s[a].pixel);o&&(1<o.length&&o[1]&&(i=o[1],i=parseFloat(i),!isNaN(i))?n={found:!0,price:o[1]}:(n=n||{found:!1},t&&this._removePixel(this.vpaidEvents.AdImpression,s[a].pixel)))}return n}}])&&Ci(e.prototype,i),s&&Ci(e,s),t}(),Pi=[".rtbauction.com","video.leadzu.com"];function Vi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Si=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._startTime=0,this._stopTime=0,this._now=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}var t,i,s;return t=e,(i=[{key:"now",value:function(){return parseInt(this._now())}},{key:"start",value:function(){this._startTime=this.now()}},{key:"stop",value:function(){this._stopTime=this.now()}},{key:"reset",value:function(){this._stopTime=this._startTime=0}},{key:"duration",value:function(){return this._startTime&&this._stopTime?this._stopTime-this._startTime:""}}])&&Vi(t.prototype,i),s&&Vi(t,s),e}();function Di(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ii=s(6);window.vpaidId=Date.now()+"-"+parseInt(1e4*Math.random());var xi=0,Oi=0,Mi=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Ii.mixin(this),this.store=t,this.startTime=(new Date).getTime(),this.trackingPixels=Ti()(),this._addExternalEventTrackers(e),this.preferdVpaid=this.store.get("pvpd")||"javascript",this.tag=e.tag,this.preferdVpaid=this.tag.getValueByKey("pvpd")||this.preferdVpaid,this.pvidtp=this.tag.getValueByKey("pvidtp"),this.vpaidLog=e.vpaidLog,this.stopped=!1,this.destroyed=!1,this.debugTracker=new d("VastParser"),this.width=parseInt(e.width||this.store.get("width")),this.height=parseInt(e.height||this.store.get("height")),this.bitrate=parseInt(e.bitrate),this.redirCount=0,this.isMobile=this.store.get("isMobile"),this.secureWrapperUrls=ie(t),this.fileTypes=["flv","wmv","mp4","webm","ogg","mov"],this.vastUrls=[],this.wrappersCount=0,this.addWrappersToPlayerDAST=this.store.get("adwrprstoplrdst"),this.creativeExtensions=[],this.omidElements=[],this.index=++xi,this.isReportWrappersOpenTime=this.store.get("rprtwrpropntime"),this.jsTrackers=e.tag.jsTrackers}var e,t,s;return e=i,(t=[{key:"_addExternalEventTrackers",value:function(e){var t=this;this._addEventPixel("adimpression",e.internalPixel,void 0,void 0);for(var i=0;i<e.tag.conversionPixels.length;i++)this._addEventPixel("adimpression",e.tag.conversionPixels[i],void 0,void 0);for(s in e.tag.eventTrackers)(e.tag.eventTrackers[s]||[]).forEach(function(e){t._addEventPixel(s,e.url,void 0,void 0,e.type)});var s,n=this.store.get("expxls")||{};for(s in n)this._addEventPixel(s,n[s],void 0,void 0)}},{key:"_fetch",value:function(s,n,t,r){var a=this,e=cmTag.$||e;e.ajax({url:s,beforeSend:function(e){t&&(e.withCredentials=!0)},timeout:1e4,complete:function(e,t,i){e.responseText&&n(null,e.responseText)},error:function(e,t,i){if(r)return n(t);a._fetch(s,n,!1,!0)}})}},{key:"parseVastFromUrl",value:function(e){if(e=e&&e.replace(/\s/g,""),e=this._replaceMacros(e),Q(this.vpaidLog,"parseVastFromUrl",{url:e},!1,!1),this.vastUrls.push(e),this.store.get("vstprxy"))return this._fetchVastByProxy(e);this._fetchVastXhr(e)}},{key:"_fetchVastByProxy",value:function(e){var t=this.store.get("pxyurl");this._fetchVastXhr(t+e)}},{key:"_fetchVastXhr",value:function(e){var t=this;f(e,"",this._onTagResponse.bind(this),function(){t._onTagResponseError("vastxhrerror_noflash",e)})}},{key:"parseVastFromString",value:function(e){Q(this.vpaidLog,"parseVastFromString",{xml:e},!1,!1),this._onTagResponse(e)}},{key:"stop",value:function(){this.stopped=!0,this.vpaidLog=null,this.debugTracker=this.trackingPixels=void 0}},{key:"_extractDuration",value:function(e){var t=this._extractTag("duration",e),e=30;return e=t&&t.length&&t[0].textContent?parseInt(t[0].textContent.replace("00:00:","")):e}},{key:"_extractMediaFile",value:function(e,t,i){if(!this.stopped){for(var s=!1,n=!1,r=this._getFilesTemplate(),a={},o=[],d=0;d<e.length;d++){var h=this._getMediaFileType(e[d]);if(h&&h.url){if(function(t,e){var e=e.get("dsm")||{},e=Pi.concat(e.bl||[]),i=!1;return e.map(function(e){-1!==e.indexOf(t)&&(i=!0)}),i}(h.url,this.store)){Q(this.vpaidLog,"badMediaFile",{url:h.url});continue}o.push(h.url)}switch(h.type){case"vpaid":"javascript"==h.subType&&(s&&"javascript"!=s?n=!0:s="javascript",a.javascript=1,r.vpaid.javascript.push(h));break;case"video":s&&"video"!=s?n=!0:s="video",a.video=1,r.videoFiles[h.subType].push(h);break;default:n=!0,r.mixed.push(h)}}var l={flag:n,vpaid:1===a.javascript,video:1===a.video,mixed:0<r.mixed.length};n&&(this.mixedFilesFlag=l.vpaid&&l.video),"video"===(s=n&&this.preferdVpaid&&a.hasOwnProperty(this.preferdVpaid)?this.preferdVpaid:s)&&(r=this.onVideoWrapperMode(r)),o.length&&Q(this.vpaidLog,"vastMediaFiles",{urls:o},!1,!1),this.storedMediaFiles=r,this.publishParseTagResults(s,r,t,i)}}},{key:"onVideoWrapperMode",value:function(e){for(var t=null,i=0;i<this.fileTypes.length;i++){var s=e.videoFiles[this.fileTypes[i]];t||0<s.length&&s[0].url&&(t=s[0]);s=this._chooseBestVideoFile(s,this.bitrate,this.width,this.height);s&&s.url&&e.video.push(s)}return 0===e.video.length&&null!==t&&e.video.push(t),this._sortVideos(e.video),e}},{key:"_sortVideos",value:function(e){var i=this;e.length&&this.pvidtp&&(e=e.sort(function(e,t){return-1!=e.url.indexOf(i.pvidtp)?-1:-1!=t.url.indexOf(i.pvidtp)?1:0}))}},{key:"publishParseTagResults",value:function(e,t,i,s){if(!this.stopped){var n=!1;switch(e){case"javascript":0<t.vpaid.javascript.length&&(n=!0);break;case"video":0<t.video.length&&(n=!0)}n?this._onWrapperFound(e,t,i):(this._onVastError("NoMediaFileAfterSort",s,l.a.mediaFileNotSupported),Q(this.vpaidLog,"noMediaFileAfterSort",{}))}}},{key:"_onWrapperFound",value:function(e,t,i){Q(this.vpaidLog,"vpiadWrapperFound",{wrapperMode:e},!1,!1);i={adParams:i,vpaidFiles:t,extra:{duration:this.duration},trackingPixels:this.trackingPixels},t={price:this.price,icons:this.icons,analysis:this.analysis,creativeExtensions:this.creativeExtensions,omidElements:this.omidElements};this.emit(ni.a.VastData,{type:e,handlerOptions:i,vastOptions:t})}},{key:"_chooseBestVideoFile",value:function(e,t,i,s){var n=this;if(this.stopped)return!1;var r=!1,a=this.store.get("isMobile");a&&this.tag.isDirectDemand&&this.store.get("mblmdiadrctdmnd")&&(0<(d=e.filter(function(e){return-1<e.url.indexOf("MOBILE")})).length&&(e=d));var o=this.width>=this.height?"width":"height",d=e.filter(function(e){return e[o]>=n[o]});0<d.length&&(e=d);for(var h=s/i,l=99999999,u=0;u<e.length;u++)e[u].ratioFactor=Math.abs(h-e[u].ratio),e[u].sizeFactor=Math.abs(i-e[u].width)+Math.abs(s-e[u].height),e[u].rateFactor=Math.abs(t-e[u].bitrate),e[u].weight=0,a&&(e[u].rateFactor*=-1,this._isRtmp(e[u].url)&&(e[u].weight=1e6)),e[u].score=100*e[u].ratioFactor+ +e[u].sizeFactor+e[u].rateFactor+e[u].weight,l>e[u].score&&(l=e[u].score,r=e[u]);return r}},{key:"_isRtmp",value:function(e){return 0===e.indexOf("rtmp://")}},{key:"_getFilesTemplate",value:function(){for(var e={video:[],videoFiles:{},vpaid:{flash:[],javascript:[]},mixed:[]},t=0;t<this.fileTypes.length;t++)e.videoFiles[this.fileTypes[t]]=[];return e}},{key:"_getMediaFileType",value:function(e){if(this.stopped)return{};var t={};t.url=e.textContent,t.url&&(t.url=t.url.trim());var i=parseInt(e.getAttribute("bitrate"));t.bitrate=i||0;i=parseInt(e.getAttribute("width"));t.width=i||0;i=parseInt(e.getAttribute("height"));switch(t.height=i||0,t.originalType=e.getAttribute("type"),t.originalType){case"video/x-flv":t.type="video",t.subType="flv";break;case"video/x-ms-wmv":t.type="video",t.subType="wmv";break;case"video/mp4":t.type="video",t.subType="mp4";break;case"video/webm":t.type="video",t.subType="webm";break;case"video/ogg":t.type="video",t.subType="ogg";break;case"video/quicktime":this.store.get("wurfl.browser.name").indexOf("Safari")<0?(t.originalType="video/mp4",t.type="video",t.subType="mp4"):(t.type="video",t.subType="mov");break;case"application/javascript":case"application/x-javascript":case"text/javascript":t.type="vpaid",t.subType="javascript";break;case"application/x-shockwave-flash":t.type="vpaid",t.subType="flash";break;default:Q(this.vpaidLog,"unknownMediaFileType",{type:t.originalType}),t.type="unknown",t.subType="unknown"}return t.width&&t.height?t.ratio=t.height/t.width:t.ratio="1:1",t}},{key:"_extractTrackingEvents",value:function(e){if(!this.stopped){this._checkForSpecificEvent("impression",e),this._checkForSpecificEvent("error",e),this._checkForSpecificEvent("clickthru",e),this._checkForSpecificEvent("clickthrough",e),this._checkForSpecificEvent("clicktracking",e);e=this._extractTag("trackingevents",e);if(0<e.length)for(var t=this._extractTag("tracking",e[0]),i=0;i<t.length;i++){var s,n,r=t[i].getAttribute("event");r&&("progress"===r.toLowerCase()?((n=t[i].getAttribute("offset"))&&(s=-1===n.indexOf("%")?"time":"precentage"),this._addEventPixel(r.toLowerCase(),this._extractTagUrl(t[i]),n,s)):this._addEventPixel(r.toLowerCase(),this._extractTagUrl(t[i])))}}}},{key:"_extractTagUrl",value:function(e){if(!this.stopped){var t=this._extractTag("url",e);return(0<t.length?t[0]:e).textContent}}},{key:"_extractTag",value:function(e,t){if(!this.stopped){for(var i,s=t.childNodes,n=[],r=Array.isArray(e),a=0;a<s.length;a++)s[a].tagName&&(i=s[a].tagName.toLowerCase(),(r?-1<e.indexOf(i):i==e)?n.push(s[a]):n=n.concat(this._extractTag(e,s[a])));return n}}},{key:"_extractTagArttibute",value:function(e,t,i){if(!this.stopped){for(var s,n=t.childNodes,r=[],a=0;a<n.length;a++)n[a].tagName&&(n[a].tagName.toLowerCase()==e?(s=n[a].getAttribute(i),r.push(s)):r=r.concat(this._extractTagArttibute(e,n[a],i)));return r}}},{key:"_filterVastByRegex",value:function(e){var t=!0,i=this.tag.getValueByKey("rgxdcdd");if(i&&0!==i.length||(i=this.tag.getValueByKey("regx"),t=!1),!i)return!1;e=new RegExp(t?i.map(function(t){try{return atob(t)}catch(e){return t}}).join("|"):i,"i").exec(e);return!(!e||!e.length)}},{key:"_onTagResponse",value:function(e,t){if(!this.stopped){if(this.tagResponsesCounter=++Oi,this.debugTracker.info("Vast was loaded",{vast:e}),Q(this.vpaidLog,"tagResponse",{response:e,xhrErrors:t},!0,!1),this._filterVastByRegex(e))return Q(this.vpaidLog,"vastFilterdByRegex",{regex:this.tag.getValueByKey("regx")}),void this._onVastFilterdByRegexError("VastFilterdByRegex",e,l.a.filterVastByRegex);e=ee(e,this.store),this.emit(ni.a.VastFound,e);var i,s=this._parseXml(e);this.store.get("addcdatavst")&&s&&0<s.getElementsByTagName("parsererror").length&&(e=function(e){for(var t,i,s=/http/g,n="<![CDATA[";null!=(i=s.exec(e));)(t=e.substr(i.index-n.length,n.length))!==n&&">"===t[t.length-1]&&(i=(e=e.slice(0,i.index)+n+e.slice(i.index)).indexOf("</",i.index),e=e.slice(0,i)+"]]>"+e.slice(i));return e}(e),s=this._parseXml(e)),null==s||this._extractTag(["parsererror"],s).length?this._onVastError("ParsingError",e,l.a.vastError):(this.vastVersion=this._extractTagArttibute("vast",s,"version").shift()||"1.1",Q(this.vpaidLog,"vastVersion",{version:this.vastVersion},!1,!1),this.price=this._getPrice(s),this.icons||(this.icons=this._getIcons(s)),this.creativeExtensions=this.creativeExtensions.concat(this._getCreativeExtensions(s)),this.creativeExtensions=this.creativeExtensions.concat(this.jsTrackers),this.omidElements=this.omidElements.concat(this._getOmidElements(s)),this.duration=this._extractDuration(s),(t=this._extractTag("mediafiles",s))&&1==t.length&&t[0].childNodes.length?0==(i=this._extractTag("mediafile",t[0])).length?(this.debugTracker.error("Vast","No media files!"),this._reportWrappersData(!1),this._onVastError("ParsingError",e,l.a.vastError,"noMediaFile")):(this._extractMediaFileAnalysisToPlayerDAST(s),this._extractTrackingEvents(s),this._extractMediaFile(i,this._getAdParameters(s),e),this._reportWrappersData(!0)):1==(i=this._extractTag("wrapper",s)).length?(1===this.tagResponsesCounter&&this.isReportWrappersOpenTime&&(this.stopper=new Si,this.stopper.start()),this._extractTrackingEvents(s),this._onWrapper(i[0],e,s)):(this._reportWrappersData(!1),this._onVastError("NoMediaFiles",e,l.a.emptyVast,"noMediaFilesAndWrapper")))}}},{key:"_reportWrappersData",value:function(e){0<this.wrappersCount&&this.isReportWrappersOpenTime&&this.stopper&&(this.stopper.stop(),this.debugTracker.info("VastParser.js -> vpaidWrapper#".concat(this.index," -> _onTagResponse() -> ").concat(e?"extracting media":"error"," after ").concat(this.wrappersCount," wrappers, process took:").concat(this.stopper.duration(),"ms")),this.emit(ni.a.WrappersData,{debugData:"now:".concat(this.wrappersCount,"!wot:").concat(this.stopper.duration(),"!scs:").concat(e,"!")}))}},{key:"_extractMediaFileAnalysisToPlayerDAST",value:function(e,t){this.analysis={vr:this.vastVersion};var i=this._extractTag("ad",e).shift();i&&(this.analysis.aid=this._extractAttributeFromTag(i,"id"));i=this._extractTag("adsystem",e).shift();i&&(this.analysis.as=this._extractTextFromTag(i),Q(this.vpaidLog,"adSystem",{system:this.analysis.as},!1,!1));e=this._extractTag("adtitle",e).shift();e&&(this.analysis.at=this._extractTextFromTag(e)),t&&(this.analysis.wu=t)}},{key:"_extractAttributeFromTag",value:function(e,t){return e.getAttribute(t)||""}},{key:"_extractTextFromTag",value:function(e){return e.textContent||""}},{key:"_getPrice",value:function(t){var e=this._extractTag(["price","pricing"],t).shift(),t=0;if(e){e=e.textContent;try{isNaN(Number(e))&&-1!=e.indexOf("DATA")&&(t=e.replace(/[^0-9.]/g,"")),t=(t=Number(e)).toFixed(3),t=Number(t)}catch(e){t=0}}return t}},{key:"_decodeType",value:function(e){var t,i=e.attributes,s={};for(t in i)i[t].value&&(s[i[t].name]=i[t].value.toLowerCase());return s}},{key:"_getCreativeExtensions",value:function(e){for(var t=[],i=this._extractTag(["creativeextension"],e),s=0;s<i.length;s++){var n={};n.element=i[s].textContent.trim(),n.attributes=this._decodeType(i[s]),t.push(n)}return t}},{key:"_getOmidElements",value:function(e){for(var t=[],i=this._extractTag(["javascriptresource"],e),s=0;s<i.length;s++){var n=i[s].attributes.getNamedItem("apiFramework");n&&"omid"==n.value&&t.push(i[s])}return t}},{key:"_getIcons",value:function(e){for(var t=[],i=this._extractTag(["icon"],e),s=0;s<i.length;s++){var n={},r=this._isIconClicksExists(i[s]);r&&(n.clickThroughUrl=this._decodeIconData(i[s],"iconclickthrough").shift()),n.staticresource=this._decodeIconData(i[s],"staticresource").shift(),n.staticresource||(n.htmlresource=this._decodeIconData(i[s],"htmlresource").shift()),!n.htmlresource&&!n.staticresource||r&&!n.clickThroughUrl||(n.iconViewTracking=this._decodeIconData(i[s],"iconviewtracking"),n.clickTracking=this._decodeIconData(i[s],"iconclicktracking"),n.attributes=this._decodeIconAttributes(i[s]),t.push(n))}return t}},{key:"_isIconClicksExists",value:function(e){return!!this._extractTag(["iconclicks"],e).shift()}},{key:"_decodeIconAttributes",value:function(e){var t,i=e.attributes,s={};for(t in i)i[t].value&&(s[i[t].name]=i[t].value.toLowerCase()),"width"!==i[t].name&&"height"!==i[t].name||(s[i[t].name]+="px");return s}},{key:"_decodeIconData",value:function(e,t){try{return this._extractTag([t],e).map(function(e){return e.textContent.trim()})}catch(e){return this.debugTracker.warn("Vast","decode Icon ".concat(t),e),""}}},{key:"_onWrapper",value:function(e,t,i){if(!this.stopped){this.wrappersCount++;var s=this._extractTag("vastadtagurl",e);if(0==s.length&&0==(s=this._extractTag("vastadtaguri",e)).length)return this._onVastError("WrapperError",t,l.a.vastWrapperError,"EmptyWrapper");s=this._extractTagUrl(s[0]);if(!s)return this._onVastError("WrapperError",t,l.a.vastWrapperError,"NoUrl");0===(s=ee(s,this.store)).indexOf("http:")?de("absolute_vpaid_wrpper",{url:s}):0!==s.indexOf("//")||this.store.get("secured_protocol")||de("relative_vpaid_wrpper",{url:s}),this.secureWrapperUrls&&(s=s.replace("http:","https:")),0===this.redirCount&&Q(this.vpaidLog,"VastWrapper",{type:"wrapper"}),this.redirCount++,this.addWrappersToPlayerDAST&&this._extractMediaFileAnalysisToPlayerDAST(i,s),this.parseVastFromUrl(s)}}},{key:"_getAdParameters",value:function(e){if(!this.stopped){var t="",e=this._extractTag("adparameters",e);return t=0<e.length&&e[0].textContent?e[0].textContent:t}}},{key:"_checkForSpecificEvent",value:function(e,t){if(!this.stopped)for(var i=this._extractTag(e,t),s=0;s<i.length;s++)this._addEventPixel(e,this._extractTagUrl(i[s]))}},{key:"_addEventPixel",value:function(e,t,i,s){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"img";this.stopped||null!=this.trackingPixels[e]&&t&&(n=n.toLowerCase(),"progress"===e?i&&s&&this._addProgressPixel(t,i,s,n):this.trackingPixels[e].push({pixel:t,method:n}))}},{key:"_addProgressPixel",value:function(e,t,i,s){try{this.trackingPixels.progress.push({pixel:e,offset:"time"===i?function(e){var t=(e=e.split("."))[0].split(":"),i=0,s=1;for(2===e.length&&(i+=parseInt(e[1])/1e3);0<t.length;)i+=s*parseInt(t.pop(),10),s*=60;return i}(t):parseInt(t.replace("%",""))/100,offsetType:i,fired:!1,method:s})}catch(e){}}},{key:"_parseXml",value:function(e){if(this.stopped)return null;var t=null;if(window.DOMParser)try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){t=null}else if(window.ActiveXObject)try{(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e)||(t=null)}catch(e){t=null}return t}},{key:"_onTagResponseError",value:function(e,t){this.stopped||(this.debugTracker.error("Vast","Vast url was not loaded!aborting..."),this.emit(ni.a.NetworkFail,{type:e}))}},{key:"_onVastError",value:function(e,t,i,s){this.stopped||(this.debugTracker.error("VAST-ERROR",e),Q(this.vpaidLog,"vastParseError",{reason:s}),this.emit(ni.a.ParserError,{type:e,oppsId:i}))}},{key:"_onVastFilterdByRegexError",value:function(e,t,i){this.stopped||(this.debugTracker.error("VAST-ERROR",e),this.emit(ni.a.ParserError,{type:e,oppsId:i}))}},{key:"_sampleVastXml",value:function(e){this.stopped}},{key:"destroy",value:function(){this.stopped=!0,this.destroyed=!0,this.vpaidLog=null,this.vastUrls=null,this.tag=null,this.trackingPixels=this.debugTracker=this.fileTypes=void 0,this._onTagResponse=this._onTagResponseError=function(){},this.stopper=null}},{key:"_replaceMacros",value:function(e){return e=e.replace(/\[CACHEBUSTER\]/,Date.now())}},{key:"hasMixedFiles",value:function(){return!0===this.mixedFilesFlag}}])&&Di(e.prototype,t),s&&Di(e,s),i}();function Ri(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Fi=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.tag=e.tag,this.tagId=e.tagId,this.manager=e.manager,this.store=e.store,this.mainVpaid=e.mainVpaid,this.opportunityManager=e.opportunityManager,this.vpaidLog=e.vpaidLog,this.wflog=e.wflog,this.placement=e.placement,this.vpaidLog=this._createVpaidLog(),this.opportunityManager=this._createOpportunityManager(),this.pixelManager=new Ei(this.store),this.vastParser=this.tag.externexternalPlayerItem?null:this._createVastParser(),this.vpaidWrapper=this._createVpaidWrapper()}var e,i,s;return e=t,(i=[{key:"_createVpaidWrapper",value:function(){return new ci({tag:this.tag,creatives:this.mainVpaid.config.creatives,vpaidEvents:this.mainVpaid.vpaidEvents,config:this.mainVpaid.config,tagid:this.tagId,manager:this.manager,wfStats:this.tag.wfStats,mainVpaid:this.mainVpaid,store:this.store,wflog:this.wflog,vpaidLog:this.vpaidLog,opportunityManager:this.opportunityManager,pixelManager:this.pixelManager,vastParser:this.vastParser,placement:this.placement})}},{key:"_createVpaidLog",value:function(){var e,t={auctionId:this.tag.auctionId,advId:this.tag.advId,dast:this.tag.dast,price:this.tag.price,queueNumber:this.tag.queueNumber,cpmFloor:this.tag.cpmFloor,dp:this.tag.dp,rollType:this.tag.rollType,lineItem:this.tag.lineItem,unitType:this.store.get("unit_type"),unitVersion:this.store.get("unit_version"),isMobile:this.store.get("isMobile")||!1,rpox:this.tag.rpox,alfrox:this.tag.alfrox,frox:this.tag.frox,waterfallIndex:this.tag.wfIndex,itemType:this.tag.itemType,requiredViewability:this.tag.requiredViewability,requiredViewabilityDrawn:this.tag.requiredViewabilityDrawn,flad:this.tag.flad||this.tag.flad_delay||0,brand:this.tag.brand,priority:this.tag.priority,isCPCV:this.tag.isCPCV,backfillDelayed:!!this.tag.isBackfillDelayed,moatSampling:this.tag.moatSampling,getValueByKey:this.tag.getValueByKey};return this.tag.crId&&(e={stId:this.tag.stId,cmpgnId:this.tag.cmpgnId,itemType:this.tag.itemType},t=Object.assign(t,e)),new _i(t,this.store)}},{key:"_createOpportunityManager",value:function(){var e=this.mainVpaid.config.creatives;return new Ai({CM_DOMAIN:e.CM_DOMAIN,AUC_DAST:e.AUC_DAST,sequenceId:this.tag.sequenceId,ST:e.ST,STS:e.STS,SDID:e.SDID,PT:e.PT,PV:e.PV,WP:e.WP,VPD:e.PUBID,VPTD:e.TAGID,VMT:e.VMT},this.store,this.vpaidLog)}},{key:"_createVastParser",value:function(){var e=this.mainVpaid.config;return new Mi({vpaidLog:this.vpaidLog,width:e.width,height:e.height,bitrate:e.bitrate,internalPixel:this.tag.pixel,tag:this.tag},this.store)}}])&&Ri(e.prototype,i),s&&Ri(e,s),t}();function Li(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Bi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Wi={FUNCTION:"function",PROP:"prop",TAG:"tag",OBJECT:"object"},Ui=function(){function i(e){var t=this;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.interface={},this.vpaidWrapper=e,this.members=[{name:"dontDie",type:Wi.FUNCTION},{name:"restartAd",type:Wi.FUNCTION},{name:"emit",type:Wi.FUNCTION},{name:"getVpaidData",type:Wi.FUNCTION},{name:"setDebugData",type:Wi.FUNCTION},{name:"on",type:Wi.FUNCTION},{name:"off",type:Wi.FUNCTION},{name:"pauseAd",type:Wi.FUNCTION},{name:"resumeAd",type:Wi.FUNCTION},{name:"resizeAd",type:Wi.FUNCTION},{name:"mute",type:Wi.FUNCTION},{name:"unmute",type:Wi.FUNCTION},{name:"toggleIframeContentDisplay",type:Wi.FUNCTION},{name:"setDebugDataFunc",type:Wi.FUNCTION},{name:"skipAd",type:Wi.FUNCTION},{name:"nonVideoVpaid",type:Wi.PROP},{name:"isCPCV",type:Wi.PROP},{name:"adTarget",type:Wi.PROP},{name:"hadImpression",type:Wi.PROP},{name:"isBf",type:Wi.PROP},{name:"hasAdChoices",type:Wi.PROP},{name:"type",type:Wi.PROP},{name:"localTarget",type:Wi.PROP},{name:"pwov",type:Wi.PROP},{name:"clickThruUrl",type:Wi.PROP},{name:"adVolume",type:Wi.PROP},{name:"isReplayable",type:Wi.PROP},{name:"tag",type:Wi.TAG},{name:"playerDAST",type:Wi.OBJECT},{name:"vpaidLog",type:Wi.OBJECT}],this.memberConverter=(Li(e={},Wi.FUNCTION,this._convertFunction.bind(this)),Li(e,Wi.PROP,this._convertProp.bind(this)),Li(e,Wi.TAG,this._convertTag.bind(this)),Li(e,Wi.OBJECT,this._convertObject.bind(this)),e),this.vpaidWrapper.once("vpaidCleaned",function(){t._stop()}),this._appendMembersToInterface(),this.interface}var e,t,s;return e=i,(t=[{key:"_appendMembersToInterface",value:function(){var t=this;this.members.forEach(function(e){t.memberConverter[e.type](e.name)})}},{key:"_convertFunction",value:function(e){this.interface[e]=this.vpaidWrapper[e].bind(this.vpaidWrapper)}},{key:"_convertProp",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return t.vpaidWrapper[e]}})}},{key:"_convertTag",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return Object.assign(t.vpaidWrapper[e],t.vpaidWrapper[e].vpaidWrapperData)}})}},{key:"_convertObject",value:function(e){this.interface[e]=this.vpaidWrapper[e]}},{key:"_stop",value:function(){this.stopped=!0,this.vpaidWrapper=this.members=this.memberConverter=this.interface=void 0}}])&&Bi(e.prototype,t),s&&Bi(e,s),i}(),Hi=s(8);function ji(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ni=s(6),qi=s(9),zi=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ni.mixin(this),this.store=e,this.debugTracker=new d("PrebidHandler"),this.config={debug:this.store.get("isDebug"),usePrebidCache:this.store.get("prbdcch"),cache:{url:this.store.get("prbdcchul")}}}var e,i,s;return e=t,(i=[{key:"loadPrebidJs",value:function(){var t=this;this.prebidJs?this._emitOnLoad():(qi.init(this.store.data),qi.get("prebid",this.store.get("prbdjsv"),function(e){t.prebidJs=e,t._emitOnLoad()},function(){t.debugTracker.error("Prebid.js","Error while loading from service loader")}))}},{key:"_emitOnLoad",value:function(){this.emit("prebidLoaded")}},{key:"requestBids",value:function(e,t,i){var s=this._parsePrebidConfig(e);this._hasBid(s)?(e=s.adUnit.bids[0],s.adUnit.code=t.id,s.adUnit.params=e.params,this._logRequest(i,s),this._buildRequestUrl(e,s,i)):this.emit("noBids")}},{key:"_parsePrebidConfig",value:function(e){try{return JSON.parse(e)}catch(e){}}},{key:"_hasBid",value:function(e){return e&&e.adUnit&&e.adUnit.bids&&e.adUnit.bids[0]}},{key:"_logRequest",value:function(e,t){var i=t.adUnit&&t.adUnit.bids&&t.adUnit.bids[0];i&&Q(e,"prebidReq",{bidder:i.bidder,pubcid:i.crumbs&&i.crumbs.pubcid?i.crumbs.pubcid:void 0,placementId:i.params&&i.params.placementId?i.params.placementId:void 0,zoneId:i.params&&i.params.zoneId?i.params.zoneId:void 0,code:t.adUnit.code,video:t.adUnit.mediaTypes.video,sizes:t.adUnit.sizes})}},{key:"_buildRequestUrl",value:function(e,t,i){var s=this.prebidJs.getBuildRequestsMethod(e.bidder);if(!s)return Q(i,"buildRequestsMissing",{bidder:e.bidder}),void this.emit("noBids");e.code=t.adUnit.code,e.mediaTypes=t.adUnit.mediaTypes,e.sizes=t.adUnit.sizes,this._setGdprData(t);s=this._getRequest(s,e,t);if(!this._isValidRequest(s))return Q(i,"invalidPrebidRequest",s||{}),void this.emit("noBids");this.emit("receivedBids",{req:s,spec:this.prebidJs.getAdapterSpec(e.bidder),conf:t})}},{key:"_getRequest",value:function(e,t,i){i=e([t],i);return i=Array.isArray(i)?i[0]:i}},{key:"_isValidRequest",value:function(e){return e&&e.url}},{key:"interpretResponse",value:function(e,t,i){if(e){i=e.interpretResponse(t,{bidRequest:i.adUnit});if(i&&i[0])return i[0]}}},{key:"logInterpretedResponse",value:function(e,t){Q(e,"prebidPricing",{price:t.cpm,currency:t.currency,netRevenue:t.netRevenue})}},{key:"_setGdprData",value:function(e){var t=e.adUnit.gdprData;this._setGdpr(e,t),this._setCcpa(e,t.ccpa),this._setSupplyChain(e,t.sChainParams)}},{key:"_setGdpr",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e.gdprConsent={gdprApplies:t.gdprApplies||!1,consentString:t.consentStr||""}}},{key:"_setCcpa",value:function(e,t){e.uspConsent=t||"1YYY"}},{key:"_setSupplyChain",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e.schain={config:{ver:"1.0",nodes:[{asi:"taboola.com",sid:t.sid||"",rid:t.rid||"",hp:1}]}}}}])&&ji(e.prototype,i),s&&ji(e,s),t}();function Gi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Qi=s(9),Ki=function(){function s(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.mainVpaid=e,this.store=t,this.time=(new Date).getTime(),this.sequenceId=((new Date).getTime()+"").substring(3,11),this.loops=0,this.stopped=!1,this.started=!1,this.schedule=[],this.timedTimeout=0,this.waterfall={},this.adSlots=1,this.filledSlots=0,this.adIsPlaying=!1,this.debugTracker=new d("Manager"),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.supportExternalPlayers=this.store.get("sprtxtrnlplyrs"),this.prebidJsEnabled=this.store.get("prbdjse"),this.droppableTypes=this.store.get("drpbletps")||[],this.shouldFireGetAdPixels=I(this.store.get("frgtadpxls")),this.store.set("isFirstImpression",!0),this.oppsID=l.a,this.queueSize=this.store.get("queue_size")||10,this.isVforce=t.get("vForce"),this.store.on("stop",this.stop.bind(this)),this.store.on(_e.outer.EmitQueueStatus,this._emitQueueStatus.bind(this,"queueStatus")),this.queueStatus=new fe(this.store),this.supportNonVideoVpaid&&(this.nonVideoItem=null,this.store.on(_e.inner.NonVideoItemInWaterfall,this._onNonVideoItemInWaterfall.bind(this))),this.store.get("debug")&&setInterval(function(){i._postMessageSchedule()},1e3),this.dontTrimMp4=this.store.get("novdtrm"),this.maxBackfillDelayItems=this.store.get("mxbckflldlyitms"),this.maxBackfillDelayItems&&(this.backfilldelayTime=this.store.get("bckflldlyms"),this.backfillPriority=this.store.get("bfprty")),this.continueGetAdFlow=this.store.get("cntgtad")}var e,t,i;return e=s,(t=[{key:"_postMessageSchedule",value:function(){if(window.cmPlayerDeubg){var e=this.schedule,t=this.store;try{window.cmPlayerDeubg({schedule:e,store:t})}catch(e){console.log(e)}}}},{key:"trigger",value:function(e,t,i){var s;this._handleAllEvents({type:e,dispatcher:t}),this.store.emit(e,t),!t.working&&e!==this.mainVpaid.vpaidEvents.AdImpression||(s={type:e,dispatcher:t},e===this.mainVpaid.vpaidEvents.AdImpression&&(s.tag=t.tag),s.vpaidReady=this.getVpaidReadyCount(),s.qsize=this.schedule.length,s.dp=t&&t.tag?t.tag.dp:"na",s.adImpMS=t?t.adImpInMS:0,s.readyInMS=t?t.readyInMS:0,s.loadToImpMS=t?t.adImpInMS-t.readyInMS:0,s.clickThru={url:i?i.url:"",playerHandles:i&&!1!==i.playerHandles},this.mainVpaid.trigger(e,s))}},{key:"getVpaidReadyCount",value:function(){var t=0;return this.schedule.map(function(e){e&&e.vpaidWrapper&&"ready"===e.vpaidWrapper.status&&t++}),t}},{key:"subscribeToVpaidWrapper",value:function(e){e.on("vpaidCleaned",this._onVpaidCleaned.bind(this,e)),this.stopped||e.subscribe(this._handleError.bind(this),this.mainVpaid.vpaidEvents.AdError)}},{key:"_handleAllEvents",value:function(e){var t=this;e.type!==this.mainVpaid.vpaidEvents.AdVideoStart&&e.type!==this.mainVpaid.vpaidEvents.AdImpression&&e.type!==this.mainVpaid.vpaidEvents.AdPlaying||!e.dispatcher.isPlaying||this.trigger("viewAdPlayer",e.dispatcher.tag),e.type===this.mainVpaid.vpaidEvents.AdLoaded&&this.shouldPlayWhenAvialable&&!this.store.get("evtbsschdl")&&(setTimeout(function(){t.playFromQueue(t.shouldPlayWhenAvialable)},2),e.dispatcher&&e.dispatcher.tag,this.shouldPlayWhenAvialable=!1),e.type===this.mainVpaid.vpaidEvents.AdImpression&&(e.dispatcher.options&&e.dispatcher.options.getAdContext?(e.dispatcher.gotAd=!0,this.debugTracker.info("gotAd",e.dispatcher,{color:"#5EB9FF"}),Q(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!1}),e.dispatcher.options.getAdContext.getAdCallback(new Ui(e.dispatcher))):e.dispatcher&&e.dispatcher.vpaidLog&&Q(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!0}))}},{key:"_runNextAd",value:function(){}},{key:"_handleError",value:function(e){e=e.dispatcher;this.adIsPlaying&&e&&e.isStarted&&!e.hadImpression&&!this.store.get("evtbsschdl")&&this.playFromQueue()}},{key:"initVpaidInQue",value:function(e){if(!this.stopped)for(var t,i=this.schedule,s={},n=0;n<i.length;n++)s=i[n],t="".concat(n,"-").concat(s.waterfallTagId),s.vpaidWrapper||(this.maxBackfillDelayItems&&s.priority===this.backfillPriority?s.backfillDelay=setTimeout(this._createVpaidWrapper.bind(this,s,t,e),this.backfilldelayTime):this._createVpaidWrapper(s,t,e))}},{key:"_createVpaidWrapper",value:function(e,t,i,s){this._setBackfillDelay(e),e.sequenceId=e.wfIndex;s=this._createQueueItem(e,t,i,s);e.vpaidWrapper=s.vpaidWrapper,this.subscribeToVpaidWrapper(e.vpaidWrapper)}},{key:"_setBackfillDelay",value:function(e){e.backfillDelay&&(e.backfillDelay=window.clearTimeout(e.backfillDelay),e.isBackfillDelayed=!0)}},{key:"_updateCostModel",value:function(e){var t=new be(this.store),i=e.getValueByKey("cstmdl");void 0===i&&(i=e.cstmdl),e.cstmdl=i,e.isCPCV=t.isCPCV(e.cstmdl)}},{key:"_createQueueItem",value:function(e,t,i,s){s={tag:e,tagId:t,manager:this,store:this.store,mainVpaid:this.mainVpaid,wflog:i,placement:s};return new Fi(s)}},{key:"_onVpaidCleaned",value:function(e){this.cleanQueue(self.queueSize),this.continueGetAdFlow&&e.options&&e.adStarted&&!e.hadImpression&&this.getAdFromQueue(e.options),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"unsubscribeFromVpaid",value:function(e){this.stopped||(e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdError),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdFound),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdStopped),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkipped),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdImpression),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkippableStateChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSizeChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLinearChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdDurationChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdExpandedChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVolumeChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoStart),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoFirstQuartile),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoMidpoint),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoThirdQuartile),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoComplete),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdClickThru),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdInteraction),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserAcceptInvitation),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserMinimize),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserClose),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPaused),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPlaying),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLog))}},{key:"_shouldDropAd",value:function(e,t){return-1<this.droppableTypes.indexOf(e)&&t.hasOwnProperty(e)&&t[e]}},{key:"cleanQueue",value:function(s,n){var r,a,o=this;this.schedule.map(function(e,t){var i,s;e&&e.vpaidWrapper&&!e.vpaidWrapper.working&&(i=!1,s=null,"error"===e.vpaidWrapper.status||"stopped"===e.vpaidWrapper.status?(i=!0,s="error"===e.vpaidWrapper.status?o.oppsID.vastError:o.oppsID.adError):n&&o._shouldDropAd(n,e)&&!e.vpaidWrapper.hadImpression&&(i=!0,s=o.oppsID.adDropped),i&&(o.queueStatus.onItemRemovedFromQueue(e),e.vpaidWrapper._status=e.vpaidWrapper.status,o.unsubscribeFromVpaid(o.schedule[t].vpaidWrapper),o.schedule[t].vpaidWrapper.stop("cleanExpierd",s),o.schedule[t]&&(o.schedule[t].vpaidWrapper=null),o.schedule[t]=void 0))}),this.schedule=this.schedule.filter(function(e){return e}),this.schedule=h.a.sort(this.schedule,this.store),this.schedule.length>s&&(this.mainVpaid.config.creatives,r=this.mainVpaid.config.creatives.ADTO||6e4,a=this.store.get("trmrdyvpaid"),this.schedule.map(function(e,t){var i;!o.schedule[t]||e.vpaidWrapper.working||!a&&"ready"===e.vpaidWrapper.status||(i=Date.now()-o.schedule[t].vpaidWrapper.created,e&&(t<o.schedule.length-s||r<i)&&(o.queueStatus.onItemRemovedFromQueue(e),o.unsubscribeFromVpaid(o.schedule[t].vpaidWrapper),o._canTrim(i=r<i?"queueExpired":"queueTrimmed",e)&&(o.schedule[t].vpaidWrapper.stop(i,o.oppsID[i]),o.schedule[t]=void 0)))})),this.schedule=this.schedule.filter(function(e){return e})}},{key:"_canTrim",value:function(e,t){return"queueTrimmed"!==e||!(t.vpaidWrapper&&"mp4"===t.vpaidWrapper.type&&this.dontTrimMp4)}},{key:"fillSchedule",value:function(e,t){this.schedule.length>this.queueSize&&this.cleanQueue(this.queueSize),this.started=!0,this.stopped=!1;var i={},s=0,n=this.mainVpaid.config.creatives;n.ADTO=1<parseInt(n.ADTO)?parseInt(n.ADTO):60,n.ADTO=n.ADTO<1e3?1e3*n.ADTO:n.ADTO,this.adSlots=parseInt(n.B2B)&&1<parseInt(n.B2B)?parseInt(n.B2B):1;for(var r=n.DEFAULTTAGTIMEOUT<1e3?1e3*n.DEFAULTTAGTIMEOUT:n.DEFAULTTAGTIMEOUT,s=0;s<e.tags.length;s++)this._shouldInsertToQueue(e.tags[s])?((i=e.tags[s]).active=!1,i.adFound=!1,i.offset=0,i.tagStart=0,i.tagTimeout=r,i.queueNumber=0,i.ADTO=n.ADTO,i.vpaidWrapper=!1,i.tagEnd=+i.tagStart+ +i.tagTimeout,i.wfStats=e.data,i.externalPlayerItem=this.store.get("xtrnlplyrstyps").includes(i.itemType),i.isPrebid=i.advType===Hi.PREBID,this._updateCostModel(i),this.store.get("frstlk")&&this._updateItemFirstLook(i),i.externalPlayerItem?this.supportExternalPlayers&&this._handleExternalPlayer(i,t):i.isPrebid?this.prebidJsEnabled&&this._loadPrebidJs(i,t):this.schedule.push(i)):t.push("tagResponse_".concat(s,"_backfillThrown"),!0);this._printQueue(this.schedule),this.mainVpaid.setVpaidId(i),this.time=(new Date).getTime(),this.initVpaidInQue(t),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_shouldInsertToQueue",value:function(e){return!this.maxBackfillDelayItems||e.priority!==this.backfillPriority||e.priority===this.backfillPriority&&this._getBackfillCount()<this.maxBackfillDelayItems}},{key:"_printQueue",value:function(e){e=e.map(function(e){return{dp:e.dp,lineItem:e.lineItem,alfrox:e.alfrox,waterfallIndex:e.wfIndex,status:e.vpaidWrapper?e.vpaidWrapper.status:"",videoUrl:e.vpaidWrapper&&e.vpaidWrapper.hadImpression?e.vpaidWrapper.getVideoUrl():""}});this.debugTracker.table(e)}},{key:"_updateItemFirstLook",value:function(e){e.flad&&(this.store.get("first_look_ad_loaded")?(e.flad_delay=e.flad,delete e.flad):this._startFladTimeout(e.flad))}},{key:"_handleExternalPlayer",value:function(t,i){var s=this;i.containsExternalPlayerItem=!0,this.externalPlayersManager?this.externalPlayersManager.initExternalPlayer(this._generateExternalPlayerSettings(t,i)):(Qi.init(this.store.data),Qi.get("external-players-manager",this.store.get("xtrnlplyrsmngrv"),function(e){s.externalPlayersManager=new e(s._generateExternalPlayersManagerSettings()),s.externalPlayersManager.on("pushItems",s._onPushItems.bind(s)),s.externalPlayersManager.initExternalPlayer(s._generateExternalPlayerSettings(t,i))},function(){s.debugTracker.error("External players manager","Error while loading from service loader")}))}},{key:"_generateExternalPlayersManagerSettings",value:function(){return{queueData:this._getExternalPlayersManagerQueueData(),vpaidEvents:we.a,aggregate:this.store.get("xtrnlplyrsmngragg"),pushItemsInterval:this.store.get("xtrnlplyrsmngrpshintrvl")}}},{key:"_getExternalPlayersManagerQueueData",value:function(){return{createQueueItemMethod:this._createQueueItem.bind(this),subscribeToVpaidWrapperMethod:this.subscribeToVpaidWrapper.bind(this)}}},{key:"_generateExternalPlayerSettings",value:function(e,t){return{item:e,wflog:t,store:this.store}}},{key:"_onPushItems",value:function(e){var t=this;e.forEach(function(e){t.schedule.push(e),e.vpaidWrapper.getHandlerOptions().onReady()}),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_startFladTimeout",value:function(e){this.store.set("first_look_ad_loaded",e),this.fladTimeout=setTimeout(this._onFladTimeout.bind(this),1e3*e)}},{key:"_onFladTimeout",value:function(){for(var e=null,t=0;t<this.schedule.length;t++)if((e=this.schedule[t]).flad_delay)return e.flad=e.flad_delay,delete e.flad_delay,void this._startFladTimeout(e.flad);this.store.set("first_look_ad_loaded",!1),this.store.emit("fladInactive")}},{key:"stop",value:function(){if(!this.stopped){this.stopped=!0,window.clearTimeout(this.timedTimeout);for(var e=0;e<this.schedule.length;e++)this.schedule[e].backfillDelay?window.clearTimeout(this.schedule[e].backfillDelay):this.schedule[e].vpaidWrapper.stop("playerClosed",this.oppsID.playerClosed);this._destroyExternalPlayersManager(),this.nonVideoItem=null}}},{key:"_destroyExternalPlayersManager",value:function(){this.externalPlayersManager&&this.externalPlayersManager.destroy()}},{key:"managerEnd",value:function(){}},{key:"playFromQueue",value:function(e){if(!this.store.get("isIdleMode")&&!this.stopped){var t=Date.now();this.store.set("playFromQueue",t);var i=this.getVpaidReadyCount();0!==i&&!e||this.store.get("vForce")||(this.shouldPlayWhenAvialable=!0),this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=h.a.sort(this.schedule,this.store));e=this.mainVpaid.config.creatives.ADTO||6e4;e+=1e4;for(var s=!1,n=this._getItemScores(),r=(this._getItemDps(),this.schedule.length-1);0<=r;r--){var a=this.schedule[r];a&&(this._setItemScores(a,r,n),"ready"!==a.vpaidWrapper.status||a.vpaidWrapper.working||a.vpaidWrapper.isStarted||s||this.store.get("first_look_ad_loaded")&&!a.flad||(this.store.set("playFromQueueFound",t),a.vpaidWrapper.workingVpaid=!0,this.store.set("ad_controls",!1!==a.getValueByKey("ad_controls")),a.vpaidWrapper.working=!0,a.vpaidWrapper.isPlaying=!0,s=this.adIsPlaying=!0,a.vpaidWrapper.startAd(),Q(a.vpaidWrapper.vpaidLog,"startFromQ",{score:a.score})))}this.store.get("run_wf_when_empty")&&0===i&&this.store.emit("playFromEmptyQueue")}}},{key:"bringVpaidToFront",value:function(){for(var e=this.schedule.length-1;0<=e;e--){var t=this.schedule[e];if(t&&t.vpaidWrapper.workingVpaid){t.vpaidWrapper.bringToFront();break}}}},{key:"_getItemScores",value:function(){for(var e=[],t=this.schedule.length-1;0<=t;t--){var i=this.schedule[t];i&&e.push(i.score)}return e}},{key:"_getItemDps",value:function(){for(var e=[],t=this.schedule.length-1;0<=t;t--){var i=this.schedule[t];i&&e.push(i.dp)}return e}},{key:"_setItemScores",value:function(e,t,i){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&e.vpaidWrapper.vpaidLog.data&&(e.vpaidWrapper.vpaidLog.data.itemScore=e.score,i&&Q(e.vpaidWrapper.vpaidLog,"itemScores",{index:t,scores:i},!1,!1))}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped){this.mainVpaid.config.creatives.PLAYER_WIDTH=this.mainVpaid.config.width=parseInt(e),this.mainVpaid.config.creatives.PLAYER_HEIGHT=this.mainVpaid.config.height=parseInt(t),this.mainVpaid.config.creatives.VIEW_MODE=this.mainVpaid.config.viewMode=i;for(var s=0;s<this.schedule.length;s++)this.schedule[s].vpaidWrapper&&!this.schedule[s].vpaidWrapper.stopped&&this.schedule[s].vpaidWrapper.callVpaidMethod("resizeAd",[e,t,i],0)}}},{key:"setAdVolume",value:function(e,t){if(!this.stopped){if(e=1<e?e/100:e,isNaN(parseFloat(e)))return!1;e=parseFloat(e),t||(this.mainVpaid.config.creatives.VOLUME=e),this.mainVpaid.config.creatives.MUTED=0==e;for(var i=0;i<this.schedule.length;i++)this.schedule[i].vpaidWrapper&&!this.schedule[i].vpaidWrapper.stopped&&this.schedule[i].vpaidWrapper.workingVpaid&&this.schedule[i].vpaidWrapper.setAdVolume(e)}}},{key:"callWorkingVpaid",value:function(e,t,i){if(!this.stopped)for(var s=0;s<this.schedule.length;s++){var n=this.schedule[s].vpaidWrapper;if(n&&n.workingVpaid)return n.callVpaidMethod(e,t,i)}}},{key:"getVpaidLogs",value:function(){for(var e=[],t=0;t<this.schedule.length;t++){var i=this.schedule[t];i&&i.vpaidWrapper&&i.vpaidWrapper.vpaidLog&&e.push(i.vpaidWrapper.vpaidLog)}return e}},{key:"getAd",value:function(i){var e=this;this.store.incr("getAdData.count");var s=this;this.debugTracker.info("getAd",i||"empty getAd",{color:"#5EB9FF"}),this.shouldFireGetAdPixels&&$(J(me.getAd,this.store));var t=new Promise(function(e,t){(i=i||{}).getAdContext={getAdCallback:e},i.getAdRetries=0,i.getAdContext.getAdTimeout=setTimeout(function(){i.getAdContext=void 0,t({name:"error",message:"couldn't find a suitable ad to play"})},1e3*(i.getAdTimeout||s.store.get("get_ad_timeout_seconds"))),s.getAdFromQueue(i)});return t.cancel=function(){e.cancelGetAd(i),e.debugTracker.info("getAd","getAd cancelled!",{color:"#5EB9FF"})},t}},{key:"cancelGetAd",value:function(e){this.store.decr("getAdData.count"),clearTimeout(e.getAdContext.getAdTimeout),e.getAdContext=void 0}},{key:"getAdFromQueue",value:function(e){if(!this.store.get("isIdleMode")&&!this.stopped&&(e=e||{},e&&e.getAdContext&&(!e.requiredViewability||!document.hidden))){this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=h.a.sort(this.schedule,this.store));for(var t=!1,i=this._getItemScores(),s=this.schedule.length-1;0<=s;s--){var n=this.schedule[s];if(this._updateStatusesOnGetAd(n,e),this._setItemScores(n,s,i),this.isViewabilityMatch(n,e)&&this.isAdPropertiesMatch(n,e.adProperties,e.excAdProperties)&&this._canPullItem(n)){this._pullItemFromQueue(n,e),t=!0;break}}this.store.get("run_wf_when_empty")&&0==this.getVpaidReadyCount()&&(this.store.emit("playFromEmptyQueue",e.forceWf),e.forceWf=!1),t||(this._canPullAdxCard(e)?this._pullAdxCard(e):this.nextAdFromQueue=setTimeout(this.getAdFromQueue.bind(this,e),1e3))}}},{key:"_canPullItem",value:function(e){return"ready"===e.vpaidWrapper.status&&!e.vpaidWrapper.working&&!e.vpaidWrapper.isStarted&&(!this.store.get("first_look_ad_loaded")||e.flad)}},{key:"_pullAdxCard",value:function(e){this.nonVideoItem.adx=!0,this._pullItemFromQueue(this.nonVideoItem,e)}},{key:"_canPullAdxCard",value:function(e){return e.requiredViewability&&this.nonVideoItem&&this.nonVideoItem.vpaidWrapper&&this._canPullItem(this.nonVideoItem)}},{key:"_pullItemFromQueue",value:function(e,t){e.vpaidWrapper.working=!0,e.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,e.vpaidWrapper.bringToFront(),"mp4"===e.vpaidWrapper.type&&e.vpaidWrapper.vpaidHandler.logVideoBuffer("StartFromQ"),e.vpaidWrapper.startAd(t),Q(e.vpaidWrapper.vpaidLog,"startFromQ",{score:e.score,adx:e.adx}),clearTimeout(t.getAdContext.getAdTimeout),t.getAdContext.getAdTimeout=void 0,t.getAdRetries++}},{key:"_updateStatusesOnGetAd",value:function(e,t){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&!e.vpaidWrapper.gotAd&&e.vpaidWrapper.updateStatusesOnGetAd(t)}},{key:"isViewabilityMatch",value:function(e,t){return!(!e||!e.vpaidWrapper)&&(void 0===t.requiredViewability||(t.requiredViewability?e.requiredViewability:!e.requiredViewability))}},{key:"isAdPropertiesMatch",value:function(e,t,i){return this._isAdPropertiesMatch(t,e,!0)&&this._isAdPropertiesMatch(i,e,!1)}},{key:"_isAdPropertiesMatch",value:function(e,t,i){if(e)for(var s in e){s=this._isPropertyMatch(s,e[s],t);if(s&&!i||!s&&i)return!1}return!0}},{key:"_isPropertyMatch",value:function(e,t,i){for(var s=0;s<t.length;s++)if(i[e]==t[s])return!0;return!1}},{key:"onStop",value:function(){}},{key:"isActivePausedAd",value:function(){for(var e=0;e<this.schedule.length;e++){var t=this.schedule[e];if(t&&t.vpaidWrapper&&t.vpaidWrapper.isPlaying&&!t.vpaidWrapper.isUnPaused)return!0}return!1}},{key:"isWorkingVpaidItem",value:function(t){var i=!1;return this.schedule.map(function(e){e&&e.vpaidWrapper&&e.vpaidWrapper==t&&e.vpaidWrapper.working&&(i=!0)}),i}},{key:"_saveCountersToStore",value:function(e,t,i){!t&&this.store&&i&&this.store.set(e,i)}},{key:"callAllWorkingVpaids",value:function(t){return this.schedule.map(function(e){if(e.vpaidWrapper&&!e.vpaidWrapper.stopped&&e.vpaidWrapper.workingVpaid)return t(e.vpaidWrapper)})}},{key:"mute",value:function(){this.callAllWorkingVpaids(function(e){return e.mute()})}},{key:"unmute",value:function(){this.callAllWorkingVpaids(function(e){return e.unmute()})}},{key:"play",value:function(){this.callAllWorkingVpaids(function(e){return e.resumeAd()})}},{key:"pause",value:function(){this.callAllWorkingVpaids(function(e){return e.pauseAd()})}},{key:"getCurrentWorkingVpaidVolume",value:function(){var t=null;return this.callAllWorkingVpaids(function(e){null===t&&(t=e.getCurrentVolume())}),t||0}},{key:"_emitQueueStatus",value:function(e){this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem,e)}},{key:"_getBackfillCount",value:function(){var t=this,i=0;return this.schedule.map(function(e){e&&e.priority===t.backfillPriority&&i++}),i}},{key:"_onNonVideoItemInWaterfall",value:function(e){this.stopped||this.nonVideoItem||(this.nonVideoItem=e.item,this.nonVideoItemWflog=e.wflog,this._createVpaidWrapper(this.nonVideoItem,"adx-".concat(this.nonVideoItem.waterfallTagId),this.nonVideoItemWflog))}},{key:"getPlayerDAST",value:function(){for(var e=this.callAllWorkingVpaids(function(e){return e.playerDAST.get()}),t=0;t<e.length;t++)if(e[t])return e[t];return""}},{key:"_loadPrebidJs",value:function(e,t){t=this._onPrebidJsLoaded.bind(this,e,t);this.prebidHandler||(this.prebidHandler=new zi(this.store)),this.prebidHandler.once("prebidLoaded",t),this.prebidHandler.loadPrebidJs()}},{key:"_onPrebidJsLoaded",value:function(e,t){e.prebidHandler=this.prebidHandler,this.schedule.push(e),this.initVpaidInQue(t)}}])&&Gi(e.prototype,t),i&&Gi(e,i),s}();function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ji=0,$i=1e4,Zi=function(){function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.index=Ji++,this.numberOfConnectedVpaids=0,this.dataChanged=!0,this.store=e,this.created=Date.now(),this.data={_id:W(10),player_id:this.store.get("player_id"),isMobile:this.store.get("isMobile"),created:(new Date).toISOString(),unitType:this.store.get("unit_type"),fullPageUrl:this.store.get("fullPageUrl"),updatesCount:0,taboolaVpaid:this.store.get("istblvpd")},this.sendDataInterval=setInterval(function(){t.dataChanged&&t._sendData()},$i)}var e,t,s;return e=i,(t=[{key:"push",value:function(e,t){this.data.hasOwnProperty(e)&&!this._hasValueChanged(this.data,e,t)||(this.dataChanged=!0),this.data[e]=t}},{key:"_hasValueChanged",value:function(e,t,i){if("object"!==Xi(i))return e[t]!==i;if(Array.isArray(i)){for(var s=0;s<i.length;s++)if(e[t].indexOf(i[s])<0)return!0;return!1}for(var n in i)if(this._hasValueChanged(this.data[t],n,i[n]))return!0;return!1}},{key:"get",value:function(e,t){return this.data.hasOwnProperty(e)?this.data[e]:t}},{key:"_sendData",value:function(){var e;this.data&&(this.data.updatesCount++,ae(e=Object.assign({},this.data),this.store.get("rmvwflg")),O("player_waterfall","WfLog",e,this.store),this.dataChanged=!1)}},{key:"sendDataOnConversion",value:function(){var e=this;setTimeout(function(){e._sendData()},2e3)}},{key:"increaseNumberOfConnectedVpaids",value:function(){this.numberOfConnectedVpaids++}},{key:"complete",value:function(){0==--this.numberOfConnectedVpaids&&(this._sendData(),this.data=this.store=void 0,this.sendDataInterval=clearInterval(this.sendDataInterval))}},{key:"setWfCounter",value:function(e){this.index=e,Ji=e+1}}])&&Yi(e.prototype,t),s&&Yi(e,s),i}();function es(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ts=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.id=Date.now()+"_"+W(20),this.index=t,this.store=e,this.vpaidsCount=0,this.reportedVpaidsCount=0,this.success=0,this.fails=0,this.isSuccessed=!1}var e,t,s;return e=i,(t=[{key:"increaseVpaidsCount",value:function(){this.vpaidsCount++}},{key:"increaseSuccess",value:function(){this.success++,this._update()}},{key:"increaseFailure",value:function(){this.fails++,this._update()}},{key:"_update",value:function(){this.reportedVpaidsCount++,this.isSuccessed||(1===this.success?(this.store.incr("waterfallSuccessesInARow"),this.store.set("waterfallFailsInARow",0),this.isSuccessed=!0):this.reportedVpaidsCount===this.vpaidsCount&&(this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0)))}},{key:"getData",value:function(){return{id:this.id,index:this.index,allVpaidsReported:this.vpaidsCount===this.reportedVpaidsCount,wf_sr:this.store.get("waterfallSuccessesInARow"),wf_fr:this.store.get("waterfallFailsInARow")}}}])&&es(e.prototype,t),s&&es(e,s),i}();function is(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ss(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ns=s(9),rs=(s(30),function(){function r(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.store=e;e=this.store.get("waterfallFailsInARow");this.store.set("waterfallFailsInARow",e||0),this.store.set("waterfallSuccessesInARow",0),this.encryptWaterfallResponse=this.store.get("encwfrs"),this.wfv=this.store.get("wfv"),this.requiredViewabilityFactor=this.store.get("rvfctr"),this.defaultTagPrice=this.store.get("dftgprc"),this.fireWaterfallErrorPixels=I(parseInt(this.store.get("frwferrpxls"))),this.fireMaxEmptyWaterfallPixel=I(parseInt(this.store.get("frmxemptwfpxl"))),this.fireEmptyWaterfallPassbackPixel=parseInt(this.store.get("frwfpssbckrpxl")),this.shouldFirePrebidSessionPixel=this.store.get("firpbidpxl"),this.updateCMPData=this.store.get("sndgdprprmswf")&&this.store.get("updtcmpbfrwf"),this.lastRun=this.store.get("ltuntwflstrn");var i=this.store.get("drpbletps")||[],s=this.store.get("adTypesToDrop")||[];this.adsToDrop={};for(var n=0;n<i.length;n++)this.adsToDrop[i[n]]=-1<s.indexOf(i[n]);this.creatives={},this.debugTracker=new d("WaterfallManager"),this.cachedTags=!1,this.cacheAge=0,this.staticWf=this.store.get("static_schedule"),this.shouldRun=function(){return!t._tbWfResponseExists()},this._runBindedWaterfallTicker=this._runWaterfallTicker.bind(this),this._roundTripAverageDuration=0,this._roundTripsCount=0,this._initDynamicWfsValues(),this.store.get("wf_manual")||this.startNextWfTimeout(),this.store.on("stop",this._stop.bind(this)),this.store.on("pausePlayer",this._stop.bind(this)),this.store.on("queueStatusChanged",this._onQueueStatusChanged.bind(this)),this.store.get("wf_dynmc_ps")&&(this.store.on("contentPaused",this._stop.bind(this)),this.store.on("contentResumed",this.startNextWfTimeout.bind(this))),this.isFirstRun=!0,this.igonreWfWhenHidden=this.store.get("ignrwfhdn"),this.lineitemMaxFails=this.store.get("mxlifls"),this._registerQueueEvent(),this.maxAllowedEmptyWaterfalls=this.store.get("mxemptwf");e=this.store.get("emptyWaterfallsInARow");this.store.set("emptyWaterfallsInARow",e||0),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.store.on("startWf",function(){t.store.set("dlywf",!1),t.runWaterfall("startWf")}),this.wfParamsFromUnit={},this.isWaitUntilContainerInView=this.store.get("wtuntlcntrinvw"),this.containerElement=this.isWaitUntilContainerInView&&this.store.get("cntrelm")&&document.querySelector(this.store.get("cntrelm"))}var e,t,i;return e=r,(t=[{key:"handleLiteUnitWfResponse",value:function(){var e,t,i=this.store.get("ltuntWfRes");i&&(e=new Zi(this.store),t=this.wfGenerator.getWfCounter()-1,e.push("waterfallIndex",t),this._handleWaterfallSuccess(i,e))}},{key:"_shouldDelayWaterfall",value:function(){return this.store.get("dlywf")}},{key:"_isContainerOutOfView",value:function(){if(this.isWaitUntilContainerInView&&this.containerElement){var e=this.containerElement.getBoundingClientRect();return e&&0===e.height&&0===e.width}return!1}},{key:"startNextWfTimeout",value:function(){var e=this;this.wfInterval&&clearTimeout(this.wfInterval),this._calcDynamicWfsValues(),0<this._delayBetweenWfs?this.wfInterval=setTimeout(function(){e._runBindedWaterfallTicker()},this._delayBetweenWfs):this.store.emit("closePlayer")}},{key:"_initDynamicWfsValues",value:function(){this.maxTimeBetweenWaterfalls=this.store.get("mxtmbtwfs"),this.minTimeBetweenWaterfalls=this.store.get("mntmbtwfs"),this.defaultTimeBetweenWaterfalls=this.store.get("time_between_waterfall"),this.timeBetweenWfFunc=this.store.get("tmbtwfs"),"function"!=typeof this.timeBetweenWfFunc&&(this.timeBetweenWfFunc=void 0),this.minTimeBetweenWfFunc=this.store.get("mntmbtwfsf"),"function"!=typeof this.minTimeBetweenWfFunc&&(this.minTimeBetweenWfFunc=void 0),this.defaultMinTimeBetweenWf=this.store.get("mintimwf")||5e3,this.store.set("dynamicWf.lastDelayBetweenWfs",-1),this.store.set("dynamicWf.currentDelayBetweenWfs",-1),this._calcDynamicWfsValues()}},{key:"_calcDynamicWfsValues",value:function(){this._delayBetweenWfs=1e3*this._calcDelayBetweenWf(),0<this._delayBetweenWfs&&(this._minTimeBetweenWf=this._calcMinDelayBetweenWfs()),this._saveDynamicWfsValues()}},{key:"_calcDelayBetweenWf",value:function(){var t=-1;if(this.timeBetweenWfFunc)try{t=this.timeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultTimeBetweenWaterfalls}return t>this.maxTimeBetweenWaterfalls?t=-1:t<this.minTimeBetweenWaterfalls&&(t=this.minTimeBetweenWaterfalls),t}},{key:"_calcMinDelayBetweenWfs",value:function(){var t=this.defaultMinTimeBetweenWf;if(this.minTimeBetweenWfFunc)try{t=this.minTimeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultMinTimeBetweenWf}return t}},{key:"_saveDynamicWfsValues",value:function(){this.store.set("dynamicWf.lastDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),this.store.set("dynamicWf.currentDelayBetweenWfs",this._delayBetweenWfs)}},{key:"_registerQueueEvent",value:function(){var t=this;this.store.get("run_wf_when_empty")&&this.store.on("playFromEmptyQueue",function(e){t.runWaterfall("queueEmpty",e)})}},{key:"_isInIdleMode",value:function(){return this.store.get("isIdleMode")}},{key:"_runWaterfallTicker",value:function(){this.startNextWfTimeout(),this.runWaterfall("interval")}},{key:"init",value:function(e,t){this.creatives=e,this.store.set("creatives",e),this.adParams=t,this._loadWaterfallGenerator()}},{key:"_loadWaterfallGenerator",value:function(){var t=this;ns.init(this.store.data),ns.get("wf-generator",this.store.get("wfgenv"),function(e){t.debugTracker.info("Wf generator v".concat(t.store.get("wfgenv")," loaded")),t.wfGenerator=new e(t.store,t.creatives),t.store.set("waterfallIndex",t.wfGenerator.getWfCounter()),t._shouldRunWaterfallOnInit()&&t.runWaterfall("run_wf_on_init")},function(){t.debugTracker.error("Load wf generator","Error while loading from service loader")})}},{key:"_shouldRunWaterfallOnInit",value:function(){return this.store.get("run_wf_on_init")}},{key:"_serveStaticWf",value:function(e){this._getRollType();var t=0;"mid-roll"==this.currentRollType?t=1:"post-roll"==this.currentRollType&&(t=2);t=new Function("try { return "+this.staticWf[t].ad_parameters+";} catch(e){}")();this._handleWaterfallSuccess(G(t.waterfall),e)}},{key:"runWaterfall",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(i&&$(J(me.forceWf,this.store)),this.wfGenerator||this.staticWf){if(!i){if(this.passedMaxEmptyWaterfalls())return;if(this.store.get("first_look"))return;if("function"==typeof this.shouldRun&&!this.shouldRun())return;if(this._shouldDelayWaterfall())return;if(this._isInIdleMode())return;if(this._isContainerOutOfView())return}var s=this,n=(new Date).getTime(),r=this.lastRun?n-this.lastRun:this._minTimeBetweenWf;if(!(r<this._minTimeBetweenWf)||i){this.lastRun=n;var a=new Zi(this.store);if(this.staticWf)setTimeout(function(){t._serveStaticWf(a)},20);else if(this._tbWfResponseSuccess(a))O("player_waterfall","firstWfFromTb",{type:"debug",message:"firstWfFromTb",fullPageUrl:this.store.get("fullPageUrl"),player_id:this.store.get("player_id")},this.store);else{this.isFirstRun&&pe("videoRunWF",Ee.START);i=!0===this.store.get("pstflrs"),this.store.get("psthdrs");this.lastRun=n,a.requestTime=Date.now(),a.ignoredLineitems=[],a.push("reason",e),a.push("waterfallIndex",this.wfGenerator.getWfCounter()),a.push("sinceLastWf",r),a.push("queueLength",this.store.get("queueLength")),a.push("vpaidReadyCount",this.store.get("vpaidReadyCount")),a.push("vpaidPendingCount",this.store.get("queueLength")-this.store.get("vpaidReadyCount")),a.push("failsInARow",this.store.get("waterfallFailsInARow")),a.push("successesInARow",this.store.get("waterfallSuccessesInARow")),a.push("lastDelayBetweenWfs",this.store.get("dynamicWf.lastDelayBetweenWfs")),a.push("currentDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),a.push("emptyWaterfallsInARow",this.store.get("emptyWaterfallsInARow")),a.push("maxAllowedEmptyWaterfalls",this.maxAllowedEmptyWaterfalls),a.push("encryptedResponse",this.encryptWaterfallResponse),a.push("waterfallVersion",this.wfv),a.push("navigatorConnection",this.store.get("navigatorConnection")),this.updateCMPData&&(o=this.wfGenerator.getConsentData(),d=this.wfGenerator.getRboxConsentData(),a.push("cdbUpdated",!!o.cdbUpdated),a.push("playerConsentData",o),a.push("rboxConsentData",d));var e=function(e,t){s._handleWaterfallError(e,a,t)},r=function(e,t,i){s._handleWaterfallSuccess(e,a,i)},o=this.wfGenerator.generateUrl({roll:this._getRollType(),pubid:this.pubid,tagid:this.tagid,isFirstRun:this.isFirstRun,unitWfParams:this.wfParamsFromUnit});a.push("url",o);var d=ue(o);if(a.push("urlParams",d),a.push("noaop",this.isFirstRun?this.store.get("firstWaterfallNoaop"):this.creatives.NOAOP),o){if(this.adParams&&this.adParams.waterfall)window.setTimeout(this._handleWaterfallSuccess.bind(this,G(this.adParams.waterfall)),0);else{if(!i)return this.wfGenerator.send({wfUrl:o,postData:"",onSuccess:r,onFail:e}),this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter()),void(this.isFirstRun&&(pe("videoRunWF",Ee.STOP),this.isFirstRun=!1));i=G(this.wfGenerator.generatePOSTParams({queueStatus:this.queueStatus,droppedAdTypes:this._getAdTypesToDrop()}));a.push("postData",i),this.wfGenerator.send({wfUrl:o,postData:i,onSuccess:r,onFail:e}),this.isFirstRun&&(pe("videoRunWF",Ee.STOP),this.isFirstRun=!1)}this._incrementWfCounter(),this.wfGenerator.changeWfBasePath()}}}}}},{key:"_getAdTypesToDrop",value:function(){var e,t=[];for(e in this.adsToDrop)this.adsToDrop[e]&&t.push(e);return t}},{key:"passedMaxEmptyWaterfalls",value:function(){return!!this.maxAllowedEmptyWaterfalls&&this.store.get("emptyWaterfallsInARow")>this.maxAllowedEmptyWaterfalls}},{key:"_sendWaterfallResponsePixel",value:function(e){this.fireWaterfallErrorPixels&&$(J(e,this.store))}},{key:"_handleWaterfallSuccess",value:function(e,t,i){if(!this.igonreWfWhenHidden){if(this._addRoundTripDuration(),!e)return this.debugTracker.info("runWaterfall","Empty Waterfall!"),void this._updateWaterfallFailure("empty-response",t,i,me.emptyWFResponse);this._measureWfSuccessBlockingTime("videoWFParsing",Ee.START),this.encryptWaterfallResponse&&(e=this._decodeText(e));var s=new Function("try { return "+e+";} catch(e){}")();if(this._measureWfSuccessBlockingTime("videoWFParsing",Ee.STOP),!(s&&s.tags&&s.tags.length)){var n=s&&s.tags?"Failed to decode empty server response":"Failed to decode server response!";return this.debugTracker.warn("runWaterfall",n),void this._updateWaterfallFailure("no-tags",t,i,me.noTagsInWFResponse)}this.store.set("emptyWaterfallsInARow",0),this.debugTracker.info("Waterfall number ".concat(t.index+1," received"),s.tags,{color:"#D15EFF"}),this._measureWfSuccessBlockingTime("videoWFHandling",Ee.START),this.store.set("sessionData",s.sd),s&&s.pixel_piggies&&this._firePiggies(s.pixel_piggies);var r,a=[];for(r in s.tags){var o,d,h,l,u,c,p,v=s.tags[r];(v.url||v.vast)&&(o=v.lp&&0<v.lp.length&&v.lp[0]?v.lp[0]:"",c=void 0,p=le(u=v.dast&&v.cirid&&v.vidDast?(h=v.cirid,l=v.dast,v.vidDast):(h=(p=ue(d=this._getPixel(v.pixel)||"")).cirid,l=p.dast,p["vid-dast"])),v.lineItemId||(c=le(l)),v.getValueByKey=function(e,t){return this.dsm&&this.dsm.hasOwnProperty(t)?this.dsm[t]:e.get(t)}.bind(v,this.store),v=Object.assign(v,(is(o={score:-1,waterfallTagId:r,created:(new Date).getTime(),dp:o?o.replace(/http:\/\/|.com|https:\/\/|.com/g,""):"na",dpFull:o||"na",conversionPixels:v.conversionPixels||[],ts:Date.now(),wfIndex:t?t.get("waterfallIndex",-1):this.wfGenerator.getWfCounter(),url:v.url?function(e){if(!e||!S)return e;var t=void 0,i=void 0;return 0===e.indexOf("http:")&&(i="absolute",t=e.replace("http:","https:")),0!==e.indexOf("//")||S.get("secured_protocol")||(i="relative",t="https:"+e),t&&de(i,{url:e}),t||e}(ee(v.url,this.store)):"",vast:v.vast?ee(v.vast,this.store):"",pixel:d,eventTrackers:v.etrk||{},jsTrackers:v.jstrk||[],brand:v.brand||"",dsm:v.dsm||{},rollType:this.currentRollType,pubId:this.pubid,tagId:this.tagid,isRon:this.isRon,cstmdl:v.cstmdl||-1,singleAd:1===v.sa,adjacencyAd:1===v.adjac},void 0!==this.defaultTagPrice&&"price",v.price||this.defaultTagPrice),is(o,h&&"cirid",h),is(o,"dast",l),is(o,"vidDast",u),is(o,"campaignId",p&&p.hasOwnProperty("cipid")?p.cipid:-1),is(o,"lineItem",(v.lineItemId||c&&c.cicmp||"").toString()),is(o,"isDirectDemand",v.advType===Hi.DIRECT||v.advType===Hi.PMP_DIRECT),o),this._overrideParamsByDemand(v),this._decodeItemParams(v)),this._shouldDropAd(v)||(0<this.requiredViewabilityFactor&&!v.requiredViewability&&(v.requiredViewability=this._drawRequiredViewabilityByFactor(v)),this._ignoreLineitem(v.lineItem)?(t.ignoredLineitems.push(v.lineItem),t.push("ignoreLineitems",t.ignoredLineitems),this.store.get(v.lineItem+".failsRow")?this.store.incr(v.lineItem+".failsRow"):this.store.set(v.lineItem+".failsRow",1)):a.push(v),this.store.get(v.lineItem)||this.store.set(v.lineItem,{failsRow:0,tries:0,conversions:0,fails:0}),v.lineItemStats=function(e){try{return JSON.parse(G(e))}catch(e){return{}}}(this.store.get(v.lineItem)),this._firePrebidPixel(v)))}0<a.length?(this._pushTagsResponseToWaterfallLog(t,a),s.tags=a,s.data=new ts(this.store,this.staticWf?1:this.wfGenerator.getWfCounter()),this.onWaterfallSuccess(s,t),t&&(t.push("duration",Date.now()-t.requestTime),t.push("response",e),t.push("tagsCount",a.length),t.push("success",!0),this._sendWfLog(t)),this.store.emit("waterfallData",s),this._logRetry(t,i,!0)):(this.debugTracker.error("runWaterfall","Failed to get any tags!"),this._handleWaterfallError("no-clean-tags",t,i)),this._measureWfSuccessBlockingTime("videoWFHandling",Ee.STOP)}}},{key:"_measureWfSuccessBlockingTime",value:function(e,t){this["measured".concat(e)]||(pe(e,t),this["measured".concat(e)]=t===Ee.STOP)}},{key:"_updateWaterfallFailure",value:function(e,t,i,s){this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),this._handleWaterfallError(e,t,i),this._sendWaterfallResponsePixel(s)}},{key:"_handlePassbackTrigger",value:function(e){1===e.get("waterfallIndex")&&(this.store.emit("emptyFirstWaterfall"),e.push("emptyFirstWaterfallPassback",!0),this._sendEmptyFirstWaterfallPassbackPixel())}},{key:"_sendEmptyFirstWaterfallPassbackPixel",value:function(){this.fireEmptyWaterfallPassbackPixel&&$(J(me.passbackOnEmptyFirstWF,this.store))}},{key:"_shouldDropAd",value:function(e){for(var t in this.adsToDrop)if(this.adsToDrop[t]&&e.hasOwnProperty(t)&&e[t])return!0;return!(!this.store.get("isAmp")||!e.getValueByKey("drponamp"))}},{key:"_logRetry",value:function(e,t,i){e&&t&&-1<t.indexOf("rt=1")&&(t=t.match(/prst=(.*?)(&|$)/),e.push("retry",!0),e.push("statusBeforeRetry",t&&1<t.length?t[1]:"0"),e.push("successOnRetry",i))}},{key:"_drawRequiredViewabilityByFactor",value:function(e){var t=L(0,100)<=this.requiredViewabilityFactor&&e&&(e.advType===Hi.OPEN_EXCHANGE_RTB_DSP||e.advType===Hi.OPEN_EXCHANGE_RTB_SSP);return t&&(e.requiredViewabilityDrawn=!0),t}},{key:"_pushTagsResponseToWaterfallLog",value:function(i,e){i&&e.map(function(e,t){e=Object.assign({},e);i.push("tagResponse_".concat(t),function e(t){var i,s={};for(i in t)if(t.hasOwnProperty(i))if("object"==E(t[i])){var n,r=e(t[i]);for(n in r)r.hasOwnProperty(n)&&"function"!=typeof r[n]&&(s[i+"_"+n]=r[n])}else s[i]=t[i];return s}(e))})}},{key:"_overrideParamsByDemand",value:function(e){return this.store.get("ovrtgbydc")?e.getValueByKey("ovrdtag"):{}}},{key:"_sendWfLog",value:function(e){var t={wfRoundTripAverageDuration:this.store.get("performance.wfRoundTripAverageDuration"),performanceMeasurment:this.store.get("performance.performanceMeasurment")};e.push("performance",t),e.push("conversionsCount",this.store.get("conversionsCount")),e.push("unit",{width:this.store.get("width"),height:this.store.get("height")}),this.store.get("vForce")&&e.push("getAdData",this.store.get("getAdData"))}},{key:"_addRoundTripDuration",value:function(){var e=Date.now()-this.lastRun;this._roundTripAverageDuration=parseInt((this._roundTripAverageDuration*this._roundTripsCount+e)/(this._roundTripsCount+1)),this.store.set("waterfall_data.last_duration",e),this.store.set("waterfall_data.average_duration",this._roundTripAverageDuration),this._roundTripsCount++}},{key:"_ignoreLineitem",value:function(e){if(0<this.lineitemMaxFails){e=this.store.get(e);return(e?e.failsRow:-1)>this.lineitemMaxFails}return!1}},{key:"_firePrebidPixel",value:function(e){this.shouldFirePrebidSessionPixel&&e.advType===Hi.PREBID&&($(J(me.prebidSession,this.store)),this.shouldFirePrebidSessionPixel=!1)}},{key:"_decodeItemParams",value:function(e){return Object.assign({rpox:this._decodeValue(e.rpox),alfrox:this._decodeValue(e.alfrox),frox:this._decodeValue(e.frox),itemType:e.t},e.ex&&{crId:e.ex.ecrid,stId:e.ex.s,cmpgnId:e.ex.ecid},e.ex&&e.ex.b&&{brand:this.encryptWaterfallResponse?e.ex.b:this._decodeText(e.ex.b)})}},{key:"_decodeValue",value:function(e){return this.encryptWaterfallResponse?e:(2530^e)/1e3}},{key:"_decodeText",value:function(e){for(var t=function(e){try{for(var t=e.length,i=[],s=0;s<oe.length;s++)i[oe.charCodeAt(s)]=s;var n,r=oe.charAt(64);!r||-1!==(n=e.indexOf(r))&&(t=n);for(var a,o,d=[],h=0,l=0;l<t;l++)l%4&&(a=i[e.charCodeAt(l-1)]<<l%4*2,o=i[e.charCodeAt(l)]>>>6-l%4*2,d[h>>>2]|=(a|o)<<24-h%4*8,h++);for(var u=[],l=0;l<h;l++){var c=d[l>>>2]>>>24-l%4*8&255;u.push(String.fromCharCode(c))}return decodeURIComponent(escape(u.join("")))}catch(e){return""}}(e),i="",s=0;s<t.length;s++){var n=s%"PlAyER".length,r=t[s].charCodeAt(0).toString(10),n="PlAyER"[n].charCodeAt(0).toString(10);i+=String.fromCharCode(r^n)}return i}},{key:"_firePiggies",value:function(e){if(this.store.get("fire_piggies")&&!(5<=this.wfGenerator.getWfCounter()))for(var t=0;t<e.length;t++){var i=e[t];if(i.url){i=U(i.url);try{(new Image).src=i}catch(e){this.debugTracker.error("_fireIframePig - Malformed url!",e)}}}}},{key:"_handleWaterfallError",value:function(e,t,i){this.store.incr("emptyWaterfallsInARow"),this.passedMaxEmptyWaterfalls()&&this._sendMaxEmptyWaterfallPixel(),this._addRoundTripDuration(),t&&(this._logRetry(t,i,!1),t.push("duration",Date.now()-t.requestTime),t.push("error",e),t.push("success",!1),this._sendWfLog(t)),this.onWaterfallError(e),this._handlePassbackTrigger(t)}},{key:"_sendMaxEmptyWaterfallPixel",value:function(){this.fireMaxEmptyWaterfallPixel&&$(J(me.maxEmptyWfs,this.store))}},{key:"_getPixel",value:function(e){if(e){var t=new RegExp(/src=[\"|\']([^"]+)[\"|\']/).exec(e),e=t&&1<t.length&&t[1]?t[1]:e;return e.substring(e.indexOf("//"))}}},{key:"onWaterfallError",value:function(){}},{key:"onWaterfallSuccess",value:function(){}},{key:"SetWaterfallError",value:function(e){this.onWaterfallError=e}},{key:"SetWaterfallSuccess",value:function(e){this.onWaterfallSuccess=e}},{key:"SetShouldRun",value:function(e){this.shouldRun=e||function(){}}},{key:"GetCounter",value:function(){return this.wfGenerator.getWfCounter()}},{key:"_getRollType",value:function(){var e=this.store.get("contentSchedule")||{},t=null,i=Object.keys(e)||[];return this.staticWf||1===this.wfGenerator.getWfCounter()?t=e[i[0]]:0<i.length&&(t=e[i[1]]),this.currentRollType=t?t.roll_type:"",this.pubid=t?t.pubid:0,this.tagid=t?t.tagid:0,t}},{key:"_stop",value:function(){clearTimeout(this.wfInterval)}},{key:"start",value:function(){this.startNextWfTimeout()}},{key:"stop",value:function(){this._stop()}},{key:"_onQueueStatusChanged",value:function(e){function t(e){return(e=Object.assign({},e)).aid=e.cstmdl=e.dp=e.pid=void 0,""===e.br&&(e.br=void 0),e}this.queueStatus={size:e.size,prevItems:e.previousQueue.map(t),items:e.items.map(t)}}},{key:"dropAds",value:function(e){this.adsToDrop.hasOwnProperty(e)&&!this.adsToDrop[e]&&(this.adsToDrop[e]=!0)}},{key:"addWfParameter",value:function(e,t){void 0!==t&&(this.wfParamsFromUnit[e]=encodeURIComponent(t))}},{key:"updateWfParameter",value:function(e,t){this.addWfParameter(e,t)}},{key:"removeWfParameter",value:function(e){this.wfParamsFromUnit[e]&&(this.wfParamsFromUnit[e]=void 0,delete this.wfParamsFromUnit[e])}},{key:"_incrementWfCounter",value:function(){this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter())}},{key:"_tbWfResponseExists",value:function(){return!!this.store.get("firstWfRes")}},{key:"_tbWfResponseSuccess",value:function(e){if(this._tbWfResponseExists())try{return this._handleTbWfResponse(e),!0}catch(e){this.debugTracker.error("tbWaterfallResponse",e)}return!1}},{key:"_handleTbWfResponse",value:function(e){e.push("firstWfFromTb",!0);var t=this.wfGenerator.getWfCounter()-1;e.setWfCounter(t),e.push("waterfallIndex",t),this._handleWaterfallSuccess(this.store.get("firstWfRes"),e),this.store.set("firstWfRes",void 0)}}])&&ss(e.prototype,t),i&&ss(e,i),r}());function as(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var os=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.iframesWeights=e}var e,i,s;return e=t,(i=[{key:"detect",value:function(e,i){var s=this,n={};return e.map(function(e){var t=s._detectIframeTypeFromUrl(e,i);n[t]=n[t]||{urls:[],counter:0},n[t].urls.push(e),n[t].counter++}),n}},{key:"_detectIframeTypeFromUrl",value:function(e,t){return-1<e.indexOf("imasdk")?"ggl":t?"pxls":"gen"}},{key:"calculateWeightsByIframeType",value:function(e){var t,i=0;for(t in e)i+=this.iframesWeights[t]*e[t].counter;return i}}])&&as(e.prototype,i),s&&as(e,s),t}();function ds(e){return(ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ls=s(9),us=(s(31),s(6)),cs=function(){function a(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),us.mixin(this),this.vpaidHandler=t,this.store=i,this.vpaidCount=1,this.version="VPAID-1.0.0",this.VPAIDversion="1.1",this.debugTracker=new d(this.version),this.vpaidParameters=this._defaultVpaidParameters,this.config=this._defaultVpaidConfig;var s,n,r={};for(s in this._createIframesDetector(),this.store.get("mltads")&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this)),e)r[s.toUpperCase()]=e[s];for(n in this.config.creatives=Object.assign({},this._defaultVpaidParameters,r),this.store.get("cmbopps")&&this.store.get("usopsla")&&this._loadOppsula(),this.manager=!1,this._initWaterfall(),this.vpaidEvents)this.on(this.vpaidEvents[n],this._runEventFunction.bind(this));this.emit(this.vpaidEvents.AdLoaded,{eventData:""}),this.store.emit("mainVpaidCreated",this.config)}var e,t,i;return e=a,(t=[{key:"_createIframesDetector",value:function(){this.store.set("iframesDetector",new os(this.store.get("ifrmswghts")))}},{key:"setVpaidId",value:function(e){this.version="[".concat(e.wfIndex,"_").concat(e.dp,"]")}},{key:"_loadOppsula",value:function(){var i=this;ls.init(this.store.data),ls.get("oppsula",this.store.get("opslavrsn"),function(e){var t=i.store.get("non_bllb_opps_base_path")||i.store.get("opps_base_path");i.store.set("ms_data",{opps_base_path:t||i.config.creatives.CM_DOMAIN});e=new e(i.store.get("unit_model"),i.store);i.store.set("oppsula",e),i.store.emit("oppsulaCreated",e)},function(){i.debugTracker.error("Load Oppsula","Error while loading from service loader")})}},{key:"_onResizeAd",value:function(e){this.config&&(this.config.width=e.width,this.config.height=e.height)}},{key:"trigger",value:function(e,t){this.vpaidHandler.emit(e,t)}},{key:"runWaterfall",value:function(e){this.waterfallManager.runWaterfall(e)}},{key:"getVpaidReadyCount",value:function(){return this.manager.getVpaidReadyCount()}},{key:"_initWaterfall",value:function(){pe("videoWFManager",Ee.START),this.waterfallManager=new rs(this.store),pe("videoWFManager",Ee.STOP),this.config.creativeData=this._getCreativeData(this.config),this.waterfallManager.init(this.config.creatives,this.config.creativeData.AdParameters),this.waterfallManager.SetWaterfallError(this._waterfallError.bind(this)),this.waterfallManager.SetWaterfallSuccess(this._waterfallSuccess.bind(this));var i=this;this.waterfallManager.SetShouldRun(function(){var e=this.store.get("max_ready_vpaid")||2,t=this.store.get("waterfall_watermark")||0;return!i.manager||i.manager.getVpaidReadyCount()+t<e})}},{key:"_getSlot",value:function(e){var t=!1;switch(ds(e)){case"string":document.getElementById(e)&&(t=document.getElementById(e));break;case"object":e.style&&e.tagName&&(t=e);break;default:this.debugTracker.error("initAd","Bad slot in 'environmentVars'")}return t}},{key:"_getCreativeData",value:function(e){var t=!1;switch(ds(e)){case"object":0<Object.keys(e).length&&(t=!0);break;case"string":if(0<e.length)try{e=new Function("return "+e+";")(),t=!0}catch(e){}}if(t){for(var i in this.config.creatives)(null==e[i]||-1<this.config.protectedCreatives.indexOf(i))&&(e[i]=this.config.creatives[i]);e.AdParameters&&(e.AdParameters=this._handleAdParams(e.AdParameters))}return e}},{key:"_handleAdParams",value:function(e){var t={};switch(ds(e)){case"object":0<Object.keys(e).length&&(t=e);break;case"string":if(0<e.length)try{t=new Function("return "+e+";")()}catch(e){}}return t}},{key:"_dataFromUrl",value:function(e){e=e.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=e.length)return this.debugTracker.warn("dataFromUrl","Bad source parameter!"),this.vpaidParameters;var t,i=e[1].split(/\?|&/gi);for(t in i)if(i[t]){var s=i[t].split(/=(.+)?/gi,2);if(2==s.length){var n=s[0].replace(/\-/gi,"_").toUpperCase();if(null!=this.vpaidParameters[n])switch(n){case"ISVIDEO":case"PLMD":case"MINDUR":case"MAXDUR":case"MINBR":case"MAXBR":case"VPD":case"VPTD":case"RS":case"ST":case"PLAYER_WIDTH":case"PLAYER_HEIGHT":case"PUBID":case"STS":case"MFP":case"ADTO":case"B2B":case"VMT":case"SORTORDERTYPE":case"TAGID":case"VIDLENGTH":case"DEFAULTTAGTIMEOUT":case"TOTALTIMEOUT":this.vpaidParameters[n]=isNaN(parseInt(s[1]))?0:parseInt(s[1]);break;case"MUTED":case"AFBP":case"DEBUG":case"PAUSE_ON_START":switch(s[1]){case"1":case"true":case"TRUE":this.vpaidParameters[n]=!0;break;case"0":case"false":case"FALSE":this.vpaidParameters[n]=!1}break;case"WP":case"SERVICE":case"PV":case"PT":case"SDID":break;default:this.vpaidParameters[n]=s[1]}else this.debugTracker.warn("dataFromUrl","Parameter '"+s[0]+"' is not supported!")}}return this.vpaidParameters}},{key:"_runEventFunction",value:function(e){this["on"+e.type]&&this["on"+e.type](e)}},{key:"_waterfallError",value:function(e){0}},{key:"_waterfallSuccess",value:function(e,t){this.manager&&(this.config.waterfall=e,this.manager.fillSchedule(e,t))}},{key:"_onManagerStopped",value:function(){this.emit(this.vpaidEvents.AdStopped)}},{key:"getTime",value:function(){return(new Date).getTime()}},{key:"initAd",value:function(e,t,i,s,n,r){this.config.inited||(this.config.target=this._getSlot(r.slot),this.config.target&&(this.config.videoSlotControls=this.store.get("ad_controls"),this.config.videoSlotCanAutoPlay=!0,this.config.width=parseInt(e),this.config.height=parseInt(t),this.config.bitrate=s,this.config.viewMode=i,this.config.creatives.PLAYER_WIDTH=this.config.width,this.config.creatives.PLAYER_HEIGHT=this.config.height,this.config.creativeData=this._getCreativeData(n),this.config.inited=!0,this.manager||(this.manager=new Ki(this,this.store)),this.waterfallManager.handleLiteUnitWfResponse(),this.manager.onStop=this._onManagerStopped.bind(this),this.emit(this.vpaidEvents.AdLoaded,{eventData:""})))}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&null!=e&&this.off(t,e)}},{key:"handshakeVersion",value:function(e){return this.VPAIDversion}},{key:"startAd",value:function(e){this.manager.playFromQueue(e),this.config.started=!0}},{key:"fire99",value:function(e,t){this.manager&&this.manager.fire99({waterfallTagId:e,dast:t})}},{key:"resizeAd",value:function(e,t,i){this.config.width=e,this.config.height=t,this.config.viewMode=i,this.manager&&this.manager.resizeAd(e,t,i)}},{key:"stopAd",value:function(){this.manager?this.manager.stop():this.emit(this.vpaidEvents.AdStopped)}},{key:"setAdVolume",value:function(e){if(!this.store.get("isMobile")){if(e=1<e?e/100:e,isNaN(parseFloat(e)))return!1;this.manager&&!this.store.get("isMobile")&&this.manager.setAdVolume(e)}}},{key:"getAdVolume",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdVolume",[],0):0}},{key:"getAdLinear",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdLinear",[],!0)}},{key:"getAdWidth",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdWidth",[],this.config.width):this.config.width}},{key:"getAdHeight",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdHeight",[],this.config.height):this.config.height}},{key:"getAdExpanded",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdExpanded",[],!0)}},{key:"getAdSkippableState",value:function(){return!!this.manager&&this.manager.callWorkingVpaid("getAdSkippableState",[],!1)}},{key:"getAdSkippableRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdSkippableRemainingTime",[],-1):-1}},{key:"getAdRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdRemainingTime",[],-1):-1}},{key:"getAdDuration",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdDuration",[],-1):-1}},{key:"getAdCompanions",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdCompanions",[],[]):[]}},{key:"getAdIcons",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdIcons",[],[]):[]}},{key:"pauseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("pauseAd",[],!0)}},{key:"resumeAd",value:function(){this.manager&&this.manager.callWorkingVpaid("resumeAd",[],!0)}},{key:"expandAd",value:function(){this.manager&&this.manager.callWorkingVpaid("expandAd",[],!0)}},{key:"collapseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("collapseAd",[],!0)}},{key:"skipAd",value:function(){this.manager&&this.manager.callWorkingVpaid("skipAd",[],!0)}},{key:"getVpaidLogs",value:function(){if(this.manager)return this.manager.getVpaidLogs()}},{key:"getAd",value:function(e){if(this.manager)return this.manager.getAd(e)}},{key:"onAdLoaded",value:function(){}},{key:"onAdStarted",value:function(){}},{key:"onAdStopped",value:function(){}},{key:"onAdSkipped",value:function(){}},{key:"onAdSkippableStateChange",value:function(){}},{key:"onAdSizeChange",value:function(){}},{key:"onAdLinearChange",value:function(){}},{key:"onAdDurationChange",value:function(){}},{key:"onAdExpandedChange",value:function(){}},{key:"onAdVolumeChange",value:function(){}},{key:"onAdImpression",value:function(){}},{key:"onAdVideoStart",value:function(){}},{key:"onAdVideoFirstQuartile",value:function(){}},{key:"onAdVideoMidpoint",value:function(){}},{key:"onAdVideoThirdQuartile",value:function(){}},{key:"onAdVideoComplete",value:function(){}},{key:"onAdClickThru",value:function(){}},{key:"onAdInteraction",value:function(){}},{key:"onAdUserAcceptInvitation",value:function(){}},{key:"onAdUserMinimize",value:function(){}},{key:"onAdUserClose",value:function(){}},{key:"onAdPaused",value:function(){}},{key:"onAdPlaying",value:function(){}},{key:"onAdLog",value:function(){}},{key:"onAdError",value:function(){}},{key:"onVpaidSpecial",value:function(){}},{key:"onSonudViolation",value:function(){}},{key:"vpaidEvents",get:function(){return we.a},set:function(e){}},{key:"_defaultVpaidParameters",get:function(){return{VIEW_MODE:"normal",REFERRER:"",VIDEO_URL:"",DOMAIN:"",PUBID:0,TAGID:0,VPD:0,VPTD:0,AUC_DAST:"",VIDLENGTH:0,KEY_WORDS:"",DESCRIPTION:"",SERVICE:"WhiteLabelBidRequestHandlerServlet",VERTICAL:"",SCHEMA:"vast2-vpaid",TYPE:"application/javascript",PV:this.version,RS:1,ST:1,WP:1,PT:5,CIRF:"",SDID:1,STS:0,CB:"",VOLUME:0,TAG:"",PAGE_URL:"",TIME_STAMP:"",TITLE:"",MFP:4,ISVIDEO:1,PLMD:2,MINDUR:1,MAXDUR:60,MINBR:1,MAXBR:512,AFBP:!1,ADTO:60,B2B:1,VMT:0,SORTORDERTYPE:0,DEFAULTTAGTIMEOUT:30,OID:"",NOAOP:"",TOTALTIMEOUT:60,CM_DOMAIN:"http://exchange.basebanner.com",OFFSET:0,MODE:"paralel",MUTED:!1,DEBUG:!1,PAUSE_ON_START:!1,PLAYER_WIDTH:0,PLAYER_HEIGHT:0}},set:function(e){}},{key:"_defaultVpaidConfig",get:function(){return{waterfall:{},source:this.src,videoSlotCanAutoPlay:!0,videoSlotControls:!1,vpaid_protect_path:!1,running:!1,inited:!1,stopped:!1,started:!1,target:!1,video:!1,bitrate:512,creatives:{},protectedCreatives:["WP","PV","PT","SDID","CM_DOMAIN","SERVICE"]}},set:function(e){}}])&&hs(e.prototype,t),i&&hs(e,i),a}();function ps(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var vs=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.store=e,this.debugTracker=new d("OpportunityAggregator"),this.opps=[];t=this.store.get("non_bllb_opps_base_path")||this.store.get("opps_base_path")||t.CM_DOMAIN;this.url=U(t)+(/.*\/$/g.test(t)?"":"/")+"OpportunityServlet",this.postHeaders=this.store.get("psthdrs")||"application/json",this.onFail=this._onFail.bind(this),this.onSuccess=this._onSuccess.bind(this);t=this._sendTicker.bind(this);setInterval(t,this.store.get("timbtopps")),this.store.on("sendOpps",t),this.store.on("beforeunload",t)}var e,t,s;return e=i,(t=[{key:"send",value:function(e){this.opps.push(e)}},{key:"_sendTicker",value:function(){0<this.opps.length&&f(this.url,G(this.opps),this.onSuccess,this.onFail,void 0,!1,!1,5e3,this.postHeaders,!1),this.opps=[]}},{key:"_onSuccess",value:function(e){}},{key:"_onFail",value:function(e){this.debugTracker.warn("Error Firing Opps",e)}}])&&ps(e.prototype,t),s&&ps(e,s),i}();function fs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ms=s(6),gs=function(){function s(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),ms.mixin(this),pe("videoVpaidHandler",Ee.START),this.store=i,this.finished=!1,this.isFirstImpression=e.isFirstImpression,this.soundViolationFired=!1,this.iframe={},this.vpaid=null,this.uid="",this.debugTracker=new d("VpaidHandler"),this.vpaidCreated=!1,this.store.get("noplrcntr")||(this.videoWrapper={}),this.options=e,this.parent=e.parent,this.parentOptions=t,this.creativeData={},this.height=0,this.width=0,this.eventFunctions={},this.viewMode="normal",this.bitRate=512,this.timerId=0,this.adPlaying=!1,this.isAdPlayerVisible=!1,this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.environmentVars={};t=Object.assign({},this.parentOptions.tagDefault,this.options.vpaidTag);this.normalizeVpaidParam(t),this.options.vpaidTag=t,this.prepareVideoTag(),this.run(e.isPreRoll),this.store.on("stop",this.stop.bind(this)),this.store.on("hideAdPlayer",this.hideAdPlayer.bind(this)),this.isMultiAdsActive=this.store.get("mltads"),this.isMultiAdsActive&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this)),this.volumeBeforeMute=0,this.paused=!1,this.hideAdPlayerDelayId=0,this.store.emit("vpaidHandlerCreated",this),pe("videoVpaidHandler",Ee.STOP)}var t,i,n;return t=s,(i=[{key:"_onResizeAd",value:function(e){this.finished||(this.options.width=e.width,this.options.height=e.height)}},{key:"volumeControlClick",value:function(e,t,i){var s=e.parentNode.getBoundingClientRect(),s=parseInt((i.pageX-(s.left+5))/(s.width-10)*100);this.setVolumeControls(e,t,s),this.volume((s=100<s?100:s)/100),this.options.parent.volume(s)}},{key:"setVolumeControls",value:function(e,t,i){(i=100<i?100:i)<=0?(i=0,t.className="vjs-mute-control vjs-control vjs-vol-0",t.muted=!0):(t.className="vjs-mute-control vjs-control vjs-vol-"+Math.floor(i/25),t.muted=!1),e.style.width=i+"%"}},{key:"muteControlClick",value:function(e,t,i){var s;t.muted?(t.className="vjs-mute-control vjs-control vjs-vol-4",t.muted=!1,s=100*(this._beforeMuteVolume||1),e.style.width=s+"%",this.volume(s),this.options.parent.volume(100)):(t.className="vjs-mute-control vjs-control vjs-vol-0",t.muted=!0,this._beforeMuteVolume=this._volume,e.style.width="0",this.volume(0),this.options.parent.volume(0))}},{key:"playPauseClick",value:function(e,t){this.paused?(this.vpaid.resumeAd(),this.paused=!1,e.className="vjs-play-control vjs-control"):(this.vpaid.pauseAd(),this.paused=!0,e.className="vjs-play-control vjs-control vjs-playing c-paused"),t.stopPropagation()}},{key:"onVpaidCreated",value:function(e){this.vpaid=e,this.vpaid||this.debugTracker.error("onVpaidCreated","Vpaid Object is Invalid!"),this.subscribeToVpaid(e),this.environmentVars={slot:this.store.get("noplrcntr")?this.parent.target:this.videoWrapper,videoSlotCanAutoPlay:!0,videoSlotControls:!0},this.store.get("contentClickUrl")&&!this.store.get("noplrcntr")&&this.videoWrapper.addEventListener("click",function(e){e.stopPropagation()}),this.debugTracker.info("onVpaidCreated","Vpaid-Player->Creating..."),this.options.vpaidTag.skip_vast||!this.creativeData.adParameters?this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters:this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters;try{this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(t){this.debugTracker.error("onVpaidCreated: Vpaid-initAd->failed!Trying to run with parsed <adParameters>...",t);try{var i=this.creativeData.adParameters;this.creativeData.adParameters={},this.creativeData.adParameters=new Function("return "+i+";")(),this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters,this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(e){this.vpaidCreated=!1,this.onVpaidLoadError(t,e)}}this.vpaidCreated&&this.parent.ga.sendGaMessage({type:"vpaidInitiated"})}},{key:"resize",value:function(e,t,i){if(i=i||"normal",t=parseInt(t),e=parseInt(e),this.options.height=t,this.options.width=e,this.viewmode=i,!isNaN(e)||!isNaN(t)){this.store.get("noplrcntr")||(this.videoWrapper.style.width=e+"px",this.videoWrapper.style.height=t+"px");var s=this.isMultiVpaidUnit||!1;if(!this.isMultiVpaidUnit)try{this.vpaid&&(s=this.vpaid.resizeAd(e,t,i))}catch(e){this.debugTracker.error("resize",e),s=!1}return s}}},{key:"viewAdPlayer",value:function(e){clearTimeout(this.hideAdPlayerDelayId),this.adPlaying||(this.store.get("isMobile")||this.antiFlashBlackScreen(),this.adPlaying=!0,this.parent.video.pause(),this.parent.video.style.display="none",this.parent.video.forceCanvas?this.parent.video.hideCanvas():(this.parent.video.style.display="none",this.parent.video.style.zIndex=0),this.store.get("noplrcntr")||(this.videoWrapper.style.zIndex=100,this.videoWrapper.classList.add("_ad-cm-playing"),this.videoWrapper.style.display="block"),this.vpaid.manager.bringVpaidToFront()),this.store.get("vForce")?this.isAdPlayerVisible||(this.isAdPlayerVisible=!0,this.store.emit("AdPlayerVisible")):this.store.emit("AdPlayerVisible")}},{key:"antiFlashBlackScreen",value:function(){document.body.scrollTop=document.body.scrollTop+1,setTimeout(function(){document.body.scrollTop=document.body.scrollTop-1},2)}},{key:"hideAdPlayer",value:function(e){var t=this;clearTimeout(this.hideAdPlayerDelayId);var i=this;this.hideAdPlayerDelayId=setTimeout(function(){window.clearTimeout(i.timerId),i.store.get("vForce")||i.parent.playerIsClosed||i.adPlaying&&(i.adPlaying=!1,i.parent.video.forceCanvas?(i.parent.video.play(),i.parent.video.showCanvas()):(i.parent.video&&i.parent.video.paused&&(i.store.get("dataSaver")||(t.store.get("isMobile")&&(i.parent.video.muted=!0),i.parent.video.play())),i.parent.video&&(i.parent.video.style.display="block",i.parent.video.style.zIndex=1e3)),t.store.get("noplrcntr")||i.videoWrapper.classList.remove("_ad-cm-playing"),i.store.emit("AdPlayerHidden"),e&&e.stop("global_ad_timeout"))})}},{key:"vpaidEvents",get:function(){return{VpaidSpecial:"VpaidSpecial",AdBlockEnabled:"AdBlockEnabled",AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt"}}},{key:"onVpaidError",value:function(e,t,i){i?this.debugTracker.error("VPAID-"+this.options.uid,i?i[0]:""):this.debugTracker.error("VPAID-"+this.options.uid,"Vpaid Threw Error"),this.parent.options.onAdError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidLoadError",value:function(e,t){if(e=e||"",t=t||"",this.parent.ga.sendGaMessage({type:"VpaidLoadError"}),500==parseInt(1e3*Math.random()))try{var i="VpaidLoadError="+encodeURIComponent(e.toString()+"[][][][]"+t.toString()),s=new XMLHttpRequest;s.open("POST","//www.mikysrv.com/push.html",!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(i),this.debugTracker.error("VPAID-"+this.options.uid,[e,t])}catch(e){}this.parent.options.onAdLoadError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidPageError",value:function(e){this.debugTracker.warn("VpaidPageError",e)}},{key:"stop",value:function(e){window.setTimeout(function(e){this.hideAdPlayer(e)}.bind(this,e),0)}},{key:"onVpaidStop",value:function(){window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"run",value:function(e){if(this.store.get("ads_playing")||0)return!1;var t,i=this.options.vpaidTag;return this.vpaid||(this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters,this.vpaid=new cs(i,this,this.store),this.store.get("cmbopps")&&(t=new vs(this.store,this.vpaid.config.creatives),this.store.set("oppsAggregator",t)),this.onVpaidCreated(this.vpaid),this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars)),this.store.set("currentPubid",i.pubid),this.store.set("currentTagid",i.tagid),this.store.set("rollType",i.roll_type),this.vpaid.startAd(e),this.vpaidCreated=!0}},{key:"startAd",value:function(){this.startAdFired=!0,this.vpaid.startAd()}},{key:"prepareVideoTag",value:function(){var e;this.getWorkingVolume();this.store.get("noplrcntr")||(e=this.parent.target,this.videoWrapper=document.createElement("div"),this.videoWrapper.className=e.className,this.videoWrapper.className+=" vpaid-handler",this.videoWrapper.id=this.options.uid+"_"+e.id,this.videoWrapper.style.cssText=e.style.cssText+";position:absolute;top:0;left:0;border:0; z-index:0");var t=this.options.vpaidTag.mute||this.parentOptions.mute;this.options.vpaidTag.mute=t,this.options.height=X(this.store.get("height")),this.options.width=X(this.store.get("width")),this.store.get("noplrcntr")||e.appendChild(this.videoWrapper)}},{key:"getWorkingVolume",value:function(){var e=0;return this.options.vpaidTag.volume?"auto"==this.options.vpaidTag.volume&&(e=this.parent.volume()/100,e=this.store.get("volume")):e=this.parentOptions.volume/100,(e=0==e&&this.vpaid?this.vpaid.manager.getCurrentWorkingVpaidVolume():e)<1?parseInt(100*e):parseInt(e)}},{key:"normalizeVpaidParam",value:function(e){e.adto=e.ad_timeout,e["player-width"]=this.parent.video.offsetWidth||this.parent.video.width,e["player-height"]=this.parent.video.offsetHeight||this.parent.video.height,e["video-url"]=this.parent.video.name,e.vidlength=parseInt(this.parent.video.duration),e.sts=this.parent.repeatCount,e["vpaid-version"]=e.vpaid_version,e["auc-dast"]=e.auc_dast;var t=2;e.use_as_is||(t=0==e.plmd?e.muted?2:1:e.plmd),e.plmd=t}},{key:"volume",value:function(e){if(null!=(e=1<e?e/100:e))try{this.vpaid&&(this.vpaid.setAdVolume(e),this._volume=e)}catch(e){return 0}else try{return this.vpaid.getAdVolume()}catch(e){return 0}}},{key:"subscribeToVpaid",value:function(t){var s=this;this.eventFunctions={AdLoaded:function(e){s.parent.ga.sendGaMessage({type:"AdLoaded"})},AdVideoStart:function(e){e.dispatcher.adPlayedCounter||e.dispatcher.isBf||(this.store.incr("ads_playing"),e.dispatcher.adPlayedCounter=!0),s.finished||(e=s.getWorkingVolume(),s.volume(e),s.parent.options.onAdVideoStart(s.parent,s))},AdImpression:function(e){s.viewAdPlayer(e?e.dispatcher:void 0);var t=this.store.get("ads_playing"),i=this.store.incr("total_impressions");if(e.dispatcher.adPlayedCounter||e.dispatcher.isBf||(this.store.incr("ads_playing"),e.dispatcher.adPlayedCounter=!0),!s.finished){s.parent.ga.sendGaMessage({type:"AdImpression"},{vage:parseInt((Date.now()-e.dispatcher.created)/1e3),vpaidReadyInQue:e.vpaidReady,qsize:e.qsize,dp:e.dp,adImpInMS:e.adImpInMS,readyInMS:e.readyInMS,loadToImpMS:e.loadToImpMS,vast:e.dispatcher.vast,adsPlaying:t,totalImpressions:i,xhrErrors:e.dispatcher.xhrErrors||""});i=e.tag;s.parent.options.onAdImpression(s,e.dispatcher,i);i=s.getWorkingVolume();if(s.volume(i),s.vpaid&&!s.store.get("isMultiVpaidUnit"))try{s.vpaid.resizeAd(s.options.width,s.options.height,s.viewmode)}catch(e){console.log(e)}}},AdStopped:function(t){t.dispatcher.adPlayedCounter&&!t.dispatcher.isBf&&this.store.set("ads_playing",0),s.parent.options.onAdStopped(e.dispatcher.index,s),s.onVpaidStop()},AdVideoComplete:function(e){s.hideAdPlayer(),e.dispatcher.adPlayedCounter&&!e.dispatcher.isBf&&this.store.set("ads_playing",0),s.parent.options&&s.parent.options.onAdVideoEnd(s.parent,s)},AdError:function(e){s.onVpaidError("[VPAID-"+s.options.uid+"]::AdError","AdError",arguments),e.dispatcher.adPlayedCounter&&!e.dispatcher.isBf&&this.store.set("ads_playing",0)},AdStarted:function(){var e=s.getWorkingVolume();s.volume(e)},VpaidSpecial:function(){s.parent.ga.sendGaMessage({type:"VpaidSpecial"})},AdBlockEnabled:function(){s.parent.ga.sendGaMessage({type:"AdBlockEnabled"})},SoundViolation:function(){s.soundViolationFired||(s.soundViolationFired=!0,s.parent.ga.sendGaMessage({type:"SoundViolation"}))},HijackAttempt:function(e){s.parent.ga.sendGaMessage({type:"HijackAttempt"}),(new Image).src=Z({dataCenter:"us",baseReportD:"basebanner.com"})+"?cijs=0&ttype=5&pix=31542217&dast="+s.options.vpaidTag.auc_dast+"&"+(new Date).getTime()},AdPaused:function(e){this.store.emit("contentPaused"),s.paused=!0,s.playButton&&(s.playButton.className="vjs-play-control vjs-control vjs-playing c-paused")},AdPlaying:function(e){s.paused&&(this.store.emit("contentResumed"),s.paused=!1),s.paused=!1,s.playButton&&(s.playButton.className="vjs-play-control vjs-control"),s.finished},AdSkipped:function(){s.eventFunctions.AdStopped()}};var i,n=this.vpaidEvents;for(i in n)n[i]&&this.eventFunctions[i]&&(this.eventFunctions[i].controller=this,t.subscribe(this.eventFunctions[i],n[i]),this.on(n[i],this.eventFunctions[i]));this.on("viewAdPlayer",s.viewAdPlayer)}},{key:"trigger",value:function(e,t){this.eventFunctions.hasOwnProperty(e)&&"function"==typeof this.eventFunctions&&(this.emit(e,t),console.log("trigger event",e))}},{key:"getVpaidLogs",value:function(){if(this.vpaid)return this.vpaid.getVpaidLogs()}},{key:"getAd",value:function(e){return this.vpaid.getAd(e)}},{key:"runWaterfall",value:function(e){this.vpaid.runWaterfall(e)}},{key:"pause",value:function(){this.paused||(this.vpaid.pauseAd(),this.paused=!0)}},{key:"resume",value:function(){this.adPlaying&&this.paused&&(this.vpaid.resumeAd(),this.paused=!1)}},{key:"mute",value:function(){this.volumeBeforeMute=0===this._volume?50:this._volume,this.volume(0)}},{key:"unMute",value:function(e){this.volumeBeforeMute||(this.parentOptions.volumeBeforeMute=this.volumeBeforeMute=e||50),this._volume=e,this.volume(this._volume)}},{key:"setPaused",value:function(e){this.paused=e}}])&&fs(t.prototype,i),n&&fs(t,n),s}();function ys(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var bs=500,_s=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.schedule={},this.parent=e,this.savedTime=-1,this.runningVpaid=!1,this.runningVpaidTagData={},this.runTimeId=0,this.bug_feature=e.options.bug_feature,this.vpaidCount=0,this._firstImpression=!1,this.minTimeBetweenRuns=5e3,this.store=t,this.lastEndedPlayedVpaid=-1e6,this.timeBetweenAds=this.store.get("schedule_auto"),this.store.on("stop",this.stop.bind(this)),this.useNewScheduler=this.store.get("evtbsschdl"),this.useNewScheduler&&(this._bindedLoop2=this._loop2.bind(this),this._bindedOnVpaidReady=this._onVpaidReady.bind(this),this._bindedOnVpaidEnded=this._onVpaidEnded.bind(this),this.loop2Ticker=setInterval(this._bindedLoop2,bs))}var e,t,s;return e=i,(t=[{key:"stop",value:function(){this.stopped=!0,window.clearTimeout(this.runTimeId),this.runningVpaid&&!this.runningVpaid.finished?this.runningVpaid.stop():this.parent,this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0,this.useNewScheduler&&(this.store.off("vpaidReady",this._bindedOnVpaidReady),this.store.off("vpaidEnded",this._bindedOnVpaidEnded),clearInterval(this.loop2Ticker))}},{key:"stopVpaid",value:function(){this.runningVpaid&&!this.runningVpaid.finished&&this.runningVpaid.stop()}},{key:"start",value:function(){window.clearTimeout(this.runTimeId),this.useNewScheduler?(this.vpaidToRun={vpaid:this.schedule["00:00"],time:"00:00"},this.store.on("vpaidReady",this._bindedOnVpaidReady),this.store.on("vpaidEnded",this._bindedOnVpaidEnded),this._bindedLoop2()):this._loop()}},{key:"disable",value:function(){this.isDisabled=!0}},{key:"_onVpaidReady",value:function(e){this._loop2()}},{key:"_onVpaidEnded",value:function(e){e.hadImpression&&(this.lastEndedPlayedVpaid=Date.now()),this._loop2()}},{key:"_loop2",value:function(){this.stopped||this.store.get("playerClosed")||this.isDisabled||0!==this.store.get("ads_started")||Date.now()-this.lastEndedPlayedVpaid>=1e3*this.timeBetweenAds&&this.runVpaid(this.vpaidToRun.vpaid,this.vpaidToRun.time)}},{key:"_loop",value:function(){if(!this.isDisabled){window.clearTimeout(this.runTimeId);var t=this,e=Math.floor(this.parent.video.currentTime);if(this._isContentPaused()&&(e=NaN),1===this.timeBetweenAds||e!=this.savedTime&&!isNaN(e)&&"repeating"!=this.parent.status){this.savedTime>e&&(this.savedTime=-1);var i=(new Date).getTime();if(i-this.lastRun<this.minTimeBetweenRuns)return void(t.runTimeId=window.setTimeout(function(){t._loop()},1e3));isNaN(this.savedTime)&&(this.savedTime=0);var s=this.savedTime+1;e<s&&(s=e);for(var n={vpaid:!1,time:0};s<=e;){var r=this.parent.secondsToString(s);this.schedule[r]&&(n.vpaid=this.schedule[r],n.time=r),s++}n.vpaid&&(window.lastRun=Date.now(),this.runVpaid(n.vpaid,n.time)&&(this.lastRun=i)),this.savedTime=e}t.runTimeId=window.setTimeout(function(e){t._loop()},700)}}},{key:"_isContentPaused",value:function(){return this.parent.video&&this.parent.video.paused}},{key:"runVpaid",value:function(e,t){return this.runningVpaidTagData=e,this.vpaidCount++,e.vpaidCount=this.vpaidCount,this.runningVpaid?this.runningVpaid.run():(this.runningVpaid=new gs({isFirstImpression:this.isFirstImpression,vpaidTag:e,uid:t,parent:this.parent,isPreRoll:"00:00"===t&&0===this.vpaidCount},this.parent.options,this.store),!0)}},{key:"_checkFirstImpression",value:function(){var e=!this._firstImpression;return this._firstImpression=!0,e}},{key:"isFirstImpression",get:function(){return this._checkFirstImpression.bind(this)}},{key:"getTagData",value:function(){return!!this.gotVpaid&&this.runningVpaidTagData}},{key:"tagVolume",set:function(e){this.runningVpaidTagData.volume=e}},{key:"vpaid",get:function(){return this.gotVpaid?this.runningVpaid.vpaid:{}}},{key:"gotVpaid",get:function(){return!(!this.runningVpaid||this.runningVpaid.finished||!this.runningVpaid.vpaidCreated)}},{key:"getVpaidLogs",value:function(){if(this.runningVpaid)return this.runningVpaid.getVpaidLogs()}}])&&ys(e.prototype,t),s&&ys(e,s),i}();function ws(){var e={};try{e=window.cmTag.config}catch(e){return{}}var t,i={};for(t in e)0===t.indexOf("player.settings.")&&(i[t.substr(16,t.length-16)]=function(e){if(/^\d+$/.test(e))return parseInt(e);if(/^true$|^false$/g.test(e))return"true"===e||!0===e;return e}(e[t]));return i}function As(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ks=s(6),Ts=function(){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),ks.mixin(this),this._maxListeners=100,this.data={},Object.assign(this.data,e);var t="10.5.6001",t=(this.data.full_player_version="10.5.6001").replace(/\./g,"");t=parseInt(t),this.data.debugLevels=e.debug||"",this.data.debug=-1!=e.debug.indexOf("*"),this.data.player_version=t;var i="",s="",t="";try{s=e.unit_name,i=e.abTest,t=e.unit_main_version}catch(e){}this.data.ab_test=i,this.data.unit_type=s,this.data.unit_version=t,this.data.session_started=Date.now(),this.data.secured_protocol="https:"===(window&&window.location&&window.location.protocol),window.cmTag&&window.cmTag.config&&window.cmTag.config.contentClickUrl&&(this.data.contentClickUrl=window.cmTag.config.contentClickUrl),S=this}var e,t,i;return e=n,(t=[{key:"incr",value:function(e){Cs.exists(e,this.data)||Cs.set(e,0,this.data);var t=Cs.get(e,!0,this.data)||0;if("number"==typeof t)return Cs.set(e,t+1,this.data),Cs.get(e,!1,this.data)}},{key:"decr",value:function(e){var t=Cs.get(e,!1,this.data);if("number"==typeof t)return Cs.set(e,t-1,this.data),Cs.get(e,!1,this.data)}},{key:"get",value:function(e){return-1===(e=e.toString()).indexOf(".")?this.data[e]:Cs.get(e,!1,this.data)}},{key:"getByTech",value:function(e,t){var i=this.get("dsm")||{};return i&&i.hasOwnProperty(t)&&i[t].hasOwnProperty(e)?i[t][e]:null}},{key:"getByAdInline",value:function(e){var t=this.get("dsm")||{};if(0<Object.keys(t).length)for(var i=new RegExp(Object.keys(t).join("|"),"gi"),s=0;s<e.length;s++){var n=e[s],n=n.as&&n.as.match(i)||n.at&&n.at.match(i);if(n&&0<n.length)return t[n[0].toLowerCase()]}return this.get("adstngs")}},{key:"getLatestVersion",value:function(e){e=e.toString();var t="".concat(e,"_latest"),i=this.get(t);if(void 0!==i)return i;var s,n,r=new RegExp("".concat(e,"[v]*\\d+$")),a={value:void 0,version:0};for(s in this.data)r.exec(s)?(n=parseInt(s.match(/\d+$/)[0]),(!a.value||a.version<n)&&this.data[s]&&(a.version=n,a.value=this.data[s])):0===a.version&&s===e&&(a.value=this.data[s]);return this.set(t,a),a}},{key:"set",value:function(e,t){e=e.toString(),Cs.set(e,t,this.data)}},{key:"getWfData",value:function(){var e,t=this.get("dsm")||{},i=[];for(e in t)/^\d+$/.test(e)&&t[e]&&t[e].hasOwnProperty("ftchVst")&&i.push({id:e,fv:t[e].ftchVst});return i}}])&&As(e.prototype,t),i&&As(e,i),n}(),Cs={set:function(e,t,i){var s=e.split("."),e=s.pop(),i=Es(s,!0,i);return i&&e?i[e]=t:void 0},get:function(e,t,i){return Es(e.split("."),t,i)},exists:function(e,t){return void 0!==this.get(e,!1,t)}};function Es(e,t,i){for(var s,n=i||data,r=0;n&&(s=e[r]);r++)n=s in n?n[s]:t?n[s]={}:void 0;return n}function Ps(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Vs=0,Ss=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.store=e,this.parent=t,this.initVpaid(),this.hadFirstImpression=!1}var e,t,s;return e=i,(t=[{key:"initVpaid",value:function(){var e=this.getVpaidTag();this.store.set("contentSchedule",{"00:00":e,"00:01":e}),this.store.set("autoplay_on_pre_roll",!1),this.vpaidHandler=new gs({isFirstImpression:this.isFirstImpression,vpaidTag:e,uid:Vs++,parent:this.parent},this.parent.options,this.store),this.vpaidHandler.runWaterfall("vforceInit")}},{key:"getVpaidTag",value:function(){var e=this.store.get("schedule"),t={};return e.forEach(function(e){e&&"pre-roll"===e.roll_type&&(t=e)}),t}},{key:"isFirstImpression",value:function(){return!this.hadFirstImpression&&(this.hadFirstImpression=!0)}},{key:"getVpaidLogs",value:function(){if(this.vpaidHandler)return this.vpaidHandler.getVpaidLogs()}},{key:"getAd",value:function(e){return this.vpaidHandler.getAd(e)}},{key:"stop",value:function(){this.vpaidHandler&&!this.vpaidHandler.finished?this.vpaidHandler.stop():this.parent&&this.parent._onVpaidClosed(),this.vpaidHandler=void 0,this.schedule=void 0,this.parent=void 0,this.savedTime=-1}},{key:"pause",value:function(){this.vpaidHandler.pause()}},{key:"resume",value:function(){this.vpaidHandler.resume()}},{key:"volume",value:function(e){this.vpaidHandler.volume(e)}},{key:"mute",value:function(){this.volume(0)}},{key:"unmute",value:function(e){this.volume(e)}},{key:"resize",value:function(e,t,i){this.vpaidHandler.resize(e,t,i)}}])&&Ps(e.prototype,t),s&&Ps(e,s),i}();function Ds(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Is=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._stopwatchs=[]}var t,i,s;return t=e,(i=[{key:"startSampling",value:function(){var e=new Si;return this._stopwatchs.push(e),e.start(),this._stopwatchs.length-1}},{key:"stopSampling",value:function(e){this._stopwatchs[e].stop()}},{key:"getDuration",value:function(e){return this._stopwatchs[e].duration()}},{key:"runOneEventLoopSampling",value:function(){var i=this;return new Promise(function(e){var t=i.startSampling();setTimeout(function(){i.stopSampling(t),e(i.getDuration(t))},0)})}},{key:"runEventLoopSampling",value:function(n,r){var a=this;return new Promise(function(t){var e=[],i=0,s=setInterval(function(){i<n?(e.push(a.runOneEventLoopSampling()),i++):(clearInterval(s),Promise.all(e).then(function(e){e=e.reduce(function(e,t){return Math.max(e,t)},0);t(e)}))},r)})}},{key:"cleanResources",value:function(){this._stopwatchs.length=0}}])&&Ds(t.prototype,i),s&&Ds(t,s),e}();function xs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Os=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._store=e,this._intervalDuration=this._store.get("kpitrvldrt"),this._numOfSamplesPerMeasurment=this._store.get("prfsmpmsnt"),this._durationOfSamplePerMeasurment=this._store.get("prfsmitrvpmsnt"),this._playerOpportunityManager=t,this.dataSaverUrl=this._store.get("dtsvrurl"),this._addListeners(),this._startLoopTimeInterval(),this._measure(),this._runFirstMeasurmentCycle()}var e,t,s;return e=i,(t=[{key:"_addListeners",value:function(){this._store.once("stop",this._onStop.bind(this)),this._store.once("beforeunload",this._onBeforeunload.bind(this))}},{key:"_startLoopTimeInterval",value:function(){var e=this._store.get("msrkpifctr")||100;1!==(e=Math.min(100,e))&&L(0,e)!==e||(e=Y(this._store.get("msrkpiintvl")||15),this._loopInterval=setInterval(this._sendLoopKpiPixel.bind(this),e))}},{key:"_sendLoopKpiPixel",value:function(){var e=J(me.KPI,this._store);e.kpipm=this._store.get("performance.performanceMeasurment"),e.kpinw=this._store.get("performance.wfRoundTripAverageDuration"),$(e,this._store)}},{key:"_measure",value:function(){var e=this;this._running=!0,this._runSampling("first_kpi"),this.intervalMeasureId=setInterval(function(){e._runSampling("last_kpi")},this._intervalDuration)}},{key:"_runSampling",value:function(t){var i=this,s=new Is;s.runEventLoopSampling(this._numOfSamplesPerMeasurment,this._durationOfSamplePerMeasurment).then(function(e){i._store.set(t,e),i._saveData(e),s.cleanResources()}),this._measureDataSaverRoundtripDuration()}},{key:"_measureDataSaverRoundtripDuration",value:function(){var e,t,i=this;this.dataSaverUrl&&(e=(new Date).getTime(),(t=new XMLHttpRequest).onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&i._store.set("performance.dtsvrRoundTripAverageDuration",(new Date).getTime()-e)},t.open("GET",this.dataSaverUrl,!0),t.send(null))}},{key:"_sendOpp",value:function(e){this._playerOpportunityManager.send(e)}},{key:"_runFirstMeasurmentCycle",value:function(){var t=this;(new Is).runOneEventLoopSampling().then(function(e){t._saveData(e),t._sendOpp(l.a.firstWfMeasurment)})}},{key:"_saveData",value:function(e){this._store.set("performance.wfRoundTripAverageDuration",this._store.get("waterfall_data.average_duration")),this._store.set("performance.performanceMeasurment",Math.round(e))}},{key:"_onBeforeunload",value:function(){this._destroy()}},{key:"_onStop",value:function(){this._destroy()}},{key:"_destroy",value:function(){this._running&&(clearInterval(this.intervalMeasureId),clearInterval(this._loopInterval),this._running=!1,this._saveData(this._store.get("last_kpi")),this._sendOpp(l.a.playerClosedMeasurment))}}])&&xs(e.prototype,t),s&&xs(e,s),i}();function Ms(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Rs=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.data=[],this.useOppsula=this.store.get("usopsla")&&this.store.get("cmbopps"),this.oppsula=this.store.get("oppsula"),this.useOppsula&&!this.oppsula&&this.store.once("oppsulaCreated",this._onOppsulaCreated.bind(this)),this.store.once("waterfallData",this._onWaterfallData.bind(this)),this.store.once("mainVpaidCreated",this._onMainVpaidCreated.bind(this))}var e,i,s;return e=t,(i=[{key:"send",value:function(e){this.opportunityManager?this.opportunityManager.send(this._fixedItem,e):this.data.push(e)}},{key:"_sendData",value:function(){var t=this;this.data.forEach(function(e){t.send(e)}),this.data=[]}},{key:"_onWaterfallData",value:function(e){this._fixedItem||(this._fixedItem=e.tags[0],this._createNewPom())}},{key:"_onOppsulaCreated",value:function(e){this.oppsula=e,this._createNewPom()}},{key:"_createNewPom",value:function(){this._fixedItem&&this.config&&(this.useOppsula&&!this.oppsula||this._fixedItem&&this.config&&(this.opportunityManager=new Ai({CM_DOMAIN:this.config.creatives.CM_DOMAIN,AUC_DAST:this.config.creatives.AUC_DAST,sequenceId:this._fixedItem.sequenceId,ST:this.config.creatives.ST,STS:this.config.creatives.STS,SDID:this.config.creatives.SDID,PT:this.config.creatives.PT,PV:this.config.creatives.PV,WP:this.config.creatives.WP,VPD:this.config.creatives.PUBID,VPTD:this.config.creatives.TAGID,VMT:this.config.creatives.VMT},this.store),this._sendData()))}},{key:"_onMainVpaidCreated",value:function(e){this.config=e}}])&&Ms(e.prototype,i),s&&Ms(e,s),t}();function Fs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ls=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.baseUrl=e}var e,i,s;return e=t,(i=[{key:"load",value:function(e,t,i){e&&e.length&&window.cmTag&&(this._setWindowLoaderObject(),this._registerOnLoaderResponse(t),this._loadScript(e,t,i))}},{key:"_setWindowLoaderObject",value:function(){window.cmTag.cmLoader||(window.cmTag.cmLoader={addLoaderCb:function(e,t){window.cmTag.cmLoader[e]=window.cmTag.cmLoader[e]||{callbacks:[]},window.cmTag.cmLoader[e].callbacks.push(t)}})}},{key:"_registerOnLoaderResponse",value:function(e){window[e]||(window[e]=function(t){window.cmTag.cmLoader[e].callbacks.map(function(e){try{e(t)}catch(e){}})})}},{key:"_loadScript",value:function(e,t,i){window.cmTag.cmLoader.addLoaderCb(t,i);i=document.createElement("script");i.src=this.baseUrl+e,document.body.appendChild(i)}}])&&Fs(e.prototype,i),s&&Fs(e,s),t}();s(32),s(33),s(34);function Bs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ws=s(9),Us=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),pe("videoDependenciesLoader",Ee.START),this.ServiceLoader=Ws,this.ServiceLoader.init(e.data),this.store=e,this.baseUrl=this.store.get("base_url"),this.JSONPHandler=new Ls(this.baseUrl),this.dependenciesProperties=ei,this._loadVpaidResources(),pe("videoDependenciesLoader",Ee.STOP)}var e,i,s;return e=t,(i=[{key:"_loadResource",value:function(t,i,s){var n,r=this;this.stopped||this.ServiceLoader.get(t.serviceKey,t.version,n=function(e){r.stopped||(r.store.get(t.storeDataKey)||r.store.set(t.storeDataKey,e),i&&i(e))},function(){var e;r.stopped||((e=r.store.get(t.jsonpCallbackName))?r.JSONPHandler.load(t.path,e,function(e){e?n(e):s&&s()}):s&&s())})}},{key:"_loadScript",value:function(e,t){var i,s;this.stopped||(i=document.createElement("script"),s=document.getElementsByTagName("script")[0],i.src=this.baseUrl+this.store.get(e.storePathKey),s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()})}},{key:"_loadHJK",value:function(t){var i=this;t=Object.assign(t,this.dependenciesProperties.hjk),this._loadResource(t,function(e){e=i._replaceResourcePlaceholders(e),i.store.set(t.storeDataKey,e)})}},{key:"_loadVpaidAnalytics",value:function(e){e=Object.assign(e,this.dependenciesProperties.vpaidAnalytics),this._loadResource(e)}},{key:"_loadVpaidCrawler",value:function(t){var i=this;t=Object.assign(t,this.dependenciesProperties.vpaidCrawler),this._loadResource(t,function(e){e=i._replaceResourcePlaceholders(e),i.store.set(t.storeDataKey,e)},this._loadHJKAndAnalytics.bind(this))}},{key:"_loadVpaidResources",value:function(){this.stopped||(this._loadVpaidCrawlerResources(),this._loadDSM())}},{key:"_loadVpaidCrawlerResources",value:function(){var e;this.stopped||(e=this._getCleanResourceVersionAndPath(this.dependenciesProperties.vpaidCrawler.storePathKey,this.dependenciesProperties.vpaidCrawler.versionRegex),this._canLoadResourceFromObj(e)?this._loadVpaidCrawler(e):this._loadHJKAndAnalytics())}},{key:"_loadHJKAndAnalytics",value:function(){var e=this._getCleanResourceVersionAndPath(this.dependenciesProperties.hjk.storePathKey,this.dependenciesProperties.hjk.versionRegex);this._canLoadResourceFromObj(e)&&this._loadHJK(e);e=this._getCleanResourceVersionAndPath(this.dependenciesProperties.vpaidAnalytics.storePathKey,this.dependenciesProperties.vpaidAnalytics.versionRegex);this._canLoadResourceFromObj(e)&&this._loadVpaidAnalytics(e)}},{key:"_loadDSM",value:function(){var e=this,t=this._getCleanResourceVersionAndPath(this.dependenciesProperties.dsm.storePathKey,this.dependenciesProperties.dsm.versionRegex);this._canLoadResourceFromObj(t)&&(t=Object.assign(t,this.dependenciesProperties.dsm),this._loadResource(t,null,this._loadScript.bind(this,t,function(){e.store.set(e.dependenciesProperties.dsm.storeDataKey,cmTag.dSettings)})))}},{key:"_canLoadResourceFromObj",value:function(e){return e&&e.version&&e.path}},{key:"_getCleanResourceVersionAndPath",value:function(e,t){e=this._getVersionObj(e);return e?{version:this._extractResourceVersion(e,t),path:e.value}:null}},{key:"_getVersionObj",value:function(e){e=this.store.getLatestVersion(e);return e&&e.value?e:""}},{key:"_extractResourceVersion",value:function(e,t){t=e.value.match(t);return!t||t.length<2?"":t[1]}},{key:"_replaceResourcePlaceholders",value:function(e){if(!this.stopped){var t=this.store.get("hjkbldomsencdd");return t&&0!==t.length||(t=this.store.get("hjkbldoms")),e.replace('"%%%TEMP%%%"',G(t)).replace('"%%%IS_DEBUG%%%"',this.store.get("debug"))}}},{key:"destroy",value:function(){this.stopped||(this.stopped=!0,this.ServiceLoader=this.JSONPHandler=this.store=this.dependenciesProperties=void 0)}}])&&Bs(e.prototype,i),s&&Bs(e,s),t}();function Hs(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var js=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.effectiveTypes={"slow-2g":1,"2g":2,"3g":3,"4g":4},this.types={bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7,unknown:8},this.navigatorConnection={},this._detectConnectionType()}var e,i,s;return e=t,(i=[{key:"_detectConnectionType",value:function(){var s=this,e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?(e.onchange=function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t=e.effectiveType||"",i=e.type||"";s.navigatorConnection={browserSupport:!0,downlink:e.downlink||0,effectiveType:t,type:i,effectiveTypeId:s.effectiveTypes.hasOwnProperty(t)?s.effectiveTypes[t]:0,typeId:s.types.hasOwnProperty(i)?s.types[i]:0,rtt:e.rtt||0,saveData:e.saveData||!1},s.store.set("navigatorConnection",s.navigatorConnection),s.store.emit("navigatorConnectionChange",s.navigatorConnection)})():(this.navigatorConnection={browserSupport:!1},this.store.set("navigatorConnection",this.navigatorConnection))}}])&&Hs(e.prototype,i),s&&Hs(e,s),t}();function Ns(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var qs=function(){function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.store=e,this.browser=this.store.get("wurfl.browser.name"),this.browserMajorVersion=this.store.get("wurfl.browser.version"),this._detectPrivateMode(function(e){t.store.set("isPrivateBrowsing",void 0===e?"cannot detect":e?"private":"not private")})}var e,t,s;return e=i,(t=[{key:"_detectPrivateMode",value:function(t){var i,s;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){i=!1},function(e){i=!0});else if(window.indexedDB&&"Firefox"===this.browser){try{s=window.indexedDB.open("test")}catch(e){i=!0}void 0===i&&this._retry(function(){return"done"===s.readyState},function(e){e||(i=!s.result)})}else if(this._isIE10OrLater()){i=!1;try{window.indexedDB||(i=!0)}catch(e){i=!0}}else if("Safari"===this.browser)if(this.browserMajorVersion<11)try{i=(localStorage.length||(localStorage.x=1,localStorage.removeItem("x")),!1)}catch(e){i=!!navigator.cookieEnabled}else try{window.openDatabase(null,null,null,null),i=!1}catch(e){i=!0}this._retry(function(){return void 0!==i},function(e){t(i)})}},{key:"_isIE10OrLater",value:function(){return"IE"===this.browser&&10<=this.browserMajorVersion||"Edge"===this.browser}},{key:"_retry",value:function(e,t){var i=0,s=!1,n=window.setInterval(function(){e()&&(window.clearInterval(n),t(s)),50<i++&&(window.clearInterval(n),t(s=!0))},10)}}])&&Ns(e.prototype,t),s&&Ns(e,s),i}();s(17).polyfill();var zs=s(9);s(35);function Gs(n){var t=this;this.overrideWindowMethods=function(){Object.assign=function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}},this._reportToPlayerOptions=function(){var e=Object.assign({},this.store.data);ae(e,this.store.get("rmplyroptns")),O("player_options","ctor1",{type:"debug",message:"ctor1",options:e},this.store)},null!=Object.assign&&z(Object.assign)||this.overrideWindowMethods(),this.status="loading",this.videoLength=0,this.ga_set=!1,this.video=void 0,this.repeatCount=0,this.schedule={},this.playerIsClosed=!1,this.options=function(e){var t,i={domain:window.location.hostname,cirf:"",referrer:document.referrer?document.referrer.split("//")[1]:window.location.hostname,vertical:"default",auc_dast:"0",title:"",description:"",keywords:"",default_ad_parameters:"",files:[],image:!1,target_id:"",height:!1,width:!1,controls:!0,aspect_ratio:"16:9",repeat:!0,mute:!1,oid:0,default_ad_timeout:30,volume:0,video_class_name:"video-js vjs-default-skin",schedule:[],schedule_auto:1,min_vpaid_run_time:4,debug:[],htmlVideoSupport:!!document.createElement("video").canPlayType,ga_factor:1,fire99:!0,ad_controls:!1,time_between_waterfall:10,tmbtwfs:function(e,t,i,s){return i.get("time_between_waterfall")},mntmbtwfsf:function(e,t,i,s){return i.get("mintimwf")},mintimwf:5e3,mntmbtwfs:5,mxtmbtwfs:900,queue_size:6,max_ready_vpaid:3,waterfall_watermark:0,base_url:"//vidstat.taboola.com",wf_path:"VideoBidRequestHandlerServlet",run_wf_when_empty:!0,kaxwnc:18e5,pstflrs:!0,pvpd:"javascript",pvidtp:"",sncad:!1,blkflshjs:!0,altmot:6e4,adimptmot:0,prtctv2:"/vpaid/hjk.214.js",hjkclb:"HijackResponse",jsnoflshdtct:!1,qsrtscr:function(e,t){return 100*t.alfrox},psthdrs:"text/plain",rstmrai:!0,vstprxy:!1,pxyurl:"http://vid.mikysrv.com/fetch?url=",global_ad_timeout:18e4,mprdct:void 0,uscnvsmpg:!0,forcecnvsmpg:!1,gtvid2:"//mpg.taboola.com/getts?url",cnvsldrt:5,mpgclrslv:["gcdn.2mdn.net"],dsu:"/vpaid/ds/117/dsm.js",run_wf_on_init:!0,useapforcntnt:!1,wf_dynmc_ps:!0,sprssviderr:!1,vForce:!1,get_ad_timeout_seconds:10,wf_manual:!1,disctxt:"By Taboola",httpsOverride:!0,usscrtgurl:!1,evtbsschdl:!0,timbtopps:2e3,cmbopps:!0,anltcsurlv4:"",anltcsurlv5:"",anltcsclb:"VpaidAnalytics",anltcsOptions:{withXHR:!0,withIframes:!0,withScripts:!0,maxNetworkCalls:0,timeout:3e3,deepIframes:!0},moat:!1,measureKPI:!1,prfsmpmsnt:5,prfsmitrvpmsnt:1500,kpitrvldrt:15e3,msrkpifctr:0,msrkpiintvl:15,moatPartnerCode:"taboolajsvideo2446883476",sndvltopp:!0,novdtrm:!1,dcdvdurl:!1,firstWaterfallNoaop:0,mxlifls:0,kbnul:"//vidanalytics.taboola.com",frcmtfrms:!0,frcvlm:!1,pxlnotsmtp:!1,cntonvfrc:!0,mxemptwf:0,dtsvrurl:"//vidutils.taboola.com",mltads:!1,erlyai:!1,frcadvlmtrvl:1e3,dbncadvltm:50,stpfrcvlevnt:"AdVideoFirstQuartile",imapihok:!1,trmrdyvpaid:!0,dfltvlm:.4,usstrckisyn:!1,dlywf:!1,adto:3e5,vakll:3e5,ovrtgbydc:!1,strgprvdrttl:6048e5,frstlk:!1,pusvidprtctn:!1,encwfrs:!1,dsktmouttoadcmpltn:0,mbltmouttoadcmpltn:0,wfv:1,aderrbfradlddopactv:!0,isMultiVpaidUnit:!1,hdeadsplypusbtn:!0,isIdleMode:!1,mttst:"",mxntwrkclls:80,rplvpdactv:!1,rvfctr:0,dnapmxvl:0,usopsla:!0,opslavrsn:"1.3.8",mcrsrvcsnmspc:"trc",bllblevt:"1,25,21,22,23,24",ifrmswghts:{gen:15,ggl:6,pxls:30},dskVidMuted:!0,ovrdnonntvfnclst:{},fkadchcs:!1,istblvpd:!1,mtdhkactv:!1,addprld:!0,blckbrngtofrnt:!1,tglifrmcntndsplyactv:!1,cmpltonstpddmn:["innovid.com"],cmpltonstpdms:0,aduntldflbfruntld:!1,adwrprstoplrdst:!0,bckflldlyms:1e4,mxbckflldlyitms:0,bfprty:0,lgvpdtxtelmnts:!1,shwadmtebtn:!0,wtfradpsdbfrrsmad:!1,mtfctr:0,noplrcntr:!1,vpdcntrcstmcss:"",flbktovdo:!0,dsbgl:!0,cntdwnrgx:"",msnifrmsrchk:!0,prvaupl:!0,stpvpdonudfndsrc:!0,sprtnnvidvpd:!0,adxcrdgtadtmt:5e3,adtnladxsprtdszs:[],stpvpdonrltvsrc:!1,rvfrquesttsemttr:!0,cntgtad:!0,dftgprc:void 0,scrmf:!0,hjkbldoms:[],rtryonfl:!1,hjkbldomsencdd:[],cpcvcmpgntps:[14,17],cstmdltps:{tags:7,dCPM:9,externalCPCV:14,internalCPCV:17},dtctcmp:!1,dtctcmpfctr:0,comp:{},cmpdtctv:"1.0.0",vidautoplydtctv:"1.0.0",drpbletps:["singleAd","adjacencyAd"],vdelv:"2.2.17",rplcpxlmcrplchldr:!0,erronopp:!0,dtctprvtbrwsng:!0,plcntbfrads:!0,sndvptmrst:!1,frwferrpxls:0,hdtrgt:!1,spprtvrtclvd:!0,prvnterlyadimpopp:!1,untetrk:["viewability","viewable50precent1sec","fullyviewable1sec"],vdtck:0,htsptdflt:{pos:"bottom-left",txtclr:"white",mrgn:20,lbl:""},frwfpssbckrpxl:0,wtchvdointrvl:1e3,rprtvidsttsintrvl:1e3,q5byprgrss:!0,mnvlddrtn:.1,frgtadpxls:100,frmltplpxls:["AdPaused","AdClickThru","AdPlaying"],rprtbuffrng:0,wtchprgrssopp:0,mblmdiadrctdmnd:!1,plyngevnttmt:100,rmvwflg:["postData","response",new RegExp("tagResponse_.*"),"navigatorConnection"],rmplyroptns:["red_id","rmvwflg"],firstWfRes:void 0,blckngtgcnvrsncnt:5,fmli:void 0,fmpw:"",dlyimpnonmoatrv:void 0,updtcmpbfrwf:!0,rgxdcdd:[],firedsplyimp:!1,rprtwrpropntime:!1,addcdatavst:!0,wfgenv:"1.1.4",aduntladtmt:1e4,mnbfrsz:1,prftchmxlngth:60,imscrptsrc:"//imasdk.googleapis.com/js/sdkloader/ima3.js",sprtxtrnlplyrs:!0,xtrnlplyrstyps:[28],xtrnlplyrsmngrv:"2.4.0",xtrnlplyrsmngragg:!1,xtrnlplyrsmngrpshintrvl:5e3,vdgtrpxmthd:function(){return 0},adtrgtcss:!1,wtuntlcntrinvw:!1,cntrelm:"",firpbidpxl:!1,sndgdprprmswf:!1,prbdjsv:"1.0.2",prbdjse:!0,isprbdprc:!0,prbdcch:!1,prbdcchul:"https://prebid.adnxs.com/pbc/v1/cache",prfrmncmsrmnts:!1,onPlayerReady:function(e){},onPlayerLoadError:function(e){},onPlayerError:function(e){},onPlayerPlay:function(e){},onPlayerStop:function(e){},onPlayerClose:function(e){},onPlayerPause:function(e){},onPlayerResume:function(e){},onPlayerSeek:function(e){},onPlayerRepeat:function(e){},onPlayerComplete:function(e){},onAdLoadError:function(e,t){},onAdError:function(e,t){},onAdStopped:function(e,t){},onAdImpression:function(e,t){},onAdVideoStart:function(e,t){},onAdVideoEnd:function(e,t){},onAdClick:function(e,t,i){}};for(t in i)null==e[t]&&(e[t]=i[t]);e.description||(e.description=e.title),e.keywords||(e.keywords=e.title),parseFloat(e.width)||parseFloat(e.height)||(e.width="377",e.height="314");var s=parseInt(100*Math.random())+1<=e.ron_percent;return e.tagDefault={ad_controls:e.ad_controls,url:"",pubid:"",tagid:"",vidlength:"",video_url:e.files[0],title:e.title,cirf:e.cirf,description:e.description,keywords:e.keywords,ad_parameters:e.default_ad_parameters,muted:e.mute?1:0,auc_dast:e.auc_dast,referrer:e.referrer,domain:e.domain,vertical:e.vertical,roll_type:"mid-roll",oid:e.oid,ad_timeout:e.default_ad_timeout,rs:"1",st:"1",sts:"1",type:"wf",noaop:"10",sortOrderType:0,mfp:4,afbp:e.use_flash_bypass,isRon:s,isvideo:0,mindur:1,maxdur:e.default_ad_timeout,minbr:1,maxbr:1e4,plmd:0,defaultTagTimeout:30,totaltimeout:60,use_as_is:!1,skip_vast:!1},e}(n);var i=Object.assign(ws(),n.dplayerSettings);this.options=Object.assign({},this.options,i);var s=new Ts(this.options);this.store=s,this.store.get("firedsplyimp")&&$(J(me.playerDisplayImpression,this.store)),this.store.set("player_id",Date.now()+"_"+W(30)),this.store.set("fullPageUrl",window.location.href),this.store.set("forcePause",!1),this.store.set("forceMute",!1),this.store.set("dataSaverDetected",!1),this.store.set("conversionsCount",0),this.store.set("failsCount",this.store.get("failsCount")||0),this.store.set("getAdData.count",0),this.store.set("playerAspectRatio",this.options.aspect_ratio),this.store.set("noplrcntr",this.store.get("noplrcntr")&&this.store.get("isMultiVpaidUnit")),this.store.set("isAmp",window.TRC&&window.TRC.isAMP),zs.init(this.store.data),zs.get("video-element",this.store.get("vdelv"),function(e){t.store.set("videoElement",e)}),d.prototype.debugLevels=this.store.get("debugLevels")||"",this.logConnectionType=function(e){var t="unknown",i={1:"dialup",2:"wired",3:"wifi",4:"mobile",5:"satellite"};e&&(t=i.hasOwnProperty(e)?i[e]:e.toString()),this.store.set("connectionType",{type:t})},this._preventAutoplay=!this.store.get("isMobile")&&this.store.get("prvaupl")&&-1<this.store.get("wurfl.browser.name").indexOf("Firefox"),pe("videoDastDecoder",Ee.START);var r=le(n.auc_dast,function(){t.store.set("dastDecoderError",G(e))});pe("videoDastDecoder",Ee.STOP),r&&(r.sesid&&this.store.set("sessionId",r.sesid),this.logConnectionType(r.ct)),this.store.set("dast",r),r.hasOwnProperty("abt")&&(this.store.set("dast_AbTest",r.abt),this.store.set("abTest",this.store.get("abTest")?"".concat(this.store.get("abTest"),"|").concat(r.abt):r.abt));i=this.store.get("isMobile"),r=this.store.get("measureKPI");(i||r)&&(this.playerOpportunityManager=new Rs(this.store)),this.store.get("base_url")&&0!==this.store.get("base_url").length||(this.store.set("original_base_url","empty"),this.store.set("href",window.location.href),this.store.set("base_url","//www.cmbestsrv.com")),this.connectionTypeDetector=new js(this.store),this.store.get("dtctprvtbrwsng")&&(pe("videoPrivateBrowsingDetector",Ee.START),this.privateBrowsingDetector=new qs(this.store),pe("videoPrivateBrowsingDetector",Ee.STOP)),this.store.set("queueLength",0),this.store.set("vpaidReadyCount",0),this.store.set("document.visible",!document.hidden),this._reportToPlayerOptions(),s.set("ads_playing",0),s.set("ads_started",0),s.set("total_impressions",0),this.dependenciesLoader=new Us(this.store),r&&(this.KPIsRecorder=new Os(this.store,this.playerOpportunityManager)),this.options.schedule&&this.options.schedule.length&&this.options.schedule[0].ad_parameters&&2<this.options.schedule[0].ad_parameters.length&&s.set("static_schedule",this.options.schedule),this.overrideNonNativeFunctions=function(){var e=this.store.get("ovrdnonntvfnclst");if(0<Object.keys(e).length){var t,i=document.createElement("iframe");for(t in i.style.width=0,i.style.height=0,i.style.visibility="hidden",i.style.display="none",document.body.appendChild(i),e)z(window[t])||(window[t]=e[t](i))}},this.overrideNonNativeFunctions(),this.isMobile=this.store.get("isMobile"),function(){{var e,t;this.isMobile&&(e=this.store.get("forcecnvsmpg"),t=this.store.get("useapforcntnt"),!e||t||this.fallbackToCanvasFired||this.playerOpportunityManager.send(l.a.fallBackCanvas))}}.call(this),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit");var a=this;window.addEventListener("beforeunload",function(e){t.store.emit("beforeunload")}),this.store.on("AdImpression",function(){a.killAfterXWithNoConversion()}),this.playerStatus="content",this.store.on("AdPlayerVisible",function(){var e;this.playerIsClosed||(this.playerStatus="ad",e={playerState:this.playerStatus,isVisible:!1},this.VideoControls&&(this.isMobile?this.VideoControls.setState(e):(this.wasContentPausedBeforeAd=this.VideoControls.getValueFromControlsState("isPaused"),e.isPaused=!1,this.VideoControls.setState(e),this.runningVpaid&&(this.runningVpaid.vpaid.vpaidHandler.setPaused(!1),this.runningVpaid.vpaid.vpaidHandler.volume(this.VideoControls.getValueFromControlsState("volume")))),this.store.emit("playerStatusChanged",this.playerStatus)))}.bind(this)),this.store.on("AdPlayerHidden",function(){var e;this.playerIsClosed||(this.playerStatus="content",e={playerState:this.playerStatus,isVisible:!0},this.VideoControls&&(this.isMobile?(this.volume(0),this.VideoControls.setState(e)):(e.isPaused=this.wasContentPausedBeforeAd,this.VideoControls.setState(e),this.volume(this.VideoControls.getValueFromControlsState("volume"))),this.store.emit("playerStatusChanged",this.playerStatus)))}.bind(this)),this.playContentAfterFirstAd=function(){this.playContentBeforeAds||(this.playContentBeforeAds=!0,this.video.autoplay=!1,this._appendCotnentMediaFiles(this.video),this.target.appendChild(this.video),!this.isMobile||this.hasAutoPlay&&!this.store.get("dataSaver")||this._switchToCanvas(!0),this._shouldUseVideoControls()&&this.addVideoControls())},this.store.once("playContentAfterFirstAd",this.playContentAfterFirstAd.bind(this)),this.debugTracker=new d("OvaMediaPlayer"),this.debugTracker.info("unit-version: ".concat(this.store.get("unit_loader_version"),", player-version: ").concat(this.store.get("player_version")),this.store,{color:"#D15EFF"}),this.debugTracker.info("userAgent: ".concat(JSON.stringify(this.store.get("wurfl")))),this.seek=function(e){if(!this._isAdState()&&this.video.currentTime!==e)try{if(null==e)return this.video.currentTime;if(isNaN(parseFloat(e)))return;this.video.currentTime=parseFloat(e)}catch(e){return 0}},this.killAfterXWithNoConversion=function(){var e=this.store.get("kaxwnc");e&&(this.kaxwnc&&clearTimeout(this.kaxwnc),this.kaxwnc=setTimeout(function(){a.closeCleanPlayer("killAfterXWithNoConversion")},e))},this.killAfterXWithNoConversion(),this.play=function(){this.store.get("forcePause")||(this._isAdState()?this.vpaidHandler.vpaid.manager:this.video).play()},this.pause=function(){this._isAdState()?this.vpaidHandler.vpaid.manager.pause():(this.store.emit("contentPaused"),this.video.pause())},this.resume=function(){this._isAdState()?this.vpaidHandler.vpaid.manager.play():(this.store.emit("contentResumed"),"paused"==this.status&&this.video.play())},this.stop=function(){try{if("stopped"==this.status||this._isAdState())return;this.status="stopping",this.video.pause(),this.seek(0),this.status="stopped",this.options.onPlayerStop(this)}catch(e){}},this.resize=function(e,t,i){this.vpaidManager&&this.vpaidManager.resize(e,t);var s=0,n=0,r=0;try{null!=e&&!isNaN(parseInt(e))||(e=!1),null!=t&&!isNaN(parseInt(t))||(t=!1),e||t||(this.debugTracker.error("resize","No `height` or `width` specified!"),e=this.store.get("width"),t=this.store.get("height")),t&&e?(this.options.height=t+"",this.options.width=e+"",this.setVideoSize(-1<this.options.width.search(/px$/g)?this.options.width:this.options.width+"px",-1<this.options.height.search(/px$/g)?this.options.height:this.options.height+"px")):(i&&1<i.split(":").length&&(this.options.aspect_ratio=i),e?(this.options.height=!1,this.options.width=e+"",r=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],s=-1<this.options.width.search(/px$/g)?this.options.width:parseFloat(this.options.width)+"px",n=Math.floor(parseFloat(s)*r)+"px"):(this.options.width=!1,this.options.height=t+"",r=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],n=-1<this.options.height.search(/px$/g)?this.options.height:parseFloat(this.options.height)+"px",s=Math.floor(parseFloat(n)*r)+"px"),this.setVideoSize(s,n))}catch(e){this.debugTracker.error("resize","Resizing component failed!")}},this.setVideoSize=function(e,t){this.isMultiVpaidUnit||(this.store.get("noplrcntr")||(this.target.style.width=e,this.target.style.height=t,this.target.setAttribute("width",parseInt(e)),this.target.setAttribute("height",parseInt(t))),this.video.style.width=e,this.video.style.height=t,this.video.setAttribute("width",parseInt(e)),this.video.setAttribute("height",parseInt(t))),this.scheduleMaster.runningVpaid&&!this.scheduleMaster.runningVpaid.finished&&this.scheduleMaster.runningVpaid.resize(parseInt(e),parseInt(t))},this.handleTarget=function(e){e=this.store.get("noplrcntr")?document.querySelector(e):"string"==typeof e?document.getElementById(e):e;return e},this.stringToSeconds=function(e){for(var t=e.split(":"),i=[],s=0;s<t.length;s++)i.push(isNaN(parseInt(t[s]))?0:parseInt(t[s]));var n=0;switch(i.length){case 1:n=parseInt(e);break;case 2:n=60*parseInt(i[0])+parseInt(i[1]);break;case 3:n=3600*parseInt(i[1])+60*parseInt(i[1])+parseInt(i[2])}return n},this.secondsToString=function(e){var t=((e=Math.floor(e))-e%3600)/3600,i=((e-=3600*(t=t<10?"0"+t:t))-e%60)/60;return(0<t?t+":":"")+(i=i<10?"0"+i:i)+":"+(e=(e-=60*i)<10?"0"+e:e)},this.generateId=function(){for(var e="vpaid-"+Math.floor(65536*(1+Math.random()));document.getElementById(e);)e="vpaid-"+Math.floor(1e5*Math.random());return e},this.ova=new o(this,this.store),this.initVpaidManager=function(){pe("videoInitVpaidManager",Ee.START),this.vpaidManager=new Ss(this.store,this),pe("videoInitVpaidManager",Ee.STOP)},this.store.on("closePlayer",function(){t.closePlayer()}),this.initScheduleMaster=function(){this.scheduleMaster=new _s(this,this.store),this.store.get("vForce")&&this.scheduleMaster.disable()},this.initScheduleMaster(),this.handlePlayerPause=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":case"playing":this.status="paused",this.options.onPlayerPause(this);break;default:return}},this.handlePlayerPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading":this.status="loading-play";break;case"ended":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerPlay&&this.options.onPlayerPlay()}.bind(this),0);break;case"loading-play":case"stopped":case"paused":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerResume&&this.options.onPlayerResume()}.bind(this),0);break;default:return}},this._onPlayerRepeat=function(){this.repeatCount++},this.handleOnCanPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":this.status="playing",this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0),window.setTimeout(function(){this.options.onPlayerPlay()}.bind(this),0);break;case"loading":this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0);break;default:return}},this.handlePlayerEnd=function(){if(!this.playerIsClosed)switch(this.store.emit("contentChanged"),this.status){case"playing":window.setTimeout(function(){this.options.onPlayerPause()}.bind(this),0);case"paused":this.status="ended",this.options.repeat?window.setTimeout(function(e){e.play()}.bind(this,this.video),0):(this.options.onPlayerComplete(this),this.options.onPlayerStop(this));break;default:return}},this.handlePlayerSeeked=function(e){this.playerIsClosed||window.setTimeout(function(){this.options.onPlayerSeek()}.bind(this),0)},this.handlePlayerError=function(e){this.status="stopping",this.video.pause(),this.status="loading",this.options.onPlayerError(this,e)},this.handlePlayerVolume=function(){this.debugTracker.info("Event","Player Volume Was Changed!")},this.muteToggle=function(){this.options.mute?this.unMute():this.mute()},this.mute=function(){this._isAdState()?this.vpaidHandler.vpaid.manager.mute():(this.video.muted=this.options.mute=!0,this.vpaidManager&&this.vpaidManager.mute(),this.volume(0))},this.unMute=function(){this._isAdState()?this.vpaidHandler.vpaid.manager.unmute():(this.video.muted=this.options.mute=!1,this.vpaidManager&&this.vpaidManager.unmute(1<this.options.volume?this.options.volume/100:this.options.volume),this.volume(this.options.volumeBeforeMute))},this.volume=function(e){if("stopped"!=this.status&&!(this.store.get("forceMute")&&0<e))return this.vpaidManager&&this.vpaidManager.volume(e),null==e?this._getCurrentVolume():this.options.videoControlsForceMute&&0<e?void 0:(0===e&&0!=this.options.volume&&(this.options.volumeBeforeMute=this.options.volume),0==(e=1<(this.options.volume=e)?e/100:e)?(this.video.muted=this.options.mute=!0,this.video.volume=0):(this.video.muted=this.options.mute=!1,this.video.volume=e),a.store.set("volume",e),this.VideoControls&&this.VideoControls.setState({volume:e}),e)},this._getCurrentVolume=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getCurrentWorkingVpaidVolume():this.options.volume},this.onPlayerReadyRun=function(){var e=this.onPlayerReadyActions.length;if(0!=e){for(var t=0;t<e;t++)this.onPlayerReadyActions[t].apply(this,[]);this.onPlayerReadyActions=new Array}},this.onPlayerReadyActions=new Array,this.attachEventsToVideo=function(e){var i=this,s=this,t=function e(t){e.player.handlePlayerSeeked(t)};t.player=this,e.addEventListener("seeked",t,!0);t=function e(){e.player.handleOnCanPlay()};t.player=this,e.addEventListener("canplay",t,!0);t=function e(){e.player.handlePlayerPlay()};t.player=this,e.addEventListener("play",t,!0);t=function e(){e.player.handlePlayerPause()};t.player=this,e.addEventListener("pause",t,!0);t=function e(){e.player.handlePlayerEnd()};t.player=this,e.addEventListener("ended",t,!0);t=function(e){s.isMobile||s.handlePlayerError(e)},s=t.player=this;e.addEventListener("error",t,!0),e.addEventListener("click",function(){0===e.currentTime&&this.store.get("dataSaverDetected")&&(e.play(),s.VideoControls&&s.VideoControls.setState({isPaused:!1}))}),this.contentInterval=setInterval(function(){var e=s.video.currentTime,t=s.video.duration;i.store.set("contentTime",e),i.store.set("contentDuration",t)},5e3)},this._switchToCanvas=function(e){var t,i=this;this.fallbackToCanvasFired||this.playerOpportunityManager.send(l.a.fallBackCanvas),this._shouldPlayContent()&&(t="",this.video.src?t=this.video.src:this.options.files.map(function(e){t||/\.mpg$/.test(e.url)||/\.mpeg$/.test(e.url)||(t=e.url)}),this.video.addEventListener("canvasToVideo",this._onNewVidCreated.bind(this)),setTimeout(function(){i.video._vidSetAttr("src",""),setTimeout(function(){i.video.forceCanvas&&(i.video.setAttribute("src",t),i.video.style.display="none",e||i.handleOnCanPlay())},2e3)},2))},this.createMediaPlayer=function(){var e=this;this.store.get("noplrcntr")||(this.target.className+=" vpaid-player-container",this.isMultiVpaidUnit&&j(this.target,"multi-vpaids"));var t,i=re(this.store,{target:this.target,onCanvasUsage:function(){setTimeout(function(){e._switchToCanvas()})},additionalCss:{position:"absolute",zIndex:102}});(this.playerTag=i).id=this.generateId(),i.className=this.options.video_class_name,this.isMultiVpaidUnit&&j(i,"multi-vpaids"),i.style.cssText="position: relative; z-index:99; cursor:pointer; display:block",this._preventAutoplay||i.setAttribute("autoplay",""),this.isMobile&&!i.forceCanvas&&"iOS"===this.store.get("wurfl.os.name")&&i.removeAttribute("autoplay",""),this.attachEventsToVideo(i),this.isMultiVpaidUnit&&(this.options.height||this.options.width?this.options.height&&this.options.width?(i.style.height=-1<this.options.height.search(/px$/g)?this.options.height:this.options.height+"px",i.style.width=-1<this.options.width.search(/px$/g)?this.options.width:this.options.width+"px"):this.options.width?(t=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],i.style.width=-1<this.options.width.search(/px$/g)?this.options.width:parseFloat(this.options.width)+"px",i.style.height=Math.floor(parseFloat(i.style.width)*t)+"px"):(t=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],i.style.height=-1<this.options.height.search(/px$/g)?this.options.height:parseFloat(this.options.height)+"px",i.style.width=Math.floor(parseFloat(i.style.height)*t)+"px"):this.debugTracker.error("createMediaPlayer","No `height` or `width` specified!")),i.muted=!0,i.setAttribute("width",parseFloat(i.style.width)+""),i.setAttribute("height",parseFloat(i.style.height)+""),i.setAttribute("playsinline","");var s=this;setTimeout(function(){try{s.handleOnCanPlay()}catch(e){}},200),this.options.repeat&&(i.playerRepeat=!0),this.options.image&&i.setAttribute("poster",this.options.image),i=this._appendCotnentMediaFiles(i),this._shouldPlayContent()&&this.target.appendChild(i),this.video=i,this.store.get("noplrcntr")||(this.target.id="_cm-css-reset"),this.isMobile&&!this.hasAutoPlay||(i.volume=this.options.volume/100);i=this._shouldUseVideoControls();this.store.set("useVideoControls",!0),i&&this._shouldPlayContent()&&this.addVideoControls(),this.volume(this.options.mute?0:this.options.volume),this.setVideoSize(n.width+"px",n.height+"px"),this.VideoControls&&this.VideoControls.setState({playerState:this.playerStatus})},this._shouldUseVideoControls=function(){return!this.isMobile&&(this.options.controls||this.store.get("ad_controls"))||this.isMobile&&this.options.controls},this._appendCotnentMediaFiles=function(e){try{if(this._shouldPlayContent())for(var t=0;t<this.options.files.length;t++){var i,s=this.options.files[t];/\.mpg$/.test(s.url)||/\.mpeg$/.test(s.url)||(!this.isMobile||this.hasAutoPlay&&!this.store.get("dataSaver")?((i=document.createElement("source")).setAttribute("type",s.type),i.src=s.url,e.name||(e.name=s.name||s.url),e.appendChild(i)):e.src=s.url)}}catch(e){this.debugTracker.error("createMediaPlayer","Files array supplied is corrupted or malformed!")}return e},this.playContentBeforeAds=this.store.get("plcntbfrads"),this._shouldPlayContent=function(){return this.store.get("vForce")?this.store.get("cntonvfrc"):this.playContentBeforeAds},this._onNewVidCreated=function(e){this.video.parentElement.removeChild(this.video),this.video=e.data.videoElement,this.VideoControls&&this.VideoControls.setVideo(this.video)},this.addVideoControls=function(){this.VideoControls=new Se(this.video,this.store,this.target,"content"),this.store.on("videoControlsVolume",this._onVideoControlVolumeChanged.bind(this)),this.store.on("volumeBeforeMuteChanged",this._onVideoControlsVolumeBeforeMuteChanged.bind(this)),this.isMobile||(this.store.on("videoControlsMute",this._onVideoControlMuteChanged.bind(this)),this.store.on("videoControlsPause",this._onVideoControlPauseChanged.bind(this)),this.store.on("videoProgressBar",this._onVideoProgressBarChanged.bind(this)))},this._onVideoControlsVolumeBeforeMuteChanged=function(e){this.options.volumeBeforeMute=e},this._isAdState=function(){return"ad"===this.playerStatus},this._onVideoControlMuteChanged=function(e){this.options.videoControlsForceMute=e,this.store.set("forceMute",e),e?this.mute():this.unMute()},this._onVideoControlVolumeChanged=function(e){this.options.videoControlsForceMute=!1,this.store.set("forceMute",0===e),this.volume(e)},this._onVideoControlPauseChanged=function(e){this.store.set("forcePause",e),e?this.pause():this.video.currentTime===this.video.duration?this.play():this.resume()},this._onVideoProgressBarChanged=function(e){this._isAdState()||(e=Math.floor(e*this.video.duration),this.store.emit("videoProgressBarTransition",this.video.duration,e),this.video.currentTime=e)},this.onVpaidCreated=function(e){this.runningVpaid=e,this.vpaidHandler=e}.bind(this),this.store.on("vpaidHandlerCreated",this.onVpaidCreated),this.ga={sendGaMessage:function(){}};a=this;this.createGA=function(){},this.removeGA=function(){this.ga_set},this.convertPreMidPostToTime=function(e,t){var t=Math.round(t),i={},s=this.options.schedule_auto,n=void 0;if(null==(n=0<e["pre-roll"].length?e["pre-roll"][0]:0<e["mid-roll"].length?e["mid-roll"][0]:0<e["post-roll"].length?e["post-roll"][0]:void 0))return this.debugTracker.error("PreMidPostToTime","Error creating automatic schedule!Pleace check the schedule preset!"),{};i["00:00"]=n;var r=[];0<e["mid-roll"].length?r=e["mid-roll"]:0<e["post-roll"].length?r=e["post-roll"]:r.push(n);for(var a=void 0,a=(0<e["post-roll"].length?e["post-roll"]:r)[0];s<t;){var o=this.secondsToString(s),d=r.shift();r.push(d),s+=this.options.schedule_auto,i[o]=d=t<s?a:d}return i},this.createSchedule=function(){if(!this.scheduleCreated&&!this.store.get("vForce")){this.scheduleCreated=!0,this.videoLength=this.video.duration,this.videoLength=this.videoLength||120;var e=this.options.schedule,t={},i=this.options.schedule_auto;0===this.options.schedule_auto&&(this.options.schedule_auto=1);for(var s=0;s<e.length;s++){var n=e[s];if(this.options.schedule_auto)t[n.roll_type]||(t[n.roll_type]=[]),t[n.roll_type].push(n);else for(var r=0;r<n.positions.length;r++)!t[n.positions[r]]&&this.videoLength-this.options.min_vpaid_run_time>this.stringToSeconds(n.positions[r])&&(t[n.positions[r]]=n)}this.options.schedule_auto&&(t["pre-roll"]||(t["pre-roll"]=[]),t["mid-roll"]||(t["mid-roll"]=[]),t["post-roll"]||(t["post-roll"]=[]),t=this.convertPreMidPostToTime(t,this.videoLength)),this.options.schedule_auto=i,this.scheduleMaster.schedule=t,this.store.set("contentSchedule",t),this.scheduleMaster.start()}},this.setVideoFile=function(e,t,i){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);t?this.video.setAttribute("poster",t):this.video.removeAttribute("poster"),i?(this.status="loading",this._preventAutoplay||this.video.setAttribute("autoplay","true")):this.video.removeAttribute("autoplay");try{this.video.removeAttribute("src");for(var s=0;s<e.length;s++){var n=e[s],r=document.createElement("source");r.setAttribute("type",n.type),r.src=n.url,this.video.name||(this.video.name=n.name||n.url),this.video.appendChild(r)}this.video.load()}catch(e){this.debugTracker.error("setVideoFile","Error creating video sources!")}},this._onVpaidClosed=function(){},this._pausePlayer=function(){this.scheduleMaster.stop(!0),this.seek(0),this.stop(),this.store.emit("pausePlayer")},this.closePlayer=function(){this._onVpaidClosed=this.closeCleanPlayer.bind(this,"_onVpaidClosed"),this.options.onPlayerClose(this),this.scheduleMaster.stop()},this.closeCleanPlayer=function(e){var t=this;this.store.set("playerClosed",!0),setTimeout(function(){if(e=e||"none",t.store.emit("stop","close:"+e),!t.playerIsClosed){if(clearInterval(t.contentInterval),t.vpaidManager&&t.vpaidManager.stop(),t.VideoControls&&t.VideoControls.destroy(),t.dependenciesLoader&&t.dependenciesLoader.destroy(),t.playerIsClosed=!0,t._onVpaidClosed=function(){},t.stop(),t.removeGA(),!t.store.get("noplrcntr"))for(;t.target.childNodes.length;)t.target.removeChild(t.target.childNodes[0]);t.competitionDetector&&t.competitionDetector.destroy(),t.onPlayerReadyActions=t.debugTracker=t.video=t.schedule=t.ova=t.ga=t.scheduleMaster=t.KPIsRecorder=t.VideoControls=void 0,t.options=t.target=void 0}},0)},this.target=this.handleTarget(n.target_id),this.target&&this.target.appendChild?(this.store.set("can_opt_out",this.store.get("can_opt_out")||null!==this.target.parentElement.querySelector("#_cm-opt-out-view")),this.options.htmlVideoSupport?this.createMediaPlayer():(this.debugTracker.error("Constructor","Browser does not support <video> Tag!Nothing to do, aborting..."),this.options.onPlayerLoadError(this)),this.store.get("base_url"),this.set=function(e,t){this.store.set(e,t)},this.get=function(e){return this.store.get(e)},this.on=function(e,t){this.store.on(e,t)},this.off=function(e,t){this.store.off(e,t)},this.getVpaidLogs=function(){return this.vpaidManager?this.vpaidManager.getVpaidLogs():this.scheduleMaster?this.scheduleMaster.getVpaidLogs():void 0},this.startWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.start()}catch(e){return!1}return!0},this.stopWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.stop()}catch(e){return!1}return!0},this.emit=function(e,t){e&&this.store.emit(e,t)},/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&setTimeout(function(){a.handleOnCanPlay()},500),this.store.get("vForce")&&this.initVpaidManager(),this.getAd=function(e){if(this.vpaidManager)return this.vpaidManager.getAd(e)},this.startIdleMode=function(){this.store.set("isIdleMode",!0)},this.stopIdleMode=function(){this.store.set("isIdleMode",!1)},this.startWf=function(){this.store.emit("startWf")},this.getPlayerDAST=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getPlayerDAST():""},this.dropAds=function(e){this.vpaidHandler.vpaid.manager.cleanQueue(this.store.get("queue_size")||10,e),this.vpaidHandler.vpaid.waterfallManager.dropAds(e)},this.setDebugData=function(e){this.store.set("debugStr",e)},this.setDebugDataFunc=function(e){this.store.set("debugDataFunc",e)},this.addWfParameter=function(e,t){this.vpaidHandler.vpaid.waterfallManager.addWfParameter(e,t)},this.updateWfParameter=function(e,t){this.vpaidHandler.vpaid.waterfallManager.updateWfParameter(e,t)},this.removeWfParameter=function(e){this.vpaidHandler.vpaid.waterfallManager.removeWfParameter(e)}):this.debugTracker.error("Constructor","No player target!Can't build player in ["+this.target+"]... aborting!")}window.OvaMediaPlayer=Gs}])}catch(e){}